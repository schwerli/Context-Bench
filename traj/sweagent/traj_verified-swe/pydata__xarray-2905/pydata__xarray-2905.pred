{"model_name_or_path": "output", "instance_id": "pydata__xarray-2905", "model_patch": "diff --git a/repro_hasvalues.py b/repro_hasvalues.py\nnew file mode 100644\nindex 00000000..5dd4a463\n--- /dev/null\n+++ b/repro_hasvalues.py\n@@ -0,0 +1,23 @@\n+import sys\n+import os\n+# Ensure local xarray is used\n+sys.path.insert(0, os.path.dirname(__file__))\n+import xarray as xr\n+\n+class HasValues(object):\n+    values = 5\n+\n+# Create two object dtype DataArrays with a None placeholder\n+good_indexed = xr.DataArray([None])\n+bad_indexed = xr.DataArray([None])\n+\n+# Assign set() and a HasValues instance into the first element via .loc\n+good_indexed.loc[{good_indexed.dims[0]: 0}] = set()\n+bad_indexed.loc[{bad_indexed.dims[0]: 0}] = HasValues()\n+\n+print('good_indexed.values:', good_indexed.values, good_indexed.values.dtype)\n+print('bad_indexed.values:', bad_indexed.values, bad_indexed.values.dtype)\n+\n+# Check expected conditions\n+print('good is set instance:', isinstance(good_indexed.values[0], set))\n+print('bad is HasValues instance:', isinstance(bad_indexed.values[0], HasValues))\ndiff --git a/xarray/core/variable.py b/xarray/core/variable.py\nindex 45553eb9..2336ba3a 100644\n--- a/xarray/core/variable.py\n+++ b/xarray/core/variable.py\n@@ -218,7 +218,19 @@ def as_compatible_data(data, fastpath=False):\n         data = np.timedelta64(getattr(data, \"value\", data), \"ns\")\n \n     # we don't want nested self-described arrays\n-    data = getattr(data, \"values\", data)\n+    # Only unwrap known array-like container types (pandas objects or xarray DataArray).\n+    # Avoid blindly accessing a generic object's `.values` attribute to prevent\n+    # coercing arbitrary Python objects that happen to define `.values`.\n+    if isinstance(data, (pd.Series, pd.DataFrame, xr.DataArray)):\n+        data = data.values\n+    elif hasattr(data, \"values\"):\n+        # Only unwrap if .values looks like an array (to preserve ability to store\n+        # arbitrary Python objects that merely define a .values attribute)\n+        v = data.values\n+        if isinstance(v, np.ndarray) or (\n+            hasattr(v, \"shape\") and hasattr(v, \"dtype\")\n+        ):\n+            data = v\n \n     if isinstance(data, np.ma.MaskedArray):\n         mask = np.ma.getmaskarray(data)\n"}