{"model_name_or_path": "output", "instance_id": "django__django-12262", "model_patch": "diff --git a/django/template/library.py b/django/template/library.py\nindex 20bc86dac8..df96e6e732 100644\n--- a/django/template/library.py\n+++ b/django/template/library.py\n@@ -261,26 +261,25 @@ def parse_bits(parser, bits, params, varargs, varkw, defaults,\n         if kwarg:\n             # The kwarg was successfully extracted\n             param, value = kwarg.popitem()\n-            if param not in params and param not in unhandled_kwargs and varkw is None:\n-                # An unexpected keyword argument was supplied\n+            # If the keyword was already provided, report a multiple values error.\n+            if param in kwargs:\n                 raise TemplateSyntaxError(\n-                    \"'%s' received unexpected keyword argument '%s'\" %\n+                    \"'%s' received multiple values for keyword argument '%s'\" %\n                     (name, param))\n-            elif param in kwargs:\n-                # The keyword argument has already been supplied once\n+            # Accept keywords that correspond to positional args, keyword-only args,\n+            # or any keyword when **kwargs is present. Otherwise, it's unexpected.\n+            if param not in params and param not in kwonly and varkw is None:\n                 raise TemplateSyntaxError(\n-                    \"'%s' received multiple values for keyword argument '%s'\" %\n+                    \"'%s' received unexpected keyword argument '%s'\" %\n                     (name, param))\n-            else:\n-                # All good, record the keyword argument\n-                kwargs[str(param)] = value\n-                if param in unhandled_params:\n-                    # If using the keyword syntax for a positional arg, then\n-                    # consume it.\n-                    unhandled_params.remove(param)\n-                elif param in unhandled_kwargs:\n-                    # Same for keyword-only arguments\n-                    unhandled_kwargs.remove(param)\n+            # All good, record the keyword argument\n+            kwargs[str(param)] = value\n+            if param in unhandled_params:\n+                # If using the keyword syntax for a positional arg, then consume it.\n+                unhandled_params.remove(param)\n+            elif param in unhandled_kwargs:\n+                # Same for required keyword-only arguments\n+                unhandled_kwargs.remove(param)\n         else:\n             if kwargs:\n                 raise TemplateSyntaxError(\ndiff --git a/mytags.py b/mytags.py\nnew file mode 100644\nindex 0000000000..e07db5013d\n--- /dev/null\n+++ b/mytags.py\n@@ -0,0 +1,12 @@\n+from django.template import Library\n+register = Library()\n+@register.simple_tag\n+def hello(*, greeting='hello'):\n+    return f\"{greeting} world\"\n+@register.simple_tag\n+def hi(*, greeting):\n+    return f\"{greeting} world\"\n+\n+@register.simple_tag\n+def kwvar_only(*, greeting='hello', **kwargs):\n+    return f\"{greeting}:{kwargs.get('x', '-')}\"\ndiff --git a/repro_template_kwonly.py b/repro_template_kwonly.py\nnew file mode 100644\nindex 0000000000..b000f57ec3\n--- /dev/null\n+++ b/repro_template_kwonly.py\n@@ -0,0 +1,53 @@\n+import sys\n+sys.path.insert(0, '/testbed')\n+\n+from django.template.engine import Engine\n+from django.template.context import Context\n+from django.template.exceptions import TemplateSyntaxError\n+\n+# Create a simple tag library in a separate module path so Engine can import it.\n+# We'll write it to /testbed/mytags.py from this script only once, but since\n+# the repository is static here, ensure it's present separately if needed.\n+# Instead, we assume mytags.py exists or create it here dynamically by import.\n+\n+# Ensure the custom tags module exists.\n+import os\n+module_path = '/testbed/mytags.py'\n+if not os.path.exists(module_path):\n+    with open(module_path, 'w') as f:\n+        f.write(\n+            'from django.template import Library\\n'\n+            'register = Library()\\n'\n+            '@register.simple_tag\\n'\n+            'def hello(*, greeting=\\'hello\\'):\\n'\n+            '    return f\\\"{greeting} world\\\"\\n'\n+            '@register.simple_tag\\n'\n+            'def hi(*, greeting):\\n'\n+            '    return f\\\"{greeting} world\\\"\\n'\n+        )\n+\n+engine = Engine(builtins=['mytags'])\n+\n+# Case 1: keyword-only with default should be allowed and render properly.\n+try:\n+    t1 = engine.from_string(\"{% hello greeting='hi' %}\")\n+    out1 = t1.render(Context({}))\n+    print('CASE1_OK', out1)\n+except TemplateSyntaxError as e:\n+    print('CASE1_ERR', e)\n+\n+# Case 2: duplicate keyword should raise multiple values error, not unexpected.\n+try:\n+    t2 = engine.from_string(\"{% hi greeting='hi' greeting='hello' %}\")\n+    out2 = t2.render(Context({}))\n+    print('CASE2_OK', out2)\n+except TemplateSyntaxError as e:\n+    print('CASE2_ERR', e)\n+\n+# Case 3: keyword-only without default missing should raise did not receive value.\n+try:\n+    t3 = engine.from_string(\"{% hi %}\")\n+    out3 = t3.render(Context({}))\n+    print('CASE3_OK', out3)\n+except TemplateSyntaxError as e:\n+    print('CASE3_ERR', e)\n"}