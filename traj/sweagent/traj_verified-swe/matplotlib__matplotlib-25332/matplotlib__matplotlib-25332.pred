{"model_name_or_path": "output", "instance_id": "matplotlib__matplotlib-25332", "model_patch": "diff --git a/lib/matplotlib/cbook.py b/lib/matplotlib/cbook.py\nindex c9699b2e21..3c918ef859 100644\n--- a/lib/matplotlib/cbook.py\n+++ b/lib/matplotlib/cbook.py\n@@ -799,6 +799,28 @@ class Grouper:\n             val = mapping.pop(key)\n             val.remove(key)\n \n+    def __getstate__(self):\n+        \"\"\"\n+        Return a picklable representation of the groups.\n+\n+        Weak references are not picklable; store the grouped objects instead,\n+        and reconstruct weak references on unpickle.\n+        \"\"\"\n+        self.clean()\n+        unique_groups = {id(group): group for group in self._mapping.values()}\n+        groups = [[x() for x in group if x() is not None]\n+                  for group in unique_groups.values()]\n+        return {\"_groups\": groups}\n+\n+    def __setstate__(self, state):\n+        groups = state.get(\"_groups\", [])\n+        self._mapping = {}\n+        for group in groups:\n+            # Filter out any Nones just in case\n+            refs = [weakref.ref(x) for x in group if x is not None]\n+            for ref in refs:\n+                self._mapping[ref] = refs\n+\n     def join(self, a, *args):\n         \"\"\"\n         Join given arguments into the same set.  Accepts one or more arguments.\ndiff --git a/repro_align_pickle.py b/repro_align_pickle.py\nnew file mode 100644\nindex 0000000000..f62aebd16e\n--- /dev/null\n+++ b/repro_align_pickle.py\n@@ -0,0 +1,37 @@\n+import sys\n+sys.path.insert(0, '/testbed/lib')\n+import matplotlib\n+import matplotlib.pyplot as plt\n+import pickle\n+\n+fig = plt.figure()\n+ax1 = fig.add_subplot(211)\n+ax2 = fig.add_subplot(212)\n+\n+# Some sample data\n+time=[0,1,2,3,4]\n+speed=[40000,4300,4500,4700,4800]\n+acc=[10,11,12,13,14]\n+ax1.plot(time,speed)\n+ax1.set_ylabel('speed')\n+ax2.plot(time,acc)\n+ax2.set_ylabel('acc')\n+\n+fig.align_labels()\n+\n+# Try to pickle\n+print('Attempting to pickle figure...')\n+try:\n+    data = pickle.dumps(fig)\n+    print('Pickle success, size:', len(data))\n+except Exception as e:\n+    print('Pickle failed:', type(e).__name__, e)\n+\n+\n+# Try unpickling too\n+print('Attempting to unpickle figure...')\n+try:\n+    fig2 = pickle.loads(data)\n+    print('Unpickle success. Axes:', len(fig2.axes))\n+except Exception as e:\n+    print('Unpickle failed:', type(e).__name__, e)\n"}