{"model_name_or_path": "output", "instance_id": "sympy__sympy-17139", "model_patch": "diff --git a/sympy/simplify/fu.py b/sympy/simplify/fu.py\nindex ad1130ef9..ddfffa64b 100644\n--- a/sympy/simplify/fu.py\n+++ b/sympy/simplify/fu.py\n@@ -501,25 +501,29 @@ def _f(rv):\n         if not (rv.is_Pow and rv.base.func == f):\n             return rv\n \n-        if (rv.exp < 0) == True:\n+        e = rv.exp\n+        # Only handle nonnegative integer exponents up to 'max'.\n+        if not getattr(e, 'is_Integer', False):\n             return rv\n-        if (rv.exp > max) == True:\n+        if e < 0:\n             return rv\n-        if rv.exp == 2:\n+        if e > max:\n+            return rv\n+        if e == 2:\n             return h(g(rv.base.args[0])**2)\n         else:\n-            if rv.exp == 4:\n-                e = 2\n+            if e == 4:\n+                ee = 2\n             elif not pow:\n-                if rv.exp % 2:\n+                if e % 2:\n                     return rv\n-                e = rv.exp//2\n+                ee = e//2\n             else:\n-                p = perfect_power(rv.exp)\n+                p = perfect_power(e)\n                 if not p:\n                     return rv\n-                e = rv.exp//2\n-            return h(g(rv.base.args[0])**2)**e\n+                ee = e//2\n+            return h(g(rv.base.args[0])**2)**ee\n \n     return bottom_up(rv, _f)\n \n"}