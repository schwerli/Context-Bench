{"model_name_or_path": "output", "instance_id": "django__django-15375", "model_patch": "diff --git a/django/db/models/aggregates.py b/django/db/models/aggregates.py\nindex 8c4eae7906..95c80cf39e 100644\n--- a/django/db/models/aggregates.py\n+++ b/django/db/models/aggregates.py\n@@ -65,7 +65,10 @@ class Aggregate(Func):\n         if hasattr(default, 'resolve_expression'):\n             default = default.resolve_expression(query, allow_joins, reuse, summarize)\n         c.default = None  # Reset the default argument before wrapping.\n-        return Coalesce(c, default, output_field=c._output_field_or_none)\n+        coalesce = Coalesce(c, default, output_field=c._output_field_or_none)\n+        # Preserve summary flag so aggregation with default works in subqueries.\n+        coalesce.is_summary = c.is_summary\n+        return coalesce\n \n     @property\n     def default_alias(self):\ndiff --git a/repro_default_after_annotate.py b/repro_default_after_annotate.py\nnew file mode 100644\nindex 0000000000..807fd769da\n--- /dev/null\n+++ b/repro_default_after_annotate.py\n@@ -0,0 +1,56 @@\n+import django\n+from django.conf import settings\n+\n+# Minimal settings\n+settings.configure(\n+    INSTALLED_APPS=[\n+        'django.contrib.contenttypes',\n+    ],\n+    DATABASES={\n+        'default': {\n+            'ENGINE': 'django.db.backends.sqlite3',\n+            'NAME': ':memory:',\n+        }\n+    },\n+    SECRET_KEY='test',\n+)\n+\n+django.setup()\n+\n+from django.db import connection\n+from django.db import models\n+from django.db.models import F, Sum\n+\n+# Define a simple model without creating an actual app module by using app_label\n+class Book(models.Model):\n+    id = models.AutoField(primary_key=True)\n+    title = models.CharField(max_length=100, null=True)\n+    class Meta:\n+        app_label = 'myapp'\n+\n+# Create table\n+with connection.schema_editor() as schema:\n+    schema.create_model(Book)\n+\n+# Insert some rows\n+Book.objects.create(title='A')\n+Book.objects.create(title='B')\n+Book.objects.create(title='C')\n+\n+print('Count:', Book.objects.count())\n+print('Annotate then aggregate without default:')\n+print(Book.objects.annotate(idx=F('id')).aggregate(Sum('id')))\n+\n+print('Annotate then aggregate with default:')\n+try:\n+    print(Book.objects.annotate(idx=F('id')).aggregate(Sum('id', default=0)))\n+except Exception as e:\n+    import traceback\n+    traceback.print_exc()\n+\n+\n+# Test with empty table\n+Book.objects.all().delete()\n+print('Count after delete:', Book.objects.count())\n+print('Annotate then aggregate with default on empty set:')\n+print(Book.objects.annotate(idx=F('id')).aggregate(Sum('id', default=0)))\n"}