{"model_name_or_path": "output", "instance_id": "django__django-15368", "model_patch": "diff --git a/django/db/models/query.py b/django/db/models/query.py\nindex f8d848e926..a5ed25a53e 100644\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -670,7 +670,9 @@ class QuerySet:\n                 when_statements = []\n                 for obj in batch_objs:\n                     attr = getattr(obj, field.attname)\n-                    if not isinstance(attr, Expression):\n+                    # Treat any object with a resolve_expression method as an expression\n+                    # (e.g., F objects), otherwise wrap literal values in Value().\n+                    if not hasattr(attr, 'resolve_expression'):\n                         attr = Value(attr, output_field=field)\n                     when_statements.append(When(pk=obj.pk, then=attr))\n                 case_statement = Case(*when_statements, output_field=field)\ndiff --git a/repro_bulk_update_f.py b/repro_bulk_update_f.py\nnew file mode 100644\nindex 0000000000..6ce2614dd0\n--- /dev/null\n+++ b/repro_bulk_update_f.py\n@@ -0,0 +1,57 @@\n+import os\n+import django\n+from django.conf import settings\n+\n+# Minimal settings\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        SECRET_KEY='x',\n+        DATABASES={\n+            'default': {\n+                'ENGINE': 'django.db.backends.sqlite3',\n+                'NAME': ':memory:',\n+            }\n+        },\n+        INSTALLED_APPS=[\n+            'django.contrib.contenttypes',\n+        ],\n+        DEFAULT_AUTO_FIELD='django.db.models.AutoField',\n+    )\n+\n+django.setup()\n+\n+from django.db import connection\n+from django.db import models\n+from django.db.models import F\n+\n+class SelfRef(models.Model):\n+    name = models.CharField(max_length=100)\n+    c8 = models.CharField(max_length=100)\n+\n+    class Meta:\n+        app_label = 'exampleapp'\n+        db_table = 'exampleapp_selfref'\n+\n+# Create the table\n+with connection.schema_editor() as schema_editor:\n+    schema_editor.create_model(SelfRef)\n+\n+# Create a row\n+obj = SelfRef.objects.create(name='John', c8='init')\n+\n+# Assign F expression and bulk update\n+obj.c8 = F('name')\n+updated = SelfRef.objects.bulk_update([obj], ['c8'])\n+print('rows updated:', updated)\n+\n+# Refresh and print value\n+obj.refresh_from_db()\n+print('c8 value:', obj.c8)\n+\n+# Show the last few queries\n+from django.db import connections\n+queries = connections['default'].queries\n+print('Last queries:')\n+for q in queries[-5:]:\n+    print(q['sql'])\ndiff --git a/repro_bulk_update_plain.py b/repro_bulk_update_plain.py\nnew file mode 100644\nindex 0000000000..3321701240\n--- /dev/null\n+++ b/repro_bulk_update_plain.py\n@@ -0,0 +1,35 @@\n+import os\n+import django\n+from django.conf import settings\n+\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        SECRET_KEY='x',\n+        DATABASES={'default': {'ENGINE': 'django.db.backends.sqlite3', 'NAME': ':memory:'}},\n+        INSTALLED_APPS=['django.contrib.contenttypes'],\n+        DEFAULT_AUTO_FIELD='django.db.models.AutoField',\n+    )\n+\n+django.setup()\n+\n+from django.db import connection\n+from django.db import models\n+\n+class M(models.Model):\n+    a = models.CharField(max_length=10)\n+    b = models.CharField(max_length=10)\n+    class Meta:\n+        app_label = 'app'\n+        db_table = 'app_m'\n+\n+with connection.schema_editor() as se:\n+    se.create_model(M)\n+\n+objs = [M(a='x', b='y'), M(a='u', b='v')]\n+M.objects.bulk_create(objs)\n+objs = list(M.objects.all())\n+objs[0].b = 'new'\n+objs[1].b = 'other'\n+M.objects.bulk_update(objs, ['b'])\n+print(list(M.objects.values_list('a','b')))\n"}