{"model_name_or_path": "output", "instance_id": "matplotlib__matplotlib-25311", "model_patch": "diff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 1dee8a23d9..c5efe3ad72 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -1514,6 +1514,16 @@ class DraggableBase:\n                 'button_release_event', self.on_release),\n         ]\n \n+    def __getstate__(self):\n+        # Drop backend-specific canvas and callback ids to make pickling safe\n+        # across interactive backends (e.g., FigureCanvasQTAgg).\n+        state = self.__dict__.copy()\n+        state.pop('canvas', None)\n+        state.pop('cids', None)\n+        state.pop('_c1', None)\n+        state.pop('background', None)\n+        return state\n+\n     def on_motion(self, evt):\n         if self._check_still_parented() and self.got_artist:\n             dx = evt.x - self.mouse_x\ndiff --git a/repro_pickle_draggable.py b/repro_pickle_draggable.py\nnew file mode 100644\nindex 0000000000..4d01338b98\n--- /dev/null\n+++ b/repro_pickle_draggable.py\n@@ -0,0 +1,22 @@\n+import sys\n+sys.path.insert(0, '/testbed/lib')\n+import matplotlib.pyplot as plt\n+import pickle\n+\n+fig = plt.figure()\n+ax = fig.add_subplot(111)\n+\n+time=[0,1,2,3,4]\n+speed=[40,43,45,47,48]\n+\n+ax.plot(time,speed,label=\"speed\")\n+\n+leg=ax.legend()\n+leg.set_draggable(True)  # pickling fails before fix\n+\n+try:\n+    pickle.dumps(fig)\n+    print(\"Pickling figure with draggable legend: SUCCESS\")\n+except Exception as e:\n+    print(\"Pickling figure with draggable legend: FAILED\")\n+    print(type(e).__name__ + \":\", e)\ndiff --git a/repro_pickle_draggable_annotation.py b/repro_pickle_draggable_annotation.py\nnew file mode 100644\nindex 0000000000..c1fa9fa3ba\n--- /dev/null\n+++ b/repro_pickle_draggable_annotation.py\n@@ -0,0 +1,16 @@\n+import sys\n+sys.path.insert(0, '/testbed/lib')\n+import matplotlib.pyplot as plt\n+import pickle\n+\n+fig, ax = plt.subplots()\n+ax.plot([0,1,2],[0,1,0])\n+ann = ax.annotate('here', xy=(1,1))\n+ann.draggable(True)\n+\n+try:\n+    pickle.dumps(fig)\n+    print(\"Pickling figure with draggable annotation: SUCCESS\")\n+except Exception as e:\n+    print(\"Pickling figure with draggable annotation: FAILED\")\n+    print(type(e).__name__ + \":\", e)\n"}