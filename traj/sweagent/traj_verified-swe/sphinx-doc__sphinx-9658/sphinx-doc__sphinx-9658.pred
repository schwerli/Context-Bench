{"model_name_or_path": "output", "instance_id": "sphinx-doc__sphinx-9658", "model_patch": "diff --git a/repro.py b/repro.py\nnew file mode 100644\nindex 000000000..999c3819a\n--- /dev/null\n+++ b/repro.py\n@@ -0,0 +1,32 @@\n+import sys\n+sys.path.insert(0, '/testbed')\n+\n+from sphinx.ext.autodoc.mock import mock\n+from sphinx.util.typing import restify\n+\n+print('Creating mocked torch.nn and defining class...')\n+with mock(['torch', 'torch.nn']):\n+    import importlib\n+    torch = importlib.import_module('torch')\n+    # Define a class inheriting from mocked torch.nn.Module\n+    class DeepKernel(torch.nn.Module):\n+        pass\n+\n+    bases = []\n+    if hasattr(DeepKernel, '__orig_bases__') and DeepKernel.__orig_bases__:\n+        bases = list(DeepKernel.__orig_bases__)\n+        src = '__orig_bases__'\n+    else:\n+        bases = list(DeepKernel.__bases__)\n+        src = '__bases__'\n+\n+    print('Using', src)\n+    print('Base entries repr:')\n+    for b in bases:\n+        print(' -', repr(b))\n+\n+    print('restify outputs:')\n+    for b in bases:\n+        print(' -', restify(b))\n+\n+print('Done.')\ndiff --git a/sphinx/util/typing.py b/sphinx/util/typing.py\nindex 87707d48f..3be746f4e 100644\n--- a/sphinx/util/typing.py\n+++ b/sphinx/util/typing.py\n@@ -124,6 +124,11 @@ def restify(cls: Optional[Type]) -> str:\n                 return ':py:class:`%s.%s`' % (cls.__module__, cls.__name__)\n             else:\n                 return ':py:class:`%s`' % cls.__name__\n+        # Handle Sphinx mocked objects used as bases (instances of _MockObject)\n+        # These can appear in __orig_bases__ and have invalid or empty __qualname__\n+        # which causes incorrect rendering like \"torch.nn.\". Prefer their display name.\n+        elif getattr(cls, '__sphinx_mock__', False) and hasattr(cls, '__display_name__'):\n+            return ':py:class:`%s`' % getattr(cls, '__display_name__')\n         elif UnionType and isinstance(cls, UnionType):\n             if len(cls.__args__) > 1 and None in cls.__args__:\n                 args = ' | '.join(restify(a) for a in cls.__args__ if a)\n@@ -144,6 +149,9 @@ def restify(cls: Optional[Type]) -> str:\n             else:\n                 return _restify_py36(cls)\n     except (AttributeError, TypeError):\n+        # For Sphinx mocked objects, fall back to their display name\n+        if getattr(cls, '__sphinx_mock__', False) and hasattr(cls, '__display_name__'):\n+            return getattr(cls, '__display_name__')\n         return repr(cls)\n \n \n"}