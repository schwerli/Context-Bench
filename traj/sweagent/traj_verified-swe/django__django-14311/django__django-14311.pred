{"model_name_or_path": "output", "instance_id": "django__django-14311", "model_patch": "diff --git a/django/utils/autoreload.py b/django/utils/autoreload.py\nindex b6af5f5491..91f783211e 100644\n--- a/django/utils/autoreload.py\n+++ b/django/utils/autoreload.py\n@@ -223,8 +223,18 @@ def get_child_arguments():\n     # __spec__ is set when the server was started with the `-m` option,\n     # see https://docs.python.org/3/reference/import.html#main-spec\n     # __spec__ may not exist, e.g. when running in a Conda env.\n-    if getattr(__main__, '__spec__', None) is not None and __main__.__spec__.parent:\n-        args += ['-m', __main__.__spec__.parent]\n+    if getattr(__main__, '__spec__', None) is not None:\n+        # If started with \"python -m\", __main__.__spec__ is set. Distinguish\n+        # between running a package (e.g., \"python -m django\") and a module\n+        # (e.g., \"python -m foo.bar.baz\"). When running a package, the\n+        # __main__ module's spec has name \"<package>.__main__\" and parent\n+        # \"<package>\". When running a module, spec.name is the full dotted\n+        # module path and parent is its containing package.\n+        spec = __main__.__spec__\n+        name = getattr(spec, 'name', None)\n+        parent = getattr(spec, 'parent', None)\n+        dotted = parent if (parent and name == parent + '.__main__') else name\n+        args += ['-m', dotted]\n         args += sys.argv[1:]\n     elif not py_script.exists():\n         # sys.argv[0] may not exist for several reasons on Windows.\ndiff --git a/repro_autoreload.py b/repro_autoreload.py\nnew file mode 100644\nindex 0000000000..e0d28226dc\n--- /dev/null\n+++ b/repro_autoreload.py\n@@ -0,0 +1,20 @@\n+import sys\n+import types\n+from importlib.machinery import ModuleSpec\n+from pathlib import Path\n+\n+from django.utils import autoreload\n+\n+# Simulate running `python -m foo.bar.baz runserver`\n+module = types.ModuleType('__main__')\n+spec = ModuleSpec(name='foo.bar.baz', loader=None)\n+# For a module (not a package), submodule_search_locations should be None.\n+spec.submodule_search_locations = None\n+module.__spec__ = spec\n+\n+# Patch sys.modules and argv to emulate the environment.\n+sys.modules['__main__'] = module\n+sys.argv = [str(Path(__file__)), 'runserver']\n+sys.warnoptions = []\n+\n+print(autoreload.get_child_arguments())\ndiff --git a/repro_django_main.py b/repro_django_main.py\nnew file mode 100644\nindex 0000000000..674acb5d17\n--- /dev/null\n+++ b/repro_django_main.py\n@@ -0,0 +1,11 @@\n+import sys\n+from pathlib import Path\n+\n+import django.__main__\n+from django.utils import autoreload\n+\n+sys.modules['__main__'] = django.__main__\n+sys.argv = [django.__main__.__file__, 'runserver']\n+sys.warnoptions = []\n+\n+print(autoreload.get_child_arguments())\ndiff --git a/repro_package_imported.py b/repro_package_imported.py\nnew file mode 100644\nindex 0000000000..1ab621a4bf\n--- /dev/null\n+++ b/repro_package_imported.py\n@@ -0,0 +1,14 @@\n+import sys\n+from importlib import import_module\n+\n+from django.utils import autoreload\n+\n+# Use a real imported __main__ from a package with __main__.py\n+main_mod = import_module('tests.utils_tests.test_module.__main__')\n+sys.modules['__main__'] = main_mod\n+sys.argv = [main_mod.__file__, 'runserver']\n+sys.warnoptions = []\n+\n+print('spec.name:', main_mod.__spec__.name)\n+print('spec.parent:', getattr(main_mod.__spec__, 'parent', None))\n+print(autoreload.get_child_arguments())\ndiff --git a/repro_package_main.py b/repro_package_main.py\nnew file mode 100644\nindex 0000000000..eb9b89648e\n--- /dev/null\n+++ b/repro_package_main.py\n@@ -0,0 +1,23 @@\n+import sys\n+import types\n+from importlib.machinery import ModuleSpec\n+from pathlib import Path\n+\n+from django.utils import autoreload\n+\n+# Simulate running `python -m utils_tests.test_module runserver` where test_module is a package.\n+module = types.ModuleType('__main__')\n+spec = ModuleSpec(name='utils_tests.test_module.__main__', loader=None)\n+# For a package, submodule_search_locations is not None and parent is inferred\n+# from name by Django's logic.\n+spec.submodule_search_locations = []\n+module.__spec__ = spec\n+\n+# Patch sys.modules and argv to emulate the environment.\n+sys.modules['__main__'] = module\n+sys.argv = [str(Path(__file__)), 'runserver']\n+sys.warnoptions = []\n+\n+print('spec.name:', module.__spec__.name)\n+print('spec.parent:', getattr(module.__spec__, 'parent', None))\n+print(autoreload.get_child_arguments())\n"}