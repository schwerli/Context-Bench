{"model_name_or_path": "output", "instance_id": "django__django-10554", "model_patch": "diff --git a/django/db/models/expressions.py b/django/db/models/expressions.py\nindex 36f88f99ec..2620b1f224 100644\n--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -739,11 +739,34 @@ class Col(Expression):\n     def get_group_by_cols(self, alias=None):\n         return [self]\n \n-    def get_db_converters(self, connection):\n-        if self.target == self.output_field:\n-            return self.output_field.get_db_converters(connection)\n-        return (self.output_field.get_db_converters(connection) +\n-                self.target.get_db_converters(connection))\n+\n+class OrderByPosition(Expression):\n+    \"\"\"\n+    Internal expression used to refer to a result column by its positional\n+    index in ORDER BY clauses for combined (compound) queries like UNION,\n+    INTERSECTION, and DIFFERENCE.\n+\n+    Some backends support ordering by select-list position using a bare\n+    integer (e.g. ORDER BY 1). Using RawSQL here would wrap the integer in\n+    parentheses (ORDER BY (1)), which can cause errors on certain backends\n+    when used with compound queries. This expression compiles to the bare\n+    integer without additional parentheses.\n+    \"\"\"\n+    def __init__(self, position):\n+        super().__init__()\n+        self.position = int(position)\n+\n+    def __repr__(self):\n+        return \"{}({})\".format(self.__class__.__name__, self.position)\n+\n+    def as_sql(self, compiler, connection):\n+        # Emit the position as a bare integer; no params required.\n+        return str(self.position), []\n+\n+    def get_group_by_cols(self, alias=None):\n+        # Positional ORDER BY doesn't contribute grouping columns.\n+        return []\n+\n \n \n class SimpleCol(Expression):\ndiff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex a791908caf..b6247313d6 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -5,7 +5,7 @@ from itertools import chain\n \n from django.core.exceptions import EmptyResultSet, FieldError\n from django.db.models.constants import LOOKUP_SEP\n-from django.db.models.expressions import OrderBy, Random, RawSQL, Ref, Value\n+from django.db.models.expressions import OrderBy, Random, RawSQL, Ref, Value, OrderByPosition\n from django.db.models.functions import Cast\n from django.db.models.query_utils import QueryWrapper, select_related_descend\n from django.db.models.sql.constants import (\n@@ -353,7 +353,7 @@ class SQLCompiler:\n                     elif col_alias:\n                         continue\n                     if src == sel_expr:\n-                        resolved.set_source_expressions([RawSQL('%d' % (idx + 1), ())])\n+                        resolved.set_source_expressions([OrderByPosition(idx + 1)])\n                         break\n                 else:\n                     raise DatabaseError('ORDER BY term does not match any column in the result set.')\ndiff --git a/repro_union_ordering.py b/repro_union_ordering.py\nnew file mode 100644\nindex 0000000000..5b97220653\n--- /dev/null\n+++ b/repro_union_ordering.py\n@@ -0,0 +1,67 @@\n+# Reproduction script for union queryset ordering derived querysets bug\n+import django\n+import os\n+import sys\n+\n+# Configure settings for tests environment by setting DJANGO_SETTINGS_MODULE\n+os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'tests.settings_tests.settings')\n+# Manually configure Django settings and database.\n+from django.conf import settings\n+ALWAYS_INSTALLED_APPS = [\n+    'django.contrib.contenttypes',\n+    'django.contrib.auth',\n+    'django.contrib.sites',\n+    'django.contrib.sessions',\n+    'django.contrib.messages',\n+    'django.contrib.admin.apps.SimpleAdminConfig',\n+    'django.contrib.staticfiles',\n+]\n+ALWAYS_MIDDLEWARE = [\n+    'django.contrib.sessions.middleware.SessionMiddleware',\n+    'django.middleware.common.CommonMiddleware',\n+    'django.middleware.csrf.CsrfViewMiddleware',\n+    'django.contrib.auth.middleware.AuthenticationMiddleware',\n+    'django.contrib.messages.middleware.MessageMiddleware',\n+]\n+TMPDIR = '/tmp/django_tmp'\n+os.makedirs(TMPDIR, exist_ok=True)\n+settings.configure(\n+    INSTALLED_APPS=ALWAYS_INSTALLED_APPS + ['tests.queries'],\n+    MIDDLEWARE=ALWAYS_MIDDLEWARE,\n+    ROOT_URLCONF='tests.urls',\n+    STATIC_URL='/static/',\n+    STATIC_ROOT=os.path.join(TMPDIR, 'static'),\n+    TEMPLATES=[{\n+        'BACKEND': 'django.template.backends.django.DjangoTemplates',\n+        'DIRS': [os.path.join('/testbed/tests', 'templates')],\n+        'APP_DIRS': True,\n+        'OPTIONS': {'context_processors': []},\n+    }],\n+    DATABASES={'default': {'ENGINE': 'django.db.backends.sqlite3', 'NAME': os.path.join(TMPDIR, 'db.sqlite3')}},\n+    SITE_ID=1,\n+    LOGGING_CONFIG=None,\n+)\n+\n+# minimal setup to initialize django\n+import django\n+from django.core.management import call_command\n+django.setup()\n+# Create tables for apps without migrations\n+call_command('migrate', run_syncdb=True, interactive=False, verbosity=0)\n+\n+from tests.queries.models import Number\n+\n+# Create sample data\n+Number.objects.all().delete()\n+for i in range(10):\n+    Number.objects.create(num=i)\n+\n+qs1 = Number.objects.filter(num__lte=1)\n+qs2 = Number.objects.filter(num__gte=8)\n+\n+qs = qs1.union(qs2)\n+print('Initial union ordered desc:', list(qs.order_by('-num')))\n+# Trigger evaluation order\n+print('Order_by none values_list flat:', list(qs.order_by().values_list('pk', flat=True)))\n+# Now re-evaluate original qs\n+print('Re-evaluate original qs:', list(qs))\n"}