{
  "instance_id": "Multi-SWE-Bench__go__maintenance__bugfix__8d23605c",
  "original_id": "cli__cli-1580",
  "1_model_selected_files": [
    "pkg/cmd/pr/view/view.go",
    "api/queries_pr.go",
    "pkg/cmd/pr/shared/display.go",
    "pkg/cmd/pr/view/view_test.go",
    "api/queries_pr_test.go"
  ],
  "2_embedding_selected_files": [
    "pkg/cmd/pr/view/view_test.go",
    "pkg/cmd/pr/view/view.go",
    "pkg/cmd/pr/pr.go",
    "pkg/cmd/pr/shared/lookup.go",
    "api/queries_pr.go",
    "pkg/cmd/pr/shared/display.go",
    "pkg/cmd/pr/shared/params.go",
    "pkg/cmd/pr/shared/title_body_survey.go",
    "pkg/cmd/pr/shared/display_test.go",
    "api/pull_request_test.go",
    "api/queries_repo_test.go",
    "api/queries_issue_test.go",
    "api/queries_pr_test.go",
    "api/queries_issue.go",
    "internal/ghrepo/repo_test.go",
    "pkg/cmd/gist/create/create_test.go",
    "internal/ghrepo/repo.go",
    "api/queries_repo.go",
    "pkg/cmdutil/repo_override.go",
    "pkg/cmd/gist/create/create.go",
    "pkg/cmd/pr/shared/params_test.go",
    "pkg/cmd/gist/gist.go",
    "utils/table_printer.go",
    "api/client_test.go",
    "pkg/cmdutil/args.go",
    "pkg/cmdutil/legacy.go",
    "api/queries_org.go",
    "api/client.go"
  ],
  "3_final_combined_files": [
    "pkg/cmd/pr/view/view.go",
    "api/queries_pr.go",
    "pkg/cmd/pr/shared/display.go",
    "pkg/cmd/pr/view/view_test.go",
    "pkg/cmd/pr/pr.go"
  ],
  "4_related_elements": {
    "pkg/cmd/pr/view/view.go": [
      "function: viewRun\nfunction: printRawPrPreview\nfunction: printHumanPrPreview\nfunction: PRFromArgs"
    ],
    "api/queries_pr.go": [
      "class: PullRequest\nfunction: PullRequestByNumber\nfunction: PullRequestForBranch"
    ],
    "pkg/cmd/pr/shared/display.go": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "pkg/cmd/pr/view/view.go": [
          "line: 82\nline: 100\nline: 103\nfunction: printRawPrPreview"
        ],
        "api/queries_pr.go": [
          ""
        ],
        "pkg/cmd/pr/shared/display.go": [
          ""
        ]
      },
      "patches": [
        "diff --git a/pkg/cmd/pr/view/view.go b/pkg/cmd/pr/view/view.go\nindex 7a1e912..2424170 100644\n--- a/pkg/cmd/pr/view/view.go\n+++ b/pkg/cmd/pr/view/view.go\n@@ -110,6 +110,11 @@ func printRawPrPreview(out io.Writer, pr *api.PullRequest) error {\n \tfmt.Fprintf(out, \"state:\\t%s\\n\", prStateWithDraft(pr))\n \tfmt.Fprintf(out, \"author:\\t%s\\n\", pr.Author.Login)\n \tfmt.Fprintf(out, \"labels:\\t%s\\n\", labels)\n+\tfmt.Fprintf(out, \"number:\\t%d\\n\", pr.Number)\n+\tfmt.Fprintf(out, \"commit_count:\\t%d\\n\", pr.Commits.TotalCount)\n+\tfmt.Fprintf(out, \"url:\\t%s\\n\", pr.URL)\n+\tfmt.Fprintf(out, \"base_branch:\\t%s\\n\", pr.BaseRefName)\n+\tfmt.Fprintf(out, \"pr_branch:\\t%s\\n\", pr.HeadRefName)\n \tfmt.Fprintf(out, \"assignees:\\t%s\\n\", assignees)\n \tfmt.Fprintf(out, \"reviewers:\\t%s\\n\", reviewers)\n \tfmt.Fprintf(out, \"projects:\\t%s\\n\", projects)\n",
        "diff --git a/pkg/cmd/pr/view/view.go b/pkg/cmd/pr/view/view.go\nindex 7a1e912..c2c7dc3 100644\n--- a/pkg/cmd/pr/view/view.go\n+++ b/pkg/cmd/pr/view/view.go\n@@ -106,10 +106,35 @@ func printRawPrPreview(out io.Writer, pr *api.PullRequest) error {\n \tlabels := prLabelList(*pr)\n \tprojects := prProjectList(*pr)\n \n+\t// Base and head repository metadata (guard against nils)\n+\tvar baseOwner, baseName string\n+\tif pr.BaseRepository != nil {\n+\t\tbaseName = pr.BaseRepository.Name\n+\t\tif pr.BaseRepository.Owner != nil {\n+\t\t\tbaseOwner = pr.BaseRepository.Owner.Login\n+\t\t}\n+\t}\n+\tvar headOwner, headName string\n+\tif pr.HeadRepository != nil {\n+\t\theadName = pr.HeadRepository.Name\n+\t\tif pr.HeadRepository.Owner != nil {\n+\t\t\theadOwner = pr.HeadRepository.Owner.Login\n+\t\t}\n+\t}\n+\n \tfmt.Fprintf(out, \"title:\\t%s\\n\", pr.Title)\n \tfmt.Fprintf(out, \"state:\\t%s\\n\", prStateWithDraft(pr))\n \tfmt.Fprintf(out, \"author:\\t%s\\n\", pr.Author.Login)\n \tfmt.Fprintf(out, \"labels:\\t%s\\n\", labels)\n+\tfmt.Fprintf(out, \"number:\\t%d\\n\", pr.Number)\n+\tfmt.Fprintf(out, \"commit_count:\\t%d\\n\", pr.Commits.TotalCount)\n+\tfmt.Fprintf(out, \"url:\\t%s\\n\", pr.URL)\n+\tfmt.Fprintf(out, \"base_repo_owner:\\t%s\\n\", baseOwner)\n+\tfmt.Fprintf(out, \"base_repo:\\t%s\\n\", baseName)\n+\tfmt.Fprintf(out, \"base_branch:\\t%s\\n\", pr.BaseRefName)\n+\tfmt.Fprintf(out, \"pr_repo_owner:\\t%s\\n\", headOwner)\n+\tfmt.Fprintf(out, \"pr_repo:\\t%s\\n\", headName)\n+\tfmt.Fprintf(out, \"pr_branch:\\t%s\\n\", pr.HeadRefName)\n \tfmt.Fprintf(out, \"assignees:\\t%s\\n\", assignees)\n \tfmt.Fprintf(out, \"reviewers:\\t%s\\n\", reviewers)\n \tfmt.Fprintf(out, \"projects:\\t%s\\n\", projects)\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nProvide all metadata fields in scripted `pr view`\n### Describe the feature or problem you’d like to solve\r\n\r\nI am trying to automate doing something with the PR just created from the current branch. `gh pr view` will print out the PR info including the URL, which would be fine, except that if your redirect stdout it drops this information. (I understand having a command behave differently in interactive vs scripted contexts, but this seems like a pretty surprising behavior).\r\n\r\n### Proposed solution\r\n\r\nAll information in the interactive view should also be present in the scripted view. In particular `gh pr view` should include the PR number and URL (and/or include the owner and repo name as separate fields). \r\n\r\nHow will it benefit CLI and its users?\r\nThis enables `gh` to be used with other automation that operates on PRs.\r\n\r\n### Additional context\r\n\r\n<details>\r\n<summary>Current behavior</summary>\r\n\r\n```\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view\r\nMerge main -> google\r\nOpen • GMNGeoffrey wants to merge 14 commits into google from main-to-google\r\n\r\nLabels: cla: yes\r\n\r\n\r\n                                                                              \r\n  • e15008ca Standardize E2E module names. (#2872)                            \r\n  • e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)    \r\n  • 177925c4 Mark unanalyzable XLA target as manual (#2881)                   \r\n  • 8204a7a8 Merge google -> main #2877                                       \r\n  • 45d5f5a1 Avoid confusing error message in TF tests (#2879)                \r\n  • 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags         \r\n  • c2e59d2e Workaround for issue in #2878.                                   \r\n  • 99ed353d Reworking type conversion to support VM target options.          \r\n  • a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.      \r\n  • 0a473431 Plumbing VM TargetOptions through conversion passes.             \r\n  • 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.     \r\n  • 2ff8b399 Removing unused TypeConversionUtils.                             \r\n  • 3546d64c Merge google -> main (#2876)                                     \r\n  • d13546b2 Remove uses of kind on derived mlir Attribute and Type classes   \r\n  (#2861)                                                                     \r\n\r\n\r\n\r\nView this pull request on GitHub: https://github.com/google/iree/pull/2887\r\n\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view > /tmp/pr.txt && cat /tmp/pr.txt \r\ntitle:  Merge main -> google\r\nstate:  OPEN\r\nauthor: GMNGeoffrey\r\nlabels: cla: yes\r\nassignees:\r\nreviewers:\r\nprojects:\r\nmilestone:\r\n--\r\n* e15008ca Standardize E2E module names. (#2872)\r\n* e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)\r\n* 177925c4 Mark unanalyzable XLA target as manual (#2881)\r\n* 8204a7a8 Merge google -> main #2877\r\n* 45d5f5a1 Avoid confusing error message in TF tests (#2879)\r\n* 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags\r\n* c2e59d2e Workaround for issue in #2878.\r\n* 99ed353d Reworking type conversion to support VM target options.\r\n* a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.\r\n* 0a473431 Plumbing VM TargetOptions through conversion passes.\r\n* 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.\r\n* 2ff8b399 Removing unused TypeConversionUtils.\r\n* 3546d64c Merge google -> main (#2876)\r\n* d13546b2 Remove uses of kind on derived mlir Attribute and Type classes (#2861)```\r\n```\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>Proposed behavior</summary>\r\n\r\n```\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view\r\nMerge main -> google\r\nOpen • GMNGeoffrey wants to merge 14 commits into google from main-to-google\r\n\r\nLabels: cla: yes\r\n\r\n\r\n                                                                              \r\n  • e15008ca Standardize E2E module names. (#2872)                            \r\n  • e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)    \r\n  • 177925c4 Mark unanalyzable XLA target as manual (#2881)                   \r\n  • 8204a7a8 Merge google -> main #2877                                       \r\n  • 45d5f5a1 Avoid confusing error message in TF tests (#2879)                \r\n  • 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags         \r\n  • c2e59d2e Workaround for issue in #2878.                                   \r\n  • 99ed353d Reworking type conversion to support VM target options.          \r\n  • a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.      \r\n  • 0a473431 Plumbing VM TargetOptions through conversion passes.             \r\n  • 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.     \r\n  • 2ff8b399 Removing unused TypeConversionUtils.                             \r\n  • 3546d64c Merge google -> main (#2876)                                     \r\n  • d13546b2 Remove uses of kind on derived mlir Attribute and Type classes   \r\n  (#2861)                                                                     \r\n\r\n\r\n\r\nView this pull request on GitHub: https://github.com/google/iree/pull/2887\r\n\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view > /tmp/pr.txt && cat /tmp/pr.txt \r\ntitle:  Merge main -> google\r\nstate:  OPEN\r\nauthor: GMNGeoffrey\r\nlabels: cla: yes\r\nnumber: 2887\r\ncommit_count: 14\r\nurl: https://github.com/google/iree/pull/2887\r\nbase_repo_owner: google\r\nbase_repo: iree\r\nbase_branch: google\r\npr_repo_owner: GMNGeoffrey\r\npr_repo: iree\r\npr_branch: main-to-google\r\nassignees:\r\nreviewers:\r\nprojects:\r\nmilestone:\r\n--\r\n* e15008ca Standardize E2E module names. (#2872)\r\n* e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)\r\n* 177925c4 Mark unanalyzable XLA target as manual (#2881)\r\n* 8204a7a8 Merge google -> main #2877\r\n* 45d5f5a1 Avoid confusing error message in TF tests (#2879)\r\n* 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags\r\n* c2e59d2e Workaround for issue in #2878.\r\n* 99ed353d Reworking type conversion to support VM target options.\r\n* a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.\r\n* 0a473431 Plumbing VM TargetOptions through conversion passes.\r\n* 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.\r\n* 2ff8b399 Removing unused TypeConversionUtils.\r\n* 3546d64c Merge google -> main (#2876)\r\n* d13546b2 Remove uses of kind on derived mlir Attribute and Type classes (#2861)```\r\n```\r\n</details>\r\n\n\n###\n### pkg/cmd/pr/view/view.go\n1|package view\n2|\n3|import (\n4|\t\"fmt\"\n5|\t\"io\"\n6|\t\"net/http\"\n7|\t\"sort\"\n8|\t\"strings\"\n9|\n10|\t\"github.com/MakeNowJust/heredoc\"\n11|\t\"github.com/cli/cli/api\"\n12|\t\"github.com/cli/cli/context\"\n13|\t\"github.com/cli/cli/internal/config\"\n14|\t\"github.com/cli/cli/internal/ghrepo\"\n15|\t\"github.com/cli/cli/pkg/cmd/pr/shared\"\n16|\t\"github.com/cli/cli/pkg/cmdutil\"\n17|\t\"github.com/cli/cli/pkg/iostreams\"\n18|\t\"github.com/cli/cli/utils\"\n19|\t\"github.com/spf13/cobra\"\n20|)\n21|\n22|type ViewOptions struct {\n23|\tHttpClient func() (*http.Client, error)\n24|\tConfig     func() (config.Config, error)\n25|\tIO         *iostreams.IOStreams\n26|\tBaseRepo   func() (ghrepo.Interface, error)\n27|\tRemotes    func() (context.Remotes, error)\n28|\tBranch     func() (string, error)\n29|\n30|\tSelectorArg string\n31|\tBrowserMode bool\n32|}\n33|\n34|func NewCmdView(f *cmdutil.Factory, runF func(*ViewOptions) error) *cobra.Command {\n35|\topts := &ViewOptions{\n36|\t\tIO:         f.IOStreams,\n37|\t\tHttpClient: f.HttpClient,\n38|\t\tConfig:     f.Config,\n39|\t\tRemotes:    f.Remotes,\n40|\t\tBranch:     f.Branch,\n41|\t}\n42|\n43|\tcmd := &cobra.Command{\n44|\t\tUse:   \"view [<number> | <url> | <branch>]\",\n45|\t\tShort: \"View a pull request\",\n46|\t\tLong: heredoc.Doc(`\n47|\t\t\tDisplay the title, body, and other information about a pull request.\n48|\n49|\t\t\tWithout an argument, the pull request that belongs to the current branch\n50|\t\t\tis displayed.\n51|\t\t\t\n52|\t\t\tWith '--web', open the pull request in a web browser instead.\n53|    \t`),\n54|\t\tArgs: cobra.MaximumNArgs(1),\n55|\t\tRunE: func(cmd *cobra.Command, args []string) error {\n56|\t\t\t// support `-R, --repo` override\n57|\t\t\topts.BaseRepo = f.BaseRepo\n58|\n59|\t\t\tif len(args) > 0 {\n60|\t\t\t\topts.SelectorArg = args[0]\n61|\t\t\t}\n62|\n63|\t\t\tif runF != nil {\n64|\t\t\t\treturn runF(opts)\n65|\t\t\t}\n66|\t\t\treturn viewRun(opts)\n67|\t\t},\n68|\t}\n69|\n70|\tcmd.Flags().BoolVarP(&opts.BrowserMode, \"web\", \"w\", false, \"Open a pull request in the browser\")\n71|\n72|\treturn cmd\n73|}\n74|\n75|func viewRun(opts *ViewOptions) error {\n76|\thttpClient, err := opts.HttpClient()\n77|\tif err != nil {\n78|\t\treturn err\n79|\t}\n80|\tapiClient := api.NewClientFromHTTP(httpClient)\n81|\n82|\tpr, _, err := shared.PRFromArgs(apiClient, opts.BaseRepo, opts.Branch, opts.Remotes, opts.SelectorArg)\n83|\tif err != nil {\n84|\t\treturn err\n85|\t}\n86|\n87|\topenURL := pr.URL\n88|\tconnectedToTerminal := opts.IO.IsStdoutTTY() && opts.IO.IsStderrTTY()\n89|\n90|\tif opts.BrowserMode {\n91|\t\tif connectedToTerminal {\n92|\t\t\tfmt.Fprintf(opts.IO.ErrOut, \"Opening %s in your browser.\\n\", openURL)\n93|\t\t}\n94|\t\treturn utils.OpenInBrowser(openURL)\n95|\t}\n96|\n97|\tif connectedToTerminal {\n98|\t\treturn printHumanPrPreview(opts.IO.Out, pr)\n99|\t}\n100|\treturn printRawPrPreview(opts.IO.Out, pr)\n101|}\n102|\n103|func printRawPrPreview(out io.Writer, pr *api.PullRequest) error {\n104|\treviewers := prReviewerList(*pr)\n105|\tassignees := prAssigneeList(*pr)\n106|\tlabels := prLabelList(*pr)\n107|\tprojects := prProjectList(*pr)\n108|\n109|\tfmt.Fprintf(out, \"title:\\t%s\\n\", pr.Title)\n110|\tfmt.Fprintf(out, \"state:\\t%s\\n\", prStateWithDraft(pr))\n111|\tfmt.Fprintf(out, \"author:\\t%s\\n\", pr.Author.Login)\n112|\tfmt.Fprintf(out, \"labels:\\t%s\\n\", labels)\n113|\tfmt.Fprintf(out, \"assignees:\\t%s\\n\", assignees)\n114|\tfmt.Fprintf(out, \"reviewers:\\t%s\\n\", reviewers)\n115|\tfmt.Fprintf(out, \"projects:\\t%s\\n\", projects)\n116|\tfmt.Fprintf(out, \"milestone:\\t%s\\n\", pr.Milestone.Title)\n117|\n118|\tfmt.Fprintln(out, \"--\")\n119|\tfmt.Fprintln(out, pr.Body)\n120|\n121|\treturn nil\n122|}\n123|\n124|func printHumanPrPreview(out io.Writer, pr *api.PullRequest) error {\n125|\t// Header (Title and State)\n126|\tfmt.Fprintln(out, utils.Bold(pr.Title))\n127|\tfmt.Fprintf(out, \"%s\", shared.StateTitleWithColor(*pr))\n128|\tfmt.Fprintln(out, utils.Gray(fmt.Sprintf(\n129|\t\t\" • %s wants to merge %s into %s from %s\",\n130|\t\tpr.Author.Login,\n131|\t\tutils.Pluralize(pr.Commits.TotalCount, \"commit\"),\n132|\t\tpr.BaseRefName,\n133|\t\tpr.HeadRefName,\n134|\t)))\n135|\tfmt.Fprintln(out)\n136|\n137|\t// Metadata\n138|\tif reviewers := prReviewerList(*pr); reviewers != \"\" {\n139|\t\tfmt.Fprint(out, utils.Bold(\"Reviewers: \"))\n140|\t\tfmt.Fprintln(out, reviewers)\n141|\t}\n142|\tif assignees := prAssigneeList(*pr); assignees != \"\" {\n143|\t\tfmt.Fprint(out, utils.Bold(\"Assignees: \"))\n144|\t\tfmt.Fprintln(out, assignees)\n145|\t}\n146|\tif labels := prLabelList(*pr); labels != \"\" {\n147|\t\tfmt.Fprint(out, utils.Bold(\"Labels: \"))\n148|\t\tfmt.Fprintln(out, labels)\n149|\t}\n150|\tif projects := prProjectList(*pr); projects != \"\" {\n151|\t\tfmt.Fprint(out, utils.Bold(\"Projects: \"))\n152|\t\tfmt.Fprintln(out, projects)\n153|\t}\n154|\tif pr.Milestone.Title != \"\" {\n155|\t\tfmt.Fprint(out, utils.Bold(\"Milestone: \"))\n156|\t\tfmt.Fprintln(out, pr.Milestone.Title)\n157|\t}\n158|\n159|\t// Body\n160|\tif pr.Body != \"\" {\n161|\t\tfmt.Fprintln(out)\n162|\t\tmd, err := utils.RenderMarkdown(pr.Body)\n163|\t\tif err != nil {\n164|\t\t\treturn err\n165|\t\t}\n166|\t\tfmt.Fprintln(out, md)\n167|\t}\n168|\tfmt.Fprintln(out)\n169|\n170|\t// Footer\n171|\tfmt.Fprintf(out, utils.Gray(\"View this pull request on GitHub: %s\\n\"), pr.URL)\n172|\treturn nil\n173|}\n174|\n175|// Ref. https://developer.github.com/v4/enum/pullrequestreviewstate/\n176|const (\n177|\trequestedReviewState        = \"REQUESTED\" // This is our own state for review request\n178|\tapprovedReviewState         = \"APPROVED\"\n179|\tchangesRequestedReviewState = \"CHANGES_REQUESTED\"\n180|\tcommentedReviewState        = \"COMMENTED\"\n181|\tdismissedReviewState        = \"DISMISSED\"\n182|\tpendingReviewState          = \"PENDING\"\n183|)\n184|\n185|type reviewerState struct {\n186|\tName  string\n187|\tState string\n188|}\n189|\n190|// colorFuncForReviewerState returns a color function for a reviewer state\n191|func colorFuncForReviewerState(state string) func(string) string {\n192|\tswitch state {\n193|\tcase requestedReviewState:\n194|\t\treturn utils.Yellow\n195|\tcase approvedReviewState:\n196|\t\treturn utils.Green\n197|\tcase changesRequestedReviewState:\n198|\t\treturn utils.Red\n199|\tcase commentedReviewState:\n200|\t\treturn func(str string) string { return str } // Do nothing\n201|\tdefault:\n202|\t\treturn nil\n203|\t}\n204|}\n205|\n206|// formattedReviewerState formats a reviewerState with state color\n207|func formattedReviewerState(reviewer *reviewerState) string {\n208|\tstate := reviewer.State\n209|\tif state == dismissedReviewState {\n210|\t\t// Show \"DISMISSED\" review as \"COMMENTED\", since \"dimissed\" only makes\n211|\t\t// sense when displayed in an events timeline but not in the final tally.\n212|\t\tstate = commentedReviewState\n213|\t}\n214|\tstateColorFunc := colorFuncForReviewerState(state)\n215|\treturn fmt.Sprintf(\"%s (%s)\", reviewer.Name, stateColorFunc(strings.ReplaceAll(strings.Title(strings.ToLower(state)), \"_\", \" \")))\n216|}\n217|\n218|// prReviewerList generates a reviewer list with their last state\n219|func prReviewerList(pr api.PullRequest) string {\n220|\treviewerStates := parseReviewers(pr)\n221|\treviewers := make([]string, 0, len(reviewerStates))\n222|\n223|\tsortReviewerStates(reviewerStates)\n224|\n225|\tfor _, reviewer := range reviewerStates {\n226|\t\treviewers = append(reviewers, formattedReviewerState(reviewer))\n227|\t}\n228|\n229|\treviewerList := strings.Join(reviewers, \", \")\n230|\n231|\treturn reviewerList\n232|}\n233|\n234|// Ref. https://developer.github.com/v4/union/requestedreviewer/\n235|const teamTypeName = \"Team\"\n236|\n237|const ghostName = \"ghost\"\n238|\n239|// parseReviewers parses given Reviews and ReviewRequests\n240|func parseReviewers(pr api.PullRequest) []*reviewerState {\n241|\treviewerStates := make(map[string]*reviewerState)\n242|\n243|\tfor _, review := range pr.Reviews.Nodes {\n244|\t\tif review.Author.Login != pr.Author.Login {\n245|\t\t\tname := review.Author.Login\n246|\t\t\tif name == \"\" {\n247|\t\t\t\tname = ghostName\n248|\t\t\t}\n249|\t\t\treviewerStates[name] = &reviewerState{\n250|\t\t\t\tName:  name,\n251|\t\t\t\tState: review.State,\n252|\t\t\t}\n253|\t\t}\n254|\t}\n255|\n256|\t// Overwrite reviewer's state if a review request for the same reviewer exists.\n257|\tfor _, reviewRequest := range pr.ReviewRequests.Nodes {\n258|\t\tname := reviewRequest.RequestedReviewer.Login\n259|\t\tif reviewRequest.RequestedReviewer.TypeName == teamTypeName {\n260|\t\t\tname = reviewRequest.RequestedReviewer.Name\n261|\t\t}\n262|\t\treviewerStates[name] = &reviewerState{\n263|\t\t\tName:  name,\n264|\t\t\tState: requestedReviewState,\n265|\t\t}\n266|\t}\n267|\n268|\t// Convert map to slice for ease of sort\n269|\tresult := make([]*reviewerState, 0, len(reviewerStates))\n270|\tfor _, reviewer := range reviewerStates {\n271|\t\tif reviewer.State == pendingReviewState {\n272|\t\t\tcontinue\n273|\t\t}\n274|\t\tresult = append(result, reviewer)\n275|\t}\n276|\n277|\treturn result\n278|}\n279|\n280|// sortReviewerStates puts completed reviews before review requests and sorts names alphabetically\n281|func sortReviewerStates(reviewerStates []*reviewerState) {\n282|\tsort.Slice(reviewerStates, func(i, j int) bool {\n283|\t\tif reviewerStates[i].State == requestedReviewState &&\n284|\t\t\treviewerStates[j].State != requestedReviewState {\n285|\t\t\treturn false\n286|\t\t}\n287|\t\tif reviewerStates[j].State == requestedReviewState &&\n288|\t\t\treviewerStates[i].State != requestedReviewState {\n289|\t\t\treturn true\n290|\t\t}\n291|\n292|\t\treturn reviewerStates[i].Name < reviewerStates[j].Name\n293|\t})\n294|}\n295|\n296|func prAssigneeList(pr api.PullRequest) string {\n297|\tif len(pr.Assignees.Nodes) == 0 {\n298|\t\treturn \"\"\n299|\t}\n300|\n301|\tAssigneeNames := make([]string, 0, len(pr.Assignees.Nodes))\n302|\tfor _, assignee := range pr.Assignees.Nodes {\n303|\t\tAssigneeNames = append(AssigneeNames, assignee.Login)\n304|\t}\n305|\n306|\tlist := strings.Join(AssigneeNames, \", \")\n307|\tif pr.Assignees.TotalCount > len(pr.Assignees.Nodes) {\n308|\t\tlist += \", …\"\n309|\t}\n310|\treturn list\n311|}\n312|\n313|func prLabelList(pr api.PullRequest) string {\n314|\tif len(pr.Labels.Nodes) == 0 {\n315|\t\treturn \"\"\n316|\t}\n317|\n318|\tlabelNames := make([]string, 0, len(pr.Labels.Nodes))\n319|\tfor _, label := range pr.Labels.Nodes {\n320|\t\tlabelNames = append(labelNames, label.Name)\n321|\t}\n322|\n323|\tlist := strings.Join(labelNames, \", \")\n324|\tif pr.Labels.TotalCount > len(pr.Labels.Nodes) {\n325|\t\tlist += \", …\"\n326|\t}\n327|\treturn list\n328|}\n329|\n330|func prProjectList(pr api.PullRequest) string {\n331|\tif len(pr.ProjectCards.Nodes) == 0 {\n332|\t\treturn \"\"\n333|\t}\n334|\n335|\tprojectNames := make([]string, 0, len(pr.ProjectCards.Nodes))\n336|\tfor _, project := range pr.ProjectCards.Nodes {\n337|\t\tcolName := project.Column.Name\n338|\t\tif colName == \"\" {\n339|\t\t\tcolName = \"Awaiting triage\"\n340|\t\t}\n341|\t\tprojectNames = append(projectNames, fmt.Sprintf(\"%s (%s)\", project.Project.Name, colName))\n342|\t}\n343|\n344|\tlist := strings.Join(projectNames, \", \")\n345|\tif pr.ProjectCards.TotalCount > len(pr.ProjectCards.Nodes) {\n346|\t\tlist += \", …\"\n347|\t}\n348|\treturn list\n349|}\n350|\n351|func prStateWithDraft(pr *api.PullRequest) string {\n352|\tif pr.IsDraft && pr.State == \"OPEN\" {\n353|\t\treturn \"DRAFT\"\n354|\t}\n355|\n356|\treturn pr.State\n357|}\n\n\n### api/queries_pr.go\n...\n30|\tViewerCreated   PullRequestAndTotalCount\n31|\tReviewRequested PullRequestAndTotalCount\n32|\tCurrentPR       *PullRequest\n33|\tDefaultBranch   string\n34|}\n35|\n36|type PullRequestAndTotalCount struct {\n37|\tTotalCount   int\n38|\tPullRequests []PullRequest\n39|}\n40|\n41|type PullRequest struct {\n42|\tID          string\n43|\tNumber      int\n44|\tTitle       string\n45|\tState       string\n46|\tClosed      bool\n47|\tURL         string\n48|\tBaseRefName string\n49|\tHeadRefName string\n50|\tBody        string\n51|\tMergeable   string\n52|\n53|\tAuthor struct {\n54|\t\tLogin string\n55|\t}\n56|\tHeadRepositoryOwner struct {\n57|\t\tLogin string\n58|\t}\n59|\tHeadRepository struct {\n60|\t\tName             string\n61|\t\tDefaultBranchRef struct {\n62|\t\t\tName string\n63|\t\t}\n64|\t}\n65|\tIsCrossRepository   bool\n66|\tIsDraft             bool\n67|\tMaintainerCanModify bool\n68|\n69|\tReviewDecision string\n70|\n71|\tCommits struct {\n72|\t\tTotalCount int\n73|\t\tNodes      []struct {\n74|\t\t\tCommit struct {\n75|\t\t\t\tStatusCheckRollup struct {\n76|\t\t\t\t\tContexts struct {\n77|\t\t\t\t\t\tNodes []struct {\n78|\t\t\t\t\t\t\tState      string\n79|\t\t\t\t\t\t\tStatus     string\n80|\t\t\t\t\t\t\tConclusion string\n81|\t\t\t\t\t\t}\n82|\t\t\t\t\t}\n83|\t\t\t\t}\n84|\t\t\t}\n85|\t\t}\n86|\t}\n87|\tReviewRequests struct {\n88|\t\tNodes []struct {\n89|\t\t\tRequestedReviewer struct {\n90|\t\t\t\tTypeName string `json:\"__typename\"`\n91|\t\t\t\tLogin    string\n92|\t\t\t\tName     string\n93|\t\t\t}\n94|\t\t}\n95|\t\tTotalCount int\n96|\t}\n97|\tReviews struct {\n98|\t\tNodes []struct {\n99|\t\t\tAuthor struct {\n100|\t\t\t\tLogin string\n101|\t\t\t}\n102|\t\t\tState string\n103|\t\t}\n104|\t}\n105|\tAssignees struct {\n106|\t\tNodes []struct {\n107|\t\t\tLogin string\n108|\t\t}\n109|\t\tTotalCount int\n110|\t}\n111|\tLabels struct {\n112|\t\tNodes []struct {\n113|\t\t\tName string\n114|\t\t}\n115|\t\tTotalCount int\n116|\t}\n117|\tProjectCards struct {\n118|\t\tNodes []struct {\n119|\t\t\tProject struct {\n120|\t\t\t\tName string\n121|\t\t\t}\n122|\t\t\tColumn struct {\n123|\t\t\t\tName string\n124|\t\t\t}\n125|\t\t}\n126|\t\tTotalCount int\n127|\t}\n128|\tMilestone struct {\n129|\t\tTitle string\n130|\t}\n131|}\n132|\n133|type NotFoundError struct {\n134|\terror\n135|}\n136|\n137|func (err *NotFoundError) Unwrap() error {\n138|\treturn err.error\n139|}\n140|\n...\n388|\t\tReviewRequested: PullRequestAndTotalCount{\n389|\t\t\tPullRequests: reviewRequested,\n390|\t\t\tTotalCount:   resp.ReviewRequested.TotalCount,\n391|\t\t},\n392|\t\tCurrentPR:     currentPR,\n393|\t\tDefaultBranch: resp.Repository.DefaultBranchRef.Name,\n394|\t}\n395|\n396|\treturn &payload, nil\n397|}\n398|\n399|func PullRequestByNumber(client *Client, repo ghrepo.Interface, number int) (*PullRequest, error) {\n400|\ttype response struct {\n401|\t\tRepository struct {\n402|\t\t\tPullRequest PullRequest\n403|\t\t}\n404|\t}\n405|\n406|\tquery := `\n407|\tquery PullRequestByNumber($owner: String!, $repo: String!, $pr_number: Int!) {\n408|\t\trepository(owner: $owner, name: $repo) {\n409|\t\t\tpullRequest(number: $pr_number) {\n410|\t\t\t\tid\n411|\t\t\t\turl\n412|\t\t\t\tnumber\n413|\t\t\t\ttitle\n414|\t\t\t\tstate\n415|\t\t\t\tclosed\n416|\t\t\t\tbody\n417|\t\t\t\tmergeable\n418|\t\t\t\tauthor {\n419|\t\t\t\t  login\n420|\t\t\t\t}\n421|\t\t\t\tcommits {\n422|\t\t\t\t  totalCount\n423|\t\t\t\t}\n424|\t\t\t\tbaseRefName\n425|\t\t\t\theadRefName\n426|\t\t\t\theadRepositoryOwner {\n427|\t\t\t\t\tlogin\n428|\t\t\t\t}\n429|\t\t\t\theadRepository {\n430|\t\t\t\t\tname\n431|\t\t\t\t}\n432|\t\t\t\tisCrossRepository\n433|\t\t\t\tisDraft\n434|\t\t\t\tmaintainerCanModify\n435|\t\t\t\treviewRequests(first: 100) {\n436|\t\t\t\t\tnodes {\n437|\t\t\t\t\t\trequestedReviewer {\n438|\t\t\t\t\t\t\t__typename\n439|\t\t\t\t\t\t\t...on User {\n440|\t\t\t\t\t\t\t\tlogin\n441|\t\t\t\t\t\t\t}\n442|\t\t\t\t\t\t\t...on Team {\n443|\t\t\t\t\t\t\t\tname\n444|\t\t\t\t\t\t\t}\n445|\t\t\t\t\t\t}\n446|\t\t\t\t\t}\n447|\t\t\t\t\ttotalCount\n448|\t\t\t\t}\n449|\t\t\t\treviews(last: 100) {\n450|\t\t\t\t\tnodes {\n451|\t\t\t\t\t\tauthor {\n452|\t\t\t\t\t\t  login\n453|\t\t\t\t\t\t}\n454|\t\t\t\t\t\tstate\n455|\t\t\t\t\t}\n456|\t\t\t\t\ttotalCount\n457|\t\t\t\t}\n458|\t\t\t\tassignees(first: 100) {\n459|\t\t\t\t\tnodes {\n460|\t\t\t\t\t\tlogin\n461|\t\t\t\t\t}\n462|\t\t\t\t\ttotalCount\n463|\t\t\t\t}\n464|\t\t\t\tlabels(first: 100) {\n465|\t\t\t\t\tnodes {\n466|\t\t\t\t\t\tname\n467|\t\t\t\t\t}\n468|\t\t\t\t\ttotalCount\n469|\t\t\t\t}\n470|\t\t\t\tprojectCards(first: 100) {\n471|\t\t\t\t\tnodes {\n472|\t\t\t\t\t\tproject {\n473|\t\t\t\t\t\t\tname\n474|\t\t\t\t\t\t}\n475|\t\t\t\t\t\tcolumn {\n476|\t\t\t\t\t\t\tname\n477|\t\t\t\t\t\t}\n478|\t\t\t\t\t}\n479|\t\t\t\t\ttotalCount\n480|\t\t\t\t}\n481|\t\t\t\tmilestone{\n482|\t\t\t\t\ttitle\n483|\t\t\t\t}\n484|\t\t\t}\n485|\t\t}\n486|\t}`\n487|\n488|\tvariables := map[string]interface{}{\n489|\t\t\"owner\":     repo.RepoOwner(),\n490|\t\t\"repo\":      repo.RepoName(),\n491|\t\t\"pr_number\": number,\n492|\t}\n493|\n494|\tvar resp response\n495|\terr := client.GraphQL(repo.RepoHost(), query, variables, &resp)\n496|\tif err != nil {\n497|\t\treturn nil, err\n498|\t}\n499|\n500|\treturn &resp.Repository.PullRequest, nil\n501|}\n502|\n503|func PullRequestForBranch(client *Client, repo ghrepo.Interface, baseBranch, headBranch string) (*PullRequest, error) {\n504|\ttype response struct {\n505|\t\tRepository struct {\n506|\t\t\tPullRequests struct {\n507|\t\t\t\tID    githubv4.ID\n508|\t\t\t\tNodes []PullRequest\n509|\t\t\t}\n510|\t\t}\n511|\t}\n512|\n513|\tquery := `\n514|\tquery PullRequestForBranch($owner: String!, $repo: String!, $headRefName: String!) {\n515|\t\trepository(owner: $owner, name: $repo) {\n516|\t\t\tpullRequests(headRefName: $headRefName, states: OPEN, first: 30) {\n517|\t\t\t\tnodes {\n518|\t\t\t\t\tid\n519|\t\t\t\t\tnumber\n520|\t\t\t\t\ttitle\n521|\t\t\t\t\tstate\n522|\t\t\t\t\tbody\n523|\t\t\t\t\tmergeable\n524|\t\t\t\t\tauthor {\n525|\t\t\t\t\t\tlogin\n526|\t\t\t\t\t}\n527|\t\t\t\t\tcommits {\n528|\t\t\t\t\t\ttotalCount\n529|\t\t\t\t\t}\n530|\t\t\t\t\turl\n531|\t\t\t\t\tbaseRefName\n532|\t\t\t\t\theadRefName\n533|\t\t\t\t\theadRepositoryOwner {\n534|\t\t\t\t\t\tlogin\n535|\t\t\t\t\t}\n536|\t\t\t\t\theadRepository {\n537|\t\t\t\t\t\tname\n538|\t\t\t\t\t}\n539|\t\t\t\t\tisCrossRepository\n540|\t\t\t\t\tisDraft\n541|\t\t\t\t\tmaintainerCanModify\n542|\t\t\t\t\treviewRequests(first: 100) {\n543|\t\t\t\t\t\tnodes {\n544|\t\t\t\t\t\t\trequestedReviewer {\n545|\t\t\t\t\t\t\t\t__typename\n546|\t\t\t\t\t\t\t\t...on User {\n547|\t\t\t\t\t\t\t\t\tlogin\n548|\t\t\t\t\t\t\t\t}\n549|\t\t\t\t\t\t\t\t...on Team {\n550|\t\t\t\t\t\t\t\t\tname\n551|\t\t\t\t\t\t\t\t}\n552|\t\t\t\t\t\t\t}\n553|\t\t\t\t\t\t}\n554|\t\t\t\t\t\ttotalCount\n555|\t\t\t\t\t}\n556|\t\t\t\t\treviews(last: 100) {\n557|\t\t\t\t\t\tnodes {\n558|\t\t\t\t\t\t\tauthor {\n559|\t\t\t\t\t\t\t  login\n560|\t\t\t\t\t\t\t}\n561|\t\t\t\t\t\t\tstate\n562|\t\t\t\t\t\t}\n563|\t\t\t\t\t\ttotalCount\n564|\t\t\t\t\t}\n565|\t\t\t\t\tassignees(first: 100) {\n566|\t\t\t\t\t\tnodes {\n567|\t\t\t\t\t\t\tlogin\n568|\t\t\t\t\t\t}\n569|\t\t\t\t\t\ttotalCount\n570|\t\t\t\t\t}\n571|\t\t\t\t\tlabels(first: 100) {\n572|\t\t\t\t\t\tnodes {\n573|\t\t\t\t\t\t\tname\n574|\t\t\t\t\t\t}\n575|\t\t\t\t\t\ttotalCount\n576|\t\t\t\t\t}\n577|\t\t\t\t\tprojectCards(first: 100) {\n578|\t\t\t\t\t\tnodes {\n579|\t\t\t\t\t\t\tproject {\n580|\t\t\t\t\t\t\t\tname\n581|\t\t\t\t\t\t\t}\n582|\t\t\t\t\t\t\tcolumn {\n583|\t\t\t\t\t\t\t\tname\n584|\t\t\t\t\t\t\t}\n585|\t\t\t\t\t\t}\n586|\t\t\t\t\t\ttotalCount\n587|\t\t\t\t\t}\n588|\t\t\t\t\tmilestone{\n589|\t\t\t\t\t\ttitle\n590|\t\t\t\t\t}\n591|\t\t\t\t}\n592|\t\t\t}\n593|\t\t}\n594|\t}`\n595|\n596|\tbranchWithoutOwner := headBranch\n597|\tif idx := strings.Index(headBranch, \":\"); idx >= 0 {\n598|\t\tbranchWithoutOwner = headBranch[idx+1:]\n599|\t}\n600|\n601|\tvariables := map[string]interface{}{\n602|\t\t\"owner\":       repo.RepoOwner(),\n603|\t\t\"repo\":        repo.RepoName(),\n604|\t\t\"headRefName\": branchWithoutOwner,\n605|\t}\n606|\n607|\tvar resp response\n608|\terr := client.GraphQL(repo.RepoHost(), query, variables, &resp)\n609|\tif err != nil {\n610|\t\treturn nil, err\n611|\t}\n612|\n613|\tfor _, pr := range resp.Repository.PullRequests.Nodes {\n614|\t\tif pr.HeadLabel() == headBranch {\n615|\t\t\tif baseBranch != \"\" {\n616|\t\t\t\tif pr.BaseRefName != baseBranch {\n617|\t\t\t\t\tcontinue\n618|\t\t\t\t}\n619|\t\t\t}\n620|\t\t\treturn &pr, nil\n621|\t\t}\n622|\t}\n623|\n624|\treturn nil, &NotFoundError{fmt.Errorf(\"no open pull requests found for branch %q\", headBranch)}\n625|}\n626|\n627|// CreatePullRequest creates a pull request in a GitHub repository\n628|func CreatePullRequest(client *Client, repo *Repository, params map[string]interface{}) (*PullRequest, error) {\n629|\tquery := `\n630|\t\tmutation PullRequestCreate($input: CreatePullRequestInput!) {\n631|\t\t\tcreatePullRequest(input: $input) {\n632|\t\t\t\tpullRequest {\n633|\t\t\t\t\tid\n634|\t\t\t\t\turl\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npkg/cmd/pr/view/view.go\nline: 82\nline: 100\nline: 103\nfunction: printRawPrPreview\n```",
          "```\npkg/cmd/pr/view/view.go\nfunction: viewRun\nfunction: printRawPrPreview\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npkg/cmd/pr/view/view.go\nline: 82\nline: 100\nline: 103\nfunction: printRawPrPreview\n```",
            "```\npkg/cmd/pr/view/view.go\nfunction: viewRun\nfunction: printRawPrPreview\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "pkg/cmd/pr/view/view.go": [
          "function: viewRun\nfunction: printRawPrPreview"
        ],
        "api/queries_pr.go": [
          ""
        ],
        "pkg/cmd/pr/shared/display.go": [
          ""
        ]
      },
      "patches": [
        "diff --git a/pkg/cmd/pr/view/view.go b/pkg/cmd/pr/view/view.go\nindex 7a1e912..87228fa 100644\n--- a/pkg/cmd/pr/view/view.go\n+++ b/pkg/cmd/pr/view/view.go\n@@ -110,6 +110,15 @@ func printRawPrPreview(out io.Writer, pr *api.PullRequest) error {\n \tfmt.Fprintf(out, \"state:\\t%s\\n\", prStateWithDraft(pr))\n \tfmt.Fprintf(out, \"author:\\t%s\\n\", pr.Author.Login)\n \tfmt.Fprintf(out, \"labels:\\t%s\\n\", labels)\n+\tfmt.Fprintf(out, \"number:\\t%d\\n\", pr.Number)\n+\tfmt.Fprintf(out, \"commit_count:\\t%d\\n\", pr.Commits.TotalCount)\n+\tfmt.Fprintf(out, \"url:\\t%s\\n\", pr.URL)\n+\tfmt.Fprintf(out, \"base_repo_owner:\\t%s\\n\", pr.BaseRepository.Owner.Login)\n+\tfmt.Fprintf(out, \"base_repo:\\t%s\\n\", pr.BaseRepository.Name)\n+\tfmt.Fprintf(out, \"base_branch:\\t%s\\n\", pr.BaseRefName)\n+\tfmt.Fprintf(out, \"pr_repo_owner:\\t%s\\n\", pr.HeadRepository.Owner.Login)\n+\tfmt.Fprintf(out, \"pr_repo:\\t%s\\n\", pr.HeadRepository.Name)\n+\tfmt.Fprintf(out, \"pr_branch:\\t%s\\n\", pr.HeadRefName)\n \tfmt.Fprintf(out, \"assignees:\\t%s\\n\", assignees)\n \tfmt.Fprintf(out, \"reviewers:\\t%s\\n\", reviewers)\n \tfmt.Fprintf(out, \"projects:\\t%s\\n\", projects)\n",
        "diff --git a/pkg/cmd/pr/view/view.go b/pkg/cmd/pr/view/view.go\nindex 7a1e912..87228fa 100644\n--- a/pkg/cmd/pr/view/view.go\n+++ b/pkg/cmd/pr/view/view.go\n@@ -110,6 +110,15 @@ func printRawPrPreview(out io.Writer, pr *api.PullRequest) error {\n \tfmt.Fprintf(out, \"state:\\t%s\\n\", prStateWithDraft(pr))\n \tfmt.Fprintf(out, \"author:\\t%s\\n\", pr.Author.Login)\n \tfmt.Fprintf(out, \"labels:\\t%s\\n\", labels)\n+\tfmt.Fprintf(out, \"number:\\t%d\\n\", pr.Number)\n+\tfmt.Fprintf(out, \"commit_count:\\t%d\\n\", pr.Commits.TotalCount)\n+\tfmt.Fprintf(out, \"url:\\t%s\\n\", pr.URL)\n+\tfmt.Fprintf(out, \"base_repo_owner:\\t%s\\n\", pr.BaseRepository.Owner.Login)\n+\tfmt.Fprintf(out, \"base_repo:\\t%s\\n\", pr.BaseRepository.Name)\n+\tfmt.Fprintf(out, \"base_branch:\\t%s\\n\", pr.BaseRefName)\n+\tfmt.Fprintf(out, \"pr_repo_owner:\\t%s\\n\", pr.HeadRepository.Owner.Login)\n+\tfmt.Fprintf(out, \"pr_repo:\\t%s\\n\", pr.HeadRepository.Name)\n+\tfmt.Fprintf(out, \"pr_branch:\\t%s\\n\", pr.HeadRefName)\n \tfmt.Fprintf(out, \"assignees:\\t%s\\n\", assignees)\n \tfmt.Fprintf(out, \"reviewers:\\t%s\\n\", reviewers)\n \tfmt.Fprintf(out, \"projects:\\t%s\\n\", projects)\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nProvide all metadata fields in scripted `pr view`\n### Describe the feature or problem you’d like to solve\r\n\r\nI am trying to automate doing something with the PR just created from the current branch. `gh pr view` will print out the PR info including the URL, which would be fine, except that if your redirect stdout it drops this information. (I understand having a command behave differently in interactive vs scripted contexts, but this seems like a pretty surprising behavior).\r\n\r\n### Proposed solution\r\n\r\nAll information in the interactive view should also be present in the scripted view. In particular `gh pr view` should include the PR number and URL (and/or include the owner and repo name as separate fields). \r\n\r\nHow will it benefit CLI and its users?\r\nThis enables `gh` to be used with other automation that operates on PRs.\r\n\r\n### Additional context\r\n\r\n<details>\r\n<summary>Current behavior</summary>\r\n\r\n```\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view\r\nMerge main -> google\r\nOpen • GMNGeoffrey wants to merge 14 commits into google from main-to-google\r\n\r\nLabels: cla: yes\r\n\r\n\r\n                                                                              \r\n  • e15008ca Standardize E2E module names. (#2872)                            \r\n  • e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)    \r\n  • 177925c4 Mark unanalyzable XLA target as manual (#2881)                   \r\n  • 8204a7a8 Merge google -> main #2877                                       \r\n  • 45d5f5a1 Avoid confusing error message in TF tests (#2879)                \r\n  • 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags         \r\n  • c2e59d2e Workaround for issue in #2878.                                   \r\n  • 99ed353d Reworking type conversion to support VM target options.          \r\n  • a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.      \r\n  • 0a473431 Plumbing VM TargetOptions through conversion passes.             \r\n  • 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.     \r\n  • 2ff8b399 Removing unused TypeConversionUtils.                             \r\n  • 3546d64c Merge google -> main (#2876)                                     \r\n  • d13546b2 Remove uses of kind on derived mlir Attribute and Type classes   \r\n  (#2861)                                                                     \r\n\r\n\r\n\r\nView this pull request on GitHub: https://github.com/google/iree/pull/2887\r\n\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view > /tmp/pr.txt && cat /tmp/pr.txt \r\ntitle:  Merge main -> google\r\nstate:  OPEN\r\nauthor: GMNGeoffrey\r\nlabels: cla: yes\r\nassignees:\r\nreviewers:\r\nprojects:\r\nmilestone:\r\n--\r\n* e15008ca Standardize E2E module names. (#2872)\r\n* e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)\r\n* 177925c4 Mark unanalyzable XLA target as manual (#2881)\r\n* 8204a7a8 Merge google -> main #2877\r\n* 45d5f5a1 Avoid confusing error message in TF tests (#2879)\r\n* 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags\r\n* c2e59d2e Workaround for issue in #2878.\r\n* 99ed353d Reworking type conversion to support VM target options.\r\n* a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.\r\n* 0a473431 Plumbing VM TargetOptions through conversion passes.\r\n* 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.\r\n* 2ff8b399 Removing unused TypeConversionUtils.\r\n* 3546d64c Merge google -> main (#2876)\r\n* d13546b2 Remove uses of kind on derived mlir Attribute and Type classes (#2861)```\r\n```\r\n</details>\r\n\r\n\r\n<details>\r\n<summary>Proposed behavior</summary>\r\n\r\n```\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view\r\nMerge main -> google\r\nOpen • GMNGeoffrey wants to merge 14 commits into google from main-to-google\r\n\r\nLabels: cla: yes\r\n\r\n\r\n                                                                              \r\n  • e15008ca Standardize E2E module names. (#2872)                            \r\n  • e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)    \r\n  • 177925c4 Mark unanalyzable XLA target as manual (#2881)                   \r\n  • 8204a7a8 Merge google -> main #2877                                       \r\n  • 45d5f5a1 Avoid confusing error message in TF tests (#2879)                \r\n  • 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags         \r\n  • c2e59d2e Workaround for issue in #2878.                                   \r\n  • 99ed353d Reworking type conversion to support VM target options.          \r\n  • a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.      \r\n  • 0a473431 Plumbing VM TargetOptions through conversion passes.             \r\n  • 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.     \r\n  • 2ff8b399 Removing unused TypeConversionUtils.                             \r\n  • 3546d64c Merge google -> main (#2876)                                     \r\n  • d13546b2 Remove uses of kind on derived mlir Attribute and Type classes   \r\n  (#2861)                                                                     \r\n\r\n\r\n\r\nView this pull request on GitHub: https://github.com/google/iree/pull/2887\r\n\r\ngcmn@ws 2020-08-14 10:56 ~/git/iree$ gh pr view > /tmp/pr.txt && cat /tmp/pr.txt \r\ntitle:  Merge main -> google\r\nstate:  OPEN\r\nauthor: GMNGeoffrey\r\nlabels: cla: yes\r\nnumber: 2887\r\ncommit_count: 14\r\nurl: https://github.com/google/iree/pull/2887\r\nbase_repo_owner: google\r\nbase_repo: iree\r\nbase_branch: google\r\npr_repo_owner: GMNGeoffrey\r\npr_repo: iree\r\npr_branch: main-to-google\r\nassignees:\r\nreviewers:\r\nprojects:\r\nmilestone:\r\n--\r\n* e15008ca Standardize E2E module names. (#2872)\r\n* e5d0f61e Add support for mhlo.log_plus_one on all the backends. (2873)\r\n* 177925c4 Mark unanalyzable XLA target as manual (#2881)\r\n* 8204a7a8 Merge google -> main #2877\r\n* 45d5f5a1 Avoid confusing error message in TF tests (#2879)\r\n* 064dd2b7 Merge pull request #2742 from google/benvanik-vm64-flags\r\n* c2e59d2e Workaround for issue in #2878.\r\n* 99ed353d Reworking type conversion to support VM target options.\r\n* a8ef9dc3 Supporting new VM TargetOptions type conversion in std->vm.\r\n* 0a473431 Plumbing VM TargetOptions through conversion passes.\r\n* 87c96f26 Adding IREE::VM::TargetOptions and --iree-vm-target-* flags.\r\n* 2ff8b399 Removing unused TypeConversionUtils.\r\n* 3546d64c Merge google -> main (#2876)\r\n* d13546b2 Remove uses of kind on derived mlir Attribute and Type classes (#2861)```\r\n```\r\n</details>\r\n\n\n###\n### pkg/cmd/pr/view/view.go\n1|package view\n2|\n3|import (\n4|\t\"fmt\"\n5|\t\"io\"\n6|\t\"net/http\"\n7|\t\"sort\"\n8|\t\"strings\"\n9|\n10|\t\"github.com/MakeNowJust/heredoc\"\n11|\t\"github.com/cli/cli/api\"\n12|\t\"github.com/cli/cli/context\"\n13|\t\"github.com/cli/cli/internal/config\"\n14|\t\"github.com/cli/cli/internal/ghrepo\"\n15|\t\"github.com/cli/cli/pkg/cmd/pr/shared\"\n16|\t\"github.com/cli/cli/pkg/cmdutil\"\n17|\t\"github.com/cli/cli/pkg/iostreams\"\n18|\t\"github.com/cli/cli/utils\"\n19|\t\"github.com/spf13/cobra\"\n20|)\n21|\n22|type ViewOptions struct {\n23|\tHttpClient func() (*http.Client, error)\n24|\tConfig     func() (config.Config, error)\n25|\tIO         *iostreams.IOStreams\n26|\tBaseRepo   func() (ghrepo.Interface, error)\n27|\tRemotes    func() (context.Remotes, error)\n28|\tBranch     func() (string, error)\n29|\n30|\tSelectorArg string\n31|\tBrowserMode bool\n32|}\n33|\n34|func NewCmdView(f *cmdutil.Factory, runF func(*ViewOptions) error) *cobra.Command {\n35|\topts := &ViewOptions{\n36|\t\tIO:         f.IOStreams,\n37|\t\tHttpClient: f.HttpClient,\n38|\t\tConfig:     f.Config,\n39|\t\tRemotes:    f.Remotes,\n40|\t\tBranch:     f.Branch,\n41|\t}\n42|\n43|\tcmd := &cobra.Command{\n44|\t\tUse:   \"view [<number> | <url> | <branch>]\",\n45|\t\tShort: \"View a pull request\",\n46|\t\tLong: heredoc.Doc(`\n47|\t\t\tDisplay the title, body, and other information about a pull request.\n48|\n49|\t\t\tWithout an argument, the pull request that belongs to the current branch\n50|\t\t\tis displayed.\n51|\t\t\t\n52|\t\t\tWith '--web', open the pull request in a web browser instead.\n53|    \t`),\n54|\t\tArgs: cobra.MaximumNArgs(1),\n55|\t\tRunE: func(cmd *cobra.Command, args []string) error {\n56|\t\t\t// support `-R, --repo` override\n57|\t\t\topts.BaseRepo = f.BaseRepo\n58|\n59|\t\t\tif len(args) > 0 {\n60|\t\t\t\topts.SelectorArg = args[0]\n61|\t\t\t}\n62|\n63|\t\t\tif runF != nil {\n64|\t\t\t\treturn runF(opts)\n65|\t\t\t}\n66|\t\t\treturn viewRun(opts)\n67|\t\t},\n68|\t}\n69|\n70|\tcmd.Flags().BoolVarP(&opts.BrowserMode, \"web\", \"w\", false, \"Open a pull request in the browser\")\n71|\n72|\treturn cmd\n73|}\n74|\n75|func viewRun(opts *ViewOptions) error {\n76|\thttpClient, err := opts.HttpClient()\n77|\tif err != nil {\n78|\t\treturn err\n79|\t}\n80|\tapiClient := api.NewClientFromHTTP(httpClient)\n81|\n82|\tpr, _, err := shared.PRFromArgs(apiClient, opts.BaseRepo, opts.Branch, opts.Remotes, opts.SelectorArg)\n83|\tif err != nil {\n84|\t\treturn err\n85|\t}\n86|\n87|\topenURL := pr.URL\n88|\tconnectedToTerminal := opts.IO.IsStdoutTTY() && opts.IO.IsStderrTTY()\n89|\n90|\tif opts.BrowserMode {\n91|\t\tif connectedToTerminal {\n92|\t\t\tfmt.Fprintf(opts.IO.ErrOut, \"Opening %s in your browser.\\n\", openURL)\n93|\t\t}\n94|\t\treturn utils.OpenInBrowser(openURL)\n95|\t}\n96|\n97|\tif connectedToTerminal {\n98|\t\treturn printHumanPrPreview(opts.IO.Out, pr)\n99|\t}\n100|\treturn printRawPrPreview(opts.IO.Out, pr)\n101|}\n102|\n103|func printRawPrPreview(out io.Writer, pr *api.PullRequest) error {\n104|\treviewers := prReviewerList(*pr)\n105|\tassignees := prAssigneeList(*pr)\n106|\tlabels := prLabelList(*pr)\n107|\tprojects := prProjectList(*pr)\n108|\n109|\tfmt.Fprintf(out, \"title:\\t%s\\n\", pr.Title)\n110|\tfmt.Fprintf(out, \"state:\\t%s\\n\", prStateWithDraft(pr))\n111|\tfmt.Fprintf(out, \"author:\\t%s\\n\", pr.Author.Login)\n112|\tfmt.Fprintf(out, \"labels:\\t%s\\n\", labels)\n113|\tfmt.Fprintf(out, \"assignees:\\t%s\\n\", assignees)\n114|\tfmt.Fprintf(out, \"reviewers:\\t%s\\n\", reviewers)\n115|\tfmt.Fprintf(out, \"projects:\\t%s\\n\", projects)\n116|\tfmt.Fprintf(out, \"milestone:\\t%s\\n\", pr.Milestone.Title)\n117|\n118|\tfmt.Fprintln(out, \"--\")\n119|\tfmt.Fprintln(out, pr.Body)\n120|\n121|\treturn nil\n122|}\n123|\n124|func printHumanPrPreview(out io.Writer, pr *api.PullRequest) error {\n125|\t// Header (Title and State)\n126|\tfmt.Fprintln(out, utils.Bold(pr.Title))\n127|\tfmt.Fprintf(out, \"%s\", shared.StateTitleWithColor(*pr))\n128|\tfmt.Fprintln(out, utils.Gray(fmt.Sprintf(\n129|\t\t\" • %s wants to merge %s into %s from %s\",\n130|\t\tpr.Author.Login,\n131|\t\tutils.Pluralize(pr.Commits.TotalCount, \"commit\"),\n132|\t\tpr.BaseRefName,\n133|\t\tpr.HeadRefName,\n134|\t)))\n135|\tfmt.Fprintln(out)\n136|\n137|\t// Metadata\n138|\tif reviewers := prReviewerList(*pr); reviewers != \"\" {\n139|\t\tfmt.Fprint(out, utils.Bold(\"Reviewers: \"))\n140|\t\tfmt.Fprintln(out, reviewers)\n141|\t}\n142|\tif assignees := prAssigneeList(*pr); assignees != \"\" {\n143|\t\tfmt.Fprint(out, utils.Bold(\"Assignees: \"))\n144|\t\tfmt.Fprintln(out, assignees)\n145|\t}\n146|\tif labels := prLabelList(*pr); labels != \"\" {\n147|\t\tfmt.Fprint(out, utils.Bold(\"Labels: \"))\n148|\t\tfmt.Fprintln(out, labels)\n149|\t}\n150|\tif projects := prProjectList(*pr); projects != \"\" {\n151|\t\tfmt.Fprint(out, utils.Bold(\"Projects: \"))\n152|\t\tfmt.Fprintln(out, projects)\n153|\t}\n154|\tif pr.Milestone.Title != \"\" {\n155|\t\tfmt.Fprint(out, utils.Bold(\"Milestone: \"))\n156|\t\tfmt.Fprintln(out, pr.Milestone.Title)\n157|\t}\n158|\n159|\t// Body\n160|\tif pr.Body != \"\" {\n161|\t\tfmt.Fprintln(out)\n162|\t\tmd, err := utils.RenderMarkdown(pr.Body)\n163|\t\tif err != nil {\n164|\t\t\treturn err\n165|\t\t}\n166|\t\tfmt.Fprintln(out, md)\n167|\t}\n168|\tfmt.Fprintln(out)\n169|\n170|\t// Footer\n171|\tfmt.Fprintf(out, utils.Gray(\"View this pull request on GitHub: %s\\n\"), pr.URL)\n172|\treturn nil\n173|}\n174|\n175|// Ref. https://developer.github.com/v4/enum/pullrequestreviewstate/\n176|const (\n177|\trequestedReviewState        = \"REQUESTED\" // This is our own state for review request\n178|\tapprovedReviewState         = \"APPROVED\"\n179|\tchangesRequestedReviewState = \"CHANGES_REQUESTED\"\n180|\tcommentedReviewState        = \"COMMENTED\"\n181|\tdismissedReviewState        = \"DISMISSED\"\n182|\tpendingReviewState          = \"PENDING\"\n183|)\n184|\n185|type reviewerState struct {\n186|\tName  string\n187|\tState string\n188|}\n189|\n190|// colorFuncForReviewerState returns a color function for a reviewer state\n191|func colorFuncForReviewerState(state string) func(string) string {\n192|\tswitch state {\n193|\tcase requestedReviewState:\n194|\t\treturn utils.Yellow\n195|\tcase approvedReviewState:\n196|\t\treturn utils.Green\n197|\tcase changesRequestedReviewState:\n198|\t\treturn utils.Red\n199|\tcase commentedReviewState:\n200|\t\treturn func(str string) string { return str } // Do nothing\n201|\tdefault:\n202|\t\treturn nil\n203|\t}\n204|}\n205|\n206|// formattedReviewerState formats a reviewerState with state color\n207|func formattedReviewerState(reviewer *reviewerState) string {\n208|\tstate := reviewer.State\n209|\tif state == dismissedReviewState {\n210|\t\t// Show \"DISMISSED\" review as \"COMMENTED\", since \"dimissed\" only makes\n211|\t\t// sense when displayed in an events timeline but not in the final tally.\n212|\t\tstate = commentedReviewState\n213|\t}\n214|\tstateColorFunc := colorFuncForReviewerState(state)\n215|\treturn fmt.Sprintf(\"%s (%s)\", reviewer.Name, stateColorFunc(strings.ReplaceAll(strings.Title(strings.ToLower(state)), \"_\", \" \")))\n216|}\n217|\n218|// prReviewerList generates a reviewer list with their last state\n219|func prReviewerList(pr api.PullRequest) string {\n220|\treviewerStates := parseReviewers(pr)\n221|\treviewers := make([]string, 0, len(reviewerStates))\n222|\n223|\tsortReviewerStates(reviewerStates)\n224|\n225|\tfor _, reviewer := range reviewerStates {\n226|\t\treviewers = append(reviewers, formattedReviewerState(reviewer))\n227|\t}\n228|\n229|\treviewerList := strings.Join(reviewers, \", \")\n230|\n231|\treturn reviewerList\n232|}\n233|\n234|// Ref. https://developer.github.com/v4/union/requestedreviewer/\n235|const teamTypeName = \"Team\"\n236|\n237|const ghostName = \"ghost\"\n238|\n239|// parseReviewers parses given Reviews and ReviewRequests\n240|func parseReviewers(pr api.PullRequest) []*reviewerState {\n241|\treviewerStates := make(map[string]*reviewerState)\n242|\n243|\tfor _, review := range pr.Reviews.Nodes {\n244|\t\tif review.Author.Login != pr.Author.Login {\n245|\t\t\tname := review.Author.Login\n246|\t\t\tif name == \"\" {\n247|\t\t\t\tname = ghostName\n248|\t\t\t}\n249|\t\t\treviewerStates[name] = &reviewerState{\n250|\t\t\t\tName:  name,\n251|\t\t\t\tState: review.State,\n252|\t\t\t}\n253|\t\t}\n254|\t}\n255|\n256|\t// Overwrite reviewer's state if a review request for the same reviewer exists.\n257|\tfor _, reviewRequest := range pr.ReviewRequests.Nodes {\n258|\t\tname := reviewRequest.RequestedReviewer.Login\n259|\t\tif reviewRequest.RequestedReviewer.TypeName == teamTypeName {\n260|\t\t\tname = reviewRequest.RequestedReviewer.Name\n261|\t\t}\n262|\t\treviewerStates[name] = &reviewerState{\n263|\t\t\tName:  name,\n264|\t\t\tState: requestedReviewState,\n265|\t\t}\n266|\t}\n267|\n268|\t// Convert map to slice for ease of sort\n269|\tresult := make([]*reviewerState, 0, len(reviewerStates))\n270|\tfor _, reviewer := range reviewerStates {\n271|\t\tif reviewer.State == pendingReviewState {\n272|\t\t\tcontinue\n273|\t\t}\n274|\t\tresult = append(result, reviewer)\n275|\t}\n276|\n277|\treturn result\n278|}\n279|\n280|// sortReviewerStates puts completed reviews before review requests and sorts names alphabetically\n281|func sortReviewerStates(reviewerStates []*reviewerState) {\n282|\tsort.Slice(reviewerStates, func(i, j int) bool {\n283|\t\tif reviewerStates[i].State == requestedReviewState &&\n284|\t\t\treviewerStates[j].State != requestedReviewState {\n285|\t\t\treturn false\n286|\t\t}\n287|\t\tif reviewerStates[j].State == requestedReviewState &&\n288|\t\t\treviewerStates[i].State != requestedReviewState {\n289|\t\t\treturn true\n290|\t\t}\n291|\n292|\t\treturn reviewerStates[i].Name < reviewerStates[j].Name\n293|\t})\n294|}\n295|\n296|func prAssigneeList(pr api.PullRequest) string {\n297|\tif len(pr.Assignees.Nodes) == 0 {\n298|\t\treturn \"\"\n299|\t}\n300|\n301|\tAssigneeNames := make([]string, 0, len(pr.Assignees.Nodes))\n302|\tfor _, assignee := range pr.Assignees.Nodes {\n303|\t\tAssigneeNames = append(AssigneeNames, assignee.Login)\n304|\t}\n305|\n306|\tlist := strings.Join(AssigneeNames, \", \")\n307|\tif pr.Assignees.TotalCount > len(pr.Assignees.Nodes) {\n308|\t\tlist += \", …\"\n309|\t}\n310|\treturn list\n311|}\n312|\n313|func prLabelList(pr api.PullRequest) string {\n314|\tif len(pr.Labels.Nodes) == 0 {\n315|\t\treturn \"\"\n316|\t}\n317|\n318|\tlabelNames := make([]string, 0, len(pr.Labels.Nodes))\n319|\tfor _, label := range pr.Labels.Nodes {\n320|\t\tlabelNames = append(labelNames, label.Name)\n321|\t}\n322|\n323|\tlist := strings.Join(labelNames, \", \")\n324|\tif pr.Labels.TotalCount > len(pr.Labels.Nodes) {\n325|\t\tlist += \", …\"\n326|\t}\n327|\treturn list\n328|}\n329|\n330|func prProjectList(pr api.PullRequest) string {\n331|\tif len(pr.ProjectCards.Nodes) == 0 {\n332|\t\treturn \"\"\n333|\t}\n334|\n335|\tprojectNames := make([]string, 0, len(pr.ProjectCards.Nodes))\n336|\tfor _, project := range pr.ProjectCards.Nodes {\n337|\t\tcolName := project.Column.Name\n338|\t\tif colName == \"\" {\n339|\t\t\tcolName = \"Awaiting triage\"\n340|\t\t}\n341|\t\tprojectNames = append(projectNames, fmt.Sprintf(\"%s (%s)\", project.Project.Name, colName))\n342|\t}\n343|\n344|\tlist := strings.Join(projectNames, \", \")\n345|\tif pr.ProjectCards.TotalCount > len(pr.ProjectCards.Nodes) {\n346|\t\tlist += \", …\"\n347|\t}\n348|\treturn list\n349|}\n350|\n351|func prStateWithDraft(pr *api.PullRequest) string {\n352|\tif pr.IsDraft && pr.State == \"OPEN\" {\n353|\t\treturn \"DRAFT\"\n354|\t}\n355|\n356|\treturn pr.State\n357|}\n\n\n### api/queries_pr.go\n...\n30|\tViewerCreated   PullRequestAndTotalCount\n31|\tReviewRequested PullRequestAndTotalCount\n32|\tCurrentPR       *PullRequest\n33|\tDefaultBranch   string\n34|}\n35|\n36|type PullRequestAndTotalCount struct {\n37|\tTotalCount   int\n38|\tPullRequests []PullRequest\n39|}\n40|\n41|type PullRequest struct {\n42|\tID          string\n43|\tNumber      int\n44|\tTitle       string\n45|\tState       string\n46|\tClosed      bool\n47|\tURL         string\n48|\tBaseRefName string\n49|\tHeadRefName string\n50|\tBody        string\n51|\tMergeable   string\n52|\n53|\tAuthor struct {\n54|\t\tLogin string\n55|\t}\n56|\tHeadRepositoryOwner struct {\n57|\t\tLogin string\n58|\t}\n59|\tHeadRepository struct {\n60|\t\tName             string\n61|\t\tDefaultBranchRef struct {\n62|\t\t\tName string\n63|\t\t}\n64|\t}\n65|\tIsCrossRepository   bool\n66|\tIsDraft             bool\n67|\tMaintainerCanModify bool\n68|\n69|\tReviewDecision string\n70|\n71|\tCommits struct {\n72|\t\tTotalCount int\n73|\t\tNodes      []struct {\n74|\t\t\tCommit struct {\n75|\t\t\t\tStatusCheckRollup struct {\n76|\t\t\t\t\tContexts struct {\n77|\t\t\t\t\t\tNodes []struct {\n78|\t\t\t\t\t\t\tState      string\n79|\t\t\t\t\t\t\tStatus     string\n80|\t\t\t\t\t\t\tConclusion string\n81|\t\t\t\t\t\t}\n82|\t\t\t\t\t}\n83|\t\t\t\t}\n84|\t\t\t}\n85|\t\t}\n86|\t}\n87|\tReviewRequests struct {\n88|\t\tNodes []struct {\n89|\t\t\tRequestedReviewer struct {\n90|\t\t\t\tTypeName string `json:\"__typename\"`\n91|\t\t\t\tLogin    string\n92|\t\t\t\tName     string\n93|\t\t\t}\n94|\t\t}\n95|\t\tTotalCount int\n96|\t}\n97|\tReviews struct {\n98|\t\tNodes []struct {\n99|\t\t\tAuthor struct {\n100|\t\t\t\tLogin string\n101|\t\t\t}\n102|\t\t\tState string\n103|\t\t}\n104|\t}\n105|\tAssignees struct {\n106|\t\tNodes []struct {\n107|\t\t\tLogin string\n108|\t\t}\n109|\t\tTotalCount int\n110|\t}\n111|\tLabels struct {\n112|\t\tNodes []struct {\n113|\t\t\tName string\n114|\t\t}\n115|\t\tTotalCount int\n116|\t}\n117|\tProjectCards struct {\n118|\t\tNodes []struct {\n119|\t\t\tProject struct {\n120|\t\t\t\tName string\n121|\t\t\t}\n122|\t\t\tColumn struct {\n123|\t\t\t\tName string\n124|\t\t\t}\n125|\t\t}\n126|\t\tTotalCount int\n127|\t}\n128|\tMilestone struct {\n129|\t\tTitle string\n130|\t}\n131|}\n132|\n133|type NotFoundError struct {\n134|\terror\n135|}\n136|\n137|func (err *NotFoundError) Unwrap() error {\n138|\treturn err.error\n139|}\n140|\n...\n388|\t\tReviewRequested: PullRequestAndTotalCount{\n389|\t\t\tPullRequests: reviewRequested,\n390|\t\t\tTotalCount:   resp.ReviewRequested.TotalCount,\n391|\t\t},\n392|\t\tCurrentPR:     currentPR,\n393|\t\tDefaultBranch: resp.Repository.DefaultBranchRef.Name,\n394|\t}\n395|\n396|\treturn &payload, nil\n397|}\n398|\n399|func PullRequestByNumber(client *Client, repo ghrepo.Interface, number int) (*PullRequest, error) {\n400|\ttype response struct {\n401|\t\tRepository struct {\n402|\t\t\tPullRequest PullRequest\n403|\t\t}\n404|\t}\n405|\n406|\tquery := `\n407|\tquery PullRequestByNumber($owner: String!, $repo: String!, $pr_number: Int!) {\n408|\t\trepository(owner: $owner, name: $repo) {\n409|\t\t\tpullRequest(number: $pr_number) {\n410|\t\t\t\tid\n411|\t\t\t\turl\n412|\t\t\t\tnumber\n413|\t\t\t\ttitle\n414|\t\t\t\tstate\n415|\t\t\t\tclosed\n416|\t\t\t\tbody\n417|\t\t\t\tmergeable\n418|\t\t\t\tauthor {\n419|\t\t\t\t  login\n420|\t\t\t\t}\n421|\t\t\t\tcommits {\n422|\t\t\t\t  totalCount\n423|\t\t\t\t}\n424|\t\t\t\tbaseRefName\n425|\t\t\t\theadRefName\n426|\t\t\t\theadRepositoryOwner {\n427|\t\t\t\t\tlogin\n428|\t\t\t\t}\n429|\t\t\t\theadRepository {\n430|\t\t\t\t\tname\n431|\t\t\t\t}\n432|\t\t\t\tisCrossRepository\n433|\t\t\t\tisDraft\n434|\t\t\t\tmaintainerCanModify\n435|\t\t\t\treviewRequests(first: 100) {\n436|\t\t\t\t\tnodes {\n437|\t\t\t\t\t\trequestedReviewer {\n438|\t\t\t\t\t\t\t__typename\n439|\t\t\t\t\t\t\t...on User {\n440|\t\t\t\t\t\t\t\tlogin\n441|\t\t\t\t\t\t\t}\n442|\t\t\t\t\t\t\t...on Team {\n443|\t\t\t\t\t\t\t\tname\n444|\t\t\t\t\t\t\t}\n445|\t\t\t\t\t\t}\n446|\t\t\t\t\t}\n447|\t\t\t\t\ttotalCount\n448|\t\t\t\t}\n449|\t\t\t\treviews(last: 100) {\n450|\t\t\t\t\tnodes {\n451|\t\t\t\t\t\tauthor {\n452|\t\t\t\t\t\t  login\n453|\t\t\t\t\t\t}\n454|\t\t\t\t\t\tstate\n455|\t\t\t\t\t}\n456|\t\t\t\t\ttotalCount\n457|\t\t\t\t}\n458|\t\t\t\tassignees(first: 100) {\n459|\t\t\t\t\tnodes {\n460|\t\t\t\t\t\tlogin\n461|\t\t\t\t\t}\n462|\t\t\t\t\ttotalCount\n463|\t\t\t\t}\n464|\t\t\t\tlabels(first: 100) {\n465|\t\t\t\t\tnodes {\n466|\t\t\t\t\t\tname\n467|\t\t\t\t\t}\n468|\t\t\t\t\ttotalCount\n469|\t\t\t\t}\n470|\t\t\t\tprojectCards(first: 100) {\n471|\t\t\t\t\tnodes {\n472|\t\t\t\t\t\tproject {\n473|\t\t\t\t\t\t\tname\n474|\t\t\t\t\t\t}\n475|\t\t\t\t\t\tcolumn {\n476|\t\t\t\t\t\t\tname\n477|\t\t\t\t\t\t}\n478|\t\t\t\t\t}\n479|\t\t\t\t\ttotalCount\n480|\t\t\t\t}\n481|\t\t\t\tmilestone{\n482|\t\t\t\t\ttitle\n483|\t\t\t\t}\n484|\t\t\t}\n485|\t\t}\n486|\t}`\n487|\n488|\tvariables := map[string]interface{}{\n489|\t\t\"owner\":     repo.RepoOwner(),\n490|\t\t\"repo\":      repo.RepoName(),\n491|\t\t\"pr_number\": number,\n492|\t}\n493|\n494|\tvar resp response\n495|\terr := client.GraphQL(repo.RepoHost(), query, variables, &resp)\n496|\tif err != nil {\n497|\t\treturn nil, err\n498|\t}\n499|\n500|\treturn &resp.Repository.PullRequest, nil\n501|}\n502|\n503|func PullRequestForBranch(client *Client, repo ghrepo.Interface, baseBranch, headBranch string) (*PullRequest, error) {\n504|\ttype response struct {\n505|\t\tRepository struct {\n506|\t\t\tPullRequests struct {\n507|\t\t\t\tID    githubv4.ID\n508|\t\t\t\tNodes []PullRequest\n509|\t\t\t}\n510|\t\t}\n511|\t}\n512|\n513|\tquery := `\n514|\tquery PullRequestForBranch($owner: String!, $repo: String!, $headRefName: String!) {\n515|\t\trepository(owner: $owner, name: $repo) {\n516|\t\t\tpullRequests(headRefName: $headRefName, states: OPEN, first: 30) {\n517|\t\t\t\tnodes {\n518|\t\t\t\t\tid\n519|\t\t\t\t\tnumber\n520|\t\t\t\t\ttitle\n521|\t\t\t\t\tstate\n522|\t\t\t\t\tbody\n523|\t\t\t\t\tmergeable\n524|\t\t\t\t\tauthor {\n525|\t\t\t\t\t\tlogin\n526|\t\t\t\t\t}\n527|\t\t\t\t\tcommits {\n528|\t\t\t\t\t\ttotalCount\n529|\t\t\t\t\t}\n530|\t\t\t\t\turl\n531|\t\t\t\t\tbaseRefName\n532|\t\t\t\t\theadRefName\n533|\t\t\t\t\theadRepositoryOwner {\n534|\t\t\t\t\t\tlogin\n535|\t\t\t\t\t}\n536|\t\t\t\t\theadRepository {\n537|\t\t\t\t\t\tname\n538|\t\t\t\t\t}\n539|\t\t\t\t\tisCrossRepository\n540|\t\t\t\t\tisDraft\n541|\t\t\t\t\tmaintainerCanModify\n542|\t\t\t\t\treviewRequests(first: 100) {\n543|\t\t\t\t\t\tnodes {\n544|\t\t\t\t\t\t\trequestedReviewer {\n545|\t\t\t\t\t\t\t\t__typename\n546|\t\t\t\t\t\t\t\t...on User {\n547|\t\t\t\t\t\t\t\t\tlogin\n548|\t\t\t\t\t\t\t\t}\n549|\t\t\t\t\t\t\t\t...on Team {\n550|\t\t\t\t\t\t\t\t\tname\n551|\t\t\t\t\t\t\t\t}\n552|\t\t\t\t\t\t\t}\n553|\t\t\t\t\t\t}\n554|\t\t\t\t\t\ttotalCount\n555|\t\t\t\t\t}\n556|\t\t\t\t\treviews(last: 100) {\n557|\t\t\t\t\t\tnodes {\n558|\t\t\t\t\t\t\tauthor {\n559|\t\t\t\t\t\t\t  login\n560|\t\t\t\t\t\t\t}\n561|\t\t\t\t\t\t\tstate\n562|\t\t\t\t\t\t}\n563|\t\t\t\t\t\ttotalCount\n564|\t\t\t\t\t}\n565|\t\t\t\t\tassignees(first: 100) {\n566|\t\t\t\t\t\tnodes {\n567|\t\t\t\t\t\t\tlogin\n568|\t\t\t\t\t\t}\n569|\t\t\t\t\t\ttotalCount\n570|\t\t\t\t\t}\n571|\t\t\t\t\tlabels(first: 100) {\n572|\t\t\t\t\t\tnodes {\n573|\t\t\t\t\t\t\tname\n574|\t\t\t\t\t\t}\n575|\t\t\t\t\t\ttotalCount\n576|\t\t\t\t\t}\n577|\t\t\t\t\tprojectCards(first: 100) {\n578|\t\t\t\t\t\tnodes {\n579|\t\t\t\t\t\t\tproject {\n580|\t\t\t\t\t\t\t\tname\n581|\t\t\t\t\t\t\t}\n582|\t\t\t\t\t\t\tcolumn {\n583|\t\t\t\t\t\t\t\tname\n584|\t\t\t\t\t\t\t}\n585|\t\t\t\t\t\t}\n586|\t\t\t\t\t\ttotalCount\n587|\t\t\t\t\t}\n588|\t\t\t\t\tmilestone{\n589|\t\t\t\t\t\ttitle\n590|\t\t\t\t\t}\n591|\t\t\t\t}\n592|\t\t\t}\n593|\t\t}\n594|\t}`\n595|\n596|\tbranchWithoutOwner := headBranch\n597|\tif idx := strings.Index(headBranch, \":\"); idx >= 0 {\n598|\t\tbranchWithoutOwner = headBranch[idx+1:]\n599|\t}\n600|\n601|\tvariables := map[string]interface{}{\n602|\t\t\"owner\":       repo.RepoOwner(),\n603|\t\t\"repo\":        repo.RepoName(),\n604|\t\t\"headRefName\": branchWithoutOwner,\n605|\t}\n606|\n607|\tvar resp response\n608|\terr := client.GraphQL(repo.RepoHost(), query, variables, &resp)\n609|\tif err != nil {\n610|\t\treturn nil, err\n611|\t}\n612|\n613|\tfor _, pr := range resp.Repository.PullRequests.Nodes {\n614|\t\tif pr.HeadLabel() == headBranch {\n615|\t\t\tif baseBranch != \"\" {\n616|\t\t\t\tif pr.BaseRefName != baseBranch {\n617|\t\t\t\t\tcontinue\n618|\t\t\t\t}\n619|\t\t\t}\n620|\t\t\treturn &pr, nil\n621|\t\t}\n622|\t}\n623|\n624|\treturn nil, &NotFoundError{fmt.Errorf(\"no open pull requests found for branch %q\", headBranch)}\n625|}\n626|\n627|// CreatePullRequest creates a pull request in a GitHub repository\n628|func CreatePullRequest(client *Client, repo *Repository, params map[string]interface{}) (*PullRequest, error) {\n629|\tquery := `\n630|\t\tmutation PullRequestCreate($input: CreatePullRequestInput!) {\n631|\t\t\tcreatePullRequest(input: $input) {\n632|\t\t\t\tpullRequest {\n633|\t\t\t\t\tid\n634|\t\t\t\t\turl\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npkg/cmd/pr/view/view.go\nline: 82\nline: 100\nline: 103\nfunction: printRawPrPreview\n```",
          "```\npkg/cmd/pr/view/view.go\nfunction: viewRun\nfunction: printRawPrPreview\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npkg/cmd/pr/view/view.go\nline: 82\nline: 100\nline: 103\nfunction: printRawPrPreview\n```",
            "```\npkg/cmd/pr/view/view.go\nfunction: viewRun\nfunction: printRawPrPreview\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/pkg/cmd/pr/view/view.go b/pkg/cmd/pr/view/view.go\nindex 7a1e912..87228fa 100644\n--- a/pkg/cmd/pr/view/view.go\n+++ b/pkg/cmd/pr/view/view.go\n@@ -110,6 +110,15 @@ func printRawPrPreview(out io.Writer, pr *api.PullRequest) error {\n \tfmt.Fprintf(out, \"state:\\t%s\\n\", prStateWithDraft(pr))\n \tfmt.Fprintf(out, \"author:\\t%s\\n\", pr.Author.Login)\n \tfmt.Fprintf(out, \"labels:\\t%s\\n\", labels)\n+\tfmt.Fprintf(out, \"number:\\t%d\\n\", pr.Number)\n+\tfmt.Fprintf(out, \"commit_count:\\t%d\\n\", pr.Commits.TotalCount)\n+\tfmt.Fprintf(out, \"url:\\t%s\\n\", pr.URL)\n+\tfmt.Fprintf(out, \"base_repo_owner:\\t%s\\n\", pr.BaseRepository.Owner.Login)\n+\tfmt.Fprintf(out, \"base_repo:\\t%s\\n\", pr.BaseRepository.Name)\n+\tfmt.Fprintf(out, \"base_branch:\\t%s\\n\", pr.BaseRefName)\n+\tfmt.Fprintf(out, \"pr_repo_owner:\\t%s\\n\", pr.HeadRepository.Owner.Login)\n+\tfmt.Fprintf(out, \"pr_repo:\\t%s\\n\", pr.HeadRepository.Name)\n+\tfmt.Fprintf(out, \"pr_branch:\\t%s\\n\", pr.HeadRefName)\n \tfmt.Fprintf(out, \"assignees:\\t%s\\n\", assignees)\n \tfmt.Fprintf(out, \"reviewers:\\t%s\\n\", reviewers)\n \tfmt.Fprintf(out, \"projects:\\t%s\\n\", projects)\n",
  "7_resolved": false
}