{
  "instance_id": "Multi-SWE-Bench__typescript__maintenance__bugfix__a7aba10f",
  "original_id": "mui__material-ui-39196",
  "1_model_selected_files": [
    "packages/mui-system/src/Stack/index.ts",
    "packages/mui-system/src/createTheme/createSpacing.ts"
  ],
  "2_embedding_selected_files": [
    "packages/mui-system/src/Stack/Stack.test.js",
    "packages/mui-system/src/createTheme/createSpacing.ts",
    "packages/mui-system/src/spacing.d.ts",
    "packages/mui-system/src/spacing.test.js",
    "packages/mui-system/src/createTheme/createSpacing.test.ts",
    "packages/mui-system/src/spacing.js",
    "packages/mui-system/src/Stack/StackProps.ts",
    "packages/mui-codemod/src/v4.0.0/theme-spacing-api.test/actual.js",
    "packages/mui-codemod/src/v4.0.0/theme-spacing-api.test/expected.js",
    "packages/mui-material/src/Stack/Stack.js",
    "packages/mui-codemod/src/v5.0.0/theme-spacing.test/actual.js",
    "packages/mui-codemod/src/v4.0.0/theme-spacing-api.test/actual_destructured.js",
    "packages/mui-codemod/src/v4.0.0/theme-spacing-api.js",
    "packages/mui-material/src/Stack/Stack.d.ts",
    "packages/mui-codemod/src/v4.0.0/theme-spacing-api.test/expected_destructured.js",
    "packages/mui-codemod/src/v5.0.0/theme-spacing.test/expected.js",
    "packages/mui-codemod/src/v5.0.0/theme-spacing.js",
    "packages/mui-codemod/src/v5.0.0/theme-spacing.test/large-expected.js",
    "packages/mui-codemod/src/v5.0.0/theme-spacing.test.js",
    "packages/mui-system/src/Unstable_Grid/Grid.test.js",
    "packages/mui-codemod/src/v5.0.0/theme-spacing.test/large-actual.js",
    "packages/mui-codemod/src/v4.0.0/theme-spacing-api.test.js",
    "packages/mui-material/src/Grid/Grid.test.js",
    "packages/mui-material/src/styles/CssVarsProvider.test.js",
    "packages/mui-material/src/Grid/Grid.js",
    ".yarn/releases/yarn-1.22.19.js",
    "packages/mui-system/src/Box/Box.d.ts",
    "packages/eslint-plugin-material-ui/src/rules/rules-of-use-theme-variants.js",
    "packages/mui-system/src/Unstable_Grid/gridGenerator.test.js",
    "packages/mui-material/src/Stack/Stack.test.js",
    "packages/mui-system/src/styleFunctionSx/styleFunctionSx.test.js",
    "packages/mui-material/src/styles/createTypography.js",
    "packages/mui-system/src/index.d.ts",
    "packages/mui-codemod/src/v5.0.0/with-width.test/expected.js",
    "packages/mui-material/src/styles/createTypography.test.js",
    "packages/mui-system/src/Unstable_Grid/gridGenerator.ts",
    "packages/mui-material/src/styles/experimental_extendTheme.test.js",
    "packages/mui-material/src/Grid/Grid.d.ts",
    "packages/mui-system/src/styleFunctionSx/defaultSxConfig.js",
    "packages/mui-system/src/style.test.js",
    "packages/eslint-plugin-material-ui/src/rules/rules-of-use-theme-variants.test.js"
  ],
  "3_final_combined_files": [
    "packages/mui-system/src/createTheme/createSpacing.ts",
    "packages/mui-system/src/Stack/index.ts",
    "packages/mui-system/src/Stack/Stack.test.js",
    "packages/mui-system/src/spacing.d.ts"
  ],
  "4_related_elements": {
    "packages/mui-system/src/createTheme/createSpacing.ts": [
      "function: createSpacing"
    ],
    "packages/mui-system/src/Stack/index.ts": [
      ""
    ],
    "packages/mui-system/src/Stack/Stack.test.js": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "packages/mui-system/src/createTheme/createSpacing.ts": [
          "function: createUnarySpacing"
        ],
        "packages/mui-system/src/Stack/index.ts": [
          ""
        ],
        "packages/mui-system/src/Stack/Stack.test.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/mui-system/src/createTheme/createSpacing.ts b/packages/mui-system/src/createTheme/createSpacing.ts\nindex 1983b34..fa021d4 100644\n--- a/packages/mui-system/src/createTheme/createSpacing.ts\n+++ b/packages/mui-system/src/createTheme/createSpacing.ts\n@@ -1,3 +1,4 @@\n+\n import { createUnarySpacing } from '../spacing';\n \n export type SpacingOptions =\n@@ -14,7 +15,7 @@ export type SpacingArgument = number | string;\n /* tslint:disable:unified-signatures */\n export interface Spacing {\n   (): string;\n-  (value: number): string;\n+  (value: SpacingArgument): string;\n   (topBottom: SpacingArgument, rightLeft: SpacingArgument): string;\n   (top: SpacingArgument, rightLeft: SpacingArgument, bottom: SpacingArgument): string;\n   (\n@@ -50,10 +51,26 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n \n     const args = argsInput.length === 0 ? [1] : argsInput;\n \n+    // If a custom spacing function was provided, prefer calling it for string tokens.\n+    const customTransform =\n+      typeof spacingInput === 'function'\n+        ? (spacingInput as (abs: number | string) => number | string)\n+        : null;\n+\n     return args\n       .map((argument) => {\n-        const output = transform(argument);\n-        return typeof output === 'number' ? `${output}px` : output;\n+        let result: number | string;\n+        if (typeof argument === 'string' && customTransform) {\n+          try {\n+            result = customTransform(argument);\n+          } catch (e) {\n+            // Fallback to the default transform if the custom function doesn't handle strings\n+            result = transform(argument);\n+          }\n+        } else {\n+          result = transform(argument);\n+        }\n+        return typeof result === 'number' ? `${result}px` : result;\n       })\n       .join(' ');\n   };\n@@ -61,4 +78,4 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n   spacing.mui = true;\n \n   return spacing;\n-}\n+}\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\n[Stack] allow spacing prop to use token strings\n### Duplicates\r\n\r\n- [X] I have searched the existing issues\r\n\r\n### Latest version\r\n\r\n- [X] I have tested the latest version\r\n\r\n### Summary ðŸ’¡\r\n\r\nThe current implementation of the spacing prop in Stack, will only use the custom spacing function if the value is a number. A small change could be made that would allow string tokens to be used instead. \r\n\r\nThis could help development teams in guiding them as to which token to use, and can avoid larger refactors (by this I mean many small changes) if a new spacing value is added to the spacing design token in the future.\r\n\r\n\r\n### Examples ðŸŒˆ\r\n\r\nProviding the following spacing design token\r\n```typescript\r\nconst spacingMap = {\r\n  xl: '2rem',\r\n  l: '1.25rem',\r\n  m: '1rem',\r\n  s: '0.5rem',\r\n  xs: '0.25rem',\r\n};\r\n\r\n// Create inverse value for when needed\r\nObject.entries(spacingMap).forEach(([key, value]) => {\r\n  spacingMap[('-' + key)] = '-' + value;\r\n});\r\n```\r\n\r\nand custom spacing\r\n```typescript\r\nfunction spacing(abs: number | string): string {\r\n  if (abs in spacingMap) {\r\n    return spacingMap[abs];\r\n  }\r\n  throw new Error(`Invalid spacing value: ${abs}`);\r\n}\r\n\r\nexport const theme = createTheme({\r\n  spacing,\r\n});\r\n```\r\n\r\nYou could use the Stack component (and other components that use a spacing like prop)\r\n```typescript\r\n<Stack spacing=\"l\" />\r\n```\r\n\r\nCurrently this will use the string as the literal value instead of using the custom spacing function\r\n<img width=\"309\" alt=\"image\" src=\"https://github.com/mui/material-ui/assets/79816238/8f754f07-ee82-4428-821f-09827c9cbbba\">\r\n\r\n\r\n### Motivation ðŸ”¦\r\n\r\nIn my teams project, we are building up our design system, based on MUI. \r\n\r\nWe would like to keep the code as close to the design, while also providing a clear description in the usage and are using non-index based tokens (ie, size values) to accomplish this.\r\n\r\nEnabling this functionality could allow teams to choose the representation that works for them, like the size values work.\n\n###\n### packages/mui-system/src/createTheme/createSpacing.ts\n...\n18|  (topBottom: SpacingArgument, rightLeft: SpacingArgument): string;\n19|  (top: SpacingArgument, rightLeft: SpacingArgument, bottom: SpacingArgument): string;\n20|  (\n21|    top: SpacingArgument,\n22|    right: SpacingArgument,\n23|    bottom: SpacingArgument,\n24|    left: SpacingArgument,\n25|  ): string;\n26|}\n27|/* tslint:enable:unified-signatures */\n28|\n29|export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing {\n30|  // Already transformed.\n31|  if ((spacingInput as any).mui) {\n32|    return spacingInput as Spacing;\n33|  }\n34|\n35|  // Material Design layouts are visually balanced. Most measurements align to an 8dp grid, which aligns both spacing and the overall layout.\n36|  // Smaller components, such as icons, can align to a 4dp grid.\n37|  // https://m2.material.io/design/layout/understanding-layout.html\n38|  const transform = createUnarySpacing({\n39|    spacing: spacingInput,\n40|  });\n41|\n42|  const spacing = (...argsInput: ReadonlyArray<number | string>): string => {\n43|    if (process.env.NODE_ENV !== 'production') {\n44|      if (!(argsInput.length <= 4)) {\n45|        console.error(\n46|          `MUI: Too many arguments provided, expected between 0 and 4, got ${argsInput.length}`,\n47|        );\n48|      }\n49|    }\n50|\n51|    const args = argsInput.length === 0 ? [1] : argsInput;\n52|\n53|    return args\n54|      .map((argument) => {\n55|        const output = transform(argument);\n56|        return typeof output === 'number' ? `${output}px` : output;\n57|      })\n58|      .join(' ');\n59|  };\n60|\n61|  spacing.mui = true;\n62|\n63|  return spacing;\n64|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.ts\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.ts\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.ts\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npackages/mui-material/src/Stack/Stack.tsx\nfunction: StackRoot\n\npackages/mui-system/src/createTheme/createSpacing.ts\nfunction: createUnarySpacing\n```",
          "```\npackages/mui-system/src/createTheme/createUnarySpacing.ts\nfunction: createUnarySpacing\n\npackages/mui-system/src/createTheme/createSpacing.ts\nline: 55\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npackages/mui-material/src/Stack/Stack.tsx\nfunction: StackRoot\n\npackages/mui-system/src/createTheme/createSpacing.ts\nfunction: createUnarySpacing\n```",
            "```\npackages/mui-system/src/createTheme/createUnarySpacing.ts\nfunction: createUnarySpacing\n\npackages/mui-system/src/createTheme/createSpacing.ts\nline: 55\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "packages/mui-system/src/createTheme/createSpacing.ts": [
          "line: 55"
        ],
        "packages/mui-system/src/Stack/index.ts": [
          ""
        ],
        "packages/mui-system/src/Stack/Stack.test.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/mui-system/src/createTheme/createSpacing.ts b/packages/mui-system/src/createTheme/createSpacing.ts\nindex 1983b34..e47d2ce 100644\n--- a/packages/mui-system/src/createTheme/createSpacing.ts\n+++ b/packages/mui-system/src/createTheme/createSpacing.ts\n@@ -52,7 +52,11 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n \n     return args\n       .map((argument) => {\n-        const output = transform(argument);\n+        // If a custom spacing function was provided, allow it to handle string tokens too.\n+        const output =\n+          typeof argument === 'string' && typeof spacingInput === 'function'\n+            ? spacingInput(argument)\n+            : transform(argument);\n         return typeof output === 'number' ? `${output}px` : output;\n       })\n       .join(' ');\n@@ -61,4 +65,4 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n   spacing.mui = true;\n \n   return spacing;\n-}\n+}\n",
        "diff --git a/packages/mui-system/src/createTheme/createSpacing.ts b/packages/mui-system/src/createTheme/createSpacing.ts\nindex 1983b34..bc4fb08 100644\n--- a/packages/mui-system/src/createTheme/createSpacing.ts\n+++ b/packages/mui-system/src/createTheme/createSpacing.ts\n@@ -1,3 +1,4 @@\n+\n import { createUnarySpacing } from '../spacing';\n \n export type SpacingOptions =\n@@ -52,7 +53,21 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n \n     return args\n       .map((argument) => {\n-        const output = transform(argument);\n+        let output = transform(argument);\n+\n+        // If a custom spacing function was provided and the argument is a string,\n+        // attempt to resolve token strings via the custom function.\n+        if (typeof argument === 'string' && typeof spacingInput === 'function') {\n+          try {\n+            const maybeToken = (spacingInput as (abs: number | string) => number | string)(\n+              argument,\n+            );\n+            output = maybeToken;\n+          } catch {\n+            // If the custom function doesn't support this value, fall back to the default behavior.\n+          }\n+        }\n+\n         return typeof output === 'number' ? `${output}px` : output;\n       })\n       .join(' ');\n@@ -61,4 +76,4 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n   spacing.mui = true;\n \n   return spacing;\n-}\n+}\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\n[Stack] allow spacing prop to use token strings\n### Duplicates\r\n\r\n- [X] I have searched the existing issues\r\n\r\n### Latest version\r\n\r\n- [X] I have tested the latest version\r\n\r\n### Summary ðŸ’¡\r\n\r\nThe current implementation of the spacing prop in Stack, will only use the custom spacing function if the value is a number. A small change could be made that would allow string tokens to be used instead. \r\n\r\nThis could help development teams in guiding them as to which token to use, and can avoid larger refactors (by this I mean many small changes) if a new spacing value is added to the spacing design token in the future.\r\n\r\n\r\n### Examples ðŸŒˆ\r\n\r\nProviding the following spacing design token\r\n```typescript\r\nconst spacingMap = {\r\n  xl: '2rem',\r\n  l: '1.25rem',\r\n  m: '1rem',\r\n  s: '0.5rem',\r\n  xs: '0.25rem',\r\n};\r\n\r\n// Create inverse value for when needed\r\nObject.entries(spacingMap).forEach(([key, value]) => {\r\n  spacingMap[('-' + key)] = '-' + value;\r\n});\r\n```\r\n\r\nand custom spacing\r\n```typescript\r\nfunction spacing(abs: number | string): string {\r\n  if (abs in spacingMap) {\r\n    return spacingMap[abs];\r\n  }\r\n  throw new Error(`Invalid spacing value: ${abs}`);\r\n}\r\n\r\nexport const theme = createTheme({\r\n  spacing,\r\n});\r\n```\r\n\r\nYou could use the Stack component (and other components that use a spacing like prop)\r\n```typescript\r\n<Stack spacing=\"l\" />\r\n```\r\n\r\nCurrently this will use the string as the literal value instead of using the custom spacing function\r\n<img width=\"309\" alt=\"image\" src=\"https://github.com/mui/material-ui/assets/79816238/8f754f07-ee82-4428-821f-09827c9cbbba\">\r\n\r\n\r\n### Motivation ðŸ”¦\r\n\r\nIn my teams project, we are building up our design system, based on MUI. \r\n\r\nWe would like to keep the code as close to the design, while also providing a clear description in the usage and are using non-index based tokens (ie, size values) to accomplish this.\r\n\r\nEnabling this functionality could allow teams to choose the representation that works for them, like the size values work.\n\n###\n### packages/mui-system/src/createTheme/createSpacing.ts\n...\n18|  (topBottom: SpacingArgument, rightLeft: SpacingArgument): string;\n19|  (top: SpacingArgument, rightLeft: SpacingArgument, bottom: SpacingArgument): string;\n20|  (\n21|    top: SpacingArgument,\n22|    right: SpacingArgument,\n23|    bottom: SpacingArgument,\n24|    left: SpacingArgument,\n25|  ): string;\n26|}\n27|/* tslint:enable:unified-signatures */\n28|\n29|export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing {\n30|  // Already transformed.\n31|  if ((spacingInput as any).mui) {\n32|    return spacingInput as Spacing;\n33|  }\n34|\n35|  // Material Design layouts are visually balanced. Most measurements align to an 8dp grid, which aligns both spacing and the overall layout.\n36|  // Smaller components, such as icons, can align to a 4dp grid.\n37|  // https://m2.material.io/design/layout/understanding-layout.html\n38|  const transform = createUnarySpacing({\n39|    spacing: spacingInput,\n40|  });\n41|\n42|  const spacing = (...argsInput: ReadonlyArray<number | string>): string => {\n43|    if (process.env.NODE_ENV !== 'production') {\n44|      if (!(argsInput.length <= 4)) {\n45|        console.error(\n46|          `MUI: Too many arguments provided, expected between 0 and 4, got ${argsInput.length}`,\n47|        );\n48|      }\n49|    }\n50|\n51|    const args = argsInput.length === 0 ? [1] : argsInput;\n52|\n53|    return args\n54|      .map((argument) => {\n55|        const output = transform(argument);\n56|        return typeof output === 'number' ? `${output}px` : output;\n57|      })\n58|      .join(' ');\n59|  };\n60|\n61|  spacing.mui = true;\n62|\n63|  return spacing;\n64|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.ts\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.ts\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.ts\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npackages/mui-material/src/Stack/Stack.tsx\nfunction: StackRoot\n\npackages/mui-system/src/createTheme/createSpacing.ts\nfunction: createUnarySpacing\n```",
          "```\npackages/mui-system/src/createTheme/createUnarySpacing.ts\nfunction: createUnarySpacing\n\npackages/mui-system/src/createTheme/createSpacing.ts\nline: 55\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npackages/mui-material/src/Stack/Stack.tsx\nfunction: StackRoot\n\npackages/mui-system/src/createTheme/createSpacing.ts\nfunction: createUnarySpacing\n```",
            "```\npackages/mui-system/src/createTheme/createUnarySpacing.ts\nfunction: createUnarySpacing\n\npackages/mui-system/src/createTheme/createSpacing.ts\nline: 55\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/packages/mui-system/src/createTheme/createSpacing.ts b/packages/mui-system/src/createTheme/createSpacing.ts\nindex 1983b34..fa021d4 100644\n--- a/packages/mui-system/src/createTheme/createSpacing.ts\n+++ b/packages/mui-system/src/createTheme/createSpacing.ts\n@@ -1,3 +1,4 @@\n+\n import { createUnarySpacing } from '../spacing';\n \n export type SpacingOptions =\n@@ -14,7 +15,7 @@ export type SpacingArgument = number | string;\n /* tslint:disable:unified-signatures */\n export interface Spacing {\n   (): string;\n-  (value: number): string;\n+  (value: SpacingArgument): string;\n   (topBottom: SpacingArgument, rightLeft: SpacingArgument): string;\n   (top: SpacingArgument, rightLeft: SpacingArgument, bottom: SpacingArgument): string;\n   (\n@@ -50,10 +51,26 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n \n     const args = argsInput.length === 0 ? [1] : argsInput;\n \n+    // If a custom spacing function was provided, prefer calling it for string tokens.\n+    const customTransform =\n+      typeof spacingInput === 'function'\n+        ? (spacingInput as (abs: number | string) => number | string)\n+        : null;\n+\n     return args\n       .map((argument) => {\n-        const output = transform(argument);\n-        return typeof output === 'number' ? `${output}px` : output;\n+        let result: number | string;\n+        if (typeof argument === 'string' && customTransform) {\n+          try {\n+            result = customTransform(argument);\n+          } catch (e) {\n+            // Fallback to the default transform if the custom function doesn't handle strings\n+            result = transform(argument);\n+          }\n+        } else {\n+          result = transform(argument);\n+        }\n+        return typeof result === 'number' ? `${result}px` : result;\n       })\n       .join(' ');\n   };\n@@ -61,4 +78,4 @@ export default function createSpacing(spacingInput: SpacingOptions = 8): Spacing\n   spacing.mui = true;\n \n   return spacing;\n-}\n+}\n",
  "7_resolved": false
}