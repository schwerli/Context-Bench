{
  "instance_id": "Multi-SWE-Bench__java__maintenance__bugfix__14da06bc",
  "original_id": "elastic__logstash-14027",
  "1_model_selected_files": [
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java",
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java",
    "logstash-core/src/main/java/org/logstash/Logstash.java",
    "logstash-core/src/main/java/org/logstash/execution/AbstractPipelineExt.java",
    "logstash-core/src/main/java/org/logstash/execution/JavaBasePipelineExt.java"
  ],
  "2_embedding_selected_files": [
    "logstash-core/src/main/java/org/logstash/ackedqueue/io/MmapPageIOV2.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/PqRepair.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/PqCheck.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/Queue.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/QueueUpgrade.java",
    "logstash-core/src/main/java/org/logstash/execution/AbstractPipelineExt.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/io/MmapPageIOV1.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/io/PageIO.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/PageFactory.java",
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/QueueRuntimeException.java",
    "logstash-core/src/main/java/org/logstash/LockException.java",
    "logstash-core/src/main/java/org/logstash/execution/ShutdownWatcherExt.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/Page.java",
    "logstash-core/src/main/java/org/logstash/common/AbstractDeadLetterQueueWriterExt.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/io/FileCheckpointIO.java",
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineBus.java",
    "logstash-core/src/main/java/org/logstash/common/io/DeadLetterQueueWriter.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/io/CheckpointIO.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/ext/JRubyWrappedAckedQueueExt.java",
    "logstash-core/src/main/java/org/logstash/execution/QueueReadClientBase.java",
    "logstash-core/src/main/java/org/logstash/FileLockFactory.java",
    "logstash-core/src/main/java/org/logstash/execution/PipelineReporterExt.java",
    "logstash-core/src/main/java/org/logstash/ext/JrubyWrappedSynchronousQueueExt.java",
    "logstash-core/src/main/java/org/logstash/execution/WorkerLoop.java",
    "logstash-core/src/main/java/org/logstash/execution/JavaBasePipelineExt.java",
    "logstash-core/src/main/java/org/logstash/execution/PeriodicFlush.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/ext/JRubyAckedQueueExt.java",
    "logstash-core/src/main/java/org/logstash/common/io/DeadLetterQueueReader.java",
    "logstash-core/src/main/java/org/logstash/execution/QueueReadClient.java",
    "logstash-core/src/main/java/org/logstash/Logstash.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/QueueFactoryExt.java"
  ],
  "3_final_combined_files": [
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java",
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java",
    "logstash-core/src/main/java/org/logstash/Logstash.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/io/MmapPageIOV2.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/PqRepair.java",
    "logstash-core/src/main/java/org/logstash/ackedqueue/PqCheck.java"
  ],
  "4_related_elements": {
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java": [
      ""
    ],
    "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java": [
      ""
    ],
    "logstash-core/src/main/java/org/logstash/Logstash.java": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java": [
          "function: PipelineOutput.multiReceive\nfunction: PipelineOutput.doClose\nfunction: LogStash::Agent#converge_state_and_update\nfunction: LogStash::PipelineAction::Reload#execute"
        ],
        "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java": [
          ""
        ],
        "logstash-core/src/main/java/org/logstash/Logstash.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\nindex 90e8f04..91226bf 100644\n--- a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\n+++ b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\n@@ -1,3 +1,4 @@\n+\n /*\n  * Licensed to Elasticsearch B.V. under one or more contributor\n  * license agreements. See the NOTICE file distributed with\n@@ -22,6 +23,29 @@ package org.logstash.plugins.pipeline;\n \n /**\n  * Represents the out endpoint of a pipeline to pipeline communication.\n- * */\n-public interface PipelineOutput {\n-}\n+ * Implementations should ensure that resources (such as PQ locks) are\n+ * released on close to avoid leaking locks across reloads.\n+ */\n+public interface PipelineOutput extends AutoCloseable {\n+\n+    /**\n+     * Releases any resources associated with this pipeline output, such as\n+     * persistent queue locks, in preparation for pipeline shutdown or reload.\n+     * Implementations should make this method idempotent and ensure it does\n+     * not throw.\n+     */\n+    @Override\n+    default void close() {\n+        // default no-op; implementations should override to release resources\n+    }\n+\n+    /**\n+     * Notifies the output that a downstream write exceeded capacity (e.g., page size).\n+     * Implementations should handle this condition without propagating exceptions to\n+     * the upstream pipeline and should log/metrics as appropriate.\n+     * The default implementation is a no-op to preserve backward compatibility.\n+     */\n+    default void onCapacityExceeded() {\n+        // default no-op; implementations may override to handle gracefully\n+    }\n+}\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java": [
          ""
        ],
        "logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java": [
          ""
        ],
        "logstash-core/src/main/java/org/logstash/Logstash.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\nindex 90e8f04..9000c7b 100644\n--- a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\n+++ b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\n@@ -1,3 +1,4 @@\n+\n /*\n  * Licensed to Elasticsearch B.V. under one or more contributor\n  * license agreements. See the NOTICE file distributed with\n@@ -22,6 +23,11 @@ package org.logstash.plugins.pipeline;\n \n /**\n  * Represents the out endpoint of a pipeline to pipeline communication.\n- * */\n-public interface PipelineOutput {\n-}\n+ *\n+ * Implementations must release any held resources (such as PQ locks) when closed to\n+ * ensure proper shutdown and reload behavior.\n+ */\n+public interface PipelineOutput extends AutoCloseable {\n+    @Override\n+    void close() throws Exception;\n+}\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\nindex 90e8f04..91226bf 100644\n--- a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\n+++ b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineOutput.java\n@@ -1,3 +1,4 @@\n+\n /*\n  * Licensed to Elasticsearch B.V. under one or more contributor\n  * license agreements. See the NOTICE file distributed with\n@@ -22,6 +23,29 @@ package org.logstash.plugins.pipeline;\n \n /**\n  * Represents the out endpoint of a pipeline to pipeline communication.\n- * */\n-public interface PipelineOutput {\n-}\n+ * Implementations should ensure that resources (such as PQ locks) are\n+ * released on close to avoid leaking locks across reloads.\n+ */\n+public interface PipelineOutput extends AutoCloseable {\n+\n+    /**\n+     * Releases any resources associated with this pipeline output, such as\n+     * persistent queue locks, in preparation for pipeline shutdown or reload.\n+     * Implementations should make this method idempotent and ensure it does\n+     * not throw.\n+     */\n+    @Override\n+    default void close() {\n+        // default no-op; implementations should override to release resources\n+    }\n+\n+    /**\n+     * Notifies the output that a downstream write exceeded capacity (e.g., page size).\n+     * Implementations should handle this condition without propagating exceptions to\n+     * the upstream pipeline and should log/metrics as appropriate.\n+     * The default implementation is a no-op to preserve backward compatibility.\n+     */\n+    default void onCapacityExceeded() {\n+        // default no-op; implementations may override to handle gracefully\n+    }\n+}\n",
  "7_resolved": false
}