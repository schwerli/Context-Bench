{
  "instance_id": "Multi-SWE-Bench__typescript__maintenance__bugfix__05c9e61e",
  "original_id": "mui__material-ui-23884",
  "1_model_selected_files": [
    "packages/material-ui/src/useAutocomplete/useAutocomplete.js",
    "packages/material-ui/src/Autocomplete/Autocomplete.js",
    "packages/material-ui-lab/src/Autocomplete/Autocomplete.js"
  ],
  "2_embedding_selected_files": [
    "packages/material-ui/src/useAutocomplete/useAutocomplete.js",
    "packages/material-ui/src/useAutocomplete/useAutocomplete.test.js",
    "packages/material-ui/src/Autocomplete/Autocomplete.test.js",
    "packages/material-ui/src/useAutocomplete/useAutocomplete.spec.ts",
    "packages/material-ui/src/Autocomplete/Autocomplete.js",
    "packages/material-ui-utils/src/capitalize.test.js",
    "packages/material-ui/src/Autocomplete/Autocomplete.d.ts",
    "packages/material-ui/src/Select/Select.test.js",
    "packages/material-ui/src/useAutocomplete/useAutocomplete.d.ts",
    "packages/material-ui-utils/src/capitalize.js",
    "packages/material-ui-utils/macros/__fixtures__/literal/output.js",
    "packages/material-ui-utils/macros/__fixtures__/no-error-code-annotation/output.js",
    "packages/material-ui/src/ButtonBase/ButtonBase.test.js",
    "packages/typescript-to-proptypes/src/generator.ts",
    "packages/material-ui/src/utils/capitalize.d.ts",
    "packages/material-ui-lab/src/Autocomplete/Autocomplete.js",
    "packages/material-ui-utils/macros/__fixtures__/relative-import/output.js",
    "packages/material-ui/src/InputBase/InputBase.test.js",
    "packages/material-ui-utils/macros/__fixtures__/relative-import/input.js",
    "packages/material-ui-lab/src/Autocomplete/Autocomplete.d.ts",
    "packages/material-ui/src/Autocomplete/index.js",
    "packages/material-ui-lab/src/useAutocomplete/index.js",
    "packages/material-ui-styles/src/propsToClassKey/propsToClassKey.js",
    "packages/material-ui-utils/macros/__fixtures__/literal/input.js"
  ],
  "3_final_combined_files": [
    "packages/material-ui/src/useAutocomplete/useAutocomplete.js",
    "packages/material-ui/src/Autocomplete/Autocomplete.js",
    "packages/material-ui-lab/src/Autocomplete/Autocomplete.js",
    "packages/material-ui/src/useAutocomplete/useAutocomplete.test.js",
    "packages/material-ui/src/Autocomplete/Autocomplete.test.js"
  ],
  "4_related_elements": {
    "packages/material-ui/src/useAutocomplete/useAutocomplete.js": [
      "function: stripDiacritics\nfunction: createFilterOptions\nfunction: changeHighlightedIndex\nvariable: getOptionLabelProp\nvariable: defaultFilterOptions"
    ],
    "packages/material-ui/src/Autocomplete/Autocomplete.js": [
      "variable: getOptionLabel\nfunction: defaultRenderOption"
    ],
    "packages/material-ui-lab/src/Autocomplete/Autocomplete.js": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "packages/material-ui/src/useAutocomplete/useAutocomplete.js": [
          "line: 83"
        ],
        "packages/material-ui/src/Autocomplete/Autocomplete.js": [
          "line: 287"
        ],
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/material-ui/src/Autocomplete/Autocomplete.js b/packages/material-ui/src/Autocomplete/Autocomplete.js\nindex 2775166..1261705 100644\n--- a/packages/material-ui/src/Autocomplete/Autocomplete.js\n+++ b/packages/material-ui/src/Autocomplete/Autocomplete.js\n@@ -283,7 +283,15 @@ const Autocomplete = React.forwardRef(function Autocomplete(props, ref) {\n     fullWidth = false,\n     getLimitTagsText = (more) => `+${more}`,\n     getOptionDisabled,\n-    getOptionLabel = (option) => option.label ?? option,\n+    getOptionLabel = (option) => {\n+      if (typeof option === 'string') {\n+        return option;\n+      }\n+      if (option && option.label != null) {\n+        return option.label;\n+      }\n+      return String(option);\n+    },\n     getOptionSelected,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\ndiff --git a/packages/material-ui/src/useAutocomplete/useAutocomplete.js b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\nindex c728db5..44e5150 100644\n--- a/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n@@ -79,7 +79,15 @@ export default function useAutocomplete(props) {\n     filterSelectedOptions = false,\n     freeSolo = false,\n     getOptionDisabled,\n-    getOptionLabel: getOptionLabelProp = (option) => option.label ?? option,\n+    getOptionLabel: getOptionLabelProp = (option) => {\n+      if (typeof option === 'string') {\n+        return option;\n+      }\n+      if (option && option.label != null) {\n+        return option.label;\n+      }\n+      return String(option);\n+    },\n     getOptionSelected = (option, value) => option === value,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\n",
        "diff --git a/packages/material-ui/src/useAutocomplete/useAutocomplete.js b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\nindex c728db5..723a424 100644\n--- a/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n@@ -22,6 +22,10 @@ export function createFilterOptions(config = {}) {\n \n   return (options, { inputValue, getOptionLabel }) => {\n     let input = trim ? inputValue.trim() : inputValue;\n+    // Ensure we always operate on strings\n+    if (typeof input !== 'string') {\n+      input = String(input);\n+    }\n     if (ignoreCase) {\n       input = input.toLowerCase();\n     }\n@@ -31,6 +35,12 @@ export function createFilterOptions(config = {}) {\n \n     const filteredOptions = options.filter((option) => {\n       let candidate = (stringify || getOptionLabel)(option);\n+\n+      // Ensure we always operate on strings\n+      if (typeof candidate !== 'string') {\n+        candidate = String(candidate);\n+      }\n+\n       if (ignoreCase) {\n         candidate = candidate.toLowerCase();\n       }\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "packages/material-ui/src/useAutocomplete/useAutocomplete.js": [
          "line: 35\nline: 411\nline: 82\nline: 118"
        ],
        "packages/material-ui/src/Autocomplete/Autocomplete.js": [
          "line: 286"
        ],
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/material-ui/src/Autocomplete/Autocomplete.js b/packages/material-ui/src/Autocomplete/Autocomplete.js\nindex 2775166..056e071 100644\n--- a/packages/material-ui/src/Autocomplete/Autocomplete.js\n+++ b/packages/material-ui/src/Autocomplete/Autocomplete.js\n@@ -283,7 +283,15 @@ const Autocomplete = React.forwardRef(function Autocomplete(props, ref) {\n     fullWidth = false,\n     getLimitTagsText = (more) => `+${more}`,\n     getOptionDisabled,\n-    getOptionLabel = (option) => option.label ?? option,\n+    getOptionLabel = (option) => {\n+      if (typeof option === 'string') {\n+        return option;\n+      }\n+      if (option && typeof option === 'object') {\n+        return option.label ?? '';\n+      }\n+      return '';\n+    },\n     getOptionSelected,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\ndiff --git a/packages/material-ui/src/useAutocomplete/useAutocomplete.js b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\nindex c728db5..8bdc23a 100644\n--- a/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n@@ -79,7 +79,15 @@ export default function useAutocomplete(props) {\n     filterSelectedOptions = false,\n     freeSolo = false,\n     getOptionDisabled,\n-    getOptionLabel: getOptionLabelProp = (option) => option.label ?? option,\n+    getOptionLabel: getOptionLabelProp = (option) => {\n+      if (typeof option === 'string') {\n+        return option;\n+      }\n+      if (option && typeof option === 'object') {\n+        return option.label ?? '';\n+      }\n+      return '';\n+    },\n     getOptionSelected = (option, value) => option === value,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\n",
        "diff --git a/packages/material-ui/src/Autocomplete/Autocomplete.js b/packages/material-ui/src/Autocomplete/Autocomplete.js\nindex 2775166..1150cfa 100644\n--- a/packages/material-ui/src/Autocomplete/Autocomplete.js\n+++ b/packages/material-ui/src/Autocomplete/Autocomplete.js\n@@ -283,7 +283,7 @@ const Autocomplete = React.forwardRef(function Autocomplete(props, ref) {\n     fullWidth = false,\n     getLimitTagsText = (more) => `+${more}`,\n     getOptionDisabled,\n-    getOptionLabel = (option) => option.label ?? option,\n+    getOptionLabel = (option) => option.label ?? String(option),\n     getOptionSelected,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\ndiff --git a/packages/material-ui/src/useAutocomplete/useAutocomplete.js b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\nindex c728db5..fa13a4b 100644\n--- a/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n@@ -79,7 +79,7 @@ export default function useAutocomplete(props) {\n     filterSelectedOptions = false,\n     freeSolo = false,\n     getOptionDisabled,\n-    getOptionLabel: getOptionLabelProp = (option) => option.label ?? option,\n+    getOptionLabel: getOptionLabelProp = (option) => option.label ?? String(option),\n     getOptionSelected = (option, value) => option === value,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\n@@ -114,6 +114,8 @@ export default function useAutocomplete(props) {\n             option,\n           )}.`,\n         );\n+        // Coerce to string to avoid runtime errors in filtering and matching.\n+        return String(optionLabel);\n       }\n       return optionLabel;\n     };\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/packages/material-ui/src/Autocomplete/Autocomplete.js b/packages/material-ui/src/Autocomplete/Autocomplete.js\nindex 2775166..1261705 100644\n--- a/packages/material-ui/src/Autocomplete/Autocomplete.js\n+++ b/packages/material-ui/src/Autocomplete/Autocomplete.js\n@@ -283,7 +283,15 @@ const Autocomplete = React.forwardRef(function Autocomplete(props, ref) {\n     fullWidth = false,\n     getLimitTagsText = (more) => `+${more}`,\n     getOptionDisabled,\n-    getOptionLabel = (option) => option.label ?? option,\n+    getOptionLabel = (option) => {\n+      if (typeof option === 'string') {\n+        return option;\n+      }\n+      if (option && option.label != null) {\n+        return option.label;\n+      }\n+      return String(option);\n+    },\n     getOptionSelected,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\ndiff --git a/packages/material-ui/src/useAutocomplete/useAutocomplete.js b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\nindex c728db5..44e5150 100644\n--- a/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui/src/useAutocomplete/useAutocomplete.js\n@@ -79,7 +79,15 @@ export default function useAutocomplete(props) {\n     filterSelectedOptions = false,\n     freeSolo = false,\n     getOptionDisabled,\n-    getOptionLabel: getOptionLabelProp = (option) => option.label ?? option,\n+    getOptionLabel: getOptionLabelProp = (option) => {\n+      if (typeof option === 'string') {\n+        return option;\n+      }\n+      if (option && option.label != null) {\n+        return option.label;\n+      }\n+      return String(option);\n+    },\n     getOptionSelected = (option, value) => option === value,\n     groupBy,\n     handleHomeEndKeys = !props.freeSolo,\n",
  "7_resolved": false
}