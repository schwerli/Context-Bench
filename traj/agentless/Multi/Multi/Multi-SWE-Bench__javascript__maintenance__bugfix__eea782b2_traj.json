{
  "instance_id": "Multi-SWE-Bench__javascript__maintenance__bugfix__eea782b2",
  "original_id": "iamkun__dayjs-1611",
  "1_model_selected_files": [
    "src/plugin/duration/index.js"
  ],
  "2_embedding_selected_files": [],
  "3_final_combined_files": [
    "src/plugin/duration/index.js"
  ],
  "4_related_elements": {
    "src/plugin/duration/index.js": [
      "function: Duration.constructor\nfunction: Duration.calMilliseconds\nfunction: Duration.parseFromMilliseconds\nfunction: Duration.format\nfunction: Duration.toISOString\nvariable: durationRegex\nvariable: REGEX_FORMAT"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "src/plugin/duration/index.js": [
          "function: Duration.constructor\nline: 81\nline: 98"
        ]
      },
      "patches": [
        "diff --git a/src/plugin/duration/index.js b/src/plugin/duration/index.js\nindex 7b8a314..02f9eba 100644\n--- a/src/plugin/duration/index.js\n+++ b/src/plugin/duration/index.js\n@@ -94,6 +94,16 @@ class Duration {\n           this.$d.minutes,\n           this.$d.seconds\n         ] = numberD\n+\n+        // Normalize fractional seconds into integer seconds and milliseconds\n+        if (typeof this.$d.seconds === 'number' && !Number.isInteger(this.$d.seconds)) {\n+          const whole = this.$d.seconds < 0 ? Math.ceil(this.$d.seconds) : Math.floor(this.$d.seconds)\n+          const frac = this.$d.seconds - whole\n+          this.$d.seconds = whole\n+          const ms = Math.round(Math.abs(frac) * 1000)\n+          this.$d.milliseconds = (this.$d.milliseconds || 0) + ms\n+        }\n+\n         this.calMilliseconds()\n         return this\n       }\n@@ -165,21 +175,28 @@ class Duration {\n \n   format(formatStr) {\n     const str = formatStr || 'YYYY-MM-DDTHH:mm:ss'\n+    const years = this.$d.years || 0\n+    const months = this.$d.months || 0\n+    const days = this.$d.days || 0\n+    const hours = this.$d.hours || 0\n+    const minutes = this.$d.minutes || 0\n+    const seconds = this.$d.seconds || 0\n+    const milliseconds = this.$d.milliseconds || 0\n     const matches = {\n-      Y: this.$d.years,\n-      YY: $u.s(this.$d.years, 2, '0'),\n-      YYYY: $u.s(this.$d.years, 4, '0'),\n-      M: this.$d.months,\n-      MM: $u.s(this.$d.months, 2, '0'),\n-      D: this.$d.days,\n-      DD: $u.s(this.$d.days, 2, '0'),\n-      H: this.$d.hours,\n-      HH: $u.s(this.$d.hours, 2, '0'),\n-      m: this.$d.minutes,\n-      mm: $u.s(this.$d.minutes, 2, '0'),\n-      s: this.$d.seconds,\n-      ss: $u.s(this.$d.seconds, 2, '0'),\n-      SSS: $u.s(this.$d.milliseconds, 3, '0')\n+      Y: years,\n+      YY: $u.s(years, 2, '0'),\n+      YYYY: $u.s(years, 4, '0'),\n+      M: months,\n+      MM: $u.s(months, 2, '0'),\n+      D: days,\n+      DD: $u.s(days, 2, '0'),\n+      H: hours,\n+      HH: $u.s(hours, 2, '0'),\n+      m: minutes,\n+      mm: $u.s(minutes, 2, '0'),\n+      s: seconds,\n+      ss: $u.s(seconds, 2, '0'),\n+      SSS: $u.s(milliseconds, 3, '0')\n     }\n     return str.replace(REGEX_FORMAT, (match, $1) => $1 || String(matches[match]))\n   }\n",
        "diff --git a/src/plugin/duration/index.js b/src/plugin/duration/index.js\nindex 7b8a314..1a1f10d 100644\n--- a/src/plugin/duration/index.js\n+++ b/src/plugin/duration/index.js\n@@ -84,16 +84,31 @@ class Duration {\n       const d = input.match(durationRegex)\n       if (d) {\n         const properties = d.slice(2)\n-        const numberD = properties.map(value => Number(value));\n-        [\n-          this.$d.years,\n-          this.$d.months,\n-          this.$d.weeks,\n-          this.$d.days,\n-          this.$d.hours,\n-          this.$d.minutes,\n-          this.$d.seconds\n-        ] = numberD\n+        // Normalize undefined capture groups to 0\n+        const normalize = (v) => (v === undefined ? 0 : Number(v))\n+\n+        // Handle fractional seconds (e.g., \"39.096S\")\n+        const secondsRaw = properties[6]\n+        let seconds = 0\n+        let milliseconds = 0\n+        if (secondsRaw !== undefined) {\n+          const [secStr, fracStr] = String(secondsRaw).split(/[.,]/)\n+          seconds = Number(secStr || 0)\n+          if (fracStr) {\n+            // Pad/truncate fractional part to 3 digits for milliseconds\n+            milliseconds = Number((`${fracStr}000`).slice(0, 3))\n+          }\n+        }\n+\n+        this.$d.years = normalize(properties[0])\n+        this.$d.months = normalize(properties[1])\n+        this.$d.weeks = normalize(properties[2])\n+        this.$d.days = normalize(properties[3])\n+        this.$d.hours = normalize(properties[4])\n+        this.$d.minutes = normalize(properties[5])\n+        this.$d.seconds = seconds\n+        this.$d.milliseconds = milliseconds\n+\n         this.calMilliseconds()\n         return this\n       }\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "src/plugin/duration/index.js": [
          "function: Duration.constructor\nline: 87\nline: 96\nline: 97\nfunction: Duration.format\nline: 169\nline: 170\nline: 171\nline: 172\nline: 173\nline: 174\nline: 175\nline: 176\nline: 177\nline: 178\nline: 179\nline: 180\nline: 181\nline: 182"
        ]
      },
      "patches": [
        "diff --git a/src/plugin/duration/index.js b/src/plugin/duration/index.js\nindex 7b8a314..062a2a4 100644\n--- a/src/plugin/duration/index.js\n+++ b/src/plugin/duration/index.js\n@@ -78,6 +78,7 @@ class Duration {\n         this.$d[prettyUnit(k)] = input[k]\n       })\n       this.calMilliseconds()\n+      this.parseFromMilliseconds()\n       return this\n     }\n     if (typeof input === 'string') {\n@@ -95,6 +96,7 @@ class Duration {\n           this.$d.seconds\n         ] = numberD\n         this.calMilliseconds()\n+        this.parseFromMilliseconds()\n         return this\n       }\n     }\n",
        "diff --git a/src/plugin/duration/index.js b/src/plugin/duration/index.js\nindex 7b8a314..062a2a4 100644\n--- a/src/plugin/duration/index.js\n+++ b/src/plugin/duration/index.js\n@@ -78,6 +78,7 @@ class Duration {\n         this.$d[prettyUnit(k)] = input[k]\n       })\n       this.calMilliseconds()\n+      this.parseFromMilliseconds()\n       return this\n     }\n     if (typeof input === 'string') {\n@@ -95,6 +96,7 @@ class Duration {\n           this.$d.seconds\n         ] = numberD\n         this.calMilliseconds()\n+        this.parseFromMilliseconds()\n         return this\n       }\n     }\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/src/plugin/duration/index.js b/src/plugin/duration/index.js\nindex 7b8a314..062a2a4 100644\n--- a/src/plugin/duration/index.js\n+++ b/src/plugin/duration/index.js\n@@ -78,6 +78,7 @@ class Duration {\n         this.$d[prettyUnit(k)] = input[k]\n       })\n       this.calMilliseconds()\n+      this.parseFromMilliseconds()\n       return this\n     }\n     if (typeof input === 'string') {\n@@ -95,6 +96,7 @@ class Duration {\n           this.$d.seconds\n         ] = numberD\n         this.calMilliseconds()\n+        this.parseFromMilliseconds()\n         return this\n       }\n     }\n",
  "7_resolved": false
}