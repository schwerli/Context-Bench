{
  "instance_id": "Multi-SWE-Bench__go__maintenance__bugfix__d129d52f",
  "original_id": "cli__cli-5396",
  "1_model_selected_files": [
    "pkg/cmd/issue/delete/delete.go",
    "pkg/cmd/issue/delete/delete_test.go"
  ],
  "2_embedding_selected_files": [
    "pkg/cmd/issue/delete/delete.go",
    "pkg/cmd/issue/delete/delete_test.go",
    "pkg/cmd/issue/issue.go",
    "pkg/cmd/secret/remove/remove_test.go",
    "pkg/cmd/secret/remove/remove.go",
    "pkg/cmd/secret/set/set.go",
    "pkg/cmd/secret/set/set_test.go",
    "pkg/cmd/secret/secret.go",
    "pkg/cmd/secret/list/list_test.go",
    "pkg/cmd/secret/list/list.go",
    "pkg/cmd/secret/set/http.go",
    "pkg/cmd/secret/shared/shared.go",
    "pkg/cmd/secret/shared/shared_test.go"
  ],
  "3_final_combined_files": [
    "pkg/cmd/issue/delete/delete.go",
    "pkg/cmd/issue/delete/delete_test.go",
    "pkg/cmd/issue/issue.go"
  ],
  "4_related_elements": {
    "pkg/cmd/issue/delete/delete.go": [
      "class: DeleteOptions\nfunction: NewCmdDelete\nfunction: deleteRun"
    ],
    "pkg/cmd/issue/delete/delete_test.go": [
      "function: TestIssueDelete_noConfirm"
    ],
    "pkg/cmd/issue/issue.go": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "pkg/cmd/issue/delete/delete.go": [
          "line: 28\nfunction: NewCmdDelete\nline: 77"
        ],
        "pkg/cmd/issue/delete/delete_test.go": [
          ""
        ],
        "pkg/cmd/issue/issue.go": [
          ""
        ]
      },
      "patches": [
        "diff --git a/pkg/cmd/issue/delete/delete.go b/pkg/cmd/issue/delete/delete.go\nindex 4bd2ffa..53caa08 100644\n--- a/pkg/cmd/issue/delete/delete.go\n+++ b/pkg/cmd/issue/delete/delete.go\n@@ -26,6 +26,7 @@ type DeleteOptions struct {\n \tBaseRepo   func() (ghrepo.Interface, error)\n \n \tSelectorArg string\n+\tNoConfirm   bool\n }\n \n func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Command {\n@@ -54,6 +55,9 @@ func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Co\n \t\t},\n \t}\n \n+\t// Skip confirmation prompt when set\n+\tcmd.Flags().BoolVar(&opts.NoConfirm, \"no-confirm\", false, \"Skip confirmation prompt\")\n+\n \treturn cmd\n }\n \n@@ -73,8 +77,8 @@ func deleteRun(opts *DeleteOptions) error {\n \t\treturn fmt.Errorf(\"issue #%d is a pull request and cannot be deleted\", issue.Number)\n \t}\n \n-\t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n-\tif opts.IO.CanPrompt() {\n+\t// When executed in an interactive shell, require confirmation unless --no-confirm is supplied. Otherwise skip confirmation.\n+\tif opts.IO.CanPrompt() && !opts.NoConfirm {\n \t\tanswer := \"\"\n \t\terr = prompt.SurveyAskOne(\n \t\t\t&survey.Input{\n",
        "diff --git a/pkg/cmd/issue/delete/delete.go b/pkg/cmd/issue/delete/delete.go\nindex 4bd2ffa..7e6f535 100644\n--- a/pkg/cmd/issue/delete/delete.go\n+++ b/pkg/cmd/issue/delete/delete.go\n@@ -26,6 +26,7 @@ type DeleteOptions struct {\n \tBaseRepo   func() (ghrepo.Interface, error)\n \n \tSelectorArg string\n+\tNoConfirm   bool\n }\n \n func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Command {\n@@ -54,6 +55,8 @@ func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Co\n \t\t},\n \t}\n \n+\tcmd.Flags().BoolVar(&opts.NoConfirm, \"no-confirm\", false, \"Skip the confirmation prompt\")\n+\n \treturn cmd\n }\n \n@@ -73,8 +76,8 @@ func deleteRun(opts *DeleteOptions) error {\n \t\treturn fmt.Errorf(\"issue #%d is a pull request and cannot be deleted\", issue.Number)\n \t}\n \n-\t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n-\tif opts.IO.CanPrompt() {\n+\t// When executed in an interactive shell, require confirmation unless --no-confirm is set. Otherwise skip confirmation.\n+\tif opts.IO.CanPrompt() && !opts.NoConfirm {\n \t\tanswer := \"\"\n \t\terr = prompt.SurveyAskOne(\n \t\t\t&survey.Input{\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nAdd a no-confirm flag for deleting issues\n### Describe the feature or problem you’d like to solve\r\n\r\nSome bad guys spam issues in my repo, i want to code a shell to delete it, but it need to verify, i want a flag like `no-confirm` to delete the issue without a confirm\r\n\r\n### Proposed solution\r\n\r\n~~~bash\r\ngh issue delete 1443 --no-confirm\r\n~~~\r\n\n\n###\n### pkg/cmd/issue/delete/delete.go\n...\n11|\t\"github.com/cli/cli/v2/internal/ghinstance\"\n12|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n13|\t\"github.com/cli/cli/v2/pkg/cmd/issue/shared\"\n14|\t\"github.com/cli/cli/v2/pkg/cmdutil\"\n15|\t\"github.com/cli/cli/v2/pkg/iostreams\"\n16|\t\"github.com/cli/cli/v2/pkg/prompt\"\n17|\tgraphql \"github.com/cli/shurcooL-graphql\"\n18|\t\"github.com/shurcooL/githubv4\"\n19|\t\"github.com/spf13/cobra\"\n20|)\n21|\n22|type DeleteOptions struct {\n23|\tHttpClient func() (*http.Client, error)\n24|\tConfig     func() (config.Config, error)\n25|\tIO         *iostreams.IOStreams\n26|\tBaseRepo   func() (ghrepo.Interface, error)\n27|\n28|\tSelectorArg string\n29|}\n30|\n31|func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Command {\n32|\topts := &DeleteOptions{\n33|\t\tIO:         f.IOStreams,\n34|\t\tHttpClient: f.HttpClient,\n35|\t\tConfig:     f.Config,\n36|\t}\n37|\n38|\tcmd := &cobra.Command{\n39|\t\tUse:   \"delete {<number> | <url>}\",\n40|\t\tShort: \"Delete issue\",\n41|\t\tArgs:  cobra.ExactArgs(1),\n42|\t\tRunE: func(cmd *cobra.Command, args []string) error {\n43|\t\t\t// support `-R, --repo` override\n44|\t\t\topts.BaseRepo = f.BaseRepo\n45|\n46|\t\t\tif len(args) > 0 {\n47|\t\t\t\topts.SelectorArg = args[0]\n48|\t\t\t}\n49|\n50|\t\t\tif runF != nil {\n51|\t\t\t\treturn runF(opts)\n52|\t\t\t}\n53|\t\t\treturn deleteRun(opts)\n54|\t\t},\n55|\t}\n56|\n57|\treturn cmd\n58|}\n59|\n60|func deleteRun(opts *DeleteOptions) error {\n61|\tcs := opts.IO.ColorScheme()\n62|\n63|\thttpClient, err := opts.HttpClient()\n64|\tif err != nil {\n65|\t\treturn err\n66|\t}\n67|\n68|\tissue, baseRepo, err := shared.IssueFromArgWithFields(httpClient, opts.BaseRepo, opts.SelectorArg, []string{\"id\", \"number\", \"title\"})\n69|\tif err != nil {\n70|\t\treturn err\n71|\t}\n72|\tif issue.IsPullRequest() {\n73|\t\treturn fmt.Errorf(\"issue #%d is a pull request and cannot be deleted\", issue.Number)\n74|\t}\n75|\n76|\t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n77|\tif opts.IO.CanPrompt() {\n78|\t\tanswer := \"\"\n79|\t\terr = prompt.SurveyAskOne(\n80|\t\t\t&survey.Input{\n81|\t\t\t\tMessage: fmt.Sprintf(\"You're going to delete issue #%d. This action cannot be reversed. To confirm, type the issue number:\", issue.Number),\n82|\t\t\t},\n83|\t\t\t&answer,\n84|\t\t)\n85|\t\tif err != nil {\n86|\t\t\treturn err\n87|\t\t}\n88|\t\tanswerInt, err := strconv.Atoi(answer)\n89|\t\tif err != nil || answerInt != issue.Number {\n90|\t\t\tfmt.Fprintf(opts.IO.Out, \"Issue #%d was not deleted.\\n\", issue.Number)\n91|\t\t\treturn nil\n92|\t\t}\n93|\t}\n94|\n95|\tif err := apiDelete(httpClient, baseRepo, issue.ID); err != nil {\n96|\t\treturn err\n97|\t}\n98|\n99|\tif opts.IO.IsStdoutTTY() {\n100|\t\tfmt.Fprintf(opts.IO.ErrOut, \"%s Deleted issue #%d (%s).\\n\", cs.Red(\"✔\"), issue.Number, issue.Title)\n101|\t}\n102|\n103|\treturn nil\n104|}\n105|\n106|func apiDelete(httpClient *http.Client, repo ghrepo.Interface, issueID string) error {\n107|\tvar mutation struct {\n108|\t\tDeleteIssue struct {\n109|\t\t\tRepository struct {\n110|\t\t\t\tID githubv4.ID\n111|\t\t\t}\n112|\t\t} `graphql:\"deleteIssue(input: $input)\"`\n113|\t}\n...\n\n\n### pkg/cmd/issue/delete/delete_test.go\n1|package delete\n2|\n3|import (\n4|\t\"bytes\"\n5|\t\"io/ioutil\"\n6|\t\"net/http\"\n7|\t\"regexp\"\n8|\t\"testing\"\n9|\n10|\t\"github.com/cli/cli/v2/internal/config\"\n11|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n12|\t\"github.com/cli/cli/v2/pkg/cmdutil\"\n13|\t\"github.com/cli/cli/v2/pkg/httpmock\"\n14|\t\"github.com/cli/cli/v2/pkg/iostreams\"\n15|\t\"github.com/cli/cli/v2/pkg/prompt\"\n16|\t\"github.com/cli/cli/v2/test\"\n17|\t\"github.com/google/shlex\"\n18|\t\"github.com/stretchr/testify/assert\"\n19|)\n20|\n21|func runCommand(rt http.RoundTripper, isTTY bool, cli string) (*test.CmdOut, error) {\n22|\tio, _, stdout, stderr := iostreams.Test()\n23|\tio.SetStdoutTTY(isTTY)\n24|\tio.SetStdinTTY(isTTY)\n25|\tio.SetStderrTTY(isTTY)\n26|\n27|\tfactory := &cmdutil.Factory{\n28|\t\tIOStreams: io,\n29|\t\tHttpClient: func() (*http.Client, error) {\n30|\t\t\treturn &http.Client{Transport: rt}, nil\n31|\t\t},\n32|\t\tConfig: func() (config.Config, error) {\n33|\t\t\treturn config.NewBlankConfig(), nil\n34|\t\t},\n35|\t\tBaseRepo: func() (ghrepo.Interface, error) {\n36|\t\t\treturn ghrepo.New(\"OWNER\", \"REPO\"), nil\n37|\t\t},\n38|\t}\n39|\n40|\tcmd := NewCmdDelete(factory, nil)\n41|\n42|\targv, err := shlex.Split(cli)\n43|\tif err != nil {\n44|\t\treturn nil, err\n45|\t}\n46|\tcmd.SetArgs(argv)\n47|\n48|\tcmd.SetIn(&bytes.Buffer{})\n49|\tcmd.SetOut(ioutil.Discard)\n50|\tcmd.SetErr(ioutil.Discard)\n51|\n52|\t_, err = cmd.ExecuteC()\n53|\treturn &test.CmdOut{\n54|\t\tOutBuf: stdout,\n55|\t\tErrBuf: stderr,\n56|\t}, err\n57|}\n58|\n59|func TestIssueDelete(t *testing.T) {\n60|\thttpRegistry := &httpmock.Registry{}\n61|\tdefer httpRegistry.Verify(t)\n62|\n63|\thttpRegistry.Register(\n64|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n65|\t\thttpmock.StringResponse(`\n66|\t\t\t{ \"data\": { \"repository\": {\n67|\t\t\t\t\"hasIssuesEnabled\": true,\n68|\t\t\t\t\"issue\": { \"id\": \"THE-ID\", \"number\": 13, \"title\": \"The title of the issue\"}\n69|\t\t\t} } }`),\n70|\t)\n71|\thttpRegistry.Register(\n72|\t\thttpmock.GraphQL(`mutation IssueDelete\\b`),\n73|\t\thttpmock.GraphQLMutation(`{\"id\": \"THE-ID\"}`,\n74|\t\t\tfunc(inputs map[string]interface{}) {\n75|\t\t\t\tassert.Equal(t, inputs[\"issueId\"], \"THE-ID\")\n76|\t\t\t}),\n77|\t)\n78|\n79|\tas := prompt.NewAskStubber(t)\n80|\tas.StubPrompt(\"You're going to delete issue #13. This action cannot be reversed. To confirm, type the issue number:\").AnswerWith(\"13\")\n81|\n82|\toutput, err := runCommand(httpRegistry, true, \"13\")\n83|\tif err != nil {\n84|\t\tt.Fatalf(\"error running command `issue delete`: %v\", err)\n85|\t}\n86|\n87|\tr := regexp.MustCompile(`Deleted issue #13 \\(The title of the issue\\)`)\n88|\n89|\tif !r.MatchString(output.Stderr()) {\n90|\t\tt.Fatalf(\"output did not match regexp /%s/\\n> output\\n%q\\n\", r, output.Stderr())\n91|\t}\n92|}\n93|\n94|func TestIssueDelete_cancel(t *testing.T) {\n95|\thttpRegistry := &httpmock.Registry{}\n96|\tdefer httpRegistry.Verify(t)\n97|\n98|\thttpRegistry.Register(\n99|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n100|\t\thttpmock.StringResponse(`\n101|\t\t\t{ \"data\": { \"repository\": {\n102|\t\t\t\t\"hasIssuesEnabled\": true,\n103|\t\t\t\t\"issue\": { \"id\": \"THE-ID\", \"number\": 13, \"title\": \"The title of the issue\"}\n104|\t\t\t} } }`),\n105|\t)\n106|\n107|\tas := prompt.NewAskStubber(t)\n108|\tas.StubPrompt(\"You're going to delete issue #13. This action cannot be reversed. To confirm, type the issue number:\").AnswerWith(\"14\")\n109|\n110|\toutput, err := runCommand(httpRegistry, true, \"13\")\n111|\tif err != nil {\n112|\t\tt.Fatalf(\"error running command `issue delete`: %v\", err)\n113|\t}\n114|\n115|\tr := regexp.MustCompile(`Issue #13 was not deleted`)\n116|\n117|\tif !r.MatchString(output.String()) {\n118|\t\tt.Fatalf(\"output did not match regexp /%s/\\n> output\\n%q\\n\", r, output.String())\n119|\t}\n120|}\n121|\n122|func TestIssueDelete_doesNotExist(t *testing.T) {\n123|\thttpRegistry := &httpmock.Registry{}\n124|\tdefer httpRegistry.Verify(t)\n125|\n126|\thttpRegistry.Register(\n127|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n128|\t\thttpmock.StringResponse(`\n129|\t\t\t{ \"errors\": [\n130|\t\t\t\t{ \"message\": \"Could not resolve to an Issue with the number of 13.\" }\n131|\t\t\t] }\n132|\t\t\t`),\n133|\t)\n134|\n135|\t_, err := runCommand(httpRegistry, true, \"13\")\n136|\tif err == nil || err.Error() != \"GraphQL: Could not resolve to an Issue with the number of 13.\" {\n137|\t\tt.Errorf(\"error running command `issue delete`: %v\", err)\n138|\t}\n139|}\n140|\n141|func TestIssueDelete_issuesDisabled(t *testing.T) {\n142|\thttpRegistry := &httpmock.Registry{}\n143|\tdefer httpRegistry.Verify(t)\n144|\n145|\thttpRegistry.Register(\n146|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n147|\t\thttpmock.StringResponse(`\n148|\t\t{\n149|\t\t\t\"data\": {\n150|\t\t\t\t\"repository\": {\n151|\t\t\t\t\t\"hasIssuesEnabled\": false,\n152|\t\t\t\t\t\"issue\": null\n153|\t\t\t\t}\n154|\t\t\t},\n155|\t\t\t\"errors\": [\n156|\t\t\t\t{\n157|\t\t\t\t\t\"type\": \"NOT_FOUND\",\n158|\t\t\t\t\t\"path\": [\n159|\t\t\t\t\t\t\"repository\",\n160|\t\t\t\t\t\t\"issue\"\n161|\t\t\t\t\t],\n162|\t\t\t\t\t\"message\": \"Could not resolve to an issue or pull request with the number of 13.\"\n163|\t\t\t\t}\n164|\t\t\t]\n165|\t\t}`),\n166|\t)\n167|\n168|\t_, err := runCommand(httpRegistry, true, \"13\")\n169|\tif err == nil || err.Error() != \"the 'OWNER/REPO' repository has disabled issues\" {\n170|\t\tt.Fatalf(\"got error: %v\", err)\n171|\t}\n172|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n```",
          "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n\npkg/cmd/issue/delete/delete_test.go\nfunction: TestIssueDelete_noConfirm\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n```",
            "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n\npkg/cmd/issue/delete/delete_test.go\nfunction: TestIssueDelete_noConfirm\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "pkg/cmd/issue/delete/delete.go": [
          "line: 28\nfunction: NewCmdDelete\nline: 77"
        ],
        "pkg/cmd/issue/delete/delete_test.go": [
          "function: TestIssueDelete_noConfirm"
        ],
        "pkg/cmd/issue/issue.go": [
          ""
        ]
      },
      "patches": [
        "diff --git a/pkg/cmd/issue/delete/delete.go b/pkg/cmd/issue/delete/delete.go\nindex 4bd2ffa..6d90aed 100644\n--- a/pkg/cmd/issue/delete/delete.go\n+++ b/pkg/cmd/issue/delete/delete.go\n@@ -25,6 +25,7 @@ type DeleteOptions struct {\n \tIO         *iostreams.IOStreams\n \tBaseRepo   func() (ghrepo.Interface, error)\n \n+\tNoConfirm  bool\n \tSelectorArg string\n }\n \n@@ -54,6 +55,8 @@ func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Co\n \t\t},\n \t}\n \n+\tcmd.Flags().BoolVar(&opts.NoConfirm, \"no-confirm\", false, \"Do not prompt for confirmation\")\n+\n \treturn cmd\n }\n \n@@ -74,7 +77,8 @@ func deleteRun(opts *DeleteOptions) error {\n \t}\n \n \t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n-\tif opts.IO.CanPrompt() {\n+\t// If --no-confirm is set, skip confirmation even in interactive mode.\n+\tif opts.IO.CanPrompt() && !opts.NoConfirm {\n \t\tanswer := \"\"\n \t\terr = prompt.SurveyAskOne(\n \t\t\t&survey.Input{\n",
        "diff --git a/pkg/cmd/issue/delete/delete.go b/pkg/cmd/issue/delete/delete.go\nindex 4bd2ffa..fef525d 100644\n--- a/pkg/cmd/issue/delete/delete.go\n+++ b/pkg/cmd/issue/delete/delete.go\n@@ -26,6 +26,7 @@ type DeleteOptions struct {\n \tBaseRepo   func() (ghrepo.Interface, error)\n \n \tSelectorArg string\n+\tSkipConfirm bool\n }\n \n func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Command {\n@@ -54,6 +55,8 @@ func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Co\n \t\t},\n \t}\n \n+\tcmd.Flags().BoolVar(&opts.SkipConfirm, \"no-confirm\", false, \"Do not prompt for confirmation\")\n+\n \treturn cmd\n }\n \n@@ -74,7 +77,7 @@ func deleteRun(opts *DeleteOptions) error {\n \t}\n \n \t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n-\tif opts.IO.CanPrompt() {\n+\tif opts.IO.CanPrompt() && !opts.SkipConfirm {\n \t\tanswer := \"\"\n \t\terr = prompt.SurveyAskOne(\n \t\t\t&survey.Input{\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nAdd a no-confirm flag for deleting issues\n### Describe the feature or problem you’d like to solve\r\n\r\nSome bad guys spam issues in my repo, i want to code a shell to delete it, but it need to verify, i want a flag like `no-confirm` to delete the issue without a confirm\r\n\r\n### Proposed solution\r\n\r\n~~~bash\r\ngh issue delete 1443 --no-confirm\r\n~~~\r\n\n\n###\n### pkg/cmd/issue/delete/delete.go\n...\n11|\t\"github.com/cli/cli/v2/internal/ghinstance\"\n12|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n13|\t\"github.com/cli/cli/v2/pkg/cmd/issue/shared\"\n14|\t\"github.com/cli/cli/v2/pkg/cmdutil\"\n15|\t\"github.com/cli/cli/v2/pkg/iostreams\"\n16|\t\"github.com/cli/cli/v2/pkg/prompt\"\n17|\tgraphql \"github.com/cli/shurcooL-graphql\"\n18|\t\"github.com/shurcooL/githubv4\"\n19|\t\"github.com/spf13/cobra\"\n20|)\n21|\n22|type DeleteOptions struct {\n23|\tHttpClient func() (*http.Client, error)\n24|\tConfig     func() (config.Config, error)\n25|\tIO         *iostreams.IOStreams\n26|\tBaseRepo   func() (ghrepo.Interface, error)\n27|\n28|\tSelectorArg string\n29|}\n30|\n31|func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Command {\n32|\topts := &DeleteOptions{\n33|\t\tIO:         f.IOStreams,\n34|\t\tHttpClient: f.HttpClient,\n35|\t\tConfig:     f.Config,\n36|\t}\n37|\n38|\tcmd := &cobra.Command{\n39|\t\tUse:   \"delete {<number> | <url>}\",\n40|\t\tShort: \"Delete issue\",\n41|\t\tArgs:  cobra.ExactArgs(1),\n42|\t\tRunE: func(cmd *cobra.Command, args []string) error {\n43|\t\t\t// support `-R, --repo` override\n44|\t\t\topts.BaseRepo = f.BaseRepo\n45|\n46|\t\t\tif len(args) > 0 {\n47|\t\t\t\topts.SelectorArg = args[0]\n48|\t\t\t}\n49|\n50|\t\t\tif runF != nil {\n51|\t\t\t\treturn runF(opts)\n52|\t\t\t}\n53|\t\t\treturn deleteRun(opts)\n54|\t\t},\n55|\t}\n56|\n57|\treturn cmd\n58|}\n59|\n60|func deleteRun(opts *DeleteOptions) error {\n61|\tcs := opts.IO.ColorScheme()\n62|\n63|\thttpClient, err := opts.HttpClient()\n64|\tif err != nil {\n65|\t\treturn err\n66|\t}\n67|\n68|\tissue, baseRepo, err := shared.IssueFromArgWithFields(httpClient, opts.BaseRepo, opts.SelectorArg, []string{\"id\", \"number\", \"title\"})\n69|\tif err != nil {\n70|\t\treturn err\n71|\t}\n72|\tif issue.IsPullRequest() {\n73|\t\treturn fmt.Errorf(\"issue #%d is a pull request and cannot be deleted\", issue.Number)\n74|\t}\n75|\n76|\t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n77|\tif opts.IO.CanPrompt() {\n78|\t\tanswer := \"\"\n79|\t\terr = prompt.SurveyAskOne(\n80|\t\t\t&survey.Input{\n81|\t\t\t\tMessage: fmt.Sprintf(\"You're going to delete issue #%d. This action cannot be reversed. To confirm, type the issue number:\", issue.Number),\n82|\t\t\t},\n83|\t\t\t&answer,\n84|\t\t)\n85|\t\tif err != nil {\n86|\t\t\treturn err\n87|\t\t}\n88|\t\tanswerInt, err := strconv.Atoi(answer)\n89|\t\tif err != nil || answerInt != issue.Number {\n90|\t\t\tfmt.Fprintf(opts.IO.Out, \"Issue #%d was not deleted.\\n\", issue.Number)\n91|\t\t\treturn nil\n92|\t\t}\n93|\t}\n94|\n95|\tif err := apiDelete(httpClient, baseRepo, issue.ID); err != nil {\n96|\t\treturn err\n97|\t}\n98|\n99|\tif opts.IO.IsStdoutTTY() {\n100|\t\tfmt.Fprintf(opts.IO.ErrOut, \"%s Deleted issue #%d (%s).\\n\", cs.Red(\"✔\"), issue.Number, issue.Title)\n101|\t}\n102|\n103|\treturn nil\n104|}\n105|\n106|func apiDelete(httpClient *http.Client, repo ghrepo.Interface, issueID string) error {\n107|\tvar mutation struct {\n108|\t\tDeleteIssue struct {\n109|\t\t\tRepository struct {\n110|\t\t\t\tID githubv4.ID\n111|\t\t\t}\n112|\t\t} `graphql:\"deleteIssue(input: $input)\"`\n113|\t}\n...\n\n\n### pkg/cmd/issue/delete/delete_test.go\n1|package delete\n2|\n3|import (\n4|\t\"bytes\"\n5|\t\"io/ioutil\"\n6|\t\"net/http\"\n7|\t\"regexp\"\n8|\t\"testing\"\n9|\n10|\t\"github.com/cli/cli/v2/internal/config\"\n11|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n12|\t\"github.com/cli/cli/v2/pkg/cmdutil\"\n13|\t\"github.com/cli/cli/v2/pkg/httpmock\"\n14|\t\"github.com/cli/cli/v2/pkg/iostreams\"\n15|\t\"github.com/cli/cli/v2/pkg/prompt\"\n16|\t\"github.com/cli/cli/v2/test\"\n17|\t\"github.com/google/shlex\"\n18|\t\"github.com/stretchr/testify/assert\"\n19|)\n20|\n21|func runCommand(rt http.RoundTripper, isTTY bool, cli string) (*test.CmdOut, error) {\n22|\tio, _, stdout, stderr := iostreams.Test()\n23|\tio.SetStdoutTTY(isTTY)\n24|\tio.SetStdinTTY(isTTY)\n25|\tio.SetStderrTTY(isTTY)\n26|\n27|\tfactory := &cmdutil.Factory{\n28|\t\tIOStreams: io,\n29|\t\tHttpClient: func() (*http.Client, error) {\n30|\t\t\treturn &http.Client{Transport: rt}, nil\n31|\t\t},\n32|\t\tConfig: func() (config.Config, error) {\n33|\t\t\treturn config.NewBlankConfig(), nil\n34|\t\t},\n35|\t\tBaseRepo: func() (ghrepo.Interface, error) {\n36|\t\t\treturn ghrepo.New(\"OWNER\", \"REPO\"), nil\n37|\t\t},\n38|\t}\n39|\n40|\tcmd := NewCmdDelete(factory, nil)\n41|\n42|\targv, err := shlex.Split(cli)\n43|\tif err != nil {\n44|\t\treturn nil, err\n45|\t}\n46|\tcmd.SetArgs(argv)\n47|\n48|\tcmd.SetIn(&bytes.Buffer{})\n49|\tcmd.SetOut(ioutil.Discard)\n50|\tcmd.SetErr(ioutil.Discard)\n51|\n52|\t_, err = cmd.ExecuteC()\n53|\treturn &test.CmdOut{\n54|\t\tOutBuf: stdout,\n55|\t\tErrBuf: stderr,\n56|\t}, err\n57|}\n58|\n59|func TestIssueDelete(t *testing.T) {\n60|\thttpRegistry := &httpmock.Registry{}\n61|\tdefer httpRegistry.Verify(t)\n62|\n63|\thttpRegistry.Register(\n64|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n65|\t\thttpmock.StringResponse(`\n66|\t\t\t{ \"data\": { \"repository\": {\n67|\t\t\t\t\"hasIssuesEnabled\": true,\n68|\t\t\t\t\"issue\": { \"id\": \"THE-ID\", \"number\": 13, \"title\": \"The title of the issue\"}\n69|\t\t\t} } }`),\n70|\t)\n71|\thttpRegistry.Register(\n72|\t\thttpmock.GraphQL(`mutation IssueDelete\\b`),\n73|\t\thttpmock.GraphQLMutation(`{\"id\": \"THE-ID\"}`,\n74|\t\t\tfunc(inputs map[string]interface{}) {\n75|\t\t\t\tassert.Equal(t, inputs[\"issueId\"], \"THE-ID\")\n76|\t\t\t}),\n77|\t)\n78|\n79|\tas := prompt.NewAskStubber(t)\n80|\tas.StubPrompt(\"You're going to delete issue #13. This action cannot be reversed. To confirm, type the issue number:\").AnswerWith(\"13\")\n81|\n82|\toutput, err := runCommand(httpRegistry, true, \"13\")\n83|\tif err != nil {\n84|\t\tt.Fatalf(\"error running command `issue delete`: %v\", err)\n85|\t}\n86|\n87|\tr := regexp.MustCompile(`Deleted issue #13 \\(The title of the issue\\)`)\n88|\n89|\tif !r.MatchString(output.Stderr()) {\n90|\t\tt.Fatalf(\"output did not match regexp /%s/\\n> output\\n%q\\n\", r, output.Stderr())\n91|\t}\n92|}\n93|\n94|func TestIssueDelete_cancel(t *testing.T) {\n95|\thttpRegistry := &httpmock.Registry{}\n96|\tdefer httpRegistry.Verify(t)\n97|\n98|\thttpRegistry.Register(\n99|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n100|\t\thttpmock.StringResponse(`\n101|\t\t\t{ \"data\": { \"repository\": {\n102|\t\t\t\t\"hasIssuesEnabled\": true,\n103|\t\t\t\t\"issue\": { \"id\": \"THE-ID\", \"number\": 13, \"title\": \"The title of the issue\"}\n104|\t\t\t} } }`),\n105|\t)\n106|\n107|\tas := prompt.NewAskStubber(t)\n108|\tas.StubPrompt(\"You're going to delete issue #13. This action cannot be reversed. To confirm, type the issue number:\").AnswerWith(\"14\")\n109|\n110|\toutput, err := runCommand(httpRegistry, true, \"13\")\n111|\tif err != nil {\n112|\t\tt.Fatalf(\"error running command `issue delete`: %v\", err)\n113|\t}\n114|\n115|\tr := regexp.MustCompile(`Issue #13 was not deleted`)\n116|\n117|\tif !r.MatchString(output.String()) {\n118|\t\tt.Fatalf(\"output did not match regexp /%s/\\n> output\\n%q\\n\", r, output.String())\n119|\t}\n120|}\n121|\n122|func TestIssueDelete_doesNotExist(t *testing.T) {\n123|\thttpRegistry := &httpmock.Registry{}\n124|\tdefer httpRegistry.Verify(t)\n125|\n126|\thttpRegistry.Register(\n127|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n128|\t\thttpmock.StringResponse(`\n129|\t\t\t{ \"errors\": [\n130|\t\t\t\t{ \"message\": \"Could not resolve to an Issue with the number of 13.\" }\n131|\t\t\t] }\n132|\t\t\t`),\n133|\t)\n134|\n135|\t_, err := runCommand(httpRegistry, true, \"13\")\n136|\tif err == nil || err.Error() != \"GraphQL: Could not resolve to an Issue with the number of 13.\" {\n137|\t\tt.Errorf(\"error running command `issue delete`: %v\", err)\n138|\t}\n139|}\n140|\n141|func TestIssueDelete_issuesDisabled(t *testing.T) {\n142|\thttpRegistry := &httpmock.Registry{}\n143|\tdefer httpRegistry.Verify(t)\n144|\n145|\thttpRegistry.Register(\n146|\t\thttpmock.GraphQL(`query IssueByNumber\\b`),\n147|\t\thttpmock.StringResponse(`\n148|\t\t{\n149|\t\t\t\"data\": {\n150|\t\t\t\t\"repository\": {\n151|\t\t\t\t\t\"hasIssuesEnabled\": false,\n152|\t\t\t\t\t\"issue\": null\n153|\t\t\t\t}\n154|\t\t\t},\n155|\t\t\t\"errors\": [\n156|\t\t\t\t{\n157|\t\t\t\t\t\"type\": \"NOT_FOUND\",\n158|\t\t\t\t\t\"path\": [\n159|\t\t\t\t\t\t\"repository\",\n160|\t\t\t\t\t\t\"issue\"\n161|\t\t\t\t\t],\n162|\t\t\t\t\t\"message\": \"Could not resolve to an issue or pull request with the number of 13.\"\n163|\t\t\t\t}\n164|\t\t\t]\n165|\t\t}`),\n166|\t)\n167|\n168|\t_, err := runCommand(httpRegistry, true, \"13\")\n169|\tif err == nil || err.Error() != \"the 'OWNER/REPO' repository has disabled issues\" {\n170|\t\tt.Fatalf(\"got error: %v\", err)\n171|\t}\n172|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n```",
          "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n\npkg/cmd/issue/delete/delete_test.go\nfunction: TestIssueDelete_noConfirm\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n```",
            "```\npkg/cmd/issue/delete/delete.go\nline: 28\nfunction: NewCmdDelete\nline: 77\n\npkg/cmd/issue/delete/delete_test.go\nfunction: TestIssueDelete_noConfirm\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/pkg/cmd/issue/delete/delete.go b/pkg/cmd/issue/delete/delete.go\nindex 4bd2ffa..7e6f535 100644\n--- a/pkg/cmd/issue/delete/delete.go\n+++ b/pkg/cmd/issue/delete/delete.go\n@@ -26,6 +26,7 @@ type DeleteOptions struct {\n \tBaseRepo   func() (ghrepo.Interface, error)\n \n \tSelectorArg string\n+\tNoConfirm   bool\n }\n \n func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Command {\n@@ -54,6 +55,8 @@ func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Co\n \t\t},\n \t}\n \n+\tcmd.Flags().BoolVar(&opts.NoConfirm, \"no-confirm\", false, \"Skip the confirmation prompt\")\n+\n \treturn cmd\n }\n \n@@ -73,8 +76,8 @@ func deleteRun(opts *DeleteOptions) error {\n \t\treturn fmt.Errorf(\"issue #%d is a pull request and cannot be deleted\", issue.Number)\n \t}\n \n-\t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n-\tif opts.IO.CanPrompt() {\n+\t// When executed in an interactive shell, require confirmation unless --no-confirm is set. Otherwise skip confirmation.\n+\tif opts.IO.CanPrompt() && !opts.NoConfirm {\n \t\tanswer := \"\"\n \t\terr = prompt.SurveyAskOne(\n \t\t\t&survey.Input{\n",
  "7_resolved": false
}