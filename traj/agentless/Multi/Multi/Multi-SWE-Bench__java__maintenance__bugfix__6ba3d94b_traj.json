{
  "instance_id": "Multi-SWE-Bench__java__maintenance__bugfix__6ba3d94b",
  "original_id": "fasterxml__jackson-core-964",
  "1_model_selected_files": [
    "src/main/java/com/fasterxml/jackson/core/JsonFactory.java",
    "src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java",
    "src/main/java/com/fasterxml/jackson/core/io/IOContext.java"
  ],
  "2_embedding_selected_files": [
    "src/main/java/com/fasterxml/jackson/core/StreamReadConstraints.java",
    "src/main/java/com/fasterxml/jackson/core/JsonFactory.java",
    "src/main/java/com/fasterxml/jackson/core/TSFBuilder.java",
    "src/main/java/com/fasterxml/jackson/core/JsonParser.java",
    "src/main/java/com/fasterxml/jackson/core/JsonFactoryBuilder.java",
    "src/main/java/com/fasterxml/jackson/core/StreamReadCapability.java",
    "src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java",
    "src/main/java/com/fasterxml/jackson/core/StreamReadFeature.java",
    "src/main/java/com/fasterxml/jackson/core/StreamWriteFeature.java",
    "src/main/java/com/fasterxml/jackson/core/StreamWriteCapability.java",
    "src/main/java/com/fasterxml/jackson/core/JsonGenerator.java",
    "src/main/java/com/fasterxml/jackson/core/JsonStreamContext.java",
    "src/main/java/com/fasterxml/jackson/core/package-info.java"
  ],
  "3_final_combined_files": [
    "src/main/java/com/fasterxml/jackson/core/JsonFactory.java",
    "src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java",
    "src/main/java/com/fasterxml/jackson/core/io/IOContext.java",
    "src/main/java/com/fasterxml/jackson/core/StreamReadConstraints.java",
    "src/main/java/com/fasterxml/jackson/core/TSFBuilder.java"
  ],
  "4_related_elements": {
    "src/main/java/com/fasterxml/jackson/core/JsonFactory.java": [
      "variable: _streamReadConstraints\nfunction: JsonFactory.setStreamReadConstraints\nfunction: JsonFactory.streamReadConstraints\nfunction: JsonFactory._createContext\nfunction: JsonFactory._createNonBlockingContext"
    ],
    "src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java": [
      "function: TokenStreamFactory.streamReadConstraints"
    ],
    "src/main/java/com/fasterxml/jackson/core/io/IOContext.java": [
      "function: IOContext.IOContext\nfunction: IOContext.streamReadConstraints"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "src/main/java/com/fasterxml/jackson/core/JsonFactory.java": [
          "function: JsonFactory.setStreamReadConstraints"
        ],
        "src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java": [
          ""
        ],
        "src/main/java/com/fasterxml/jackson/core/io/IOContext.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\nindex a2cd221..4bb1985 100644\n--- a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n+++ b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n@@ -276,7 +276,7 @@ public class JsonFactory\n      *\n      * @since 2.15\n      */\n-    final protected StreamReadConstraints _streamReadConstraints;\n+    protected StreamReadConstraints _streamReadConstraints;\n \n     /**\n      * Optional helper object that may decorate input sources, to do\n@@ -778,6 +778,22 @@ public class JsonFactory\n         return _streamReadConstraints;\n     }\n \n+    /**\n+     * Method for setting {@link StreamReadConstraints} to use for parsers created\n+     * by this factory. If {@code constraints} is {@code null}, default constraints\n+     * will be used.\n+     *\n+     * @param constraints Read constraints to use; {@code null} for defaults\n+     *\n+     * @return This factory instance (to allow call chaining)\n+     *\n+     * @since 2.15\n+     */\n+    public JsonFactory setStreamReadConstraints(StreamReadConstraints constraints) {\n+        _streamReadConstraints = (constraints == null) ? StreamReadConstraints.defaults() : constraints;\n+        return this;\n+    }\n+\n     /*\n     /**********************************************************\n     /* Configuration, parser configuration\n@@ -2124,4 +2140,4 @@ public class JsonFactory\n         // or its sub-class / delegated to one, no need to check for equality, identity is enough\n         return getFormatName() == FORMAT_NAME_JSON;\n     }\n-}\n+}\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nOffer a way to directly set `StreamReadConstraints` via `JsonFactory` (not just Builder)\nAlthough Builder-style configuration is becoming preferred for Jackson in 2.x (and the only way in 3.0), there is need to support mutable configuration for some key configuration. While for any truly new, optional functionality Builder-style may be sufficient, processing limits change existing behavior so they must be available via \"legacy\" style configuration too. This is in particular important for frameworks that do not fully control configurability but expose it to their users; and expecting users to change interfaces/mechanisms for `ObjectMapper`/`JsonFactory` configuration is a big ask (not to mention compatibility nightmare).\r\n\r\nSo, before 2.15.0 final, let's ensure `StreamReadConstraints` can be set on `JsonFactory`: it can not (alas!) be immutable until 3.0.\r\n\n\n###\n### src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n...\n765|    @Override\n766|    public int getFormatGeneratorFeatures() {\n767|        return 0;\n768|    }\n769|\n770|    /*\n771|    /**********************************************************************\n772|    /* Constraints violation checking (2.15)\n773|    /**********************************************************************\n774|     */\n775|\n776|    @Override\n777|    public StreamReadConstraints streamReadConstraints() {\n778|        return _streamReadConstraints;\n779|    }\n780|\n781|    /*\n782|    /**********************************************************\n783|    /* Configuration, parser configuration\n784|    /**********************************************************\n785|     */\n786|\n787|    /**\n788|     * Method for enabling or disabling specified parser feature\n...\n2000|    }\n2001|\n2002|    /**\n2003|     * Overridable factory method that actually instantiates desired\n2004|     * context object.\n2005|     *\n2006|     * @param contentRef Source/target reference to use for diagnostics, exception messages\n2007|     * @param resourceManaged Whether input/output buffer is managed by this factory or not\n2008|     *\n2009|     * @return I/O context created\n2010|     */\n2011|    protected IOContext _createContext(ContentReference contentRef, boolean resourceManaged) {\n2012|        // 21-Mar-2021, tatu: Bit of defensive coding for backwards compatibility\n2013|        if (contentRef == null) {\n2014|            contentRef = ContentReference.unknown();\n2015|        }\n2016|        return new IOContext(_streamReadConstraints, _getBufferRecycler(), contentRef, resourceManaged);\n2017|    }\n2018|\n2019|    /**\n2020|     * Deprecated variant of {@link #_createContext(Object, boolean)}\n2021|     *\n2022|     * @param rawContentRef \"Raw\" source/target reference\n2023|     * @param resourceManaged Whether input/output buffer is managed by this factory or not\n2024|     *\n2025|     * @return I/O context created\n2026|     *\n...\n2035|\n2036|    /**\n2037|     * Overridable factory method that actually instantiates desired\n2038|     * context object for async (non-blocking) parsing\n2039|     *\n2040|     * @param srcRef Source reference to use for diagnostics, exception messages\n2041|     *\n2042|     * @return I/O context created\n2043|     *\n2044|     * @since 2.9.7\n2045|     */\n2046|    protected IOContext _createNonBlockingContext(Object srcRef) {\n2047|        // [jackson-core#479]: allow recycling for non-blocking parser again\n2048|        // now that access is thread-safe\n2049|        return new IOContext(_streamReadConstraints, _getBufferRecycler(),\n2050|                _createContentReference(srcRef),\n2051|                false);\n2052|    }\n2053|\n2054|    /**\n2055|     * Overridable factory method for constructing {@link ContentReference}\n2056|     * to pass to parser or generator being created; used in cases where no offset\n2057|     * or length is applicable (either irrelevant, or full contents assumed).\n2058|     *\n2059|     * @param contentAccessor Access to underlying content; depends on source/target,\n2060|     *    as well as content representation\n2061|     *\n...\n\n\n### src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java\n...\n143|    /**********************************************************************\n144|     */\n145|\n146|    /**\n147|     * Get the constraints to apply when performing streaming reads.\n148|     *\n149|     * @return Constraints to apply to reads done by {@link JsonParser}s constructed\n150|     *   by this factory.\n151|     *\n152|     * @since 2.15\n153|     */\n154|    public abstract StreamReadConstraints streamReadConstraints();\n155|\n156|    /*\n157|    /**********************************************************************\n158|    /* Factory methods, parsers\n159|    /**********************************************************************\n160|     */\n161|\n162|    public abstract JsonParser createParser(byte[] data) throws IOException;\n163|    public abstract JsonParser createParser(byte[] data, int offset, int len) throws IOException;\n...\n\n\n### src/main/java/com/fasterxml/jackson/core/io/IOContext.java\n...\n145|    }\n146|\n147|    @Deprecated // since 2.13\n148|    public IOContext(BufferRecycler br, Object rawContent, boolean managedResource) {\n149|        this(br, ContentReference.rawReference(rawContent), managedResource);\n150|    }\n151|\n152|    /**\n153|     * @return constraints for streaming reads\n154|     * @since 2.15\n155|     */\n156|    public StreamReadConstraints streamReadConstraints() {\n157|        return _streamReadConstraints;\n158|    }\n159|\n160|    public void setEncoding(JsonEncoding enc) {\n161|        _encoding = enc;\n162|    }\n163|\n164|    public IOContext withEncoding(JsonEncoding enc) {\n165|        _encoding = enc;\n166|        return this;\n167|    }\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.java\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.java\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.java\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nfunction: JsonFactory.setStreamReadConstraints\n```",
          "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nclass: JsonFactory\nfunction: JsonFactory.setStreamReadConstraints\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nfunction: JsonFactory.setStreamReadConstraints\n```",
            "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nclass: JsonFactory\nfunction: JsonFactory.setStreamReadConstraints\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "src/main/java/com/fasterxml/jackson/core/JsonFactory.java": [
          "class: JsonFactory\nfunction: JsonFactory.setStreamReadConstraints"
        ],
        "src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java": [
          ""
        ],
        "src/main/java/com/fasterxml/jackson/core/io/IOContext.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\nindex a2cd221..17b4e0d 100644\n--- a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n+++ b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n@@ -273,10 +273,11 @@ public class JsonFactory\n     /**\n      * Read constraints to use for {@link JsonParser}s constructed using\n      * this factory.\n+     * In 2.x this is mutable to allow legacy-style configuration via {@link #setStreamReadConstraints(StreamReadConstraints)}.\n      *\n      * @since 2.15\n      */\n-    final protected StreamReadConstraints _streamReadConstraints;\n+    protected StreamReadConstraints _streamReadConstraints;\n \n     /**\n      * Optional helper object that may decorate input sources, to do\n@@ -778,6 +779,21 @@ public class JsonFactory\n         return _streamReadConstraints;\n     }\n \n+    /**\n+     * Legacy-style mutator for defining {@link StreamReadConstraints} used for {@link JsonParser}s\n+     * created by this factory. If {@code null} is passed, default constraints are used.\n+     * This exists in 2.x to allow mutable configuration; removed in 3.0 where builder is required.\n+     *\n+     * @param constraints Constraints to use, or {@code null} for defaults\n+     * @return This factory instance (to allow call chaining)\n+     *\n+     * @since 2.15\n+     */\n+    public JsonFactory setStreamReadConstraints(StreamReadConstraints constraints) {\n+        _streamReadConstraints = (constraints == null) ? StreamReadConstraints.defaults() : constraints;\n+        return this;\n+    }\n+\n     /*\n     /**********************************************************\n     /* Configuration, parser configuration\n@@ -2124,4 +2140,4 @@ public class JsonFactory\n         // or its sub-class / delegated to one, no need to check for equality, identity is enough\n         return getFormatName() == FORMAT_NAME_JSON;\n     }\n-}\n+}\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nOffer a way to directly set `StreamReadConstraints` via `JsonFactory` (not just Builder)\nAlthough Builder-style configuration is becoming preferred for Jackson in 2.x (and the only way in 3.0), there is need to support mutable configuration for some key configuration. While for any truly new, optional functionality Builder-style may be sufficient, processing limits change existing behavior so they must be available via \"legacy\" style configuration too. This is in particular important for frameworks that do not fully control configurability but expose it to their users; and expecting users to change interfaces/mechanisms for `ObjectMapper`/`JsonFactory` configuration is a big ask (not to mention compatibility nightmare).\r\n\r\nSo, before 2.15.0 final, let's ensure `StreamReadConstraints` can be set on `JsonFactory`: it can not (alas!) be immutable until 3.0.\r\n\n\n###\n### src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n...\n765|    @Override\n766|    public int getFormatGeneratorFeatures() {\n767|        return 0;\n768|    }\n769|\n770|    /*\n771|    /**********************************************************************\n772|    /* Constraints violation checking (2.15)\n773|    /**********************************************************************\n774|     */\n775|\n776|    @Override\n777|    public StreamReadConstraints streamReadConstraints() {\n778|        return _streamReadConstraints;\n779|    }\n780|\n781|    /*\n782|    /**********************************************************\n783|    /* Configuration, parser configuration\n784|    /**********************************************************\n785|     */\n786|\n787|    /**\n788|     * Method for enabling or disabling specified parser feature\n...\n2000|    }\n2001|\n2002|    /**\n2003|     * Overridable factory method that actually instantiates desired\n2004|     * context object.\n2005|     *\n2006|     * @param contentRef Source/target reference to use for diagnostics, exception messages\n2007|     * @param resourceManaged Whether input/output buffer is managed by this factory or not\n2008|     *\n2009|     * @return I/O context created\n2010|     */\n2011|    protected IOContext _createContext(ContentReference contentRef, boolean resourceManaged) {\n2012|        // 21-Mar-2021, tatu: Bit of defensive coding for backwards compatibility\n2013|        if (contentRef == null) {\n2014|            contentRef = ContentReference.unknown();\n2015|        }\n2016|        return new IOContext(_streamReadConstraints, _getBufferRecycler(), contentRef, resourceManaged);\n2017|    }\n2018|\n2019|    /**\n2020|     * Deprecated variant of {@link #_createContext(Object, boolean)}\n2021|     *\n2022|     * @param rawContentRef \"Raw\" source/target reference\n2023|     * @param resourceManaged Whether input/output buffer is managed by this factory or not\n2024|     *\n2025|     * @return I/O context created\n2026|     *\n...\n2035|\n2036|    /**\n2037|     * Overridable factory method that actually instantiates desired\n2038|     * context object for async (non-blocking) parsing\n2039|     *\n2040|     * @param srcRef Source reference to use for diagnostics, exception messages\n2041|     *\n2042|     * @return I/O context created\n2043|     *\n2044|     * @since 2.9.7\n2045|     */\n2046|    protected IOContext _createNonBlockingContext(Object srcRef) {\n2047|        // [jackson-core#479]: allow recycling for non-blocking parser again\n2048|        // now that access is thread-safe\n2049|        return new IOContext(_streamReadConstraints, _getBufferRecycler(),\n2050|                _createContentReference(srcRef),\n2051|                false);\n2052|    }\n2053|\n2054|    /**\n2055|     * Overridable factory method for constructing {@link ContentReference}\n2056|     * to pass to parser or generator being created; used in cases where no offset\n2057|     * or length is applicable (either irrelevant, or full contents assumed).\n2058|     *\n2059|     * @param contentAccessor Access to underlying content; depends on source/target,\n2060|     *    as well as content representation\n2061|     *\n...\n\n\n### src/main/java/com/fasterxml/jackson/core/TokenStreamFactory.java\n...\n143|    /**********************************************************************\n144|     */\n145|\n146|    /**\n147|     * Get the constraints to apply when performing streaming reads.\n148|     *\n149|     * @return Constraints to apply to reads done by {@link JsonParser}s constructed\n150|     *   by this factory.\n151|     *\n152|     * @since 2.15\n153|     */\n154|    public abstract StreamReadConstraints streamReadConstraints();\n155|\n156|    /*\n157|    /**********************************************************************\n158|    /* Factory methods, parsers\n159|    /**********************************************************************\n160|     */\n161|\n162|    public abstract JsonParser createParser(byte[] data) throws IOException;\n163|    public abstract JsonParser createParser(byte[] data, int offset, int len) throws IOException;\n...\n\n\n### src/main/java/com/fasterxml/jackson/core/io/IOContext.java\n...\n145|    }\n146|\n147|    @Deprecated // since 2.13\n148|    public IOContext(BufferRecycler br, Object rawContent, boolean managedResource) {\n149|        this(br, ContentReference.rawReference(rawContent), managedResource);\n150|    }\n151|\n152|    /**\n153|     * @return constraints for streaming reads\n154|     * @since 2.15\n155|     */\n156|    public StreamReadConstraints streamReadConstraints() {\n157|        return _streamReadConstraints;\n158|    }\n159|\n160|    public void setEncoding(JsonEncoding enc) {\n161|        _encoding = enc;\n162|    }\n163|\n164|    public IOContext withEncoding(JsonEncoding enc) {\n165|        _encoding = enc;\n166|        return this;\n167|    }\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.java\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.java\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.java\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nfunction: JsonFactory.setStreamReadConstraints\n```",
          "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nclass: JsonFactory\nfunction: JsonFactory.setStreamReadConstraints\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nfunction: JsonFactory.setStreamReadConstraints\n```",
            "```\nsrc/main/java/com/fasterxml/jackson/core/JsonFactory.java\nclass: JsonFactory\nfunction: JsonFactory.setStreamReadConstraints\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\nindex a2cd221..4bb1985 100644\n--- a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n+++ b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n@@ -276,7 +276,7 @@ public class JsonFactory\n      *\n      * @since 2.15\n      */\n-    final protected StreamReadConstraints _streamReadConstraints;\n+    protected StreamReadConstraints _streamReadConstraints;\n \n     /**\n      * Optional helper object that may decorate input sources, to do\n@@ -778,6 +778,22 @@ public class JsonFactory\n         return _streamReadConstraints;\n     }\n \n+    /**\n+     * Method for setting {@link StreamReadConstraints} to use for parsers created\n+     * by this factory. If {@code constraints} is {@code null}, default constraints\n+     * will be used.\n+     *\n+     * @param constraints Read constraints to use; {@code null} for defaults\n+     *\n+     * @return This factory instance (to allow call chaining)\n+     *\n+     * @since 2.15\n+     */\n+    public JsonFactory setStreamReadConstraints(StreamReadConstraints constraints) {\n+        _streamReadConstraints = (constraints == null) ? StreamReadConstraints.defaults() : constraints;\n+        return this;\n+    }\n+\n     /*\n     /**********************************************************\n     /* Configuration, parser configuration\n@@ -2124,4 +2140,4 @@ public class JsonFactory\n         // or its sub-class / delegated to one, no need to check for equality, identity is enough\n         return getFormatName() == FORMAT_NAME_JSON;\n     }\n-}\n+}\n",
  "7_resolved": false
}