{
  "instance_id": "Multi-SWE-Bench__typescript__maintenance__bugfix__7c41997b",
  "original_id": "vuejs__core-10250",
  "1_model_selected_files": [
    "packages/server-renderer/src/helpers/ssrRenderAttrs.ts",
    "packages/runtime-dom/src/modules/style.ts",
    "packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts",
    "packages/compiler-ssr/src/transforms/ssrTransformElement.ts",
    "packages/runtime-dom/src/helpers/useCssVars.ts"
  ],
  "2_embedding_selected_files": [
    "packages/runtime-core/__tests__/hydration.spec.ts",
    "packages/runtime-core/src/hydration.ts",
    "packages/compiler-ssr/__tests__/ssrVShow.spec.ts",
    "packages/compiler-ssr/__tests__/ssrInjectCssVars.spec.ts",
    "packages/compiler-ssr/__tests__/ssrElement.spec.ts",
    "packages/server-renderer/__tests__/ssrComputed.spec.ts",
    "packages/compiler-ssr/__tests__/ssrVModel.spec.ts",
    "packages/server-renderer/__tests__/ssrRenderAttrs.spec.ts",
    "packages/compiler-ssr/__tests__/ssrComponent.spec.ts",
    "packages/runtime-core/__tests__/hmr.spec.ts",
    "packages/server-renderer/__tests__/render.spec.ts",
    "packages/compiler-ssr/__tests__/ssrScopeId.spec.ts",
    "packages/server-renderer/__tests__/ssrWatch.spec.ts",
    "packages/compiler-ssr/src/transforms/ssrTransformElement.ts",
    "packages/server-renderer/__tests__/ssrScopeId.spec.ts",
    "packages/compiler-ssr/src/transforms/ssrVShow.ts",
    "packages/server-renderer/__tests__/ssrSuspense.spec.ts",
    "packages/server-renderer/__tests__/ssrAttrFallthrough.spec.ts",
    "packages/compiler-dom/__tests__/transforms/transformStyle.spec.ts",
    "packages/compiler-ssr/__tests__/ssrVFor.spec.ts",
    "packages/compiler-sfc/__tests__/cssVars.spec.ts",
    "packages/compiler-ssr/__tests__/ssrVIf.spec.ts",
    "packages/server-renderer/__tests__/ssrDirectives.spec.ts",
    "packages/compiler-ssr/__tests__/ssrSlotOutlet.spec.ts",
    "packages/runtime-dom/src/modules/style.ts",
    "packages/vue-compat/__tests__/instance.spec.ts",
    "packages/compiler-ssr/__tests__/ssrTransitionGroup.spec.ts",
    "packages/compiler-ssr/src/errors.ts",
    "packages/compiler-ssr/__tests__/ssrText.spec.ts",
    "packages/server-renderer/__tests__/ssrDynamicComponent.spec.ts"
  ],
  "3_final_combined_files": [
    "packages/server-renderer/src/helpers/ssrRenderAttrs.ts",
    "packages/runtime-dom/src/modules/style.ts",
    "packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts",
    "packages/runtime-core/__tests__/hydration.spec.ts",
    "packages/runtime-core/src/hydration.ts",
    "packages/compiler-ssr/__tests__/ssrVShow.spec.ts"
  ],
  "4_related_elements": {
    "packages/server-renderer/src/helpers/ssrRenderAttrs.ts": [
      "function: ssrRenderAttrs\nfunction: ssrRenderDynamicAttr\nfunction: ssrRenderAttr\nfunction: ssrRenderClass\nfunction: ssrRenderStyle\nvariable: shouldIgnoreProp\nfunction: normalizeStyle\nfunction: stringifyStyle\nfunction: escapeHtml\nfunction: isString"
    ],
    "packages/runtime-dom/src/modules/style.ts": [
      "function: patchStyle\nfunction: setStyle\nfunction: autoPrefix\nvariable: CSS_VAR_TEXT\nvariable: semicolonRE\nvariable: importantRE\nvariable: prefixes\nvariable: prefixCache\nvariable: vShowOldKey"
    ],
    "packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts": [
      "function: ssrInjectCssVars\nfunction: injectCssVars\nvariable: _cssVars"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "packages/server-renderer/src/helpers/ssrRenderAttrs.ts": [
          "function: ssrRenderAttrs\nline: 41\nline: 42\nfunction: ssrRenderStyle\nline: 87\nline: 95"
        ],
        "packages/runtime-dom/src/modules/style.ts": [
          "function: patchStyle\nline: 24\nline: 33"
        ],
        "packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts": [
          "function: ssrInjectCssVars\nline: 58\nline: 66"
        ]
      },
      "patches": [
        "diff --git a/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts b/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts\nindex d89dcbc..6e23849 100644\n--- a/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts\n+++ b/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts\n@@ -1,3 +1,4 @@\n+\n import {\n   ElementTypes,\n   type NodeTransform,\n@@ -58,11 +59,11 @@ function injectCssVars(node: RootNode | TemplateChildNode) {\n       node.props.push({\n         type: NodeTypes.DIRECTIVE,\n         name: 'bind',\n-        arg: undefined,\n+        arg: createSimpleExpression(`style`, true),\n         exp: createSimpleExpression(`_cssVars`, false),\n         modifiers: [],\n         loc: locStub,\n       })\n     }\n   }\n-}\n+}\ndiff --git a/packages/runtime-dom/src/modules/style.ts b/packages/runtime-dom/src/modules/style.ts\nindex d9299f5..aed0d2c 100644\n--- a/packages/runtime-dom/src/modules/style.ts\n+++ b/packages/runtime-dom/src/modules/style.ts\n@@ -1,3 +1,4 @@\n+\n import { capitalize, hyphenate, isArray, isString } from '@vue/shared'\n import { camelize, warn } from '@vue/runtime-core'\n import { vShowOldKey } from '../directives/vShow'\n@@ -26,7 +27,10 @@ export function patchStyle(el: Element, prev: Style, next: Style) {\n         // #9821\n         const cssVarText = (style as any)[CSS_VAR_TEXT]\n         if (cssVarText) {\n-          ;(next as string) += ';' + cssVarText\n+          // avoid duplicating CSS vars if they are already present in the string\n+          if (!((next as string) ?? '').includes(cssVarText)) {\n+            ;(next as string) += ';' + cssVarText\n+          }\n         }\n         style.cssText = next as string\n       }\n",
        "diff --git a/packages/runtime-dom/src/modules/style.ts b/packages/runtime-dom/src/modules/style.ts\nindex d9299f5..3517435 100644\n--- a/packages/runtime-dom/src/modules/style.ts\n+++ b/packages/runtime-dom/src/modules/style.ts\n@@ -1,3 +1,4 @@\n+\n import { capitalize, hyphenate, isArray, isString } from '@vue/shared'\n import { camelize, warn } from '@vue/runtime-core'\n import { vShowOldKey } from '../directives/vShow'\n@@ -22,12 +23,12 @@ export function patchStyle(el: Element, prev: Style, next: Style) {\n     }\n   } else {\n     if (isCssString) {\n+      // #9821 - always include CSS vars text when present so hydration matches\n+      const cssVarText = (style as any)[CSS_VAR_TEXT]\n+      if (cssVarText) {\n+        ;(next as string) += ';' + cssVarText\n+      }\n       if (prev !== next) {\n-        // #9821\n-        const cssVarText = (style as any)[CSS_VAR_TEXT]\n-        if (cssVarText) {\n-          ;(next as string) += ';' + cssVarText\n-        }\n         style.cssText = next as string\n       }\n     } else if (prev) {\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "packages/runtime-dom/src/modules/style.ts": [
          "function: patchStyle\nline: 1\nline: 27\nline: 31"
        ],
        "packages/server-renderer/src/helpers/ssrRenderAttrs.ts": [
          ""
        ],
        "packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/runtime-dom/src/modules/style.ts b/packages/runtime-dom/src/modules/style.ts\nindex d9299f5..fe6324f 100644\n--- a/packages/runtime-dom/src/modules/style.ts\n+++ b/packages/runtime-dom/src/modules/style.ts\n@@ -1,3 +1,4 @@\n+\n import { capitalize, hyphenate, isArray, isString } from '@vue/shared'\n import { camelize, warn } from '@vue/runtime-core'\n import { vShowOldKey } from '../directives/vShow'\n@@ -25,10 +26,18 @@ export function patchStyle(el: Element, prev: Style, next: Style) {\n       if (prev !== next) {\n         // #9821\n         const cssVarText = (style as any)[CSS_VAR_TEXT]\n+        let text = next as string\n         if (cssVarText) {\n-          ;(next as string) += ';' + cssVarText\n+          text += ';' + cssVarText\n+        }\n+        // During hydration, if the SSR-rendered inline style already matches\n+        // the incoming style string, avoid resetting cssText here to prevent\n+        // a hydration mismatch warning. CSS vars (if any) will be applied\n+        // separately by useCssVars.\n+        const ssrStyle = el.getAttribute('style')\n+        if (!(ssrStyle !== null && ssrStyle === (next as string))) {\n+          style.cssText = text\n         }\n-        style.cssText = next as string\n       }\n     } else if (prev) {\n       el.removeAttribute('style')\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts b/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts\nindex d89dcbc..6e23849 100644\n--- a/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts\n+++ b/packages/compiler-ssr/src/transforms/ssrInjectCssVars.ts\n@@ -1,3 +1,4 @@\n+\n import {\n   ElementTypes,\n   type NodeTransform,\n@@ -58,11 +59,11 @@ function injectCssVars(node: RootNode | TemplateChildNode) {\n       node.props.push({\n         type: NodeTypes.DIRECTIVE,\n         name: 'bind',\n-        arg: undefined,\n+        arg: createSimpleExpression(`style`, true),\n         exp: createSimpleExpression(`_cssVars`, false),\n         modifiers: [],\n         loc: locStub,\n       })\n     }\n   }\n-}\n+}\ndiff --git a/packages/runtime-dom/src/modules/style.ts b/packages/runtime-dom/src/modules/style.ts\nindex d9299f5..aed0d2c 100644\n--- a/packages/runtime-dom/src/modules/style.ts\n+++ b/packages/runtime-dom/src/modules/style.ts\n@@ -1,3 +1,4 @@\n+\n import { capitalize, hyphenate, isArray, isString } from '@vue/shared'\n import { camelize, warn } from '@vue/runtime-core'\n import { vShowOldKey } from '../directives/vShow'\n@@ -26,7 +27,10 @@ export function patchStyle(el: Element, prev: Style, next: Style) {\n         // #9821\n         const cssVarText = (style as any)[CSS_VAR_TEXT]\n         if (cssVarText) {\n-          ;(next as string) += ';' + cssVarText\n+          // avoid duplicating CSS vars if they are already present in the string\n+          if (!((next as string) ?? '').includes(cssVarText)) {\n+            ;(next as string) += ';' + cssVarText\n+          }\n         }\n         style.cssText = next as string\n       }\n",
  "7_resolved": false
}