{
  "instance_id": "Multi-SWE-Bench__javascript__maintenance__bugfix__1081c568",
  "original_id": "sveltejs__svelte-11913",
  "1_model_selected_files": [],
  "2_embedding_selected_files": [
    "packages/svelte/src/reactivity/map.js",
    "packages/svelte/src/reactivity/map.test.ts",
    "packages/svelte/src/reactivity/set.js",
    "packages/svelte/src/reactivity/set.test.ts",
    "packages/svelte/src/reactivity/index-server.js",
    "packages/svelte/src/reactivity/index-client.js",
    "packages/svelte/src/internal/client/runtime.js",
    "packages/svelte/src/reactivity/url.js",
    "packages/svelte/src/reactivity/url.test.ts",
    "packages/svelte/src/internal/client/dev/inspect.js",
    "packages/svelte/src/internal/client/utils.js",
    "packages/svelte/src/internal/client/reactivity/sources.js",
    "packages/svelte/src/reactivity/date.js",
    "packages/svelte/src/internal/client/reactivity/props.js",
    "packages/svelte/src/internal/client/dom/legacy/misc.js",
    "packages/svelte/src/internal/client/reactivity/store.js",
    "packages/svelte/src/reactivity/utils.js",
    "packages/svelte/src/internal/client/errors.js",
    "packages/svelte/src/internal/server/index.js",
    "packages/svelte/src/internal/client/dom/blocks/each.js",
    "packages/svelte/src/internal/client/warnings.js",
    "packages/svelte/src/ambient.d.ts",
    "packages/svelte/types/index.d.ts",
    "packages/svelte/src/internal/client/proxy.js",
    "packages/svelte/src/compiler/utils/mapped_code.js",
    "packages/svelte/src/compiler/phases/3-transform/client/transform-client.js",
    "packages/svelte/src/internal/client/dom/elements/attributes.js",
    "packages/svelte/src/compiler/phases/scope.js",
    "packages/svelte/src/index-client.js",
    "packages/svelte/src/version.js",
    "packages/svelte/src/internal/client/reactivity/deriveds.js",
    "packages/svelte/src/internal/client/reactivity/effects.js",
    "packages/svelte/src/internal/client/dev/equality.js",
    "packages/svelte/src/internal/client/dom/legacy/lifecycle.js",
    "packages/svelte/src/compiler/phases/2-analyze/index.js",
    "packages/svelte/src/compiler/preprocess/index.js",
    "packages/svelte/src/internal/index.js",
    "packages/svelte/src/index.d.ts",
    "packages/svelte/src/internal/client/types.d.ts",
    "packages/svelte/src/legacy/legacy-client.js",
    "packages/svelte/src/compiler/phases/3-transform/client/visitors/template.js",
    "packages/svelte/src/internal/client/index.js"
  ],
  "3_final_combined_files": [
    "packages/svelte/src/reactivity/map.js",
    "packages/svelte/src/reactivity/map.test.ts",
    "packages/svelte/src/reactivity/set.js"
  ],
  "4_related_elements": {
    "packages/svelte/src/reactivity/map.js": [
      "class: ReactiveMap"
    ],
    "packages/svelte/src/reactivity/set.js": [
      "class: ReactiveSet"
    ],
    "packages/svelte/src/reactivity/map.test.ts": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "packages/svelte/src/reactivity/map.js": [
          "function: ReactiveMap.#read_all\nline: 145\nline: 146\nline: 147\nfunction: ReactiveMap.forEach\nline: 65\nline: 67"
        ],
        "packages/svelte/src/reactivity/map.test.ts": [
          ""
        ],
        "packages/svelte/src/reactivity/set.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/svelte/src/reactivity/map.js b/packages/svelte/src/reactivity/map.js\nindex a7c6f0c..000b3ae 100644\n--- a/packages/svelte/src/reactivity/map.js\n+++ b/packages/svelte/src/reactivity/map.js\n@@ -25,9 +25,9 @@ export class ReactiveMap extends Map {\n \n \t\tif (value) {\n \t\t\tfor (var [key, v] of value) {\n-\t\t\t\tsuper.set(key, v);\n+\t\t\t\t// Use the reactive set to ensure per-key sources are created for initial entries\n+\t\t\t\tthis.set(key, v);\n \t\t\t}\n-\t\t\tthis.#size.v = super.size;\n \t\t}\n \t}\n \n",
        "diff --git a/packages/svelte/src/reactivity/map.js b/packages/svelte/src/reactivity/map.js\nindex a7c6f0c..e6ffbb5 100644\n--- a/packages/svelte/src/reactivity/map.js\n+++ b/packages/svelte/src/reactivity/map.js\n@@ -62,7 +62,7 @@ export class ReactiveMap extends Map {\n \t * @param {any} [this_arg]\n \t */\n \tforEach(callbackfn, this_arg) {\n-\t\tget(this.#version);\n+\t\tthis.#read_all();\n \n \t\treturn super.forEach(callbackfn, this_arg);\n \t}\n@@ -142,8 +142,9 @@ export class ReactiveMap extends Map {\n \n \t#read_all() {\n \t\tget(this.#version);\n-\t\tfor (var [, s] of this.#sources) {\n-\t\t\tget(s);\n+\t\tfor (var key of super.keys()) {\n+\t\t\t// Ensure a source exists for each key and mark it as read\n+\t\t\tthis.get(key);\n \t\t}\n \t}\n \n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "packages/svelte/src/reactivity/map.js": [
          "function: ReactiveMap.constructor\nfunction: ReactiveMap.#read_all"
        ],
        "packages/svelte/src/reactivity/map.test.ts": [
          ""
        ],
        "packages/svelte/src/reactivity/set.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/svelte/src/reactivity/map.js b/packages/svelte/src/reactivity/map.js\nindex a7c6f0c..464a69a 100644\n--- a/packages/svelte/src/reactivity/map.js\n+++ b/packages/svelte/src/reactivity/map.js\n@@ -26,6 +26,11 @@ export class ReactiveMap extends Map {\n \t\tif (value) {\n \t\t\tfor (var [key, v] of value) {\n \t\t\t\tsuper.set(key, v);\n+\t\t\t\t// Ensure initial entries have a reactive source so reads like values()/entries() depend on them\n+\t\t\t\tvar s = this.#sources.get(key);\n+\t\t\t\tif (!s) {\n+\t\t\t\t\tthis.#sources.set(key, source(Symbol()));\n+\t\t\t\t}\n \t\t\t}\n \t\t\tthis.#size.v = super.size;\n \t\t}\n",
        "diff --git a/packages/svelte/src/reactivity/map.js b/packages/svelte/src/reactivity/map.js\nindex a7c6f0c..e0fe887 100644\n--- a/packages/svelte/src/reactivity/map.js\n+++ b/packages/svelte/src/reactivity/map.js\n@@ -62,7 +62,7 @@ export class ReactiveMap extends Map {\n \t * @param {any} [this_arg]\n \t */\n \tforEach(callbackfn, this_arg) {\n-\t\tget(this.#version);\n+\t\tthis.#read_all();\n \n \t\treturn super.forEach(callbackfn, this_arg);\n \t}\n@@ -142,8 +142,9 @@ export class ReactiveMap extends Map {\n \n \t#read_all() {\n \t\tget(this.#version);\n-\t\tfor (var [, s] of this.#sources) {\n-\t\t\tget(s);\n+\t\t// Ensure sources exist and are read for all current keys\n+\t\tfor (var key of super.keys()) {\n+\t\t\tthis.get(key);\n \t\t}\n \t}\n \n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/packages/svelte/src/reactivity/map.js b/packages/svelte/src/reactivity/map.js\nindex a7c6f0c..e6ffbb5 100644\n--- a/packages/svelte/src/reactivity/map.js\n+++ b/packages/svelte/src/reactivity/map.js\n@@ -62,7 +62,7 @@ export class ReactiveMap extends Map {\n \t * @param {any} [this_arg]\n \t */\n \tforEach(callbackfn, this_arg) {\n-\t\tget(this.#version);\n+\t\tthis.#read_all();\n \n \t\treturn super.forEach(callbackfn, this_arg);\n \t}\n@@ -142,8 +142,9 @@ export class ReactiveMap extends Map {\n \n \t#read_all() {\n \t\tget(this.#version);\n-\t\tfor (var [, s] of this.#sources) {\n-\t\t\tget(s);\n+\t\tfor (var key of super.keys()) {\n+\t\t\t// Ensure a source exists for each key and mark it as read\n+\t\t\tthis.get(key);\n \t\t}\n \t}\n \n",
  "7_resolved": false
}