{
  "instance_id": "Multi-SWE-Bench__javascript__maintenance__bugfix__cbea412a",
  "original_id": "expressjs__express-3870",
  "1_model_selected_files": [
    "lib/application.js",
    "lib/response.js",
    "lib/view.js"
  ],
  "2_embedding_selected_files": [
    "lib/view.js",
    "lib/application.js",
    "lib/middleware/query.js",
    "lib/utils.js",
    "lib/express.js",
    "lib/request.js",
    "lib/response.js",
    "express/index.js",
    "lib/router/index.js",
    "lib/router/layer.js",
    "lib/middleware/init.js",
    "lib/router/route.js"
  ],
  "3_final_combined_files": [
    "lib/application.js",
    "lib/view.js",
    "lib/response.js",
    "lib/middleware/query.js"
  ],
  "4_related_elements": {
    "lib/application.js": [
      "variable: app.cache\nfunction: app.render"
    ],
    "lib/response.js": [
      "function: res.render"
    ],
    "lib/view.js": [
      "class: View"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "lib/application.js": [
          "function: app.render"
        ],
        "lib/response.js": [
          "function: res.render"
        ],
        "lib/view.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/lib/application.js b/lib/application.js\nindex fe8aa74..6dccf50 100644\n--- a/lib/application.js\n+++ b/lib/application.js\n@@ -559,6 +559,7 @@ app.render = function render(name, options, callback) {\n   }\n \n   // primed cache\n+  var viewCacheKey = renderOptions.cacheKey != null ? renderOptions.cacheKey : name;\n   if (renderOptions.cache) {\n     view = cache[name];\n   }\ndiff --git a/lib/response.js b/lib/response.js\nindex dea98a9..f7c3289 100644\n--- a/lib/response.js\n+++ b/lib/response.js\n@@ -976,8 +976,9 @@ res.vary = function(field){\n  *\n  * Options:\n  *\n- *  - `cache`     boolean hinting to the engine it should cache\n- *  - `filename`  filename of the view being rendered\n+ *  - `cache`      boolean hinting to the engine it should cache\n+ *  - `filename`   filename of the view being rendered\n+ *  - `cacheKey`   custom cache key to identify cached views/templates\n  *\n  * @public\n  */\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "lib/application.js": [
          "function: render"
        ],
        "lib/response.js": [
          "function: render"
        ],
        "lib/view.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/lib/application.js b/lib/application.js\nindex fe8aa74..5160693 100644\n--- a/lib/application.js\n+++ b/lib/application.js\n@@ -558,6 +558,9 @@ app.render = function render(name, options, callback) {\n     renderOptions.cache = this.enabled('view cache');\n   }\n \n+  // resolve cache key (defaults to view name)\n+  var cacheKey = renderOptions.cacheKey || name;\n+\n   // primed cache\n   if (renderOptions.cache) {\n     view = cache[name];\ndiff --git a/lib/response.js b/lib/response.js\nindex dea98a9..c192144 100644\n--- a/lib/response.js\n+++ b/lib/response.js\n@@ -978,6 +978,7 @@ res.vary = function(field){\n  *\n  *  - `cache`     boolean hinting to the engine it should cache\n  *  - `filename`  filename of the view being rendered\n+ *  - `cacheKey`  custom cache key for Express and view engines\n  *\n  * @public\n  */\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/lib/application.js b/lib/application.js\nindex fe8aa74..6dccf50 100644\n--- a/lib/application.js\n+++ b/lib/application.js\n@@ -559,6 +559,7 @@ app.render = function render(name, options, callback) {\n   }\n \n   // primed cache\n+  var viewCacheKey = renderOptions.cacheKey != null ? renderOptions.cacheKey : name;\n   if (renderOptions.cache) {\n     view = cache[name];\n   }\ndiff --git a/lib/response.js b/lib/response.js\nindex dea98a9..f7c3289 100644\n--- a/lib/response.js\n+++ b/lib/response.js\n@@ -976,8 +976,9 @@ res.vary = function(field){\n  *\n  * Options:\n  *\n- *  - `cache`     boolean hinting to the engine it should cache\n- *  - `filename`  filename of the view being rendered\n+ *  - `cache`      boolean hinting to the engine it should cache\n+ *  - `filename`   filename of the view being rendered\n+ *  - `cacheKey`   custom cache key to identify cached views/templates\n  *\n  * @public\n  */\n",
  "7_resolved": false
}