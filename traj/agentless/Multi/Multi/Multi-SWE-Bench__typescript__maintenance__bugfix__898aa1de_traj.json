{
  "instance_id": "Multi-SWE-Bench__typescript__maintenance__bugfix__898aa1de",
  "original_id": "mui__material-ui-39775",
  "1_model_selected_files": [
    "packages/mui-material/src/Rating/Rating.js",
    "packages/mui-material/src/Rating/Rating.test.js",
    "packages/mui-lab/src/Rating/Rating.js"
  ],
  "2_embedding_selected_files": [
    "packages/mui-material/src/Rating/Rating.js",
    "packages/mui-material/src/Rating/Rating.test.js",
    "packages/mui-material/src/Rating/Rating.d.ts",
    "packages/mui-material/src/internal/svg-icons/Star.js",
    "packages/mui-material/src/Rating/index.js",
    "packages/mui-material/src/Slider/Slider.test.js",
    "packages/mui-material/src/styles/CssVarsProvider.test.js",
    "packages/mui-material/src/internal/svg-icons/StarBorder.js",
    "packages/mui-material/src/Badge/Badge.js",
    "packages/mui-material/src/Popover/Popover.test.js",
    "packages/mui-material/src/Grid/Grid.test.js",
    "packages/mui-material/src/Rating/ratingClasses.ts",
    "packages/mui-material/src/Slider/Slider.js",
    "packages/mui-material/src/StepIcon/StepIcon.test.js",
    "packages/mui-material/src/Badge/Badge.test.js",
    "packages/mui-material/src/Icon/Icon.js",
    "packages/mui-material/src/Tabs/Tabs.test.js",
    "packages/mui-material/src/Rating/index.d.ts",
    "packages/mui-material/src/Checkbox/Checkbox.test.js",
    "packages/mui-material/src/Icon/Icon.test.js",
    "packages/mui-material/src/Tooltip/Tooltip.test.js",
    "packages/mui-material/src/SvgIcon/SvgIcon.test.js",
    "packages/mui-material/src/Tabs/Tabs.js",
    "packages/mui-material/src/Tooltip/Tooltip.js",
    "packages/mui-material/src/SpeedDialIcon/SpeedDialIcon.test.js",
    "packages/mui-material/src/InputAdornment/InputAdornment.js",
    "packages/mui-material/src/Breadcrumbs/Breadcrumbs.test.js",
    "packages/mui-material/src/SpeedDial/SpeedDial.test.js",
    "packages/mui-material/src/InputAdornment/InputAdornment.test.js",
    "packages/mui-material/src/Popover/Popover.js",
    "packages/mui-material/src/Tab/Tab.js",
    "packages/mui-material/src/InputBase/InputBase.js",
    "packages/mui-material/src/SwipeableDrawer/SwipeableDrawer.test.js",
    "packages/mui-material/src/internal/svg-icons/IndeterminateCheckBox.js",
    "packages/mui-material/src/OutlinedInput/NotchedOutline.test.js"
  ],
  "3_final_combined_files": [
    "packages/mui-material/src/Rating/Rating.js",
    "packages/mui-material/src/Rating/Rating.test.js",
    "packages/mui-lab/src/Rating/Rating.js",
    "packages/mui-material/src/Rating/Rating.d.ts"
  ],
  "4_related_elements": {
    "packages/mui-material/src/Rating/Rating.js": [
      "function: handleMouseMove\nvariable: rootRef\nvariable: RatingRoot\nvariable: RatingIcon\nvariable: RatingDecimal\nfunction: RatingItem\nfunction: roundValueToPrecision"
    ],
    "packages/mui-material/src/Rating/Rating.test.js": [
      "function: should handle mouse hover correctly"
    ],
    "packages/mui-lab/src/Rating/Rating.js": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "packages/mui-material/src/Rating/Rating.js": [
          "line: 371\nline: 372\nline: 375\nline: 377"
        ],
        "packages/mui-material/src/Rating/Rating.test.js": [
          ""
        ],
        "packages/mui-lab/src/Rating/Rating.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/mui-material/src/Rating/Rating.js b/packages/mui-material/src/Rating/Rating.js\nindex 598a5d1..3923bb0 100644\n--- a/packages/mui-material/src/Rating/Rating.js\n+++ b/packages/mui-material/src/Rating/Rating.js\n@@ -1,3 +1,4 @@\n+\n 'use client';\n import * as React from 'react';\n import PropTypes from 'prop-types';\n@@ -367,14 +368,16 @@ const Rating = React.forwardRef(function Rating(inProps, ref) {\n     }\n \n     const rootNode = rootRef.current;\n-    const { right, left } = rootNode.getBoundingClientRect();\n-    const { width } = rootNode.firstChild.getBoundingClientRect();\n+    const rect = rootNode.getBoundingClientRect();\n+    // Use the total width of the rating container so spacing between icons is accounted for.\n+    // Fallback to clientWidth to avoid division by zero in edge cases.\n+    const containerWidth = rect.width || rootNode.clientWidth || 1;\n     let percent;\n \n     if (theme.direction === 'rtl') {\n-      percent = (right - event.clientX) / (width * max);\n+      percent = (rect.right - event.clientX) / containerWidth;\n     } else {\n-      percent = (event.clientX - left) / (width * max);\n+      percent = (event.clientX - rect.left) / containerWidth;\n     }\n \n     let newHover = roundValueToPrecision(max * percent + precision / 2, precision);\n@@ -751,4 +754,4 @@ Rating.propTypes /* remove-proptypes */ = {\n   value: PropTypes.number,\n };\n \n-export default Rating;\n+export default Rating;\n",
        "diff --git a/packages/mui-material/src/Rating/Rating.js b/packages/mui-material/src/Rating/Rating.js\nindex 598a5d1..cce413e 100644\n--- a/packages/mui-material/src/Rating/Rating.js\n+++ b/packages/mui-material/src/Rating/Rating.js\n@@ -367,14 +367,14 @@ const Rating = React.forwardRef(function Rating(inProps, ref) {\n     }\n \n     const rootNode = rootRef.current;\n-    const { right, left } = rootNode.getBoundingClientRect();\n-    const { width } = rootNode.firstChild.getBoundingClientRect();\n+    const { right, left, width } = rootNode.getBoundingClientRect();\n     let percent;\n \n+    // Use the full root width to account for custom spacing between icons\n     if (theme.direction === 'rtl') {\n-      percent = (right - event.clientX) / (width * max);\n+      percent = (right - event.clientX) / width;\n     } else {\n-      percent = (event.clientX - left) / (width * max);\n+      percent = (event.clientX - left) / width;\n     }\n \n     let newHover = roundValueToPrecision(max * percent + precision / 2, precision);\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nCan't get correct position after changing spacing of icons in <Rating /> component in v5.\nFor some reasons, I need to change the spacing between icons in `<Rating />`  component, but it causes the component cannot get correct position of each icons.\r\n\r\nHere is the demo:\r\n\r\nhttps://codesandbox.io/s/halfrating-material-demo-forked-0lh9f?file=/demo.js:388-393\r\n\r\nWhen you move your mouse on the second star, the third one will be highlighted.\n\n###\n### packages/mui-material/src/Rating/Rating.js\n1|'use client';\n2|import * as React from 'react';\n3|import PropTypes from 'prop-types';\n4|import clsx from 'clsx';\n5|import { chainPropTypes, visuallyHidden } from '@mui/utils';\n6|import { unstable_composeClasses as composeClasses } from '@mui/base/composeClasses';\n7|import useTheme from '../styles/useTheme';\n8|import {\n9|  capitalize,\n10|  useForkRef,\n11|  useIsFocusVisible,\n12|  useControlled,\n13|  unstable_useId as useId,\n14|} from '../utils';\n15|import Star from '../internal/svg-icons/Star';\n16|import StarBorder from '../internal/svg-icons/StarBorder';\n17|import useThemeProps from '../styles/useThemeProps';\n18|import styled, { slotShouldForwardProp } from '../styles/styled';\n19|import ratingClasses, { getRatingUtilityClass } from './ratingClasses';\n20|\n21|function clamp(value, min, max) {\n22|  if (value < min) {\n23|    return min;\n24|  }\n25|  if (value > max) {\n26|    return max;\n27|  }\n28|  return value;\n29|}\n30|\n31|function getDecimalPrecision(num) {\n32|  const decimalPart = num.toString().split('.')[1];\n33|  return decimalPart ? decimalPart.length : 0;\n34|}\n35|\n36|function roundValueToPrecision(value, precision) {\n37|  if (value == null) {\n38|    return value;\n39|  }\n40|\n41|  const nearest = Math.round(value / precision) * precision;\n42|  return Number(nearest.toFixed(getDecimalPrecision(precision)));\n43|}\n44|\n45|const useUtilityClasses = (ownerState) => {\n46|  const { classes, size, readOnly, disabled, emptyValueFocused, focusVisible } = ownerState;\n47|\n48|  const slots = {\n49|    root: [\n50|      'root',\n51|      `size${capitalize(size)}`,\n52|      disabled && 'disabled',\n53|      focusVisible && 'focusVisible',\n54|      readOnly && 'readOnly',\n55|    ],\n56|    label: ['label', 'pristine'],\n57|    labelEmptyValue: [emptyValueFocused && 'labelEmptyValueActive'],\n58|    icon: ['icon'],\n59|    iconEmpty: ['iconEmpty'],\n60|    iconFilled: ['iconFilled'],\n61|    iconHover: ['iconHover'],\n62|    iconFocus: ['iconFocus'],\n63|    iconActive: ['iconActive'],\n64|    decimal: ['decimal'],\n65|    visuallyHidden: ['visuallyHidden'],\n66|  };\n67|\n68|  return composeClasses(slots, getRatingUtilityClass, classes);\n69|};\n70|\n71|const RatingRoot = styled('span', {\n72|  name: 'MuiRating',\n73|  slot: 'Root',\n74|  overridesResolver: (props, styles) => {\n75|    const { ownerState } = props;\n76|\n77|    return [\n78|      { [`& .${ratingClasses.visuallyHidden}`]: styles.visuallyHidden },\n79|      styles.root,\n80|      styles[`size${capitalize(ownerState.size)}`],\n81|      ownerState.readOnly && styles.readOnly,\n82|    ];\n83|  },\n84|})(({ theme, ownerState }) => ({\n85|  display: 'inline-flex',\n86|  // Required to position the pristine input absolutely\n87|  position: 'relative',\n88|  fontSize: theme.typography.pxToRem(24),\n89|  color: '#faaf00',\n90|  cursor: 'pointer',\n91|  textAlign: 'left',\n92|  WebkitTapHighlightColor: 'transparent',\n93|  [`&.${ratingClasses.disabled}`]: {\n94|    opacity: (theme.vars || theme).palette.action.disabledOpacity,\n95|    pointerEvents: 'none',\n96|  },\n97|  [`&.${ratingClasses.focusVisible} .${ratingClasses.iconActive}`]: {\n98|    outline: '1px solid #999',\n99|  },\n100|  [`& .${ratingClasses.visuallyHidden}`]: visuallyHidden,\n101|  ...(ownerState.size === 'small' && {\n102|    fontSize: theme.typography.pxToRem(18),\n103|  }),\n104|  ...(ownerState.size === 'large' && {\n105|    fontSize: theme.typography.pxToRem(30),\n106|  }),\n107|  // TODO v6: use the .Mui-readOnly global state class\n108|  ...(ownerState.readOnly && {\n109|    pointerEvents: 'none',\n110|  }),\n111|}));\n112|\n113|const RatingLabel = styled('label', {\n114|  name: 'MuiRating',\n115|  slot: 'Label',\n116|  overridesResolver: ({ ownerState }, styles) => [\n117|    styles.label,\n118|    ownerState.emptyValueFocused && styles.labelEmptyValueActive,\n119|  ],\n120|})(({ ownerState }) => ({\n121|  cursor: 'inherit',\n122|  ...(ownerState.emptyValueFocused && {\n123|    top: 0,\n124|    bottom: 0,\n125|    position: 'absolute',\n126|    outline: '1px solid #999',\n127|    width: '100%',\n128|  }),\n129|}));\n130|\n131|const RatingIcon = styled('span', {\n132|  name: 'MuiRating',\n133|  slot: 'Icon',\n134|  overridesResolver: (props, styles) => {\n135|    const { ownerState } = props;\n136|\n137|    return [\n138|      styles.icon,\n139|      ownerState.iconEmpty && styles.iconEmpty,\n140|      ownerState.iconFilled && styles.iconFilled,\n141|      ownerState.iconHover && styles.iconHover,\n142|      ownerState.iconFocus && styles.iconFocus,\n143|      ownerState.iconActive && styles.iconActive,\n144|    ];\n145|  },\n146|})(({ theme, ownerState }) => ({\n147|  // Fit wrapper to actual icon size.\n148|  display: 'flex',\n149|  transition: theme.transitions.create('transform', {\n150|    duration: theme.transitions.duration.shortest,\n151|  }),\n152|  // Fix mouseLeave issue.\n153|  // https://github.com/facebook/react/issues/4492\n154|  pointerEvents: 'none',\n155|  ...(ownerState.iconActive && {\n156|    transform: 'scale(1.2)',\n157|  }),\n158|  ...(ownerState.iconEmpty && {\n159|    color: (theme.vars || theme).palette.action.disabled,\n160|  }),\n161|}));\n162|\n163|const RatingDecimal = styled('span', {\n164|  name: 'MuiRating',\n165|  slot: 'Decimal',\n166|  shouldForwardProp: (prop) => slotShouldForwardProp(prop) && prop !== 'iconActive',\n167|  overridesResolver: (props, styles) => {\n168|    const { iconActive } = props;\n169|\n170|    return [styles.decimal, iconActive && styles.iconActive];\n171|  },\n172|})(({ iconActive }) => ({\n173|  position: 'relative',\n174|  ...(iconActive && {\n175|    transform: 'scale(1.2)',\n176|  }),\n177|}));\n178|\n179|function IconContainer(props) {\n180|  const { value, ...other } = props;\n181|  return <span {...other} />;\n182|}\n183|\n184|IconContainer.propTypes = {\n185|  value: PropTypes.number.isRequired,\n186|};\n187|\n188|function RatingItem(props) {\n189|  const {\n190|    classes,\n191|    disabled,\n192|    emptyIcon,\n193|    focus,\n194|    getLabelText,\n195|    highlightSelectedOnly,\n196|    hover,\n197|    icon,\n198|    IconContainerComponent,\n199|    isActive,\n200|    itemValue,\n201|    labelProps,\n202|    name,\n203|    onBlur,\n204|    onChange,\n205|    onClick,\n206|    onFocus,\n207|    readOnly,\n208|    ownerState,\n209|    ratingValue,\n210|    ratingValueRounded,\n211|  } = props;\n212|\n213|  const isFilled = highlightSelectedOnly ? itemValue === ratingValue : itemValue <= ratingValue;\n214|  const isHovered = itemValue <= hover;\n215|  const isFocused = itemValue <= focus;\n216|  const isChecked = itemValue === ratingValueRounded;\n217|\n218|  const id = useId();\n219|  const container = (\n220|    <RatingIcon\n221|      as={IconContainerComponent}\n222|      value={itemValue}\n223|      className={clsx(classes.icon, {\n224|        [classes.iconEmpty]: !isFilled,\n225|        [classes.iconFilled]: isFilled,\n226|        [classes.iconHover]: isHovered,\n227|        [classes.iconFocus]: isFocused,\n228|        [classes.iconActive]: isActive,\n229|      })}\n230|      ownerState={{\n231|        ...ownerState,\n232|        iconEmpty: !isFilled,\n233|        iconFilled: isFilled,\n234|        iconHover: isHovered,\n235|        iconFocus: isFocused,\n236|        iconActive: isActive,\n237|      }}\n238|    >\n239|      {emptyIcon && !isFilled ? emptyIcon : icon}\n240|    </RatingIcon>\n241|  );\n242|\n243|  if (readOnly) {\n244|    return <span {...labelProps}>{container}</span>;\n245|  }\n246|\n247|  return (\n248|    <React.Fragment>\n249|      <RatingLabel\n250|        ownerState={{ ...ownerState, emptyValueFocused: undefined }}\n251|        htmlFor={id}\n252|        {...labelProps}\n253|      >\n254|        {container}\n255|        <span className={classes.visuallyHidden}>{getLabelText(itemValue)}</span>\n256|      </RatingLabel>\n257|      <input\n258|        className={classes.visuallyHidden}\n259|        onFocus={onFocus}\n260|        onBlur={onBlur}\n261|        onChange={onChange}\n262|        onClick={onClick}\n263|        disabled={disabled}\n264|        value={itemValue}\n265|        id={id}\n266|        type=\"radio\"\n267|        name={name}\n268|        checked={isChecked}\n269|      />\n270|    </React.Fragment>\n271|  );\n272|}\n273|\n274|RatingItem.propTypes = {\n275|  classes: PropTypes.object.isRequired,\n276|  disabled: PropTypes.bool.isRequired,\n277|  emptyIcon: PropTypes.node,\n278|  focus: PropTypes.number.isRequired,\n279|  getLabelText: PropTypes.func.isRequired,\n280|  highlightSelectedOnly: PropTypes.bool.isRequired,\n281|  hover: PropTypes.number.isRequired,\n282|  icon: PropTypes.node,\n283|  IconContainerComponent: PropTypes.elementType.isRequired,\n284|  isActive: PropTypes.bool.isRequired,\n285|  itemValue: PropTypes.number.isRequired,\n286|  labelProps: PropTypes.object,\n287|  name: PropTypes.string,\n288|  onBlur: PropTypes.func.isRequired,\n289|  onChange: PropTypes.func.isRequired,\n290|  onClick: PropTypes.func.isRequired,\n291|  onFocus: PropTypes.func.isRequired,\n292|  ownerState: PropTypes.object.isRequired,\n293|  ratingValue: PropTypes.number,\n294|  ratingValueRounded: PropTypes.number,\n295|  readOnly: PropTypes.bool.isRequired,\n296|};\n297|\n298|const defaultIcon = <Star fontSize=\"inherit\" />;\n299|const defaultEmptyIcon = <StarBorder fontSize=\"inherit\" />;\n300|\n301|function defaultLabelText(value) {\n302|  return `${value} Star${value !== 1 ? 's' : ''}`;\n303|}\n304|\n305|const Rating = React.forwardRef(function Rating(inProps, ref) {\n306|  const props = useThemeProps({ name: 'MuiRating', props: inProps });\n307|  const {\n308|    className,\n309|    defaultValue = null,\n310|    disabled = false,\n311|    emptyIcon = defaultEmptyIcon,\n312|    emptyLabelText = 'Empty',\n313|    getLabelText = defaultLabelText,\n314|    highlightSelectedOnly = false,\n315|    icon = defaultIcon,\n316|    IconContainerComponent = IconContainer,\n317|    max = 5,\n318|    name: nameProp,\n319|    onChange,\n320|    onChangeActive,\n321|    onMouseLeave,\n322|    onMouseMove,\n323|    precision = 1,\n324|    readOnly = false,\n325|    size = 'medium',\n326|    value: valueProp,\n327|    ...other\n328|  } = props;\n329|\n330|  const name = useId(nameProp);\n331|\n332|  const [valueDerived, setValueState] = useControlled({\n333|    controlled: valueProp,\n334|    default: defaultValue,\n335|    name: 'Rating',\n336|  });\n337|\n338|  const valueRounded = roundValueToPrecision(valueDerived, precision);\n339|  const theme = useTheme();\n340|  const [{ hover, focus }, setState] = React.useState({\n341|    hover: -1,\n342|    focus: -1,\n343|  });\n344|\n345|  let value = valueRounded;\n346|  if (hover !== -1) {\n347|    value = hover;\n348|  }\n349|  if (focus !== -1) {\n350|    value = focus;\n351|  }\n352|\n353|  const {\n354|    isFocusVisibleRef,\n355|    onBlur: handleBlurVisible,\n356|    onFocus: handleFocusVisible,\n357|    ref: focusVisibleRef,\n358|  } = useIsFocusVisible();\n359|  const [focusVisible, setFocusVisible] = React.useState(false);\n360|\n361|  const rootRef = React.useRef();\n362|  const handleRef = useForkRef(focusVisibleRef, rootRef, ref);\n363|\n364|  const handleMouseMove = (event) => {\n365|    if (onMouseMove) {\n366|      onMouseMove(event);\n367|    }\n368|\n369|    const rootNode = rootRef.current;\n370|    const { right, left } = rootNode.getBoundingClientRect();\n371|    const { width } = rootNode.firstChild.getBoundingClientRect();\n372|    let percent;\n373|\n374|    if (theme.direction === 'rtl') {\n375|      percent = (right - event.clientX) / (width * max);\n376|    } else {\n377|      percent = (event.clientX - left) / (width * max);\n378|    }\n379|\n380|    let newHover = roundValueToPrecision(max * percent + precision / 2, precision);\n381|    newHover = clamp(newHover, precision, max);\n382|\n383|    setState((prev) =>\n384|      prev.hover === newHover && prev.focus === newHover\n385|        ? prev\n386|        : {\n387|            hover: newHover,\n388|            focus: newHover,\n389|          },\n390|    );\n391|\n392|    setFocusVisible(false);\n393|\n394|    if (onChangeActive && hover !== newHover) {\n395|      onChangeActive(event, newHover);\n396|    }\n397|  };\n398|\n399|  const handleMouseLeave = (event) => {\n400|    if (onMouseLeave) {\n401|      onMouseLeave(event);\n402|    }\n403|\n404|    const newHover = -1;\n405|    setState({\n406|      hover: newHover,\n407|      focus: newHover,\n408|    });\n409|\n410|    if (onChangeActive && hover !== newHover) {\n411|      onChangeActive(event, newHover);\n412|    }\n413|  };\n414|\n415|  const handleChange = (event) => {\n416|    let newValue = event.target.value === '' ? null : parseFloat(event.target.value);\n417|\n418|    // Give mouse priority over keyboard\n419|    // Fix https://github.com/mui/material-ui/issues/22827\n420|    if (hover !== -1) {\n421|      newValue = hover;\n422|    }\n423|\n424|    setValueState(newValue);\n425|\n426|    if (onChange) {\n427|      onChange(event, newValue);\n428|    }\n429|  };\n430|\n431|  const handleClear = (event) => {\n432|    // Ignore keyboard events\n433|    // https://github.com/facebook/react/issues/7407\n434|    if (event.clientX === 0 && event.clientY === 0) {\n435|      return;\n436|    }\n437|\n438|    setState({\n439|      hover: -1,\n440|      focus: -1,\n441|    });\n442|\n443|    setValueState(null);\n444|\n445|    if (onChange && parseFloat(event.target.value) === valueRounded) {\n446|      onChange(event, null);\n447|    }\n448|  };\n449|\n450|  const handleFocus = (event) => {\n451|    handleFocusVisible(event);\n452|    if (isFocusVisibleRef.current === true) {\n453|      setFocusVisible(true);\n454|    }\n455|\n456|    const newFocus = parseFloat(event.target.value);\n457|    setState((prev) => ({\n458|      hover: prev.hover,\n459|      focus: newFocus,\n460|    }));\n461|  };\n462|\n463|  const handleBlur = (event) => {\n464|    if (hover !== -1) {\n465|      return;\n466|    }\n467|\n468|    handleBlurVisible(event);\n469|    if (isFocusVisibleRef.current === false) {\n470|      setFocusVisible(false);\n471|    }\n472|\n473|    const newFocus = -1;\n474|    setState((prev) => ({\n475|      hover: prev.hover,\n476|      focus: newFocus,\n477|    }));\n478|  };\n479|\n480|  const [emptyValueFocused, setEmptyValueFocused] = React.useState(false);\n481|\n482|  const ownerState = {\n483|    ...props,\n484|    defaultValue,\n485|    disabled,\n486|    emptyIcon,\n487|    emptyLabelText,\n488|    emptyValueFocused,\n489|    focusVisible,\n490|    getLabelText,\n491|    icon,\n492|    IconContainerComponent,\n493|    max,\n494|    precision,\n495|    readOnly,\n496|    size,\n497|  };\n498|\n499|  const classes = useUtilityClasses(ownerState);\n500|\n501|  return (\n502|    <RatingRoot\n503|      ref={handleRef}\n504|      onMouseMove={handleMouseMove}\n505|      onMouseLeave={handleMouseLeave}\n506|      className={clsx(\n507|        classes.root,\n508|        {\n509|          // TODO v6: remove this class as it duplicates with the global state class Mui-readOnly\n510|          'MuiRating-readOnly': readOnly,\n511|        },\n512|        className,\n513|      )}\n514|      ownerState={ownerState}\n515|      role={readOnly ? 'img' : null}\n516|      aria-label={readOnly ? getLabelText(value) : null}\n517|      {...other}\n518|    >\n519|      {Array.from(new Array(max)).map((_, index) => {\n520|        const itemValue = index + 1;\n521|\n522|        const ratingItemProps = {\n523|          classes,\n524|          disabled,\n525|          emptyIcon,\n526|          focus,\n527|          getLabelText,\n528|          highlightSelectedOnly,\n529|          hover,\n530|          icon,\n531|          IconContainerComponent,\n532|          name,\n533|          onBlur: handleBlur,\n534|          onChange: handleChange,\n535|          onClick: handleClear,\n536|          onFocus: handleFocus,\n537|          ratingValue: value,\n538|          ratingValueRounded: valueRounded,\n539|          readOnly,\n540|          ownerState,\n541|        };\n542|\n543|        const isActive = itemValue === Math.ceil(value) && (hover !== -1 || focus !== -1);\n544|        if (precision < 1) {\n545|          const items = Array.from(new Array(1 / precision));\n546|          return (\n547|            <RatingDecimal\n548|              key={itemValue}\n549|              className={clsx(classes.decimal, { [classes.iconActive]: isActive })}\n550|              ownerState={ownerState}\n551|              iconActive={isActive}\n552|            >\n553|              {items.map(($, indexDecimal) => {\n554|                const itemDecimalValue = roundValueToPrecision(\n555|                  itemValue - 1 + (indexDecimal + 1) * precision,\n556|                  precision,\n557|                );\n558|\n559|                return (\n560|                  <RatingItem\n561|                    key={itemDecimalValue}\n562|                    {...ratingItemProps}\n563|                    // The icon is already displayed as active\n564|                    isActive={false}\n565|                    itemValue={itemDecimalValue}\n566|                    labelProps={{\n567|                      style:\n568|                        items.length - 1 === indexDecimal\n569|                          ? {}\n570|                          : {\n571|                              width:\n572|                                itemDecimalValue === value\n573|                                  ? `${(indexDecimal + 1) * precision * 100}%`\n574|                                  : '0%',\n575|                              overflow: 'hidden',\n576|                              position: 'absolute',\n577|                            },\n578|                    }}\n579|                  />\n580|                );\n581|              })}\n582|            </RatingDecimal>\n583|          );\n584|        }\n585|\n586|        return (\n587|          <RatingItem\n588|            key={itemValue}\n589|            {...ratingItemProps}\n590|            isActive={isActive}\n591|            itemValue={itemValue}\n592|          />\n593|        );\n594|      })}\n595|      {!readOnly && !disabled && (\n596|        <RatingLabel\n597|          className={clsx(classes.label, classes.labelEmptyValue)}\n598|          ownerState={ownerState}\n599|        >\n600|          <input\n601|            className={classes.visuallyHidden}\n602|            value=\"\"\n603|            id={`${name}-empty`}\n604|            type=\"radio\"\n605|            name={name}\n606|            checked={valueRounded == null}\n607|            onFocus={() => setEmptyValueFocused(true)}\n608|            onBlur={() => setEmptyValueFocused(false)}\n609|            onChange={handleChange}\n610|          />\n611|          <span className={classes.visuallyHidden}>{emptyLabelText}</span>\n612|        </RatingLabel>\n613|      )}\n614|    </RatingRoot>\n615|  );\n616|});\n617|\n618|Rating.propTypes /* remove-proptypes */ = {\n619|  // ----------------------------- Warning --------------------------------\n620|  // | These PropTypes are generated from the TypeScript type definitions |\n621|  // |     To update them edit the d.ts file and run \"yarn proptypes\"     |\n622|  // ----------------------------------------------------------------------\n623|  /**\n624|   * Override or extend the styles applied to the component.\n625|   */\n626|  classes: PropTypes.object,\n627|  /**\n628|   * @ignore\n629|   */\n630|  className: PropTypes.string,\n631|  /**\n632|   * The default value. Use when the component is not controlled.\n633|   * @default null\n634|   */\n635|  defaultValue: PropTypes.number,\n636|  /**\n637|   * If `true`, the component is disabled.\n638|   * @default false\n639|   */\n640|  disabled: PropTypes.bool,\n641|  /**\n642|   * The icon to display when empty.\n643|   * @default <StarBorder fontSize=\"inherit\" />\n644|   */\n645|  emptyIcon: PropTypes.node,\n646|  /**\n647|   * The label read when the rating input is empty.\n648|   * @default 'Empty'\n649|   */\n650|  emptyLabelText: PropTypes.node,\n651|  /**\n652|   * Accepts a function which returns a string value that provides a user-friendly name for the current value of the rating.\n653|   * This is important for screen reader users.\n654|   *\n655|   * For localization purposes, you can use the provided [translations](/material-ui/guides/localization/).\n656|   * @param {number} value The rating label's value to format.\n657|   * @returns {string}\n658|   * @default function defaultLabelText(value) {\n659|   *   return `${value} Star${value !== 1 ? 's' : ''}`;\n660|   * }\n661|   */\n662|  getLabelText: PropTypes.func,\n663|  /**\n664|   * If `true`, only the selected icon will be highlighted.\n665|   * @default false\n666|   */\n667|  highlightSelectedOnly: PropTypes.bool,\n668|  /**\n669|   * The icon to display.\n670|   * @default <Star fontSize=\"inherit\" />\n671|   */\n672|  icon: PropTypes.node,\n673|  /**\n674|   * The component containing the icon.\n675|   * @default function IconContainer(props) {\n676|   *   const { value, ...other } = props;\n677|   *   return <span {...other} />;\n678|   * }\n679|   */\n680|  IconContainerComponent: PropTypes.elementType,\n681|  /**\n682|   * Maximum rating.\n683|   * @default 5\n684|   */\n685|  max: PropTypes.number,\n686|  /**\n687|   * The name attribute of the radio `input` elements.\n688|   * This input `name` should be unique within the page.\n689|   * Being unique within a form is insufficient since the `name` is used to generated IDs.\n690|   */\n691|  name: PropTypes.string,\n692|  /**\n693|   * Callback fired when the value changes.\n694|   * @param {React.SyntheticEvent} event The event source of the callback.\n695|   * @param {number|null} value The new value.\n696|   */\n697|  onChange: PropTypes.func,\n698|  /**\n699|   * Callback function that is fired when the hover state changes.\n700|   * @param {React.SyntheticEvent} event The event source of the callback.\n701|   * @param {number} value The new value.\n702|   */\n703|  onChangeActive: PropTypes.func,\n704|  /**\n705|   * @ignore\n706|   */\n707|  onMouseLeave: PropTypes.func,\n708|  /**\n709|   * @ignore\n710|   */\n711|  onMouseMove: PropTypes.func,\n712|  /**\n713|   * The minimum increment value change allowed.\n714|   * @default 1\n715|   */\n716|  precision: chainPropTypes(PropTypes.number, (props) => {\n717|    if (props.precision < 0.1) {\n718|      return new Error(\n719|        [\n720|          'MUI: The prop `precision` should be above 0.1.',\n721|          'A value below this limit has an imperceptible impact.',\n722|        ].join('\\n'),\n723|      );\n724|    }\n725|    return null;\n726|  }),\n727|  /**\n728|   * Removes all hover effects and pointer events.\n729|   * @default false\n730|   */\n731|  readOnly: PropTypes.bool,\n732|  /**\n733|   * The size of the component.\n734|   * @default 'medium'\n735|   */\n736|  size: PropTypes /* @typescript-to-proptypes-ignore */.oneOfType([\n737|    PropTypes.oneOf(['small', 'medium', 'large']),\n738|    PropTypes.string,\n739|  ]),\n740|  /**\n741|   * The system prop that allows defining system overrides as well as additional CSS styles.\n742|   */\n743|  sx: PropTypes.oneOfType([\n744|    PropTypes.arrayOf(PropTypes.oneOfType([PropTypes.func, PropTypes.object, PropTypes.bool])),\n745|    PropTypes.func,\n746|    PropTypes.object,\n747|  ]),\n748|  /**\n749|   * The rating value.\n750|   */\n751|  value: PropTypes.number,\n752|};\n753|\n754|export default Rating;\n\n\n### packages/mui-material/src/Rating/Rating.test.js\n1|import * as React from 'react';\n2|import { expect } from 'chai';\n3|import { stub, spy } from 'sinon';\n4|import {\n5|  act,\n6|  describeConformance,\n7|  createRenderer,\n8|  fireEvent,\n9|  screen,\n10|} from '@mui-internal/test-utils';\n11|import Rating, { ratingClasses as classes } from '@mui/material/Rating';\n12|import { createTheme, ThemeProvider } from '@mui/material/styles';\n13|\n14|describe('<Rating />', () => {\n15|  const { render } = createRenderer();\n16|\n17|  describeConformance(<Rating />, () => ({\n18|    classes,\n19|    inheritComponent: 'span',\n20|    render,\n21|    muiName: 'MuiRating',\n22|    testVariantProps: { variant: 'foo' },\n23|    testDeepOverrides: { slotName: 'label', slotClassName: classes.label },\n24|    testStateOverrides: { prop: 'size', value: 'small', styleKey: 'sizeSmall' },\n25|    refInstanceof: window.HTMLSpanElement,\n26|    skip: ['componentProp', 'componentsProp'],\n27|  }));\n28|\n29|  it('should render', () => {\n30|    const { container } = render(<Rating />);\n31|\n32|    expect(container.firstChild).to.have.class(classes.root);\n33|  });\n34|\n35|  it('should round the value to the provided precision', () => {\n36|    const { container } = render(<Rating name=\"rating-test\" value={3.9} precision={0.2} />);\n37|\n38|    expect(container.querySelector('input[name=\"rating-test\"]:checked')).to.have.property(\n39|      'value',\n40|      '4',\n41|    );\n42|  });\n43|\n44|  it('should handle mouse hover correctly', () => {\n45|    const { container } = render(<Rating />);\n46|    stub(container.firstChild, 'getBoundingClientRect').callsFake(() => ({\n47|      left: 0,\n48|      right: 100,\n49|    }));\n50|    stub(container.firstChild.firstChild, 'getBoundingClientRect').callsFake(() => ({\n51|      width: 20,\n52|    }));\n53|    fireEvent.mouseMove(container.firstChild, {\n54|      clientX: 19,\n55|    });\n56|    expect(container.querySelectorAll(`.${classes.iconHover}`).length).to.equal(1);\n57|    fireEvent.mouseMove(container.firstChild, {\n58|      clientX: 21,\n59|    });\n60|    expect(container.querySelectorAll(`.${classes.iconHover}`).length).to.equal(2);\n61|  });\n62|\n63|  it('should clear the rating', () => {\n64|    const handleChange = spy();\n65|    const { container } = render(<Rating name=\"rating-test\" onChange={handleChange} value={2} />);\n66|\n67|    fireEvent.click(container.querySelector('input[name=\"rating-test\"][value=\"2\"]'), {\n68|      clientX: 1,\n69|    });\n70|\n71|    expect(handleChange.callCount).to.equal(1);\n72|    expect(handleChange.args[0][1]).to.deep.equal(null);\n73|  });\n74|\n75|  it('should select the rating', () => {\n76|    const handleChange = spy();\n77|    const { container } = render(<Rating name=\"rating-test\" onChange={handleChange} value={2} />);\n78|    fireEvent.click(container.querySelector('input[name=\"rating-test\"][value=\"3\"]'));\n79|    expect(handleChange.callCount).to.equal(1);\n80|    expect(handleChange.args[0][1]).to.deep.equal(3);\n81|    const checked = container.querySelector('input[name=\"rating-test\"]:checked');\n82|    expect(checked.value).to.equal('2');\n83|  });\n84|\n85|  it('should change the value to null', () => {\n86|    const handleChange = spy();\n87|    render(<Rating name=\"rating-test\" onChange={handleChange} value={2} />);\n88|    fireEvent.click(document.querySelector('#rating-test-empty'));\n89|    expect(handleChange.args[0][1]).to.equal(null);\n90|  });\n91|\n92|  it('should select the empty input if value is null', () => {\n93|    const { container } = render(<Rating name=\"rating-test\" value={null} />);\n94|    const input = container.querySelector('#rating-test-empty');\n95|    const checked = container.querySelector('input[name=\"rating-test\"]:checked');\n96|    expect(input).to.equal(checked);\n97|    expect(input.value).to.equal('');\n98|  });\n99|\n100|  it('should support a defaultValue', () => {\n101|    const { container } = render(<Rating defaultValue={3} name=\"rating-test\" />);\n102|    let checked;\n103|    checked = container.querySelector('input[name=\"rating-test\"]:checked');\n104|    expect(checked.value).to.equal('3');\n105|\n106|    fireEvent.click(container.querySelector('input[name=\"rating-test\"][value=\"2\"]'));\n107|    checked = container.querySelector('input[name=\"rating-test\"]:checked');\n108|    expect(checked.value).to.equal('2');\n109|  });\n110|\n111|  it('has a customization point for the label of the empty value when it is active', () => {\n112|    const { container } = render(\n113|      <Rating classes={{ labelEmptyValueActive: 'customized' }} name=\"\" value={null} />,\n114|    );\n115|\n116|    expect(container.querySelector('.customized')).to.equal(null);\n117|\n118|    act(() => {\n119|      const noValueRadio = screen.getAllByRole('radio').find((radio) => {\n120|        return radio.checked;\n121|      });\n122|\n123|      noValueRadio.focus();\n124|    });\n125|\n126|    expect(container.querySelector('.customized')).to.have.tagName('label');\n127|  });\n128|\n129|  it('should apply labelEmptyValueActive styles from theme', function test() {\n130|    if (/jsdom/.test(window.navigator.userAgent)) {\n131|      this.skip();\n132|    }\n133|\n134|    const theme = createTheme({\n135|      components: {\n136|        MuiRating: {\n137|          styleOverrides: {\n138|            labelEmptyValueActive: {\n139|              height: '120px',\n140|            },\n141|          },\n142|        },\n143|      },\n144|    });\n145|    const { container } = render(\n146|      <ThemeProvider theme={theme}>\n147|        <Rating value={null} />\n148|      </ThemeProvider>,\n149|    );\n150|\n151|    act(() => {\n152|      const noValueRadio = screen.getAllByRole('radio').find((radio) => {\n153|        return radio.checked;\n154|      });\n155|\n156|      noValueRadio.focus();\n157|    });\n158|\n159|    expect(container.querySelector(`.${classes.labelEmptyValueActive}`)).toHaveComputedStyle({\n160|      height: '120px',\n161|    });\n162|  });\n163|\n164|  // Internal test that only applies if Rating is implemented using `input[type\"radio\"]`\n165|  // It ensures that keyboard navigation for Arrow and TAB keys is handled by the browser\n166|  it('should ensure a `name`', () => {\n167|    render(<Rating value={null} />);\n168|\n169|    const [arbitraryRadio, ...radios] = document.querySelectorAll('input[type=\"radio\"]');\n170|    // `name` **property** will always be a string even if the **attribute** is omitted\n171|    expect(arbitraryRadio.name).not.to.equal('');\n172|    // all input[type=\"radio\"] have the same name\n173|    expect(new Set(radios.map((radio) => radio.name))).to.have.length(1);\n174|  });\n175|\n176|  describe('prop: readOnly', () => {\n177|    it('renders a role=\"img\"', () => {\n178|      render(<Rating readOnly value={2} />);\n179|\n180|      expect(screen.getByRole('img')).toHaveAccessibleName('2 Stars');\n181|    });\n182|\n183|    it('can be labelled with getLabelText', () => {\n184|      render(<Rating getLabelText={(value) => `Stars: ${value}`} readOnly value={2} />);\n185|\n186|      expect(screen.getByRole('img')).toHaveAccessibleName('Stars: 2');\n187|    });\n188|\n189|    it('should have readOnly class applied', () => {\n190|      render(<Rating readOnly value={2} />);\n191|\n192|      expect(screen.getByRole('img')).to.have.class(classes.readOnly);\n193|    });\n194|  });\n195|\n196|  describe('<form> integration', () => {\n197|    before(function beforeHook() {\n198|      if (/jsdom/.test(window.navigator.userAgent)) {\n199|        // JSDOM has issues with form validation for certain elements.\n200|        // We could address them individually but that doesn't add much value if we already have a working environment.\n201|        this.skip();\n202|      }\n203|    });\n204|\n205|    [\n206|      {\n207|        ratingProps: { name: 'rating', defaultValue: 2 },\n208|        formData: [['rating', '2']],\n209|      },\n210|      {\n211|        ratingProps: { name: 'rating', defaultValue: 2, disabled: true },\n212|        formData: [],\n213|      },\n214|      {\n215|        ratingProps: { name: 'rating', defaultValue: 2, readOnly: true },\n216|        // native <input type=\"radio\" /> and our Radio/Checkbox don't implement readOnly as well\n217|        formData: [],\n218|      },\n219|      {\n220|        ratingProps: { name: 'rating', required: true },\n221|        // FIXME: `Rating` does not implement `required`.\n222|        //        Native <input type=\"radio\" /> would not pass validation\n223|        // formData: undefined,\n224|        formData: [['rating', '']],\n225|      },\n226|    ].forEach((testData, testNumber) => {\n227|      it(`submits the expected form data #${testNumber + 1}`, () => {\n228|        /**\n229|         * @type FormData\n230|         */\n231|        let data;\n232|        const handleSubmit = spy((event) => {\n233|          // Prevent navigation\n234|          event.preventDefault();\n235|          // populate FormData with the submitted form\n236|          data = new FormData(event.target);\n237|        });\n238|        render(\n239|          <form onSubmit={handleSubmit}>\n240|            <Rating {...testData.ratingProps} />\n241|            <button type=\"submit\" />\n242|          </form>,\n243|        );\n244|        const submitter = document.querySelector('button[type=\"submit\"]');\n245|\n246|        act(() => {\n247|          // form.submit() would not run form validation\n248|          submitter.click();\n249|        });\n250|\n251|        if (testData.formData === undefined) {\n252|          expect(handleSubmit.callCount).to.equal(0);\n253|        } else {\n254|          expect(Array.from(data.entries())).to.deep.equal(testData.formData);\n255|        }\n256|      });\n257|    });\n258|  });\n259|});\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.ts\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.ts\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.ts\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npackages/mui-material/src/Rating/Rating.js\nline: 371\nline: 372\nline: 375\nline: 377\n```",
          "```\npackages/mui-material/src/Rating/Rating.js\nfunction: handleMouseMove\nline: 371\nline: 375\nline: 377\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npackages/mui-material/src/Rating/Rating.js\nline: 371\nline: 372\nline: 375\nline: 377\n```",
            "```\npackages/mui-material/src/Rating/Rating.js\nfunction: handleMouseMove\nline: 371\nline: 375\nline: 377\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "packages/mui-material/src/Rating/Rating.js": [
          "function: handleMouseMove\nline: 371\nline: 375\nline: 377"
        ],
        "packages/mui-material/src/Rating/Rating.test.js": [
          ""
        ],
        "packages/mui-lab/src/Rating/Rating.js": [
          ""
        ]
      },
      "patches": [
        "diff --git a/packages/mui-material/src/Rating/Rating.js b/packages/mui-material/src/Rating/Rating.js\nindex 598a5d1..b75d984 100644\n--- a/packages/mui-material/src/Rating/Rating.js\n+++ b/packages/mui-material/src/Rating/Rating.js\n@@ -1,3 +1,4 @@\n+\n 'use client';\n import * as React from 'react';\n import PropTypes from 'prop-types';\n@@ -367,14 +368,15 @@ const Rating = React.forwardRef(function Rating(inProps, ref) {\n     }\n \n     const rootNode = rootRef.current;\n-    const { right, left } = rootNode.getBoundingClientRect();\n-    const { width } = rootNode.firstChild.getBoundingClientRect();\n+    // Use the total width of the root container instead of a single icon width.\n+    // This accounts for custom spacing (margins/gaps) between icons.\n+    const { right, left, width } = rootNode.getBoundingClientRect();\n     let percent;\n \n     if (theme.direction === 'rtl') {\n-      percent = (right - event.clientX) / (width * max);\n+      percent = (right - event.clientX) / width;\n     } else {\n-      percent = (event.clientX - left) / (width * max);\n+      percent = (event.clientX - left) / width;\n     }\n \n     let newHover = roundValueToPrecision(max * percent + precision / 2, precision);\n@@ -751,4 +753,4 @@ Rating.propTypes /* remove-proptypes */ = {\n   value: PropTypes.number,\n };\n \n-export default Rating;\n+export default Rating;\n",
        "diff --git a/packages/mui-material/src/Rating/Rating.js b/packages/mui-material/src/Rating/Rating.js\nindex 598a5d1..049d258 100644\n--- a/packages/mui-material/src/Rating/Rating.js\n+++ b/packages/mui-material/src/Rating/Rating.js\n@@ -367,14 +367,13 @@ const Rating = React.forwardRef(function Rating(inProps, ref) {\n     }\n \n     const rootNode = rootRef.current;\n-    const { right, left } = rootNode.getBoundingClientRect();\n-    const { width } = rootNode.firstChild.getBoundingClientRect();\n+    const { right, left, width: containerWidth } = rootNode.getBoundingClientRect();\n     let percent;\n \n     if (theme.direction === 'rtl') {\n-      percent = (right - event.clientX) / (width * max);\n+      percent = (right - event.clientX) / containerWidth;\n     } else {\n-      percent = (event.clientX - left) / (width * max);\n+      percent = (event.clientX - left) / containerWidth;\n     }\n \n     let newHover = roundValueToPrecision(max * percent + precision / 2, precision);\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nCan't get correct position after changing spacing of icons in <Rating /> component in v5.\nFor some reasons, I need to change the spacing between icons in `<Rating />`  component, but it causes the component cannot get correct position of each icons.\r\n\r\nHere is the demo:\r\n\r\nhttps://codesandbox.io/s/halfrating-material-demo-forked-0lh9f?file=/demo.js:388-393\r\n\r\nWhen you move your mouse on the second star, the third one will be highlighted.\n\n###\n### packages/mui-material/src/Rating/Rating.js\n1|'use client';\n2|import * as React from 'react';\n3|import PropTypes from 'prop-types';\n4|import clsx from 'clsx';\n5|import { chainPropTypes, visuallyHidden } from '@mui/utils';\n6|import { unstable_composeClasses as composeClasses } from '@mui/base/composeClasses';\n7|import useTheme from '../styles/useTheme';\n8|import {\n9|  capitalize,\n10|  useForkRef,\n11|  useIsFocusVisible,\n12|  useControlled,\n13|  unstable_useId as useId,\n14|} from '../utils';\n15|import Star from '../internal/svg-icons/Star';\n16|import StarBorder from '../internal/svg-icons/StarBorder';\n17|import useThemeProps from '../styles/useThemeProps';\n18|import styled, { slotShouldForwardProp } from '../styles/styled';\n19|import ratingClasses, { getRatingUtilityClass } from './ratingClasses';\n20|\n21|function clamp(value, min, max) {\n22|  if (value < min) {\n23|    return min;\n24|  }\n25|  if (value > max) {\n26|    return max;\n27|  }\n28|  return value;\n29|}\n30|\n31|function getDecimalPrecision(num) {\n32|  const decimalPart = num.toString().split('.')[1];\n33|  return decimalPart ? decimalPart.length : 0;\n34|}\n35|\n36|function roundValueToPrecision(value, precision) {\n37|  if (value == null) {\n38|    return value;\n39|  }\n40|\n41|  const nearest = Math.round(value / precision) * precision;\n42|  return Number(nearest.toFixed(getDecimalPrecision(precision)));\n43|}\n44|\n45|const useUtilityClasses = (ownerState) => {\n46|  const { classes, size, readOnly, disabled, emptyValueFocused, focusVisible } = ownerState;\n47|\n48|  const slots = {\n49|    root: [\n50|      'root',\n51|      `size${capitalize(size)}`,\n52|      disabled && 'disabled',\n53|      focusVisible && 'focusVisible',\n54|      readOnly && 'readOnly',\n55|    ],\n56|    label: ['label', 'pristine'],\n57|    labelEmptyValue: [emptyValueFocused && 'labelEmptyValueActive'],\n58|    icon: ['icon'],\n59|    iconEmpty: ['iconEmpty'],\n60|    iconFilled: ['iconFilled'],\n61|    iconHover: ['iconHover'],\n62|    iconFocus: ['iconFocus'],\n63|    iconActive: ['iconActive'],\n64|    decimal: ['decimal'],\n65|    visuallyHidden: ['visuallyHidden'],\n66|  };\n67|\n68|  return composeClasses(slots, getRatingUtilityClass, classes);\n69|};\n70|\n71|const RatingRoot = styled('span', {\n72|  name: 'MuiRating',\n73|  slot: 'Root',\n74|  overridesResolver: (props, styles) => {\n75|    const { ownerState } = props;\n76|\n77|    return [\n78|      { [`& .${ratingClasses.visuallyHidden}`]: styles.visuallyHidden },\n79|      styles.root,\n80|      styles[`size${capitalize(ownerState.size)}`],\n81|      ownerState.readOnly && styles.readOnly,\n82|    ];\n83|  },\n84|})(({ theme, ownerState }) => ({\n85|  display: 'inline-flex',\n86|  // Required to position the pristine input absolutely\n87|  position: 'relative',\n88|  fontSize: theme.typography.pxToRem(24),\n89|  color: '#faaf00',\n90|  cursor: 'pointer',\n91|  textAlign: 'left',\n92|  WebkitTapHighlightColor: 'transparent',\n93|  [`&.${ratingClasses.disabled}`]: {\n94|    opacity: (theme.vars || theme).palette.action.disabledOpacity,\n95|    pointerEvents: 'none',\n96|  },\n97|  [`&.${ratingClasses.focusVisible} .${ratingClasses.iconActive}`]: {\n98|    outline: '1px solid #999',\n99|  },\n100|  [`& .${ratingClasses.visuallyHidden}`]: visuallyHidden,\n101|  ...(ownerState.size === 'small' && {\n102|    fontSize: theme.typography.pxToRem(18),\n103|  }),\n104|  ...(ownerState.size === 'large' && {\n105|    fontSize: theme.typography.pxToRem(30),\n106|  }),\n107|  // TODO v6: use the .Mui-readOnly global state class\n108|  ...(ownerState.readOnly && {\n109|    pointerEvents: 'none',\n110|  }),\n111|}));\n112|\n113|const RatingLabel = styled('label', {\n114|  name: 'MuiRating',\n115|  slot: 'Label',\n116|  overridesResolver: ({ ownerState }, styles) => [\n117|    styles.label,\n118|    ownerState.emptyValueFocused && styles.labelEmptyValueActive,\n119|  ],\n120|})(({ ownerState }) => ({\n121|  cursor: 'inherit',\n122|  ...(ownerState.emptyValueFocused && {\n123|    top: 0,\n124|    bottom: 0,\n125|    position: 'absolute',\n126|    outline: '1px solid #999',\n127|    width: '100%',\n128|  }),\n129|}));\n130|\n131|const RatingIcon = styled('span', {\n132|  name: 'MuiRating',\n133|  slot: 'Icon',\n134|  overridesResolver: (props, styles) => {\n135|    const { ownerState } = props;\n136|\n137|    return [\n138|      styles.icon,\n139|      ownerState.iconEmpty && styles.iconEmpty,\n140|      ownerState.iconFilled && styles.iconFilled,\n141|      ownerState.iconHover && styles.iconHover,\n142|      ownerState.iconFocus && styles.iconFocus,\n143|      ownerState.iconActive && styles.iconActive,\n144|    ];\n145|  },\n146|})(({ theme, ownerState }) => ({\n147|  // Fit wrapper to actual icon size.\n148|  display: 'flex',\n149|  transition: theme.transitions.create('transform', {\n150|    duration: theme.transitions.duration.shortest,\n151|  }),\n152|  // Fix mouseLeave issue.\n153|  // https://github.com/facebook/react/issues/4492\n154|  pointerEvents: 'none',\n155|  ...(ownerState.iconActive && {\n156|    transform: 'scale(1.2)',\n157|  }),\n158|  ...(ownerState.iconEmpty && {\n159|    color: (theme.vars || theme).palette.action.disabled,\n160|  }),\n161|}));\n162|\n163|const RatingDecimal = styled('span', {\n164|  name: 'MuiRating',\n165|  slot: 'Decimal',\n166|  shouldForwardProp: (prop) => slotShouldForwardProp(prop) && prop !== 'iconActive',\n167|  overridesResolver: (props, styles) => {\n168|    const { iconActive } = props;\n169|\n170|    return [styles.decimal, iconActive && styles.iconActive];\n171|  },\n172|})(({ iconActive }) => ({\n173|  position: 'relative',\n174|  ...(iconActive && {\n175|    transform: 'scale(1.2)',\n176|  }),\n177|}));\n178|\n179|function IconContainer(props) {\n180|  const { value, ...other } = props;\n181|  return <span {...other} />;\n182|}\n183|\n184|IconContainer.propTypes = {\n185|  value: PropTypes.number.isRequired,\n186|};\n187|\n188|function RatingItem(props) {\n189|  const {\n190|    classes,\n191|    disabled,\n192|    emptyIcon,\n193|    focus,\n194|    getLabelText,\n195|    highlightSelectedOnly,\n196|    hover,\n197|    icon,\n198|    IconContainerComponent,\n199|    isActive,\n200|    itemValue,\n201|    labelProps,\n202|    name,\n203|    onBlur,\n204|    onChange,\n205|    onClick,\n206|    onFocus,\n207|    readOnly,\n208|    ownerState,\n209|    ratingValue,\n210|    ratingValueRounded,\n211|  } = props;\n212|\n213|  const isFilled = highlightSelectedOnly ? itemValue === ratingValue : itemValue <= ratingValue;\n214|  const isHovered = itemValue <= hover;\n215|  const isFocused = itemValue <= focus;\n216|  const isChecked = itemValue === ratingValueRounded;\n217|\n218|  const id = useId();\n219|  const container = (\n220|    <RatingIcon\n221|      as={IconContainerComponent}\n222|      value={itemValue}\n223|      className={clsx(classes.icon, {\n224|        [classes.iconEmpty]: !isFilled,\n225|        [classes.iconFilled]: isFilled,\n226|        [classes.iconHover]: isHovered,\n227|        [classes.iconFocus]: isFocused,\n228|        [classes.iconActive]: isActive,\n229|      })}\n230|      ownerState={{\n231|        ...ownerState,\n232|        iconEmpty: !isFilled,\n233|        iconFilled: isFilled,\n234|        iconHover: isHovered,\n235|        iconFocus: isFocused,\n236|        iconActive: isActive,\n237|      }}\n238|    >\n239|      {emptyIcon && !isFilled ? emptyIcon : icon}\n240|    </RatingIcon>\n241|  );\n242|\n243|  if (readOnly) {\n244|    return <span {...labelProps}>{container}</span>;\n245|  }\n246|\n247|  return (\n248|    <React.Fragment>\n249|      <RatingLabel\n250|        ownerState={{ ...ownerState, emptyValueFocused: undefined }}\n251|        htmlFor={id}\n252|        {...labelProps}\n253|      >\n254|        {container}\n255|        <span className={classes.visuallyHidden}>{getLabelText(itemValue)}</span>\n256|      </RatingLabel>\n257|      <input\n258|        className={classes.visuallyHidden}\n259|        onFocus={onFocus}\n260|        onBlur={onBlur}\n261|        onChange={onChange}\n262|        onClick={onClick}\n263|        disabled={disabled}\n264|        value={itemValue}\n265|        id={id}\n266|        type=\"radio\"\n267|        name={name}\n268|        checked={isChecked}\n269|      />\n270|    </React.Fragment>\n271|  );\n272|}\n273|\n274|RatingItem.propTypes = {\n275|  classes: PropTypes.object.isRequired,\n276|  disabled: PropTypes.bool.isRequired,\n277|  emptyIcon: PropTypes.node,\n278|  focus: PropTypes.number.isRequired,\n279|  getLabelText: PropTypes.func.isRequired,\n280|  highlightSelectedOnly: PropTypes.bool.isRequired,\n281|  hover: PropTypes.number.isRequired,\n282|  icon: PropTypes.node,\n283|  IconContainerComponent: PropTypes.elementType.isRequired,\n284|  isActive: PropTypes.bool.isRequired,\n285|  itemValue: PropTypes.number.isRequired,\n286|  labelProps: PropTypes.object,\n287|  name: PropTypes.string,\n288|  onBlur: PropTypes.func.isRequired,\n289|  onChange: PropTypes.func.isRequired,\n290|  onClick: PropTypes.func.isRequired,\n291|  onFocus: PropTypes.func.isRequired,\n292|  ownerState: PropTypes.object.isRequired,\n293|  ratingValue: PropTypes.number,\n294|  ratingValueRounded: PropTypes.number,\n295|  readOnly: PropTypes.bool.isRequired,\n296|};\n297|\n298|const defaultIcon = <Star fontSize=\"inherit\" />;\n299|const defaultEmptyIcon = <StarBorder fontSize=\"inherit\" />;\n300|\n301|function defaultLabelText(value) {\n302|  return `${value} Star${value !== 1 ? 's' : ''}`;\n303|}\n304|\n305|const Rating = React.forwardRef(function Rating(inProps, ref) {\n306|  const props = useThemeProps({ name: 'MuiRating', props: inProps });\n307|  const {\n308|    className,\n309|    defaultValue = null,\n310|    disabled = false,\n311|    emptyIcon = defaultEmptyIcon,\n312|    emptyLabelText = 'Empty',\n313|    getLabelText = defaultLabelText,\n314|    highlightSelectedOnly = false,\n315|    icon = defaultIcon,\n316|    IconContainerComponent = IconContainer,\n317|    max = 5,\n318|    name: nameProp,\n319|    onChange,\n320|    onChangeActive,\n321|    onMouseLeave,\n322|    onMouseMove,\n323|    precision = 1,\n324|    readOnly = false,\n325|    size = 'medium',\n326|    value: valueProp,\n327|    ...other\n328|  } = props;\n329|\n330|  const name = useId(nameProp);\n331|\n332|  const [valueDerived, setValueState] = useControlled({\n333|    controlled: valueProp,\n334|    default: defaultValue,\n335|    name: 'Rating',\n336|  });\n337|\n338|  const valueRounded = roundValueToPrecision(valueDerived, precision);\n339|  const theme = useTheme();\n340|  const [{ hover, focus }, setState] = React.useState({\n341|    hover: -1,\n342|    focus: -1,\n343|  });\n344|\n345|  let value = valueRounded;\n346|  if (hover !== -1) {\n347|    value = hover;\n348|  }\n349|  if (focus !== -1) {\n350|    value = focus;\n351|  }\n352|\n353|  const {\n354|    isFocusVisibleRef,\n355|    onBlur: handleBlurVisible,\n356|    onFocus: handleFocusVisible,\n357|    ref: focusVisibleRef,\n358|  } = useIsFocusVisible();\n359|  const [focusVisible, setFocusVisible] = React.useState(false);\n360|\n361|  const rootRef = React.useRef();\n362|  const handleRef = useForkRef(focusVisibleRef, rootRef, ref);\n363|\n364|  const handleMouseMove = (event) => {\n365|    if (onMouseMove) {\n366|      onMouseMove(event);\n367|    }\n368|\n369|    const rootNode = rootRef.current;\n370|    const { right, left } = rootNode.getBoundingClientRect();\n371|    const { width } = rootNode.firstChild.getBoundingClientRect();\n372|    let percent;\n373|\n374|    if (theme.direction === 'rtl') {\n375|      percent = (right - event.clientX) / (width * max);\n376|    } else {\n377|      percent = (event.clientX - left) / (width * max);\n378|    }\n379|\n380|    let newHover = roundValueToPrecision(max * percent + precision / 2, precision);\n381|    newHover = clamp(newHover, precision, max);\n382|\n383|    setState((prev) =>\n384|      prev.hover === newHover && prev.focus === newHover\n385|        ? prev\n386|        : {\n387|            hover: newHover,\n388|            focus: newHover,\n389|          },\n390|    );\n391|\n392|    setFocusVisible(false);\n393|\n394|    if (onChangeActive && hover !== newHover) {\n395|      onChangeActive(event, newHover);\n396|    }\n397|  };\n398|\n399|  const handleMouseLeave = (event) => {\n400|    if (onMouseLeave) {\n401|      onMouseLeave(event);\n402|    }\n403|\n404|    const newHover = -1;\n405|    setState({\n406|      hover: newHover,\n407|      focus: newHover,\n408|    });\n409|\n410|    if (onChangeActive && hover !== newHover) {\n411|      onChangeActive(event, newHover);\n412|    }\n413|  };\n414|\n415|  const handleChange = (event) => {\n416|    let newValue = event.target.value === '' ? null : parseFloat(event.target.value);\n417|\n418|    // Give mouse priority over keyboard\n419|    // Fix https://github.com/mui/material-ui/issues/22827\n420|    if (hover !== -1) {\n421|      newValue = hover;\n422|    }\n423|\n424|    setValueState(newValue);\n425|\n426|    if (onChange) {\n427|      onChange(event, newValue);\n428|    }\n429|  };\n430|\n431|  const handleClear = (event) => {\n432|    // Ignore keyboard events\n433|    // https://github.com/facebook/react/issues/7407\n434|    if (event.clientX === 0 && event.clientY === 0) {\n435|      return;\n436|    }\n437|\n438|    setState({\n439|      hover: -1,\n440|      focus: -1,\n441|    });\n442|\n443|    setValueState(null);\n444|\n445|    if (onChange && parseFloat(event.target.value) === valueRounded) {\n446|      onChange(event, null);\n447|    }\n448|  };\n449|\n450|  const handleFocus = (event) => {\n451|    handleFocusVisible(event);\n452|    if (isFocusVisibleRef.current === true) {\n453|      setFocusVisible(true);\n454|    }\n455|\n456|    const newFocus = parseFloat(event.target.value);\n457|    setState((prev) => ({\n458|      hover: prev.hover,\n459|      focus: newFocus,\n460|    }));\n461|  };\n462|\n463|  const handleBlur = (event) => {\n464|    if (hover !== -1) {\n465|      return;\n466|    }\n467|\n468|    handleBlurVisible(event);\n469|    if (isFocusVisibleRef.current === false) {\n470|      setFocusVisible(false);\n471|    }\n472|\n473|    const newFocus = -1;\n474|    setState((prev) => ({\n475|      hover: prev.hover,\n476|      focus: newFocus,\n477|    }));\n478|  };\n479|\n480|  const [emptyValueFocused, setEmptyValueFocused] = React.useState(false);\n481|\n482|  const ownerState = {\n483|    ...props,\n484|    defaultValue,\n485|    disabled,\n486|    emptyIcon,\n487|    emptyLabelText,\n488|    emptyValueFocused,\n489|    focusVisible,\n490|    getLabelText,\n491|    icon,\n492|    IconContainerComponent,\n493|    max,\n494|    precision,\n495|    readOnly,\n496|    size,\n497|  };\n498|\n499|  const classes = useUtilityClasses(ownerState);\n500|\n501|  return (\n502|    <RatingRoot\n503|      ref={handleRef}\n504|      onMouseMove={handleMouseMove}\n505|      onMouseLeave={handleMouseLeave}\n506|      className={clsx(\n507|        classes.root,\n508|        {\n509|          // TODO v6: remove this class as it duplicates with the global state class Mui-readOnly\n510|          'MuiRating-readOnly': readOnly,\n511|        },\n512|        className,\n513|      )}\n514|      ownerState={ownerState}\n515|      role={readOnly ? 'img' : null}\n516|      aria-label={readOnly ? getLabelText(value) : null}\n517|      {...other}\n518|    >\n519|      {Array.from(new Array(max)).map((_, index) => {\n520|        const itemValue = index + 1;\n521|\n522|        const ratingItemProps = {\n523|          classes,\n524|          disabled,\n525|          emptyIcon,\n526|          focus,\n527|          getLabelText,\n528|          highlightSelectedOnly,\n529|          hover,\n530|          icon,\n531|          IconContainerComponent,\n532|          name,\n533|          onBlur: handleBlur,\n534|          onChange: handleChange,\n535|          onClick: handleClear,\n536|          onFocus: handleFocus,\n537|          ratingValue: value,\n538|          ratingValueRounded: valueRounded,\n539|          readOnly,\n540|          ownerState,\n541|        };\n542|\n543|        const isActive = itemValue === Math.ceil(value) && (hover !== -1 || focus !== -1);\n544|        if (precision < 1) {\n545|          const items = Array.from(new Array(1 / precision));\n546|          return (\n547|            <RatingDecimal\n548|              key={itemValue}\n549|              className={clsx(classes.decimal, { [classes.iconActive]: isActive })}\n550|              ownerState={ownerState}\n551|              iconActive={isActive}\n552|            >\n553|              {items.map(($, indexDecimal) => {\n554|                const itemDecimalValue = roundValueToPrecision(\n555|                  itemValue - 1 + (indexDecimal + 1) * precision,\n556|                  precision,\n557|                );\n558|\n559|                return (\n560|                  <RatingItem\n561|                    key={itemDecimalValue}\n562|                    {...ratingItemProps}\n563|                    // The icon is already displayed as active\n564|                    isActive={false}\n565|                    itemValue={itemDecimalValue}\n566|                    labelProps={{\n567|                      style:\n568|                        items.length - 1 === indexDecimal\n569|                          ? {}\n570|                          : {\n571|                              width:\n572|                                itemDecimalValue === value\n573|                                  ? `${(indexDecimal + 1) * precision * 100}%`\n574|                                  : '0%',\n575|                              overflow: 'hidden',\n576|                              position: 'absolute',\n577|                            },\n578|                    }}\n579|                  />\n580|                );\n581|              })}\n582|            </RatingDecimal>\n583|          );\n584|        }\n585|\n586|        return (\n587|          <RatingItem\n588|            key={itemValue}\n589|            {...ratingItemProps}\n590|            isActive={isActive}\n591|            itemValue={itemValue}\n592|          />\n593|        );\n594|      })}\n595|      {!readOnly && !disabled && (\n596|        <RatingLabel\n597|          className={clsx(classes.label, classes.labelEmptyValue)}\n598|          ownerState={ownerState}\n599|        >\n600|          <input\n601|            className={classes.visuallyHidden}\n602|            value=\"\"\n603|            id={`${name}-empty`}\n604|            type=\"radio\"\n605|            name={name}\n606|            checked={valueRounded == null}\n607|            onFocus={() => setEmptyValueFocused(true)}\n608|            onBlur={() => setEmptyValueFocused(false)}\n609|            onChange={handleChange}\n610|          />\n611|          <span className={classes.visuallyHidden}>{emptyLabelText}</span>\n612|        </RatingLabel>\n613|      )}\n614|    </RatingRoot>\n615|  );\n616|});\n617|\n618|Rating.propTypes /* remove-proptypes */ = {\n619|  // ----------------------------- Warning --------------------------------\n620|  // | These PropTypes are generated from the TypeScript type definitions |\n621|  // |     To update them edit the d.ts file and run \"yarn proptypes\"     |\n622|  // ----------------------------------------------------------------------\n623|  /**\n624|   * Override or extend the styles applied to the component.\n625|   */\n626|  classes: PropTypes.object,\n627|  /**\n628|   * @ignore\n629|   */\n630|  className: PropTypes.string,\n631|  /**\n632|   * The default value. Use when the component is not controlled.\n633|   * @default null\n634|   */\n635|  defaultValue: PropTypes.number,\n636|  /**\n637|   * If `true`, the component is disabled.\n638|   * @default false\n639|   */\n640|  disabled: PropTypes.bool,\n641|  /**\n642|   * The icon to display when empty.\n643|   * @default <StarBorder fontSize=\"inherit\" />\n644|   */\n645|  emptyIcon: PropTypes.node,\n646|  /**\n647|   * The label read when the rating input is empty.\n648|   * @default 'Empty'\n649|   */\n650|  emptyLabelText: PropTypes.node,\n651|  /**\n652|   * Accepts a function which returns a string value that provides a user-friendly name for the current value of the rating.\n653|   * This is important for screen reader users.\n654|   *\n655|   * For localization purposes, you can use the provided [translations](/material-ui/guides/localization/).\n656|   * @param {number} value The rating label's value to format.\n657|   * @returns {string}\n658|   * @default function defaultLabelText(value) {\n659|   *   return `${value} Star${value !== 1 ? 's' : ''}`;\n660|   * }\n661|   */\n662|  getLabelText: PropTypes.func,\n663|  /**\n664|   * If `true`, only the selected icon will be highlighted.\n665|   * @default false\n666|   */\n667|  highlightSelectedOnly: PropTypes.bool,\n668|  /**\n669|   * The icon to display.\n670|   * @default <Star fontSize=\"inherit\" />\n671|   */\n672|  icon: PropTypes.node,\n673|  /**\n674|   * The component containing the icon.\n675|   * @default function IconContainer(props) {\n676|   *   const { value, ...other } = props;\n677|   *   return <span {...other} />;\n678|   * }\n679|   */\n680|  IconContainerComponent: PropTypes.elementType,\n681|  /**\n682|   * Maximum rating.\n683|   * @default 5\n684|   */\n685|  max: PropTypes.number,\n686|  /**\n687|   * The name attribute of the radio `input` elements.\n688|   * This input `name` should be unique within the page.\n689|   * Being unique within a form is insufficient since the `name` is used to generated IDs.\n690|   */\n691|  name: PropTypes.string,\n692|  /**\n693|   * Callback fired when the value changes.\n694|   * @param {React.SyntheticEvent} event The event source of the callback.\n695|   * @param {number|null} value The new value.\n696|   */\n697|  onChange: PropTypes.func,\n698|  /**\n699|   * Callback function that is fired when the hover state changes.\n700|   * @param {React.SyntheticEvent} event The event source of the callback.\n701|   * @param {number} value The new value.\n702|   */\n703|  onChangeActive: PropTypes.func,\n704|  /**\n705|   * @ignore\n706|   */\n707|  onMouseLeave: PropTypes.func,\n708|  /**\n709|   * @ignore\n710|   */\n711|  onMouseMove: PropTypes.func,\n712|  /**\n713|   * The minimum increment value change allowed.\n714|   * @default 1\n715|   */\n716|  precision: chainPropTypes(PropTypes.number, (props) => {\n717|    if (props.precision < 0.1) {\n718|      return new Error(\n719|        [\n720|          'MUI: The prop `precision` should be above 0.1.',\n721|          'A value below this limit has an imperceptible impact.',\n722|        ].join('\\n'),\n723|      );\n724|    }\n725|    return null;\n726|  }),\n727|  /**\n728|   * Removes all hover effects and pointer events.\n729|   * @default false\n730|   */\n731|  readOnly: PropTypes.bool,\n732|  /**\n733|   * The size of the component.\n734|   * @default 'medium'\n735|   */\n736|  size: PropTypes /* @typescript-to-proptypes-ignore */.oneOfType([\n737|    PropTypes.oneOf(['small', 'medium', 'large']),\n738|    PropTypes.string,\n739|  ]),\n740|  /**\n741|   * The system prop that allows defining system overrides as well as additional CSS styles.\n742|   */\n743|  sx: PropTypes.oneOfType([\n744|    PropTypes.arrayOf(PropTypes.oneOfType([PropTypes.func, PropTypes.object, PropTypes.bool])),\n745|    PropTypes.func,\n746|    PropTypes.object,\n747|  ]),\n748|  /**\n749|   * The rating value.\n750|   */\n751|  value: PropTypes.number,\n752|};\n753|\n754|export default Rating;\n\n\n### packages/mui-material/src/Rating/Rating.test.js\n1|import * as React from 'react';\n2|import { expect } from 'chai';\n3|import { stub, spy } from 'sinon';\n4|import {\n5|  act,\n6|  describeConformance,\n7|  createRenderer,\n8|  fireEvent,\n9|  screen,\n10|} from '@mui-internal/test-utils';\n11|import Rating, { ratingClasses as classes } from '@mui/material/Rating';\n12|import { createTheme, ThemeProvider } from '@mui/material/styles';\n13|\n14|describe('<Rating />', () => {\n15|  const { render } = createRenderer();\n16|\n17|  describeConformance(<Rating />, () => ({\n18|    classes,\n19|    inheritComponent: 'span',\n20|    render,\n21|    muiName: 'MuiRating',\n22|    testVariantProps: { variant: 'foo' },\n23|    testDeepOverrides: { slotName: 'label', slotClassName: classes.label },\n24|    testStateOverrides: { prop: 'size', value: 'small', styleKey: 'sizeSmall' },\n25|    refInstanceof: window.HTMLSpanElement,\n26|    skip: ['componentProp', 'componentsProp'],\n27|  }));\n28|\n29|  it('should render', () => {\n30|    const { container } = render(<Rating />);\n31|\n32|    expect(container.firstChild).to.have.class(classes.root);\n33|  });\n34|\n35|  it('should round the value to the provided precision', () => {\n36|    const { container } = render(<Rating name=\"rating-test\" value={3.9} precision={0.2} />);\n37|\n38|    expect(container.querySelector('input[name=\"rating-test\"]:checked')).to.have.property(\n39|      'value',\n40|      '4',\n41|    );\n42|  });\n43|\n44|  it('should handle mouse hover correctly', () => {\n45|    const { container } = render(<Rating />);\n46|    stub(container.firstChild, 'getBoundingClientRect').callsFake(() => ({\n47|      left: 0,\n48|      right: 100,\n49|    }));\n50|    stub(container.firstChild.firstChild, 'getBoundingClientRect').callsFake(() => ({\n51|      width: 20,\n52|    }));\n53|    fireEvent.mouseMove(container.firstChild, {\n54|      clientX: 19,\n55|    });\n56|    expect(container.querySelectorAll(`.${classes.iconHover}`).length).to.equal(1);\n57|    fireEvent.mouseMove(container.firstChild, {\n58|      clientX: 21,\n59|    });\n60|    expect(container.querySelectorAll(`.${classes.iconHover}`).length).to.equal(2);\n61|  });\n62|\n63|  it('should clear the rating', () => {\n64|    const handleChange = spy();\n65|    const { container } = render(<Rating name=\"rating-test\" onChange={handleChange} value={2} />);\n66|\n67|    fireEvent.click(container.querySelector('input[name=\"rating-test\"][value=\"2\"]'), {\n68|      clientX: 1,\n69|    });\n70|\n71|    expect(handleChange.callCount).to.equal(1);\n72|    expect(handleChange.args[0][1]).to.deep.equal(null);\n73|  });\n74|\n75|  it('should select the rating', () => {\n76|    const handleChange = spy();\n77|    const { container } = render(<Rating name=\"rating-test\" onChange={handleChange} value={2} />);\n78|    fireEvent.click(container.querySelector('input[name=\"rating-test\"][value=\"3\"]'));\n79|    expect(handleChange.callCount).to.equal(1);\n80|    expect(handleChange.args[0][1]).to.deep.equal(3);\n81|    const checked = container.querySelector('input[name=\"rating-test\"]:checked');\n82|    expect(checked.value).to.equal('2');\n83|  });\n84|\n85|  it('should change the value to null', () => {\n86|    const handleChange = spy();\n87|    render(<Rating name=\"rating-test\" onChange={handleChange} value={2} />);\n88|    fireEvent.click(document.querySelector('#rating-test-empty'));\n89|    expect(handleChange.args[0][1]).to.equal(null);\n90|  });\n91|\n92|  it('should select the empty input if value is null', () => {\n93|    const { container } = render(<Rating name=\"rating-test\" value={null} />);\n94|    const input = container.querySelector('#rating-test-empty');\n95|    const checked = container.querySelector('input[name=\"rating-test\"]:checked');\n96|    expect(input).to.equal(checked);\n97|    expect(input.value).to.equal('');\n98|  });\n99|\n100|  it('should support a defaultValue', () => {\n101|    const { container } = render(<Rating defaultValue={3} name=\"rating-test\" />);\n102|    let checked;\n103|    checked = container.querySelector('input[name=\"rating-test\"]:checked');\n104|    expect(checked.value).to.equal('3');\n105|\n106|    fireEvent.click(container.querySelector('input[name=\"rating-test\"][value=\"2\"]'));\n107|    checked = container.querySelector('input[name=\"rating-test\"]:checked');\n108|    expect(checked.value).to.equal('2');\n109|  });\n110|\n111|  it('has a customization point for the label of the empty value when it is active', () => {\n112|    const { container } = render(\n113|      <Rating classes={{ labelEmptyValueActive: 'customized' }} name=\"\" value={null} />,\n114|    );\n115|\n116|    expect(container.querySelector('.customized')).to.equal(null);\n117|\n118|    act(() => {\n119|      const noValueRadio = screen.getAllByRole('radio').find((radio) => {\n120|        return radio.checked;\n121|      });\n122|\n123|      noValueRadio.focus();\n124|    });\n125|\n126|    expect(container.querySelector('.customized')).to.have.tagName('label');\n127|  });\n128|\n129|  it('should apply labelEmptyValueActive styles from theme', function test() {\n130|    if (/jsdom/.test(window.navigator.userAgent)) {\n131|      this.skip();\n132|    }\n133|\n134|    const theme = createTheme({\n135|      components: {\n136|        MuiRating: {\n137|          styleOverrides: {\n138|            labelEmptyValueActive: {\n139|              height: '120px',\n140|            },\n141|          },\n142|        },\n143|      },\n144|    });\n145|    const { container } = render(\n146|      <ThemeProvider theme={theme}>\n147|        <Rating value={null} />\n148|      </ThemeProvider>,\n149|    );\n150|\n151|    act(() => {\n152|      const noValueRadio = screen.getAllByRole('radio').find((radio) => {\n153|        return radio.checked;\n154|      });\n155|\n156|      noValueRadio.focus();\n157|    });\n158|\n159|    expect(container.querySelector(`.${classes.labelEmptyValueActive}`)).toHaveComputedStyle({\n160|      height: '120px',\n161|    });\n162|  });\n163|\n164|  // Internal test that only applies if Rating is implemented using `input[type\"radio\"]`\n165|  // It ensures that keyboard navigation for Arrow and TAB keys is handled by the browser\n166|  it('should ensure a `name`', () => {\n167|    render(<Rating value={null} />);\n168|\n169|    const [arbitraryRadio, ...radios] = document.querySelectorAll('input[type=\"radio\"]');\n170|    // `name` **property** will always be a string even if the **attribute** is omitted\n171|    expect(arbitraryRadio.name).not.to.equal('');\n172|    // all input[type=\"radio\"] have the same name\n173|    expect(new Set(radios.map((radio) => radio.name))).to.have.length(1);\n174|  });\n175|\n176|  describe('prop: readOnly', () => {\n177|    it('renders a role=\"img\"', () => {\n178|      render(<Rating readOnly value={2} />);\n179|\n180|      expect(screen.getByRole('img')).toHaveAccessibleName('2 Stars');\n181|    });\n182|\n183|    it('can be labelled with getLabelText', () => {\n184|      render(<Rating getLabelText={(value) => `Stars: ${value}`} readOnly value={2} />);\n185|\n186|      expect(screen.getByRole('img')).toHaveAccessibleName('Stars: 2');\n187|    });\n188|\n189|    it('should have readOnly class applied', () => {\n190|      render(<Rating readOnly value={2} />);\n191|\n192|      expect(screen.getByRole('img')).to.have.class(classes.readOnly);\n193|    });\n194|  });\n195|\n196|  describe('<form> integration', () => {\n197|    before(function beforeHook() {\n198|      if (/jsdom/.test(window.navigator.userAgent)) {\n199|        // JSDOM has issues with form validation for certain elements.\n200|        // We could address them individually but that doesn't add much value if we already have a working environment.\n201|        this.skip();\n202|      }\n203|    });\n204|\n205|    [\n206|      {\n207|        ratingProps: { name: 'rating', defaultValue: 2 },\n208|        formData: [['rating', '2']],\n209|      },\n210|      {\n211|        ratingProps: { name: 'rating', defaultValue: 2, disabled: true },\n212|        formData: [],\n213|      },\n214|      {\n215|        ratingProps: { name: 'rating', defaultValue: 2, readOnly: true },\n216|        // native <input type=\"radio\" /> and our Radio/Checkbox don't implement readOnly as well\n217|        formData: [],\n218|      },\n219|      {\n220|        ratingProps: { name: 'rating', required: true },\n221|        // FIXME: `Rating` does not implement `required`.\n222|        //        Native <input type=\"radio\" /> would not pass validation\n223|        // formData: undefined,\n224|        formData: [['rating', '']],\n225|      },\n226|    ].forEach((testData, testNumber) => {\n227|      it(`submits the expected form data #${testNumber + 1}`, () => {\n228|        /**\n229|         * @type FormData\n230|         */\n231|        let data;\n232|        const handleSubmit = spy((event) => {\n233|          // Prevent navigation\n234|          event.preventDefault();\n235|          // populate FormData with the submitted form\n236|          data = new FormData(event.target);\n237|        });\n238|        render(\n239|          <form onSubmit={handleSubmit}>\n240|            <Rating {...testData.ratingProps} />\n241|            <button type=\"submit\" />\n242|          </form>,\n243|        );\n244|        const submitter = document.querySelector('button[type=\"submit\"]');\n245|\n246|        act(() => {\n247|          // form.submit() would not run form validation\n248|          submitter.click();\n249|        });\n250|\n251|        if (testData.formData === undefined) {\n252|          expect(handleSubmit.callCount).to.equal(0);\n253|        } else {\n254|          expect(Array.from(data.entries())).to.deep.equal(testData.formData);\n255|        }\n256|      });\n257|    });\n258|  });\n259|});\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.ts\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.ts\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.ts\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npackages/mui-material/src/Rating/Rating.js\nline: 371\nline: 372\nline: 375\nline: 377\n```",
          "```\npackages/mui-material/src/Rating/Rating.js\nfunction: handleMouseMove\nline: 371\nline: 375\nline: 377\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npackages/mui-material/src/Rating/Rating.js\nline: 371\nline: 372\nline: 375\nline: 377\n```",
            "```\npackages/mui-material/src/Rating/Rating.js\nfunction: handleMouseMove\nline: 371\nline: 375\nline: 377\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/packages/mui-material/src/Rating/Rating.js b/packages/mui-material/src/Rating/Rating.js\nindex 598a5d1..cce413e 100644\n--- a/packages/mui-material/src/Rating/Rating.js\n+++ b/packages/mui-material/src/Rating/Rating.js\n@@ -367,14 +367,14 @@ const Rating = React.forwardRef(function Rating(inProps, ref) {\n     }\n \n     const rootNode = rootRef.current;\n-    const { right, left } = rootNode.getBoundingClientRect();\n-    const { width } = rootNode.firstChild.getBoundingClientRect();\n+    const { right, left, width } = rootNode.getBoundingClientRect();\n     let percent;\n \n+    // Use the full root width to account for custom spacing between icons\n     if (theme.direction === 'rtl') {\n-      percent = (right - event.clientX) / (width * max);\n+      percent = (right - event.clientX) / width;\n     } else {\n-      percent = (event.clientX - left) / (width * max);\n+      percent = (event.clientX - left) / width;\n     }\n \n     let newHover = roundValueToPrecision(max * percent + precision / 2, precision);\n",
  "7_resolved": true
}