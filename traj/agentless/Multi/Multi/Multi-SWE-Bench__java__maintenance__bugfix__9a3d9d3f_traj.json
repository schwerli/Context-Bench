{
  "instance_id": "Multi-SWE-Bench__java__maintenance__bugfix__9a3d9d3f",
  "original_id": "fasterxml__jackson-databind-4015",
  "1_model_selected_files": [
    "src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java"
  ],
  "2_embedding_selected_files": [
    "src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/EnumDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/ObjectArrayDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/NullifyingDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/JsonDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/impl/NullsAsEmptyProvider.java",
    "src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/UntypedObjectDeserializerNR.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/SettableBeanProperty.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/UntypedObjectDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/NumberDeserializers.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/DelegatingDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/JsonNodeDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java",
    "src/main/java/com/fasterxml/jackson/databind/DeserializationFeature.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/NullValueProvider.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/CollectionDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/AbstractDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/ObjectReader.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/impl/FailingDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/MapDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerBase.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/impl/FieldProperty.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/EnumSetDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/StringCollectionDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/FactoryBasedEnumDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/DefaultDeserializationContext.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/StringArrayDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/impl/ObjectIdValueProperty.java"
  ],
  "3_final_combined_files": [
    "src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/EnumDeserializer.java",
    "src/main/java/com/fasterxml/jackson/databind/deser/std/ObjectArrayDeserializer.java"
  ],
  "4_related_elements": {
    "src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java": [
      "function: CoercionConfigs.findCoercion\nfunction: CoercionConfigs.findCoercionFromBlankString\nfunction: CoercionConfigs._isScalarType"
    ],
    "src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java": [
      "function: FromStringDeserializer.logicalType\nfunction: FromStringDeserializer._deserializeFromEmptyString\nfunction: FromStringDeserializer._deserializeFromEmptyStringDefault\nfunction: FromStringDeserializer.Std.getEmptyValue\nfunction: FromStringDeserializer.Std._deserializeFromEmptyStringDefault"
    ],
    "src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java": [
      "function: StdDeserializer._deserializeFromString\nfunction: StdDeserializer._deserializeFromEmptyString\nfunction: StdDeserializer._findCoercionFromEmptyString\nfunction: StdDeserializer._checkFromStringCoercion"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java": [
          "function: CoercionConfigs.findCoercion"
        ],
        "src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java": [
          "function: FromStringDeserializer._deserializeFromEmptyString\nfunction: FromStringDeserializer._deserializeFromEmptyStringDefault"
        ],
        "src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nindex 80a292a..851e65e 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n@@ -229,6 +229,14 @@ public class CoercionConfigs\n         }\n \n         if (inputShape == CoercionInputShape.EmptyString) {\n+            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n+            //     2.11, wrt \"FromStringDeserializer\" supported types\n+            // Give precedence to \"OtherScalar\" types (e.g., Locale, Charset, etc)\n+            // so that they may try to convert empty String values rather than\n+            // being coerced to null via `ACCEPT_EMPTY_STRING_AS_NULL_OBJECT`.\n+            if (targetType == LogicalType.OtherScalar) {\n+                return CoercionAction.TryConvert;\n+            }\n             // Since coercion of scalar must be enabled (see check above), allow empty-string\n             // coercions by default even without this setting\n             if (baseScalar\n@@ -236,11 +244,6 @@ public class CoercionConfigs\n                     || config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n                 return CoercionAction.AsNull;\n             }\n-            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n-            //     2.11, wrt \"FromStringDeserializer\" supported types\n-            if (targetType == LogicalType.OtherScalar) {\n-                return CoercionAction.TryConvert;\n-            }\n             // But block from allowing structured types like POJOs, Maps etc\n             return CoercionAction.Fail;\n         }\n",
        "diff --git a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nindex 80a292a..eccd1dc 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n@@ -229,6 +229,12 @@ public class CoercionConfigs\n         }\n \n         if (inputShape == CoercionInputShape.EmptyString) {\n+            // 09-Jun-2020, tatu: Support backwards-compatibility with 2.11 for\n+            // \"FromStringDeserializer\" supported types. For OtherScalar,\n+            // prefer TryConvert even if ACCEPT_EMPTY_STRING_AS_NULL_OBJECT is enabled.\n+            if (targetType == LogicalType.OtherScalar) {\n+                return CoercionAction.TryConvert;\n+            }\n             // Since coercion of scalar must be enabled (see check above), allow empty-string\n             // coercions by default even without this setting\n             if (baseScalar\n@@ -236,11 +242,6 @@ public class CoercionConfigs\n                     || config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n                 return CoercionAction.AsNull;\n             }\n-            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n-            //     2.11, wrt \"FromStringDeserializer\" supported types\n-            if (targetType == LogicalType.OtherScalar) {\n-                return CoercionAction.TryConvert;\n-            }\n             // But block from allowing structured types like POJOs, Maps etc\n             return CoercionAction.Fail;\n         }\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nLocale \"\" is deserialised as `null` if `ACCEPT_EMPTY_STRING_AS_NULL_OBJECT` is enabled\n**Describe the bug**\r\n\r\nWhen trying to deserialise an empty JSON string as `java.util.Locale`, the resulting value is `NULL`, when ACCEPT_EMPTY_STRING_AS_NULL_OBJECT is set to `true`.\r\nMy expectation was that the empty string would be converted to `Locale.ROOT`.\r\n\r\n**Version information**\r\n2.13.5\r\n\r\n**To Reproduce**\r\n\r\nThe following test fails:\r\n\r\n```java\r\nclass JsonDeserializationTest\r\n{\r\n    @Test\r\n    void testDeserializeRootLocale() throws JsonProcessingException\r\n    {\r\n        ObjectMapper objectMapper = new ObjectMapper();\r\n        objectMapper.configure(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT, true);\r\n\r\n        assertEquals(Locale.ROOT, objectMapper.readValue(\"\\\"\\\"\", Locale.class));\r\n    }\r\n}\r\n```\r\n\r\nWhen looking at the current source code at https://github.com/FasterXML/jackson-databind/blob/2.16/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java#L241\r\nIt looks like `CoercionAction.TryConvert` should be returned in this case.\n\n###\n### src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n...\n150|     * from shape that is now always allowed to be coerced from is requested.\n151|     *\n152|     * @param config Currently active deserialization configuration\n153|     * @param targetType Logical target type of coercion\n154|     * @param targetClass Physical target type of coercion\n155|     * @param inputShape Input shape to coerce from\n156|     *\n157|     * @return CoercionAction configured for specified coercion\n158|     *\n159|     * @since 2.12\n160|     */\n161|    public CoercionAction findCoercion(DeserializationConfig config,\n162|            LogicalType targetType,\n163|            Class<?> targetClass, CoercionInputShape inputShape)\n164|    {\n165|        // First, see if there is exact match for physical type\n166|        if ((_perClassCoercions != null) && (targetClass != null)) {\n167|            MutableCoercionConfig cc = _perClassCoercions.get(targetClass);\n168|            if (cc != null) {\n169|                CoercionAction act = cc.findAction(inputShape);\n170|                if (act != null) {\n171|                    return act;\n172|                }\n173|            }\n174|        }\n175|\n176|        // If not, maybe by logical type\n177|        if ((_perTypeCoercions != null) && (targetType != null)) {\n178|            MutableCoercionConfig cc = _perTypeCoercions[targetType.ordinal()];\n179|            if (cc != null) {\n180|                CoercionAction act = cc.findAction(inputShape);\n181|                if (act != null) {\n182|                    return act;\n183|                }\n184|            }\n185|        }\n186|\n187|        // Barring that, default coercion for input shape?\n188|        CoercionAction act = _defaultCoercions.findAction(inputShape);\n189|        if (act != null) {\n190|            return act;\n191|        }\n192|\n193|        // Otherwise there are some legacy features that can provide answer\n194|        switch (inputShape) {\n195|        case EmptyArray:\n196|            // Default for setting is false\n197|            return config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_ARRAY_AS_NULL_OBJECT) ?\n198|                    CoercionAction.AsNull : CoercionAction.Fail;\n199|        case Float:\n200|            if (targetType == LogicalType.Integer) {\n201|                // Default for setting in 2.x is true\n202|                return config.isEnabled(DeserializationFeature.ACCEPT_FLOAT_AS_INT) ?\n203|                        CoercionAction.TryConvert : CoercionAction.Fail;\n204|            }\n205|            break;\n206|        case Integer:\n207|            if (targetType == LogicalType.Enum) {\n208|                if (config.isEnabled(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS)) {\n209|                    return CoercionAction.Fail;\n210|                }\n211|            }\n212|            break;\n213|        default:\n214|        }\n215|\n216|        // classic scalars are numbers, booleans; but date/time also considered\n217|        // scalar for this particular purpose\n218|        final boolean baseScalar = _isScalarType(targetType);\n219|\n220|        if (baseScalar\n221|                // Default for setting in 2.x is true\n222|                && !config.isEnabled(MapperFeature.ALLOW_COERCION_OF_SCALARS)\n223|                // 12-Oct-2022, carterkozak: As per [databind#3624]: Coercion from integer-shaped\n224|                // data into a floating point type is not banned by the\n225|                // ALLOW_COERCION_OF_SCALARS feature because '1' is a valid JSON representation of\n226|                // '1.0' in a way that other types of coercion do not satisfy.\n227|                && (targetType != LogicalType.Float || inputShape != CoercionInputShape.Integer)) {\n228|            return CoercionAction.Fail;\n229|        }\n230|\n231|        if (inputShape == CoercionInputShape.EmptyString) {\n232|            // Since coercion of scalar must be enabled (see check above), allow empty-string\n233|            // coercions by default even without this setting\n234|            if (baseScalar\n235|                    // Default for setting is false\n236|                    || config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n237|                return CoercionAction.AsNull;\n238|            }\n239|            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n240|            //     2.11, wrt \"FromStringDeserializer\" supported types\n241|            if (targetType == LogicalType.OtherScalar) {\n242|                return CoercionAction.TryConvert;\n243|            }\n244|            // But block from allowing structured types like POJOs, Maps etc\n245|            return CoercionAction.Fail;\n246|        }\n247|\n248|        // and all else failing, return default\n249|        return _defaultAction;\n250|    }\n251|\n252|    /**\n253|     * More specialized accessor called in case of input being a blank\n254|     * String (one consisting of only white space characters with length of at least one).\n255|     * Will basically first determine if \"blank as empty\" is allowed: if not,\n256|     * returns {@code actionIfBlankNotAllowed}, otherwise returns action for\n257|     * {@link CoercionInputShape#EmptyString}.\n258|     *\n259|     * @param config Currently active deserialization configuration\n260|     * @param targetType Logical target type of coercion\n261|     * @param targetClass Physical target type of coercion\n262|     * @param actionIfBlankNotAllowed Return value to use in case \"blanks as empty\"\n263|     *    is not allowed\n264|     *\n265|     * @return CoercionAction configured for specified coercion from blank string\n266|     */\n267|    public CoercionAction findCoercionFromBlankString(DeserializationConfig config,\n268|            LogicalType targetType,\n269|            Class<?> targetClass,\n270|            CoercionAction actionIfBlankNotAllowed)\n271|    {\n272|        Boolean acceptBlankAsEmpty = null;\n273|        CoercionAction action = null;\n274|\n275|        // First, see if there is exact match for physical type\n276|        if ((_perClassCoercions != null) && (targetClass != null)) {\n277|            MutableCoercionConfig cc = _perClassCoercions.get(targetClass);\n278|            if (cc != null) {\n279|                acceptBlankAsEmpty = cc.getAcceptBlankAsEmpty();\n280|                action = cc.findAction(CoercionInputShape.EmptyString);\n281|            }\n282|        }\n283|\n284|        // If not, maybe by logical type\n285|        if ((_perTypeCoercions != null) && (targetType != null)) {\n286|            MutableCoercionConfig cc = _perTypeCoercions[targetType.ordinal()];\n287|            if (cc != null) {\n288|                if (acceptBlankAsEmpty == null) {\n289|                    acceptBlankAsEmpty = cc.getAcceptBlankAsEmpty();\n290|                }\n291|                if (action == null) {\n292|                    action = cc.findAction(CoercionInputShape.EmptyString);\n293|                }\n294|            }\n295|        }\n296|\n297|        // Barring that, default coercion for input shape?\n298|        if (acceptBlankAsEmpty == null) {\n299|            acceptBlankAsEmpty = _defaultCoercions.getAcceptBlankAsEmpty();\n300|        }\n301|        if (action == null) {\n302|            action = _defaultCoercions.findAction(CoercionInputShape.EmptyString);\n303|        }\n304|\n305|        // First: if using blank as empty is no-go, return what caller specified\n306|        if (Boolean.FALSE.equals(acceptBlankAsEmpty)) {\n307|            return actionIfBlankNotAllowed;\n308|        }\n309|        // Otherwise, if action found, return that\n310|        if (action != null) {\n311|            return action;\n312|        }\n313|\n314|        // 23-Sep-2021, tatu: [databind#3234] Should default to \"allow\" for Scalar types\n315|        //    for backwards compatibility\n316|        if (_isScalarType(targetType)) {\n317|            return CoercionAction.AsNull;\n318|        }\n319|\n320|        // If not, one specific legacy setting to consider...\n321|        if (config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n322|            return CoercionAction.AsNull;\n323|        }\n324|\n325|        // But finally consider ultimate default to be \"false\" and so:\n326|        return actionIfBlankNotAllowed;\n327|    }\n328|\n329|    protected boolean _isScalarType(LogicalType targetType) {\n330|        return (targetType == LogicalType.Float)\n331|                || (targetType == LogicalType.Integer)\n332|                || (targetType == LogicalType.Boolean)\n333|                || (targetType == LogicalType.DateTime);\n334|    }\n335|}\n\n\n### src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\n...\n121|            kind = Std.STD_INET_SOCKET_ADDRESS;\n122|        } else if (rawType == StringBuilder.class) {\n123|            return new StringBuilderDeserializer();\n124|        } else if (rawType == StringBuffer.class) { // since 2.13.3\n125|            return new StringBufferDeserializer();\n126|        } else {\n127|            return null;\n128|        }\n129|        return new Std(rawType, kind);\n130|    }\n131|\n132|    @Override // since 2.12\n133|    public LogicalType logicalType() {\n134|        return LogicalType.OtherScalar;\n135|    }\n136|\n137|    /*\n138|    /**********************************************************\n139|    /* Deserializer implementations\n140|    /**********************************************************\n141|     */\n142|\n143|    @SuppressWarnings(\"unchecked\")\n144|    @Override\n...\n225|     * {@code null} nor directly assignable to target type.\n226|     * Used, for example, by {@link UUIDDeserializer} to coerce from {@code byte[]}.\n227|     */\n228|    protected T _deserializeEmbedded(Object ob, DeserializationContext ctxt) throws IOException {\n229|        // default impl: error out\n230|        ctxt.reportInputMismatch(this,\n231|                \"Don't know how to convert embedded Object of type %s into %s\",\n232|                ob.getClass().getName(), _valueClass.getName());\n233|        return null;\n234|    }\n235|\n236|    @Deprecated // since 2.12 -- override variant that takes context\n237|    protected final T _deserializeFromEmptyString() throws IOException {\n238|        return null;\n239|    }\n240|\n241|    /**\n242|     * @since 2.12\n243|     */\n244|    protected Object _deserializeFromEmptyString(DeserializationContext ctxt) throws IOException {\n245|        CoercionAction act = ctxt.findCoercionAction(logicalType(), _valueClass,\n246|                CoercionInputShape.EmptyString);\n247|        if (act == CoercionAction.Fail) {\n248|            ctxt.reportInputMismatch(this,\n...\n255|        if (act == CoercionAction.AsEmpty) {\n256|            return getEmptyValue(ctxt);\n257|        }\n258|        // 09-Jun-2020, tatu: semantics for `TryConvert` are bit interesting due to\n259|        //    historical reasons\n260|        return _deserializeFromEmptyStringDefault(ctxt);\n261|    }\n262|\n263|    /**\n264|     * @since 2.12\n265|     */\n266|    protected Object _deserializeFromEmptyStringDefault(DeserializationContext ctxt) throws IOException {\n267|        // by default, \"as-null\", but overridable by sub-classes\n268|        return getNullValue(ctxt);\n269|    }\n270|\n271|    /*\n272|    /**********************************************************\n273|    /* A general-purpose implementation\n274|    /**********************************************************\n275|     */\n276|\n277|    /**\n278|     * \"Chameleon\" deserializer that works on simple types that are deserialized\n...\n\n\n### src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java\n...\n245|            }\n246|        }\n247|        return (T) ctxt.handleUnexpectedToken(getValueType(ctxt), p);\n248|    }\n249|\n250|    /**\n251|     * Helper method to call in case deserializer does not support native automatic\n252|     * use of incoming String values, but there may be standard coercions to consider.\n253|     *\n254|     * @since 2.12\n255|     */\n256|    @SuppressWarnings(\"unchecked\")\n257|    protected T _deserializeFromString(JsonParser p, DeserializationContext ctxt)\n258|            throws IOException\n259|    {\n260|        final ValueInstantiator inst = getValueInstantiator();\n261|        final Class<?> rawTargetType = handledType();\n262|        String value = p.getValueAsString();\n263|\n264|        if ((inst != null) && inst.canCreateFromString()) {\n265|            return (T) inst.createFromString(ctxt, value);\n266|        }\n267|        if (value.isEmpty()) {\n268|            final CoercionAction act = ctxt.findCoercionAction(logicalType(), rawTargetType,\n269|                    CoercionInputShape.EmptyString);\n270|            return (T) _deserializeFromEmptyString(p, ctxt, act, rawTargetType,\n271|                    \"empty String (\\\"\\\")\");\n272|        }\n273|        if (_isBlank(value)) {\n274|            final CoercionAction act = ctxt.findCoercionFromBlankString(logicalType(), rawTargetType,\n275|                    CoercionAction.Fail);\n276|            return (T) _deserializeFromEmptyString(p, ctxt, act, rawTargetType,\n277|                    \"blank String (all whitespace)\");\n278|        }\n279|\n280|        // 28-Sep-2011, tatu: Ok this is not clean at all; but since there are legacy\n281|        //   systems that expect conversions in some cases, let's just add a minimal\n282|        //   patch (note: same could conceivably be used for numbers too).\n283|        if (inst != null) {\n284|            value = value.trim(); // mostly to avoid problems wrt XML indentation\n285|            if (inst.canCreateFromInt()) {\n286|                if (ctxt.findCoercionAction(LogicalType.Integer, Integer.class,\n287|                        CoercionInputShape.String) == CoercionAction.TryConvert) {\n288|                    return (T) inst.createFromInt(ctxt, _parseIntPrimitive(ctxt, value));\n289|                }\n290|            }\n291|            if (inst.canCreateFromLong()) {\n292|                if (ctxt.findCoercionAction(LogicalType.Integer, Long.class,\n293|                        CoercionInputShape.String) == CoercionAction.TryConvert) {\n294|                    return (T) inst.createFromLong(ctxt, _parseLongPrimitive(ctxt, value));\n295|                }\n296|            }\n297|            if (inst.canCreateFromBoolean()) {\n298|                // 29-May-2020, tatu: With 2.12 can and should use CoercionConfig so:\n299|                if (ctxt.findCoercionAction(LogicalType.Boolean, Boolean.class,\n300|                        CoercionInputShape.String) == CoercionAction.TryConvert) {\n301|                    String str = value.trim();\n302|                    if (\"true\".equals(str)) {\n303|                        return (T) inst.createFromBoolean(ctxt, true);\n304|                    }\n305|                    if (\"false\".equals(str)) {\n306|                        return (T) inst.createFromBoolean(ctxt, false);\n307|                    }\n308|                }\n309|            }\n310|        }\n311|        return (T) ctxt.handleMissingInstantiator(rawTargetType, inst, ctxt.getParser(),\n312|                \"no String-argument constructor/factory method to deserialize from String value ('%s')\",\n313|                value);\n314|    }\n315|\n316|    protected Object _deserializeFromEmptyString(JsonParser p, DeserializationContext ctxt,\n317|            CoercionAction act, Class<?> rawTargetType, String desc) throws IOException\n318|    {\n319|\n320|        switch (act) {\n321|        case AsEmpty:\n322|            return getEmptyValue(ctxt);\n323|        case Fail:\n324|            // This will throw an exception\n325|            _checkCoercionFail(ctxt, act, rawTargetType, \"\", \"empty String (\\\"\\\")\");\n326|            // ... so will never fall through\n327|        case TryConvert:\n328|            // hmmmh... empty or null, typically? Assume \"as null\" for now\n329|        case AsNull:\n330|        default:\n331|            return null;\n332|        }\n333|\n334|        // 06-Nov-2020, tatu: This was behavior pre-2.12, giving less useful\n335|        //    exception\n336|        /*\n337|        final ValueInstantiator inst = getValueInstantiator();\n338|\n339|        // 03-Jun-2020, tatu: Should ideally call `handleUnexpectedToken()` instead, but\n340|        //    since this call was already made, use it.\n341|        return ctxt.handleMissingInstantiator(rawTargetType, inst, p,\n342|\"Cannot deserialize value of type %s from %s (no String-argument constructor/factory method; coercion not enabled)\",\n343|                ClassUtil.getTypeDescription(getValueType(ctxt)), desc);\n344|                */\n345|    }\n346|\n347|    /**\n348|     * Helper called to support {@link DeserializationFeature#UNWRAP_SINGLE_VALUE_ARRAYS}:\n349|     * default implementation simply calls\n350|     * {@link #deserialize(JsonParser, DeserializationContext)},\n351|     * but handling may be overridden.\n352|     *\n353|     * @since 2.9\n354|     */\n...\n1490|    }\n1491|\n1492|    /*\n1493|    /****************************************************\n1494|    /* Helper methods for sub-classes, new (2.12+)\n1495|    /****************************************************\n1496|     */\n1497|\n1498|    /**\n1499|     * @since 2.12\n1500|     */\n1501|    protected CoercionAction _checkFromStringCoercion(DeserializationContext ctxt, String value)\n1502|        throws IOException\n1503|    {\n1504|        return _checkFromStringCoercion(ctxt, value, logicalType(), handledType());\n1505|    }\n1506|\n1507|    /**\n1508|     * @since 2.12\n1509|     */\n1510|    protected CoercionAction _checkFromStringCoercion(DeserializationContext ctxt, String value,\n1511|            LogicalType logicalType, Class<?> rawTargetType)\n1512|        throws IOException\n1513|    {\n1514|        // 18-Dec-2020, tatu: Formats without strong typing (XML, CSV, Properties at\n...\n2168|                }\n2169|            }\n2170|            return new NullsAsEmptyProvider(valueDeser);\n2171|        }\n2172|        if (nulls == Nulls.SKIP) {\n2173|            return NullsConstantProvider.skipper();\n2174|        }\n2175|        return null;\n2176|    }\n2177|\n2178|    // @since 2.12\n2179|    protected CoercionAction _findCoercionFromEmptyString(DeserializationContext ctxt) {\n2180|        return ctxt.findCoercionAction(logicalType(), handledType(),\n2181|                CoercionInputShape.EmptyString);\n2182|    }\n2183|\n2184|    // @since 2.12\n2185|    protected CoercionAction _findCoercionFromEmptyArray(DeserializationContext ctxt) {\n2186|        return ctxt.findCoercionAction(logicalType(), handledType(),\n2187|                CoercionInputShape.EmptyArray);\n2188|    }\n2189|\n2190|    // @since 2.12\n2191|    protected CoercionAction _findCoercionFromBlankString(DeserializationContext ctxt) {\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.java\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.java\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.java\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nfunction: FromStringDeserializer._deserializeFromEmptyStringDefault\n```",
          "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\nline: 231\nline: 236\nline: 241\nline: 243\nline: 245\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nline: 258\nline: 260\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nfunction: FromStringDeserializer._deserializeFromEmptyStringDefault\n```",
            "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\nline: 231\nline: 236\nline: 241\nline: 243\nline: 245\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nline: 258\nline: 260\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java": [
          "function: CoercionConfigs.findCoercion\nline: 231\nline: 236\nline: 241\nline: 243\nline: 245"
        ],
        "src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java": [
          "function: FromStringDeserializer._deserializeFromEmptyString\nline: 258\nline: 260"
        ],
        "src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nindex 80a292a..99d3d98 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n@@ -229,6 +229,11 @@ public class CoercionConfigs\n         }\n \n         if (inputShape == CoercionInputShape.EmptyString) {\n+            // 09-Jun-2020, tatu: Support backwards-compatibility with 2.11 for\n+            // \"FromStringDeserializer\" supported types: prefer conversion over nulls.\n+            if (targetType == LogicalType.OtherScalar) {\n+                return CoercionAction.TryConvert;\n+            }\n             // Since coercion of scalar must be enabled (see check above), allow empty-string\n             // coercions by default even without this setting\n             if (baseScalar\n@@ -236,11 +241,6 @@ public class CoercionConfigs\n                     || config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n                 return CoercionAction.AsNull;\n             }\n-            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n-            //     2.11, wrt \"FromStringDeserializer\" supported types\n-            if (targetType == LogicalType.OtherScalar) {\n-                return CoercionAction.TryConvert;\n-            }\n             // But block from allowing structured types like POJOs, Maps etc\n             return CoercionAction.Fail;\n         }\n",
        "diff --git a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nindex 80a292a..c2ceb55 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n@@ -229,6 +229,13 @@ public class CoercionConfigs\n         }\n \n         if (inputShape == CoercionInputShape.EmptyString) {\n+            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n+            //     2.11, wrt \"FromStringDeserializer\" supported types. Allow these to attempt\n+            //     conversion from empty string (for example, Locale -> Locale.ROOT), even if\n+            //     ACCEPT_EMPTY_STRING_AS_NULL_OBJECT is enabled.\n+            if (targetType == LogicalType.OtherScalar) {\n+                return CoercionAction.TryConvert;\n+            }\n             // Since coercion of scalar must be enabled (see check above), allow empty-string\n             // coercions by default even without this setting\n             if (baseScalar\n@@ -236,11 +243,6 @@ public class CoercionConfigs\n                     || config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n                 return CoercionAction.AsNull;\n             }\n-            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n-            //     2.11, wrt \"FromStringDeserializer\" supported types\n-            if (targetType == LogicalType.OtherScalar) {\n-                return CoercionAction.TryConvert;\n-            }\n             // But block from allowing structured types like POJOs, Maps etc\n             return CoercionAction.Fail;\n         }\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nLocale \"\" is deserialised as `null` if `ACCEPT_EMPTY_STRING_AS_NULL_OBJECT` is enabled\n**Describe the bug**\r\n\r\nWhen trying to deserialise an empty JSON string as `java.util.Locale`, the resulting value is `NULL`, when ACCEPT_EMPTY_STRING_AS_NULL_OBJECT is set to `true`.\r\nMy expectation was that the empty string would be converted to `Locale.ROOT`.\r\n\r\n**Version information**\r\n2.13.5\r\n\r\n**To Reproduce**\r\n\r\nThe following test fails:\r\n\r\n```java\r\nclass JsonDeserializationTest\r\n{\r\n    @Test\r\n    void testDeserializeRootLocale() throws JsonProcessingException\r\n    {\r\n        ObjectMapper objectMapper = new ObjectMapper();\r\n        objectMapper.configure(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT, true);\r\n\r\n        assertEquals(Locale.ROOT, objectMapper.readValue(\"\\\"\\\"\", Locale.class));\r\n    }\r\n}\r\n```\r\n\r\nWhen looking at the current source code at https://github.com/FasterXML/jackson-databind/blob/2.16/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java#L241\r\nIt looks like `CoercionAction.TryConvert` should be returned in this case.\n\n###\n### src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n...\n150|     * from shape that is now always allowed to be coerced from is requested.\n151|     *\n152|     * @param config Currently active deserialization configuration\n153|     * @param targetType Logical target type of coercion\n154|     * @param targetClass Physical target type of coercion\n155|     * @param inputShape Input shape to coerce from\n156|     *\n157|     * @return CoercionAction configured for specified coercion\n158|     *\n159|     * @since 2.12\n160|     */\n161|    public CoercionAction findCoercion(DeserializationConfig config,\n162|            LogicalType targetType,\n163|            Class<?> targetClass, CoercionInputShape inputShape)\n164|    {\n165|        // First, see if there is exact match for physical type\n166|        if ((_perClassCoercions != null) && (targetClass != null)) {\n167|            MutableCoercionConfig cc = _perClassCoercions.get(targetClass);\n168|            if (cc != null) {\n169|                CoercionAction act = cc.findAction(inputShape);\n170|                if (act != null) {\n171|                    return act;\n172|                }\n173|            }\n174|        }\n175|\n176|        // If not, maybe by logical type\n177|        if ((_perTypeCoercions != null) && (targetType != null)) {\n178|            MutableCoercionConfig cc = _perTypeCoercions[targetType.ordinal()];\n179|            if (cc != null) {\n180|                CoercionAction act = cc.findAction(inputShape);\n181|                if (act != null) {\n182|                    return act;\n183|                }\n184|            }\n185|        }\n186|\n187|        // Barring that, default coercion for input shape?\n188|        CoercionAction act = _defaultCoercions.findAction(inputShape);\n189|        if (act != null) {\n190|            return act;\n191|        }\n192|\n193|        // Otherwise there are some legacy features that can provide answer\n194|        switch (inputShape) {\n195|        case EmptyArray:\n196|            // Default for setting is false\n197|            return config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_ARRAY_AS_NULL_OBJECT) ?\n198|                    CoercionAction.AsNull : CoercionAction.Fail;\n199|        case Float:\n200|            if (targetType == LogicalType.Integer) {\n201|                // Default for setting in 2.x is true\n202|                return config.isEnabled(DeserializationFeature.ACCEPT_FLOAT_AS_INT) ?\n203|                        CoercionAction.TryConvert : CoercionAction.Fail;\n204|            }\n205|            break;\n206|        case Integer:\n207|            if (targetType == LogicalType.Enum) {\n208|                if (config.isEnabled(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS)) {\n209|                    return CoercionAction.Fail;\n210|                }\n211|            }\n212|            break;\n213|        default:\n214|        }\n215|\n216|        // classic scalars are numbers, booleans; but date/time also considered\n217|        // scalar for this particular purpose\n218|        final boolean baseScalar = _isScalarType(targetType);\n219|\n220|        if (baseScalar\n221|                // Default for setting in 2.x is true\n222|                && !config.isEnabled(MapperFeature.ALLOW_COERCION_OF_SCALARS)\n223|                // 12-Oct-2022, carterkozak: As per [databind#3624]: Coercion from integer-shaped\n224|                // data into a floating point type is not banned by the\n225|                // ALLOW_COERCION_OF_SCALARS feature because '1' is a valid JSON representation of\n226|                // '1.0' in a way that other types of coercion do not satisfy.\n227|                && (targetType != LogicalType.Float || inputShape != CoercionInputShape.Integer)) {\n228|            return CoercionAction.Fail;\n229|        }\n230|\n231|        if (inputShape == CoercionInputShape.EmptyString) {\n232|            // Since coercion of scalar must be enabled (see check above), allow empty-string\n233|            // coercions by default even without this setting\n234|            if (baseScalar\n235|                    // Default for setting is false\n236|                    || config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n237|                return CoercionAction.AsNull;\n238|            }\n239|            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n240|            //     2.11, wrt \"FromStringDeserializer\" supported types\n241|            if (targetType == LogicalType.OtherScalar) {\n242|                return CoercionAction.TryConvert;\n243|            }\n244|            // But block from allowing structured types like POJOs, Maps etc\n245|            return CoercionAction.Fail;\n246|        }\n247|\n248|        // and all else failing, return default\n249|        return _defaultAction;\n250|    }\n251|\n252|    /**\n253|     * More specialized accessor called in case of input being a blank\n254|     * String (one consisting of only white space characters with length of at least one).\n255|     * Will basically first determine if \"blank as empty\" is allowed: if not,\n256|     * returns {@code actionIfBlankNotAllowed}, otherwise returns action for\n257|     * {@link CoercionInputShape#EmptyString}.\n258|     *\n259|     * @param config Currently active deserialization configuration\n260|     * @param targetType Logical target type of coercion\n261|     * @param targetClass Physical target type of coercion\n262|     * @param actionIfBlankNotAllowed Return value to use in case \"blanks as empty\"\n263|     *    is not allowed\n264|     *\n265|     * @return CoercionAction configured for specified coercion from blank string\n266|     */\n267|    public CoercionAction findCoercionFromBlankString(DeserializationConfig config,\n268|            LogicalType targetType,\n269|            Class<?> targetClass,\n270|            CoercionAction actionIfBlankNotAllowed)\n271|    {\n272|        Boolean acceptBlankAsEmpty = null;\n273|        CoercionAction action = null;\n274|\n275|        // First, see if there is exact match for physical type\n276|        if ((_perClassCoercions != null) && (targetClass != null)) {\n277|            MutableCoercionConfig cc = _perClassCoercions.get(targetClass);\n278|            if (cc != null) {\n279|                acceptBlankAsEmpty = cc.getAcceptBlankAsEmpty();\n280|                action = cc.findAction(CoercionInputShape.EmptyString);\n281|            }\n282|        }\n283|\n284|        // If not, maybe by logical type\n285|        if ((_perTypeCoercions != null) && (targetType != null)) {\n286|            MutableCoercionConfig cc = _perTypeCoercions[targetType.ordinal()];\n287|            if (cc != null) {\n288|                if (acceptBlankAsEmpty == null) {\n289|                    acceptBlankAsEmpty = cc.getAcceptBlankAsEmpty();\n290|                }\n291|                if (action == null) {\n292|                    action = cc.findAction(CoercionInputShape.EmptyString);\n293|                }\n294|            }\n295|        }\n296|\n297|        // Barring that, default coercion for input shape?\n298|        if (acceptBlankAsEmpty == null) {\n299|            acceptBlankAsEmpty = _defaultCoercions.getAcceptBlankAsEmpty();\n300|        }\n301|        if (action == null) {\n302|            action = _defaultCoercions.findAction(CoercionInputShape.EmptyString);\n303|        }\n304|\n305|        // First: if using blank as empty is no-go, return what caller specified\n306|        if (Boolean.FALSE.equals(acceptBlankAsEmpty)) {\n307|            return actionIfBlankNotAllowed;\n308|        }\n309|        // Otherwise, if action found, return that\n310|        if (action != null) {\n311|            return action;\n312|        }\n313|\n314|        // 23-Sep-2021, tatu: [databind#3234] Should default to \"allow\" for Scalar types\n315|        //    for backwards compatibility\n316|        if (_isScalarType(targetType)) {\n317|            return CoercionAction.AsNull;\n318|        }\n319|\n320|        // If not, one specific legacy setting to consider...\n321|        if (config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n322|            return CoercionAction.AsNull;\n323|        }\n324|\n325|        // But finally consider ultimate default to be \"false\" and so:\n326|        return actionIfBlankNotAllowed;\n327|    }\n328|\n329|    protected boolean _isScalarType(LogicalType targetType) {\n330|        return (targetType == LogicalType.Float)\n331|                || (targetType == LogicalType.Integer)\n332|                || (targetType == LogicalType.Boolean)\n333|                || (targetType == LogicalType.DateTime);\n334|    }\n335|}\n\n\n### src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\n...\n121|            kind = Std.STD_INET_SOCKET_ADDRESS;\n122|        } else if (rawType == StringBuilder.class) {\n123|            return new StringBuilderDeserializer();\n124|        } else if (rawType == StringBuffer.class) { // since 2.13.3\n125|            return new StringBufferDeserializer();\n126|        } else {\n127|            return null;\n128|        }\n129|        return new Std(rawType, kind);\n130|    }\n131|\n132|    @Override // since 2.12\n133|    public LogicalType logicalType() {\n134|        return LogicalType.OtherScalar;\n135|    }\n136|\n137|    /*\n138|    /**********************************************************\n139|    /* Deserializer implementations\n140|    /**********************************************************\n141|     */\n142|\n143|    @SuppressWarnings(\"unchecked\")\n144|    @Override\n...\n225|     * {@code null} nor directly assignable to target type.\n226|     * Used, for example, by {@link UUIDDeserializer} to coerce from {@code byte[]}.\n227|     */\n228|    protected T _deserializeEmbedded(Object ob, DeserializationContext ctxt) throws IOException {\n229|        // default impl: error out\n230|        ctxt.reportInputMismatch(this,\n231|                \"Don't know how to convert embedded Object of type %s into %s\",\n232|                ob.getClass().getName(), _valueClass.getName());\n233|        return null;\n234|    }\n235|\n236|    @Deprecated // since 2.12 -- override variant that takes context\n237|    protected final T _deserializeFromEmptyString() throws IOException {\n238|        return null;\n239|    }\n240|\n241|    /**\n242|     * @since 2.12\n243|     */\n244|    protected Object _deserializeFromEmptyString(DeserializationContext ctxt) throws IOException {\n245|        CoercionAction act = ctxt.findCoercionAction(logicalType(), _valueClass,\n246|                CoercionInputShape.EmptyString);\n247|        if (act == CoercionAction.Fail) {\n248|            ctxt.reportInputMismatch(this,\n...\n255|        if (act == CoercionAction.AsEmpty) {\n256|            return getEmptyValue(ctxt);\n257|        }\n258|        // 09-Jun-2020, tatu: semantics for `TryConvert` are bit interesting due to\n259|        //    historical reasons\n260|        return _deserializeFromEmptyStringDefault(ctxt);\n261|    }\n262|\n263|    /**\n264|     * @since 2.12\n265|     */\n266|    protected Object _deserializeFromEmptyStringDefault(DeserializationContext ctxt) throws IOException {\n267|        // by default, \"as-null\", but overridable by sub-classes\n268|        return getNullValue(ctxt);\n269|    }\n270|\n271|    /*\n272|    /**********************************************************\n273|    /* A general-purpose implementation\n274|    /**********************************************************\n275|     */\n276|\n277|    /**\n278|     * \"Chameleon\" deserializer that works on simple types that are deserialized\n...\n\n\n### src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java\n...\n245|            }\n246|        }\n247|        return (T) ctxt.handleUnexpectedToken(getValueType(ctxt), p);\n248|    }\n249|\n250|    /**\n251|     * Helper method to call in case deserializer does not support native automatic\n252|     * use of incoming String values, but there may be standard coercions to consider.\n253|     *\n254|     * @since 2.12\n255|     */\n256|    @SuppressWarnings(\"unchecked\")\n257|    protected T _deserializeFromString(JsonParser p, DeserializationContext ctxt)\n258|            throws IOException\n259|    {\n260|        final ValueInstantiator inst = getValueInstantiator();\n261|        final Class<?> rawTargetType = handledType();\n262|        String value = p.getValueAsString();\n263|\n264|        if ((inst != null) && inst.canCreateFromString()) {\n265|            return (T) inst.createFromString(ctxt, value);\n266|        }\n267|        if (value.isEmpty()) {\n268|            final CoercionAction act = ctxt.findCoercionAction(logicalType(), rawTargetType,\n269|                    CoercionInputShape.EmptyString);\n270|            return (T) _deserializeFromEmptyString(p, ctxt, act, rawTargetType,\n271|                    \"empty String (\\\"\\\")\");\n272|        }\n273|        if (_isBlank(value)) {\n274|            final CoercionAction act = ctxt.findCoercionFromBlankString(logicalType(), rawTargetType,\n275|                    CoercionAction.Fail);\n276|            return (T) _deserializeFromEmptyString(p, ctxt, act, rawTargetType,\n277|                    \"blank String (all whitespace)\");\n278|        }\n279|\n280|        // 28-Sep-2011, tatu: Ok this is not clean at all; but since there are legacy\n281|        //   systems that expect conversions in some cases, let's just add a minimal\n282|        //   patch (note: same could conceivably be used for numbers too).\n283|        if (inst != null) {\n284|            value = value.trim(); // mostly to avoid problems wrt XML indentation\n285|            if (inst.canCreateFromInt()) {\n286|                if (ctxt.findCoercionAction(LogicalType.Integer, Integer.class,\n287|                        CoercionInputShape.String) == CoercionAction.TryConvert) {\n288|                    return (T) inst.createFromInt(ctxt, _parseIntPrimitive(ctxt, value));\n289|                }\n290|            }\n291|            if (inst.canCreateFromLong()) {\n292|                if (ctxt.findCoercionAction(LogicalType.Integer, Long.class,\n293|                        CoercionInputShape.String) == CoercionAction.TryConvert) {\n294|                    return (T) inst.createFromLong(ctxt, _parseLongPrimitive(ctxt, value));\n295|                }\n296|            }\n297|            if (inst.canCreateFromBoolean()) {\n298|                // 29-May-2020, tatu: With 2.12 can and should use CoercionConfig so:\n299|                if (ctxt.findCoercionAction(LogicalType.Boolean, Boolean.class,\n300|                        CoercionInputShape.String) == CoercionAction.TryConvert) {\n301|                    String str = value.trim();\n302|                    if (\"true\".equals(str)) {\n303|                        return (T) inst.createFromBoolean(ctxt, true);\n304|                    }\n305|                    if (\"false\".equals(str)) {\n306|                        return (T) inst.createFromBoolean(ctxt, false);\n307|                    }\n308|                }\n309|            }\n310|        }\n311|        return (T) ctxt.handleMissingInstantiator(rawTargetType, inst, ctxt.getParser(),\n312|                \"no String-argument constructor/factory method to deserialize from String value ('%s')\",\n313|                value);\n314|    }\n315|\n316|    protected Object _deserializeFromEmptyString(JsonParser p, DeserializationContext ctxt,\n317|            CoercionAction act, Class<?> rawTargetType, String desc) throws IOException\n318|    {\n319|\n320|        switch (act) {\n321|        case AsEmpty:\n322|            return getEmptyValue(ctxt);\n323|        case Fail:\n324|            // This will throw an exception\n325|            _checkCoercionFail(ctxt, act, rawTargetType, \"\", \"empty String (\\\"\\\")\");\n326|            // ... so will never fall through\n327|        case TryConvert:\n328|            // hmmmh... empty or null, typically? Assume \"as null\" for now\n329|        case AsNull:\n330|        default:\n331|            return null;\n332|        }\n333|\n334|        // 06-Nov-2020, tatu: This was behavior pre-2.12, giving less useful\n335|        //    exception\n336|        /*\n337|        final ValueInstantiator inst = getValueInstantiator();\n338|\n339|        // 03-Jun-2020, tatu: Should ideally call `handleUnexpectedToken()` instead, but\n340|        //    since this call was already made, use it.\n341|        return ctxt.handleMissingInstantiator(rawTargetType, inst, p,\n342|\"Cannot deserialize value of type %s from %s (no String-argument constructor/factory method; coercion not enabled)\",\n343|                ClassUtil.getTypeDescription(getValueType(ctxt)), desc);\n344|                */\n345|    }\n346|\n347|    /**\n348|     * Helper called to support {@link DeserializationFeature#UNWRAP_SINGLE_VALUE_ARRAYS}:\n349|     * default implementation simply calls\n350|     * {@link #deserialize(JsonParser, DeserializationContext)},\n351|     * but handling may be overridden.\n352|     *\n353|     * @since 2.9\n354|     */\n...\n1490|    }\n1491|\n1492|    /*\n1493|    /****************************************************\n1494|    /* Helper methods for sub-classes, new (2.12+)\n1495|    /****************************************************\n1496|     */\n1497|\n1498|    /**\n1499|     * @since 2.12\n1500|     */\n1501|    protected CoercionAction _checkFromStringCoercion(DeserializationContext ctxt, String value)\n1502|        throws IOException\n1503|    {\n1504|        return _checkFromStringCoercion(ctxt, value, logicalType(), handledType());\n1505|    }\n1506|\n1507|    /**\n1508|     * @since 2.12\n1509|     */\n1510|    protected CoercionAction _checkFromStringCoercion(DeserializationContext ctxt, String value,\n1511|            LogicalType logicalType, Class<?> rawTargetType)\n1512|        throws IOException\n1513|    {\n1514|        // 18-Dec-2020, tatu: Formats without strong typing (XML, CSV, Properties at\n...\n2168|                }\n2169|            }\n2170|            return new NullsAsEmptyProvider(valueDeser);\n2171|        }\n2172|        if (nulls == Nulls.SKIP) {\n2173|            return NullsConstantProvider.skipper();\n2174|        }\n2175|        return null;\n2176|    }\n2177|\n2178|    // @since 2.12\n2179|    protected CoercionAction _findCoercionFromEmptyString(DeserializationContext ctxt) {\n2180|        return ctxt.findCoercionAction(logicalType(), handledType(),\n2181|                CoercionInputShape.EmptyString);\n2182|    }\n2183|\n2184|    // @since 2.12\n2185|    protected CoercionAction _findCoercionFromEmptyArray(DeserializationContext ctxt) {\n2186|        return ctxt.findCoercionAction(logicalType(), handledType(),\n2187|                CoercionInputShape.EmptyArray);\n2188|    }\n2189|\n2190|    // @since 2.12\n2191|    protected CoercionAction _findCoercionFromBlankString(DeserializationContext ctxt) {\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.java\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.java\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.java\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nfunction: FromStringDeserializer._deserializeFromEmptyStringDefault\n```",
          "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\nline: 231\nline: 236\nline: 241\nline: 243\nline: 245\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nline: 258\nline: 260\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nfunction: FromStringDeserializer._deserializeFromEmptyStringDefault\n```",
            "```\nsrc/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nfunction: CoercionConfigs.findCoercion\nline: 231\nline: 236\nline: 241\nline: 243\nline: 245\n\nsrc/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java\nfunction: FromStringDeserializer._deserializeFromEmptyString\nline: 258\nline: 260\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\nindex 80a292a..eccd1dc 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/cfg/CoercionConfigs.java\n@@ -229,6 +229,12 @@ public class CoercionConfigs\n         }\n \n         if (inputShape == CoercionInputShape.EmptyString) {\n+            // 09-Jun-2020, tatu: Support backwards-compatibility with 2.11 for\n+            // \"FromStringDeserializer\" supported types. For OtherScalar,\n+            // prefer TryConvert even if ACCEPT_EMPTY_STRING_AS_NULL_OBJECT is enabled.\n+            if (targetType == LogicalType.OtherScalar) {\n+                return CoercionAction.TryConvert;\n+            }\n             // Since coercion of scalar must be enabled (see check above), allow empty-string\n             // coercions by default even without this setting\n             if (baseScalar\n@@ -236,11 +242,6 @@ public class CoercionConfigs\n                     || config.isEnabled(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)) {\n                 return CoercionAction.AsNull;\n             }\n-            // 09-Jun-2020, tatu: Seems necessary to support backwards-compatibility with\n-            //     2.11, wrt \"FromStringDeserializer\" supported types\n-            if (targetType == LogicalType.OtherScalar) {\n-                return CoercionAction.TryConvert;\n-            }\n             // But block from allowing structured types like POJOs, Maps etc\n             return CoercionAction.Fail;\n         }\n",
  "7_resolved": true
}