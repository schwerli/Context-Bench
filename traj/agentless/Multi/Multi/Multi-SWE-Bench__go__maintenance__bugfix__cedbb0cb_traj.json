{
  "instance_id": "Multi-SWE-Bench__go__maintenance__bugfix__cedbb0cb",
  "original_id": "cli__cli-495",
  "1_model_selected_files": [
    "utils/table_printer.go",
    "command/pr.go",
    "utils/utils.go"
  ],
  "2_embedding_selected_files": [
    "command/pr.go",
    "command/pr_test.go",
    "command/pr_create_test.go",
    "command/pr_checkout_test.go",
    "command/pr_create.go",
    "command/pr_checkout.go",
    "command/issue_test.go",
    "command/issue.go",
    "command/root.go",
    "utils/table_printer.go",
    "command/root_test.go",
    "command/title_body_survey.go",
    "command/completion_test.go",
    "utils/prepare_cmd.go",
    "command/completion.go",
    "utils/utils.go",
    "utils/utils_test.go",
    "utils/color.go"
  ],
  "3_final_combined_files": [
    "command/pr.go",
    "utils/table_printer.go",
    "utils/utils.go",
    "command/pr_test.go",
    "command/pr_create_test.go"
  ],
  "4_related_elements": {
    "utils/table_printer.go": [
      "function: NewTablePrinter\nfunction: ttyTablePrinter.AddField\nfunction: ttyTablePrinter.Render\nfunction: truncate"
    ],
    "command/pr.go": [
      "function: prList\nfunction: truncate\nfunction: printPrs"
    ],
    "utils/utils.go": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "utils/table_printer.go": [
          "function: truncate\nline: 179\nfunction: (*ttyTablePrinter).Render\nline: 128"
        ],
        "command/pr.go": [
          "function: truncate\nline: 432"
        ],
        "utils/utils.go": [
          ""
        ]
      },
      "patches": [
        "diff --git a/command/pr.go b/command/pr.go\nindex 01ef5cf..c0bd9c6 100644\n--- a/command/pr.go\n+++ b/command/pr.go\n@@ -428,8 +428,14 @@ func printMessage(w io.Writer, s string) {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n-\t\treturn title[0:maxLength-3] + \"...\"\n+\t\tif maxLength <= 3 {\n+\t\t\treturn title[:maxLength]\n+\t\t}\n+\t\treturn title[:maxLength-3] + \"...\"\n \t}\n \treturn title\n }\n@@ -439,4 +445,4 @@ func replaceExcessiveWhitespace(s string) string {\n \ts = regexp.MustCompile(`\\r?\\n`).ReplaceAllString(s, \" \")\n \ts = regexp.MustCompile(`\\s{2,}`).ReplaceAllString(s, \" \")\n \treturn s\n-}\n+}\ndiff --git a/utils/table_printer.go b/utils/table_printer.go\nindex 38164c6..47a7fff 100644\n--- a/utils/table_printer.go\n+++ b/utils/table_printer.go\n@@ -175,8 +175,14 @@ func (t *tsvTablePrinter) Render() error {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n-\t\treturn title[0:maxLength-3] + \"...\"\n+\t\tif maxLength <= 3 {\n+\t\t\treturn title[:maxLength]\n+\t\t}\n+\t\treturn title[:maxLength-3] + \"...\"\n \t}\n \treturn title\n-}\n+}\n",
        "diff --git a/command/pr.go b/command/pr.go\nindex 01ef5cf..4b6e541 100644\n--- a/command/pr.go\n+++ b/command/pr.go\n@@ -428,8 +428,14 @@ func printMessage(w io.Writer, s string) {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n-\t\treturn title[0:maxLength-3] + \"...\"\n+\t\tif maxLength > 3 {\n+\t\t\treturn title[0:maxLength-3] + \"...\"\n+\t\t}\n+\t\treturn title[0:maxLength]\n \t}\n \treturn title\n }\n@@ -439,4 +445,4 @@ func replaceExcessiveWhitespace(s string) string {\n \ts = regexp.MustCompile(`\\r?\\n`).ReplaceAllString(s, \" \")\n \ts = regexp.MustCompile(`\\s{2,}`).ReplaceAllString(s, \" \")\n \treturn s\n-}\n+}\ndiff --git a/utils/table_printer.go b/utils/table_printer.go\nindex 38164c6..017ab02 100644\n--- a/utils/table_printer.go\n+++ b/utils/table_printer.go\n@@ -175,8 +175,16 @@ func (t *tsvTablePrinter) Render() error {\n }\n \n func truncate(maxLength int, title string) string {\n+\t// guard against non-positive widths\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n-\t\treturn title[0:maxLength-3] + \"...\"\n+\t\tif maxLength > 3 {\n+\t\t\treturn title[0:maxLength-3] + \"...\"\n+\t\t}\n+\t\t// width too small for ellipsis; hard truncate\n+\t\treturn title[0:maxLength]\n \t}\n \treturn title\n }\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nPanic running \"gh pr list at /home/runner/work/cli/cli/utils/table_printer.go:179\n### Describe the bug\r\n\r\nFrom within the directory for a cloned repo, I ran \"gh pr list\". The output successfully printed the organization and repo name, and then paniced\r\n\r\ngh --version                                                                                                                                                                             \r\ngh version 0.5.5 (2020-02-13)                                                                                                                                                                                                                  \r\nhttps://github.com/cli/cli/releases/tag/v0.5.5           \r\n\r\n### Steps to reproduce the behavior\r\n\r\n\"gh pr list\" issued against a private repo\r\n\r\n### Expected vs actual behavior\r\n\r\nI expected it not to panic :-)\r\n\r\n### Logs\r\n\r\n```\r\n$ gh pr list                                                                                                                                                                               \r\n                                                                                                                                                                                                                                               \r\nPull requests for Xeograph/xgsrc                                                                                                                                                                                                               \r\n                                                                                                                                                                                                                                               \r\n#9713  panic: runtime error: slice bounds out of range [:-7]                                                                                                                                                                                   \r\n                                                                                                                                                                                                                                               \r\ngoroutine 1 [running]:                                                                                                                                                                                                                         \r\ngithub.com/cli/cli/utils.truncate(0xfffffffffffffffc, 0xc00075a960, 0x22, 0x1, 0x1)                                                                                                                                                            \r\n    /home/runner/work/cli/cli/utils/table_printer.go:179 +0xa6                                                                                                                                                                                 \r\ngithub.com/cli/cli/utils.(*ttyTablePrinter).Render(0xc0005ae4e0, 0xc00057ad80, 0x16)                                                                                                                                                           \r\n    /home/runner/work/cli/cli/utils/table_printer.go:128 +0x339                                                                                                                                                                                \r\ngithub.com/cli/cli/command.prList(0x109bac0, 0x10cbb30, 0x0, 0x0, 0x0, 0x0)                                                                                                                                                                    \r\n    /home/runner/work/cli/cli/command/pr.go:221 +0x9f3                                                                                                                                                                                         \r\ngithub.com/spf13/cobra.(*Command).execute(0x109bac0, 0x10cbb30, 0x0, 0x0, 0x109bac0, 0x10cbb30)                                                                                                                                                \r\n    /home/runner/go/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:826 +0x460                                                                                                                                                                \r\ngithub.com/spf13/cobra.(*Command).ExecuteC(0x109a940, 0x5, 0x0, 0x0)                                                                                                                                                                           \r\n    /home/runner/go/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:914 +0x2fb                                                                                                                                                                \r\nmain.main()                                                                                                                                                                                                                                    \r\n    /home/runner/work/cli/cli/cmd/gh/main.go:33 +0xde      \r\n```\r\n\r\n\n\n###\n### utils/table_printer.go\n...\n11|\t\"github.com/mattn/go-isatty\"\n12|\t\"golang.org/x/crypto/ssh/terminal\"\n13|)\n14|\n15|type TablePrinter interface {\n16|\tIsTTY() bool\n17|\tAddField(string, func(int, string) string, func(string) string)\n18|\tEndRow()\n19|\tRender() error\n20|}\n21|\n22|func NewTablePrinter(w io.Writer) TablePrinter {\n23|\tif outFile, isFile := w.(*os.File); isFile {\n24|\t\tisCygwin := isatty.IsCygwinTerminal(outFile.Fd())\n25|\t\tif isatty.IsTerminal(outFile.Fd()) || isCygwin {\n26|\t\t\tttyWidth := 80\n27|\t\t\tif w, _, err := terminal.GetSize(int(outFile.Fd())); err == nil {\n28|\t\t\t\tttyWidth = w\n29|\t\t\t} else if isCygwin {\n30|\t\t\t\ttputCmd := exec.Command(\"tput\", \"cols\")\n31|\t\t\t\ttputCmd.Stdin = os.Stdin\n32|\t\t\t\tif out, err := tputCmd.Output(); err == nil {\n33|\t\t\t\t\tif w, err := strconv.Atoi(strings.TrimSpace(string(out))); err == nil {\n34|\t\t\t\t\t\tttyWidth = w\n35|\t\t\t\t\t}\n36|\t\t\t\t}\n37|\t\t\t}\n38|\t\t\treturn &ttyTablePrinter{\n39|\t\t\t\tout:      NewColorable(outFile),\n40|\t\t\t\tmaxWidth: ttyWidth,\n41|\t\t\t}\n42|\t\t}\n43|\t}\n44|\treturn &tsvTablePrinter{\n45|\t\tout: w,\n46|\t}\n47|}\n48|\n49|type tableField struct {\n50|\tText         string\n51|\tTruncateFunc func(int, string) string\n52|\tColorFunc    func(string) string\n53|}\n54|\n55|type ttyTablePrinter struct {\n56|\tout      io.Writer\n...\n166|}\n167|\n168|func (t *tsvTablePrinter) EndRow() {\n169|\tfmt.Fprint(t.out, \"\\n\")\n170|\tt.currentCol = 0\n171|}\n172|\n173|func (t *tsvTablePrinter) Render() error {\n174|\treturn nil\n175|}\n176|\n177|func truncate(maxLength int, title string) string {\n178|\tif len(title) > maxLength {\n179|\t\treturn title[0:maxLength-3] + \"...\"\n180|\t}\n181|\treturn title\n182|}\n\n\n### command/pr.go\n...\n115|\tprintHeader(out, \"Requesting a code review from you\")\n116|\tif prPayload.ReviewRequested.TotalCount > 0 {\n117|\t\tprintPrs(out, prPayload.ReviewRequested.TotalCount, prPayload.ReviewRequested.PullRequests...)\n118|\t} else {\n119|\t\tprintMessage(out, \"  You have no pull requests to review\")\n120|\t}\n121|\tfmt.Fprintln(out)\n122|\n123|\treturn nil\n124|}\n125|\n126|func prList(cmd *cobra.Command, args []string) error {\n127|\tctx := contextForCommand(cmd)\n128|\tapiClient, err := apiClientForContext(ctx)\n129|\tif err != nil {\n130|\t\treturn err\n131|\t}\n132|\n133|\tbaseRepo, err := determineBaseRepo(cmd, ctx)\n134|\tif err != nil {\n135|\t\treturn err\n136|\t}\n137|\n138|\tfmt.Fprintf(colorableErr(cmd), \"\\nPull requests for %s\\n\\n\", ghrepo.FullName(*baseRepo))\n139|\n140|\tlimit, err := cmd.Flags().GetInt(\"limit\")\n141|\tif err != nil {\n142|\t\treturn err\n143|\t}\n144|\tstate, err := cmd.Flags().GetString(\"state\")\n145|\tif err != nil {\n146|\t\treturn err\n147|\t}\n148|\tbaseBranch, err := cmd.Flags().GetString(\"base\")\n149|\tif err != nil {\n150|\t\treturn err\n151|\t}\n152|\tlabels, err := cmd.Flags().GetStringSlice(\"label\")\n153|\tif err != nil {\n154|\t\treturn err\n155|\t}\n156|\tassignee, err := cmd.Flags().GetString(\"assignee\")\n157|\tif err != nil {\n158|\t\treturn err\n159|\t}\n160|\n161|\tvar graphqlState []string\n162|\tswitch state {\n163|\tcase \"open\":\n164|\t\tgraphqlState = []string{\"OPEN\"}\n165|\tcase \"closed\":\n166|\t\tgraphqlState = []string{\"CLOSED\"}\n167|\tcase \"merged\":\n168|\t\tgraphqlState = []string{\"MERGED\"}\n169|\tcase \"all\":\n170|\t\tgraphqlState = []string{\"OPEN\", \"CLOSED\", \"MERGED\"}\n171|\tdefault:\n172|\t\treturn fmt.Errorf(\"invalid state: %s\", state)\n173|\t}\n174|\n175|\tparams := map[string]interface{}{\n176|\t\t\"owner\": (*baseRepo).RepoOwner(),\n177|\t\t\"repo\":  (*baseRepo).RepoName(),\n178|\t\t\"state\": graphqlState,\n179|\t}\n180|\tif len(labels) > 0 {\n181|\t\tparams[\"labels\"] = labels\n182|\t}\n183|\tif baseBranch != \"\" {\n184|\t\tparams[\"baseBranch\"] = baseBranch\n185|\t}\n186|\tif assignee != \"\" {\n187|\t\tparams[\"assignee\"] = assignee\n188|\t}\n189|\n190|\tprs, err := api.PullRequestList(apiClient, params, limit)\n191|\tif err != nil {\n192|\t\treturn err\n193|\t}\n194|\n195|\tif len(prs) == 0 {\n196|\t\tcolorErr := colorableErr(cmd) // Send to stderr because otherwise when piping this command it would seem like the \"no open prs\" message is actually a pr\n197|\t\tmsg := \"There are no open pull requests\"\n198|\n199|\t\tuserSetFlags := false\n200|\t\tcmd.Flags().Visit(func(f *pflag.Flag) {\n201|\t\t\tuserSetFlags = true\n202|\t\t})\n203|\t\tif userSetFlags {\n204|\t\t\tmsg = \"No pull requests match your search\"\n205|\t\t}\n206|\t\tprintMessage(colorErr, msg)\n207|\t\treturn nil\n208|\t}\n209|\n210|\ttable := utils.NewTablePrinter(cmd.OutOrStdout())\n211|\tfor _, pr := range prs {\n212|\t\tprNum := strconv.Itoa(pr.Number)\n213|\t\tif table.IsTTY() {\n214|\t\t\tprNum = \"#\" + prNum\n215|\t\t}\n216|\t\ttable.AddField(prNum, nil, colorFuncForState(pr.State))\n217|\t\ttable.AddField(replaceExcessiveWhitespace(pr.Title), nil, nil)\n218|\t\ttable.AddField(pr.HeadLabel(), nil, utils.Cyan)\n219|\t\ttable.EndRow()\n220|\t}\n221|\terr = table.Render()\n222|\tif err != nil {\n223|\t\treturn err\n224|\t}\n225|\n226|\treturn nil\n227|}\n228|\n229|func colorFuncForState(state string) func(string) string {\n230|\tswitch state {\n231|\tcase \"OPEN\":\n232|\t\treturn utils.Green\n233|\tcase \"CLOSED\":\n234|\t\treturn utils.Red\n235|\tcase \"MERGED\":\n236|\t\treturn utils.Magenta\n...\n368|\t\t\tprHeadRef = strings.TrimPrefix(branchConfig.MergeRef, \"refs/heads/\")\n369|\t\t}\n370|\t\t// prepend `OWNER:` if this branch is pushed to a fork\n371|\t\tif !strings.EqualFold(branchOwner, baseRepo.RepoOwner()) {\n372|\t\t\tprHeadRef = fmt.Sprintf(\"%s:%s\", branchOwner, prHeadRef)\n373|\t\t}\n374|\t}\n375|\n376|\treturn\n377|}\n378|\n379|func printPrs(w io.Writer, totalCount int, prs ...api.PullRequest) {\n380|\tfor _, pr := range prs {\n381|\t\tprNumber := fmt.Sprintf(\"#%d\", pr.Number)\n382|\t\tfmt.Fprintf(w, \"  %s  %s %s\", utils.Green(prNumber), truncate(50, replaceExcessiveWhitespace(pr.Title)), utils.Cyan(\"[\"+pr.HeadLabel()+\"]\"))\n383|\n384|\t\tchecks := pr.ChecksStatus()\n385|\t\treviews := pr.ReviewStatus()\n386|\t\tif checks.Total > 0 || reviews.ChangesRequested || reviews.Approved {\n387|\t\t\tfmt.Fprintf(w, \"\\n  \")\n388|\t\t}\n389|\n390|\t\tif checks.Total > 0 {\n391|\t\t\tvar summary string\n392|\t\t\tif checks.Failing > 0 {\n393|\t\t\t\tif checks.Failing == checks.Total {\n394|\t\t\t\t\tsummary = utils.Red(\"All checks failing\")\n395|\t\t\t\t} else {\n396|\t\t\t\t\tsummary = utils.Red(fmt.Sprintf(\"%d/%d checks failing\", checks.Failing, checks.Total))\n397|\t\t\t\t}\n398|\t\t\t} else if checks.Pending > 0 {\n399|\t\t\t\tsummary = utils.Yellow(\"Checks pending\")\n400|\t\t\t} else if checks.Passing == checks.Total {\n401|\t\t\t\tsummary = utils.Green(\"Checks passing\")\n402|\t\t\t}\n403|\t\t\tfmt.Fprintf(w, \" - %s\", summary)\n404|\t\t}\n405|\n406|\t\tif reviews.ChangesRequested {\n407|\t\t\tfmt.Fprintf(w, \" - %s\", utils.Red(\"Changes requested\"))\n408|\t\t} else if reviews.ReviewRequired {\n409|\t\t\tfmt.Fprintf(w, \" - %s\", utils.Yellow(\"Review required\"))\n410|\t\t} else if reviews.Approved {\n411|\t\t\tfmt.Fprintf(w, \" - %s\", utils.Green(\"Approved\"))\n412|\t\t}\n413|\n414|\t\tfmt.Fprint(w, \"\\n\")\n415|\t}\n416|\tremaining := totalCount - len(prs)\n417|\tif remaining > 0 {\n418|\t\tfmt.Fprintf(w, utils.Gray(\"  And %d more\\n\"), remaining)\n419|\t}\n420|}\n421|\n422|func printHeader(w io.Writer, s string) {\n423|\tfmt.Fprintln(w, utils.Bold(s))\n424|}\n425|\n426|func printMessage(w io.Writer, s string) {\n427|\tfmt.Fprintln(w, utils.Gray(s))\n428|}\n429|\n430|func truncate(maxLength int, title string) string {\n431|\tif len(title) > maxLength {\n432|\t\treturn title[0:maxLength-3] + \"...\"\n433|\t}\n434|\treturn title\n435|}\n436|\n437|func replaceExcessiveWhitespace(s string) string {\n438|\ts = strings.TrimSpace(s)\n439|\ts = regexp.MustCompile(`\\r?\\n`).ReplaceAllString(s, \" \")\n440|\ts = regexp.MustCompile(`\\s{2,}`).ReplaceAllString(s, \" \")\n441|\treturn s\n442|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\nutils/table_printer.go\nfunction: (*ttyTablePrinter).Render\nline: 128\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```",
          "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\nutils/table_printer.go\nfunction: (*ttyTablePrinter).Render\nline: 128\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```",
            "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "utils/table_printer.go": [
          "function: truncate\nline: 179"
        ],
        "command/pr.go": [
          "function: truncate\nline: 432"
        ],
        "utils/utils.go": [
          ""
        ]
      },
      "patches": [
        "diff --git a/command/pr.go b/command/pr.go\nindex 01ef5cf..7a02fc1 100644\n--- a/command/pr.go\n+++ b/command/pr.go\n@@ -428,7 +428,13 @@ func printMessage(w io.Writer, s string) {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n+\t\tif maxLength <= 3 {\n+\t\t\treturn title[0:maxLength]\n+\t\t}\n \t\treturn title[0:maxLength-3] + \"...\"\n \t}\n \treturn title\n@@ -439,4 +445,4 @@ func replaceExcessiveWhitespace(s string) string {\n \ts = regexp.MustCompile(`\\r?\\n`).ReplaceAllString(s, \" \")\n \ts = regexp.MustCompile(`\\s{2,}`).ReplaceAllString(s, \" \")\n \treturn s\n-}\n+}\ndiff --git a/utils/table_printer.go b/utils/table_printer.go\nindex 38164c6..34ee692 100644\n--- a/utils/table_printer.go\n+++ b/utils/table_printer.go\n@@ -175,8 +175,14 @@ func (t *tsvTablePrinter) Render() error {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n+\t\tif maxLength <= 3 {\n+\t\t\treturn title[0:maxLength]\n+\t\t}\n \t\treturn title[0:maxLength-3] + \"...\"\n \t}\n \treturn title\n-}\n+}\n",
        "diff --git a/command/pr.go b/command/pr.go\nindex 01ef5cf..1603bef 100644\n--- a/command/pr.go\n+++ b/command/pr.go\n@@ -428,7 +428,14 @@ func printMessage(w io.Writer, s string) {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n+\t\tif maxLength <= 3 {\n+\t\t\t// Not enough room to append \"...\" without exceeding maxLength\n+\t\t\treturn title[0:maxLength]\n+\t\t}\n \t\treturn title[0:maxLength-3] + \"...\"\n \t}\n \treturn title\n@@ -439,4 +446,4 @@ func replaceExcessiveWhitespace(s string) string {\n \ts = regexp.MustCompile(`\\r?\\n`).ReplaceAllString(s, \" \")\n \ts = regexp.MustCompile(`\\s{2,}`).ReplaceAllString(s, \" \")\n \treturn s\n-}\n+}\ndiff --git a/utils/table_printer.go b/utils/table_printer.go\nindex 38164c6..e07b4c8 100644\n--- a/utils/table_printer.go\n+++ b/utils/table_printer.go\n@@ -175,7 +175,14 @@ func (t *tsvTablePrinter) Render() error {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n+\t\tif maxLength <= 3 {\n+\t\t\t// Not enough room to append \"...\" without exceeding maxLength\n+\t\t\treturn title[0:maxLength]\n+\t\t}\n \t\treturn title[0:maxLength-3] + \"...\"\n \t}\n \treturn title\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nPanic running \"gh pr list at /home/runner/work/cli/cli/utils/table_printer.go:179\n### Describe the bug\r\n\r\nFrom within the directory for a cloned repo, I ran \"gh pr list\". The output successfully printed the organization and repo name, and then paniced\r\n\r\ngh --version                                                                                                                                                                             \r\ngh version 0.5.5 (2020-02-13)                                                                                                                                                                                                                  \r\nhttps://github.com/cli/cli/releases/tag/v0.5.5           \r\n\r\n### Steps to reproduce the behavior\r\n\r\n\"gh pr list\" issued against a private repo\r\n\r\n### Expected vs actual behavior\r\n\r\nI expected it not to panic :-)\r\n\r\n### Logs\r\n\r\n```\r\n$ gh pr list                                                                                                                                                                               \r\n                                                                                                                                                                                                                                               \r\nPull requests for Xeograph/xgsrc                                                                                                                                                                                                               \r\n                                                                                                                                                                                                                                               \r\n#9713  panic: runtime error: slice bounds out of range [:-7]                                                                                                                                                                                   \r\n                                                                                                                                                                                                                                               \r\ngoroutine 1 [running]:                                                                                                                                                                                                                         \r\ngithub.com/cli/cli/utils.truncate(0xfffffffffffffffc, 0xc00075a960, 0x22, 0x1, 0x1)                                                                                                                                                            \r\n    /home/runner/work/cli/cli/utils/table_printer.go:179 +0xa6                                                                                                                                                                                 \r\ngithub.com/cli/cli/utils.(*ttyTablePrinter).Render(0xc0005ae4e0, 0xc00057ad80, 0x16)                                                                                                                                                           \r\n    /home/runner/work/cli/cli/utils/table_printer.go:128 +0x339                                                                                                                                                                                \r\ngithub.com/cli/cli/command.prList(0x109bac0, 0x10cbb30, 0x0, 0x0, 0x0, 0x0)                                                                                                                                                                    \r\n    /home/runner/work/cli/cli/command/pr.go:221 +0x9f3                                                                                                                                                                                         \r\ngithub.com/spf13/cobra.(*Command).execute(0x109bac0, 0x10cbb30, 0x0, 0x0, 0x109bac0, 0x10cbb30)                                                                                                                                                \r\n    /home/runner/go/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:826 +0x460                                                                                                                                                                \r\ngithub.com/spf13/cobra.(*Command).ExecuteC(0x109a940, 0x5, 0x0, 0x0)                                                                                                                                                                           \r\n    /home/runner/go/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:914 +0x2fb                                                                                                                                                                \r\nmain.main()                                                                                                                                                                                                                                    \r\n    /home/runner/work/cli/cli/cmd/gh/main.go:33 +0xde      \r\n```\r\n\r\n\n\n###\n### utils/table_printer.go\n...\n11|\t\"github.com/mattn/go-isatty\"\n12|\t\"golang.org/x/crypto/ssh/terminal\"\n13|)\n14|\n15|type TablePrinter interface {\n16|\tIsTTY() bool\n17|\tAddField(string, func(int, string) string, func(string) string)\n18|\tEndRow()\n19|\tRender() error\n20|}\n21|\n22|func NewTablePrinter(w io.Writer) TablePrinter {\n23|\tif outFile, isFile := w.(*os.File); isFile {\n24|\t\tisCygwin := isatty.IsCygwinTerminal(outFile.Fd())\n25|\t\tif isatty.IsTerminal(outFile.Fd()) || isCygwin {\n26|\t\t\tttyWidth := 80\n27|\t\t\tif w, _, err := terminal.GetSize(int(outFile.Fd())); err == nil {\n28|\t\t\t\tttyWidth = w\n29|\t\t\t} else if isCygwin {\n30|\t\t\t\ttputCmd := exec.Command(\"tput\", \"cols\")\n31|\t\t\t\ttputCmd.Stdin = os.Stdin\n32|\t\t\t\tif out, err := tputCmd.Output(); err == nil {\n33|\t\t\t\t\tif w, err := strconv.Atoi(strings.TrimSpace(string(out))); err == nil {\n34|\t\t\t\t\t\tttyWidth = w\n35|\t\t\t\t\t}\n36|\t\t\t\t}\n37|\t\t\t}\n38|\t\t\treturn &ttyTablePrinter{\n39|\t\t\t\tout:      NewColorable(outFile),\n40|\t\t\t\tmaxWidth: ttyWidth,\n41|\t\t\t}\n42|\t\t}\n43|\t}\n44|\treturn &tsvTablePrinter{\n45|\t\tout: w,\n46|\t}\n47|}\n48|\n49|type tableField struct {\n50|\tText         string\n51|\tTruncateFunc func(int, string) string\n52|\tColorFunc    func(string) string\n53|}\n54|\n55|type ttyTablePrinter struct {\n56|\tout      io.Writer\n...\n166|}\n167|\n168|func (t *tsvTablePrinter) EndRow() {\n169|\tfmt.Fprint(t.out, \"\\n\")\n170|\tt.currentCol = 0\n171|}\n172|\n173|func (t *tsvTablePrinter) Render() error {\n174|\treturn nil\n175|}\n176|\n177|func truncate(maxLength int, title string) string {\n178|\tif len(title) > maxLength {\n179|\t\treturn title[0:maxLength-3] + \"...\"\n180|\t}\n181|\treturn title\n182|}\n\n\n### command/pr.go\n...\n115|\tprintHeader(out, \"Requesting a code review from you\")\n116|\tif prPayload.ReviewRequested.TotalCount > 0 {\n117|\t\tprintPrs(out, prPayload.ReviewRequested.TotalCount, prPayload.ReviewRequested.PullRequests...)\n118|\t} else {\n119|\t\tprintMessage(out, \"  You have no pull requests to review\")\n120|\t}\n121|\tfmt.Fprintln(out)\n122|\n123|\treturn nil\n124|}\n125|\n126|func prList(cmd *cobra.Command, args []string) error {\n127|\tctx := contextForCommand(cmd)\n128|\tapiClient, err := apiClientForContext(ctx)\n129|\tif err != nil {\n130|\t\treturn err\n131|\t}\n132|\n133|\tbaseRepo, err := determineBaseRepo(cmd, ctx)\n134|\tif err != nil {\n135|\t\treturn err\n136|\t}\n137|\n138|\tfmt.Fprintf(colorableErr(cmd), \"\\nPull requests for %s\\n\\n\", ghrepo.FullName(*baseRepo))\n139|\n140|\tlimit, err := cmd.Flags().GetInt(\"limit\")\n141|\tif err != nil {\n142|\t\treturn err\n143|\t}\n144|\tstate, err := cmd.Flags().GetString(\"state\")\n145|\tif err != nil {\n146|\t\treturn err\n147|\t}\n148|\tbaseBranch, err := cmd.Flags().GetString(\"base\")\n149|\tif err != nil {\n150|\t\treturn err\n151|\t}\n152|\tlabels, err := cmd.Flags().GetStringSlice(\"label\")\n153|\tif err != nil {\n154|\t\treturn err\n155|\t}\n156|\tassignee, err := cmd.Flags().GetString(\"assignee\")\n157|\tif err != nil {\n158|\t\treturn err\n159|\t}\n160|\n161|\tvar graphqlState []string\n162|\tswitch state {\n163|\tcase \"open\":\n164|\t\tgraphqlState = []string{\"OPEN\"}\n165|\tcase \"closed\":\n166|\t\tgraphqlState = []string{\"CLOSED\"}\n167|\tcase \"merged\":\n168|\t\tgraphqlState = []string{\"MERGED\"}\n169|\tcase \"all\":\n170|\t\tgraphqlState = []string{\"OPEN\", \"CLOSED\", \"MERGED\"}\n171|\tdefault:\n172|\t\treturn fmt.Errorf(\"invalid state: %s\", state)\n173|\t}\n174|\n175|\tparams := map[string]interface{}{\n176|\t\t\"owner\": (*baseRepo).RepoOwner(),\n177|\t\t\"repo\":  (*baseRepo).RepoName(),\n178|\t\t\"state\": graphqlState,\n179|\t}\n180|\tif len(labels) > 0 {\n181|\t\tparams[\"labels\"] = labels\n182|\t}\n183|\tif baseBranch != \"\" {\n184|\t\tparams[\"baseBranch\"] = baseBranch\n185|\t}\n186|\tif assignee != \"\" {\n187|\t\tparams[\"assignee\"] = assignee\n188|\t}\n189|\n190|\tprs, err := api.PullRequestList(apiClient, params, limit)\n191|\tif err != nil {\n192|\t\treturn err\n193|\t}\n194|\n195|\tif len(prs) == 0 {\n196|\t\tcolorErr := colorableErr(cmd) // Send to stderr because otherwise when piping this command it would seem like the \"no open prs\" message is actually a pr\n197|\t\tmsg := \"There are no open pull requests\"\n198|\n199|\t\tuserSetFlags := false\n200|\t\tcmd.Flags().Visit(func(f *pflag.Flag) {\n201|\t\t\tuserSetFlags = true\n202|\t\t})\n203|\t\tif userSetFlags {\n204|\t\t\tmsg = \"No pull requests match your search\"\n205|\t\t}\n206|\t\tprintMessage(colorErr, msg)\n207|\t\treturn nil\n208|\t}\n209|\n210|\ttable := utils.NewTablePrinter(cmd.OutOrStdout())\n211|\tfor _, pr := range prs {\n212|\t\tprNum := strconv.Itoa(pr.Number)\n213|\t\tif table.IsTTY() {\n214|\t\t\tprNum = \"#\" + prNum\n215|\t\t}\n216|\t\ttable.AddField(prNum, nil, colorFuncForState(pr.State))\n217|\t\ttable.AddField(replaceExcessiveWhitespace(pr.Title), nil, nil)\n218|\t\ttable.AddField(pr.HeadLabel(), nil, utils.Cyan)\n219|\t\ttable.EndRow()\n220|\t}\n221|\terr = table.Render()\n222|\tif err != nil {\n223|\t\treturn err\n224|\t}\n225|\n226|\treturn nil\n227|}\n228|\n229|func colorFuncForState(state string) func(string) string {\n230|\tswitch state {\n231|\tcase \"OPEN\":\n232|\t\treturn utils.Green\n233|\tcase \"CLOSED\":\n234|\t\treturn utils.Red\n235|\tcase \"MERGED\":\n236|\t\treturn utils.Magenta\n...\n368|\t\t\tprHeadRef = strings.TrimPrefix(branchConfig.MergeRef, \"refs/heads/\")\n369|\t\t}\n370|\t\t// prepend `OWNER:` if this branch is pushed to a fork\n371|\t\tif !strings.EqualFold(branchOwner, baseRepo.RepoOwner()) {\n372|\t\t\tprHeadRef = fmt.Sprintf(\"%s:%s\", branchOwner, prHeadRef)\n373|\t\t}\n374|\t}\n375|\n376|\treturn\n377|}\n378|\n379|func printPrs(w io.Writer, totalCount int, prs ...api.PullRequest) {\n380|\tfor _, pr := range prs {\n381|\t\tprNumber := fmt.Sprintf(\"#%d\", pr.Number)\n382|\t\tfmt.Fprintf(w, \"  %s  %s %s\", utils.Green(prNumber), truncate(50, replaceExcessiveWhitespace(pr.Title)), utils.Cyan(\"[\"+pr.HeadLabel()+\"]\"))\n383|\n384|\t\tchecks := pr.ChecksStatus()\n385|\t\treviews := pr.ReviewStatus()\n386|\t\tif checks.Total > 0 || reviews.ChangesRequested || reviews.Approved {\n387|\t\t\tfmt.Fprintf(w, \"\\n  \")\n388|\t\t}\n389|\n390|\t\tif checks.Total > 0 {\n391|\t\t\tvar summary string\n392|\t\t\tif checks.Failing > 0 {\n393|\t\t\t\tif checks.Failing == checks.Total {\n394|\t\t\t\t\tsummary = utils.Red(\"All checks failing\")\n395|\t\t\t\t} else {\n396|\t\t\t\t\tsummary = utils.Red(fmt.Sprintf(\"%d/%d checks failing\", checks.Failing, checks.Total))\n397|\t\t\t\t}\n398|\t\t\t} else if checks.Pending > 0 {\n399|\t\t\t\tsummary = utils.Yellow(\"Checks pending\")\n400|\t\t\t} else if checks.Passing == checks.Total {\n401|\t\t\t\tsummary = utils.Green(\"Checks passing\")\n402|\t\t\t}\n403|\t\t\tfmt.Fprintf(w, \" - %s\", summary)\n404|\t\t}\n405|\n406|\t\tif reviews.ChangesRequested {\n407|\t\t\tfmt.Fprintf(w, \" - %s\", utils.Red(\"Changes requested\"))\n408|\t\t} else if reviews.ReviewRequired {\n409|\t\t\tfmt.Fprintf(w, \" - %s\", utils.Yellow(\"Review required\"))\n410|\t\t} else if reviews.Approved {\n411|\t\t\tfmt.Fprintf(w, \" - %s\", utils.Green(\"Approved\"))\n412|\t\t}\n413|\n414|\t\tfmt.Fprint(w, \"\\n\")\n415|\t}\n416|\tremaining := totalCount - len(prs)\n417|\tif remaining > 0 {\n418|\t\tfmt.Fprintf(w, utils.Gray(\"  And %d more\\n\"), remaining)\n419|\t}\n420|}\n421|\n422|func printHeader(w io.Writer, s string) {\n423|\tfmt.Fprintln(w, utils.Bold(s))\n424|}\n425|\n426|func printMessage(w io.Writer, s string) {\n427|\tfmt.Fprintln(w, utils.Gray(s))\n428|}\n429|\n430|func truncate(maxLength int, title string) string {\n431|\tif len(title) > maxLength {\n432|\t\treturn title[0:maxLength-3] + \"...\"\n433|\t}\n434|\treturn title\n435|}\n436|\n437|func replaceExcessiveWhitespace(s string) string {\n438|\ts = strings.TrimSpace(s)\n439|\ts = regexp.MustCompile(`\\r?\\n`).ReplaceAllString(s, \" \")\n440|\ts = regexp.MustCompile(`\\s{2,}`).ReplaceAllString(s, \" \")\n441|\treturn s\n442|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\nutils/table_printer.go\nfunction: (*ttyTablePrinter).Render\nline: 128\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```",
          "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\nutils/table_printer.go\nfunction: (*ttyTablePrinter).Render\nline: 128\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```",
            "```\nutils/table_printer.go\nfunction: truncate\nline: 179\n\ncommand/pr.go\nfunction: truncate\nline: 432\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/command/pr.go b/command/pr.go\nindex 01ef5cf..4b6e541 100644\n--- a/command/pr.go\n+++ b/command/pr.go\n@@ -428,8 +428,14 @@ func printMessage(w io.Writer, s string) {\n }\n \n func truncate(maxLength int, title string) string {\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n-\t\treturn title[0:maxLength-3] + \"...\"\n+\t\tif maxLength > 3 {\n+\t\t\treturn title[0:maxLength-3] + \"...\"\n+\t\t}\n+\t\treturn title[0:maxLength]\n \t}\n \treturn title\n }\n@@ -439,4 +445,4 @@ func replaceExcessiveWhitespace(s string) string {\n \ts = regexp.MustCompile(`\\r?\\n`).ReplaceAllString(s, \" \")\n \ts = regexp.MustCompile(`\\s{2,}`).ReplaceAllString(s, \" \")\n \treturn s\n-}\n+}\ndiff --git a/utils/table_printer.go b/utils/table_printer.go\nindex 38164c6..017ab02 100644\n--- a/utils/table_printer.go\n+++ b/utils/table_printer.go\n@@ -175,8 +175,16 @@ func (t *tsvTablePrinter) Render() error {\n }\n \n func truncate(maxLength int, title string) string {\n+\t// guard against non-positive widths\n+\tif maxLength <= 0 {\n+\t\treturn \"\"\n+\t}\n \tif len(title) > maxLength {\n-\t\treturn title[0:maxLength-3] + \"...\"\n+\t\tif maxLength > 3 {\n+\t\t\treturn title[0:maxLength-3] + \"...\"\n+\t\t}\n+\t\t// width too small for ellipsis; hard truncate\n+\t\treturn title[0:maxLength]\n \t}\n \treturn title\n }\n",
  "7_resolved": true
}