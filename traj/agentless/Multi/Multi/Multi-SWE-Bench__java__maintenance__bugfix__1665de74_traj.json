{
  "instance_id": "Multi-SWE-Bench__java__maintenance__bugfix__1665de74",
  "original_id": "mockito__mockito-3220",
  "1_model_selected_files": [
    "src/main/java/org/mockito/Mockito.java",
    "src/main/java/org/mockito/internal/MockedStaticImpl.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/InlineByteBuddyMockMaker.java",
    "src/main/java/org/mockito/internal/util/MockCreationValidator.java"
  ],
  "2_embedding_selected_files": [
    "src/main/java/org/mockito/plugins/DoNotMockEnforcer.java",
    "src/main/java/org/mockito/internal/configuration/DefaultDoNotMockEnforcer.java",
    "src/main/java/org/mockito/DoNotMock.java",
    "src/main/java/org/mockito/internal/MockitoCore.java",
    "src/main/java/org/mockito/internal/MockedStaticImpl.java",
    "src/main/java/org/mockito/MockedStatic.java",
    "src/main/java/org/mockito/Mockito.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/InlineDelegateByteBuddyMockMaker.java",
    "src/main/java/org/mockito/internal/configuration/MockAnnotationProcessor.java",
    "src/main/java/org/mockito/NotExtensible.java",
    "src/main/java/org/mockito/Mock.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/InlineBytecodeGenerator.java",
    "src/main/java/org/mockito/plugins/MockMaker.java",
    "src/main/java/org/mockito/internal/SuppressSignatureCheck.java",
    "src/main/java/org/mockito/internal/creation/MockSettingsImpl.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/MockMethodInterceptor.java",
    "src/main/java/org/mockito/internal/package-info.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/SubclassByteBuddyMockMaker.java",
    "src/main/java/org/mockito/internal/util/MockUtil.java",
    "src/main/java/org/mockito/internal/configuration/SpyAnnotationEngine.java",
    "src/main/java/org/mockito/internal/configuration/injection/filter/OngoingInjector.java",
    "src/main/java/org/mockito/internal/util/MockCreationValidator.java",
    "src/main/java/org/mockito/MockSettings.java",
    "src/main/java/org/mockito/package-info.java",
    "src/main/java/org/mockito/internal/util/KotlinInlineClassUtil.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/StackWalkerChecker.java",
    "src/main/java/org/mockito/internal/creation/package-info.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/ClassCreatingMockMaker.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/InlineByteBuddyMockMaker.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/StackTraceChecker.java",
    "src/main/java/org/mockito/internal/configuration/injection/MockInjection.java",
    "src/main/java/org/mockito/MockitoAnnotations.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/MockAccess.java",
    "src/main/java/org/mockito/internal/configuration/injection/SpyOnInjectedFieldsHandler.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/SubclassBytecodeGenerator.java",
    "src/main/java/org/mockito/internal/util/DefaultMockingDetails.java",
    "src/main/java/org/mockito/plugins/InlineMockMaker.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/TypeSupport.java",
    "src/main/java/org/mockito/BDDMockito.java",
    "src/main/java/org/mockito/internal/configuration/injection/filter/TypeBasedCandidateFilter.java",
    "src/main/java/org/mockito/internal/configuration/IndependentAnnotationEngine.java"
  ],
  "3_final_combined_files": [
    "src/main/java/org/mockito/Mockito.java",
    "src/main/java/org/mockito/internal/MockedStaticImpl.java",
    "src/main/java/org/mockito/internal/creation/bytebuddy/InlineByteBuddyMockMaker.java",
    "src/main/java/org/mockito/plugins/DoNotMockEnforcer.java",
    "src/main/java/org/mockito/internal/configuration/DefaultDoNotMockEnforcer.java",
    "src/main/java/org/mockito/DoNotMock.java"
  ],
  "4_related_elements": {
    "src/main/java/org/mockito/Mockito.java": [
      ""
    ],
    "src/main/java/org/mockito/internal/MockedStaticImpl.java": [
      ""
    ],
    "src/main/java/org/mockito/internal/creation/bytebuddy/InlineByteBuddyMockMaker.java": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "src/main/java/org/mockito/Mockito.java": [
          "function: Mockito.mockStatic"
        ],
        "src/main/java/org/mockito/internal/MockedStaticImpl.java": [
          ""
        ],
        "src/main/java/org/mockito/internal/creation/bytebuddy/InlineByteBuddyMockMaker.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/src/main/java/org/mockito/Mockito.java b/src/main/java/org/mockito/Mockito.java\nindex 0249451..41a61e5 100644\n--- a/src/main/java/org/mockito/Mockito.java\n+++ b/src/main/java/org/mockito/Mockito.java\n@@ -2262,6 +2262,21 @@ public class Mockito extends ArgumentMatchers {\n      * @return mock controller\n      */\n     public static <T> MockedStatic<T> mockStatic(Class<T> classToMock) {\n+        // Enforce @DoNotMock for static mocks as well\n+        org.mockito.DoNotMock doNotMock = classToMock.getAnnotation(org.mockito.DoNotMock.class);\n+        if (doNotMock != null) {\n+            String reason = \"\";\n+            try {\n+                reason = doNotMock.reason();\n+            } catch (Throwable ignored) {\n+                // In case the annotation does not expose a 'reason' member in older versions\n+            }\n+            String message = \"Cannot mock static methods of \" + classToMock.getName() + \" because it is annotated with @DoNotMock.\";\n+            if (reason != null && !reason.isEmpty()) {\n+                message += \" Reason: \" + reason;\n+            }\n+            throw new org.mockito.exceptions.base.MockitoException(message);\n+        }\n         return mockStatic(classToMock, withSettings());\n     }\n \n",
        "diff --git a/src/main/java/org/mockito/Mockito.java b/src/main/java/org/mockito/Mockito.java\nindex 0249451..aa7fc36 100644\n--- a/src/main/java/org/mockito/Mockito.java\n+++ b/src/main/java/org/mockito/Mockito.java\n@@ -2262,6 +2262,11 @@ public class Mockito extends ArgumentMatchers {\n      * @return mock controller\n      */\n     public static <T> MockedStatic<T> mockStatic(Class<T> classToMock) {\n+        // Enforce @DoNotMock for static mocking as well\n+        if (classToMock.isAnnotationPresent(org.mockito.DoNotMock.class)) {\n+            throw new org.mockito.exceptions.base.MockitoException(\n+                    \"Type \" + classToMock.getName() + \" is annotated with @DoNotMock and cannot be mocked via mockStatic().\");\n+        }\n         return mockStatic(classToMock, withSettings());\n     }\n \n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "src/main/java/org/mockito/Mockito.java": [
          "function: Mockito.mockStatic\nfunction: Mockito.mockStatic"
        ],
        "src/main/java/org/mockito/internal/MockedStaticImpl.java": [
          ""
        ],
        "src/main/java/org/mockito/internal/creation/bytebuddy/InlineByteBuddyMockMaker.java": [
          ""
        ]
      },
      "patches": [
        "diff --git a/src/main/java/org/mockito/Mockito.java b/src/main/java/org/mockito/Mockito.java\nindex 0249451..d77ca4a 100644\n--- a/src/main/java/org/mockito/Mockito.java\n+++ b/src/main/java/org/mockito/Mockito.java\n@@ -2262,6 +2262,11 @@ public class Mockito extends ArgumentMatchers {\n      * @return mock controller\n      */\n     public static <T> MockedStatic<T> mockStatic(Class<T> classToMock) {\n+        if (classToMock != null && classToMock.isAnnotationPresent(org.mockito.DoNotMock.class)) {\n+            throw new org.mockito.exceptions.base.MockitoException(\n+                    \"Cannot mock static methods of \" + classToMock.getName() + \" because it is annotated with @DoNotMock.\"\n+            );\n+        }\n         return mockStatic(classToMock, withSettings());\n     }\n \n",
        "diff --git a/src/main/java/org/mockito/Mockito.java b/src/main/java/org/mockito/Mockito.java\nindex 0249451..2c87ade 100644\n--- a/src/main/java/org/mockito/Mockito.java\n+++ b/src/main/java/org/mockito/Mockito.java\n@@ -2262,6 +2262,12 @@ public class Mockito extends ArgumentMatchers {\n      * @return mock controller\n      */\n     public static <T> MockedStatic<T> mockStatic(Class<T> classToMock) {\n+        // Enforce @DoNotMock for static mocking\n+        if (classToMock.isAnnotationPresent(org.mockito.DoNotMock.class)) {\n+            throw new org.mockito.exceptions.base.MockitoException(\n+                    \"Cannot mock static methods of \" + classToMock.getName()\n+                            + \" because it is annotated with @DoNotMock.\");\n+        }\n         return mockStatic(classToMock, withSettings());\n     }\n \n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/src/main/java/org/mockito/Mockito.java b/src/main/java/org/mockito/Mockito.java\nindex 0249451..aa7fc36 100644\n--- a/src/main/java/org/mockito/Mockito.java\n+++ b/src/main/java/org/mockito/Mockito.java\n@@ -2262,6 +2262,11 @@ public class Mockito extends ArgumentMatchers {\n      * @return mock controller\n      */\n     public static <T> MockedStatic<T> mockStatic(Class<T> classToMock) {\n+        // Enforce @DoNotMock for static mocking as well\n+        if (classToMock.isAnnotationPresent(org.mockito.DoNotMock.class)) {\n+            throw new org.mockito.exceptions.base.MockitoException(\n+                    \"Type \" + classToMock.getName() + \" is annotated with @DoNotMock and cannot be mocked via mockStatic().\");\n+        }\n         return mockStatic(classToMock, withSettings());\n     }\n \n",
  "7_resolved": false
}