{
  "instance_id": "Multi-SWE-Bench__go__maintenance__bugfix__73631dc4",
  "original_id": "cli__cli-1457",
  "1_model_selected_files": [
    "command/pr.go",
    "command/issue.go",
    "command/pr_test.go",
    "command/issue_test.go",
    "utils/table_printer.go"
  ],
  "2_embedding_selected_files": [
    "command/issue.go",
    "command/pr.go",
    "command/issue_test.go",
    "command/pr_test.go",
    "command/pr_create.go",
    "command/pr_lookup.go",
    "command/pr_diff.go",
    "command/pr_create_test.go",
    "command/pr_review_test.go",
    "command/issue_lookup.go",
    "command/pr_diff_test.go",
    "command/pr_checkout.go",
    "command/pr_review.go",
    "command/pr_checkout_test.go",
    "command/title_body_survey.go"
  ],
  "3_final_combined_files": [
    "command/pr.go",
    "command/issue.go",
    "command/pr_test.go",
    "command/issue_test.go"
  ],
  "4_related_elements": {
    "command/issue.go": [
      "function: listHeader\nfunction: issueList\nvariable: issueListCmd"
    ],
    "command/pr.go": [
      "function: prList\nvariable: prListCmd"
    ],
    "command/pr_test.go": [
      "function: TestPRList"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "command/issue.go": [
          "function: listHeader\nline: 260"
        ],
        "command/pr.go": [
          "line: 296"
        ],
        "command/pr_test.go": [
          "line: 310"
        ]
      },
      "patches": [
        "diff --git a/command/issue.go b/command/issue.go\nindex e6ea2dc..e5fefb0 100644\n--- a/command/issue.go\n+++ b/command/issue.go\n@@ -376,7 +376,7 @@ func listHeader(repoName string, itemName string, matchCount int, totalMatchCoun\n \t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n \t}\n \n-\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n+\treturn fmt.Sprintf(\"Showing %d of %s open in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n }\n \n func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\ndiff --git a/command/pr_test.go b/command/pr_test.go\nindex 66465d2..3947516 100644\n--- a/command/pr_test.go\n+++ b/command/pr_test.go\n@@ -307,7 +307,7 @@ func TestPRList(t *testing.T) {\n \t}\n \n \tassert.Equal(t, `\n-Showing 3 of 3 pull requests in OWNER/REPO\n+Showing 3 of 3 open pull requests in OWNER/REPO\n \n `, output.Stderr())\n \n",
        "diff --git a/command/issue.go b/command/issue.go\nindex e6ea2dc..36e9a35 100644\n--- a/command/issue.go\n+++ b/command/issue.go\n@@ -376,7 +376,7 @@ func listHeader(repoName string, itemName string, matchCount int, totalMatchCoun\n \t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n \t}\n \n-\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n+\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, \"open \"+itemName), repoName)\n }\n \n func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\ndiff --git a/command/pr_test.go b/command/pr_test.go\nindex 66465d2..3947516 100644\n--- a/command/pr_test.go\n+++ b/command/pr_test.go\n@@ -307,7 +307,7 @@ func TestPRList(t *testing.T) {\n \t}\n \n \tassert.Equal(t, `\n-Showing 3 of 3 pull requests in OWNER/REPO\n+Showing 3 of 3 open pull requests in OWNER/REPO\n \n `, output.Stderr())\n \n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nTweak wording on list headers to show state\nRight now, our headers on `gh pr list` and `gh issue list` say: \r\n\r\n> Showing 30 of 234 issues in cli/cli\r\n\r\n> Showing 30 of 234 pull requests in cli/cli \r\n\r\n\r\nBut it would be great to make it clear that this list is all the _open_ issues (or PRs), so we could adjust the wording to say: \r\n\r\n> Showing 30 of 234 open issues in cli/cli\r\n\r\n> Showing 30 of 234 open pull requests in cli/cli\n\n###\n### command/issue.go\n...\n163|\tu.RawQuery = q.Encode()\n164|\treturn u.String(), nil\n165|}\n166|\n167|func quoteValueForQuery(v string) string {\n168|\tif strings.ContainsAny(v, \" \\\"\\t\\r\\n\") {\n169|\t\treturn fmt.Sprintf(\"%q\", v)\n170|\t}\n171|\treturn v\n172|}\n173|\n174|func issueList(cmd *cobra.Command, args []string) error {\n175|\tctx := contextForCommand(cmd)\n176|\tapiClient, err := apiClientForContext(ctx)\n177|\tif err != nil {\n178|\t\treturn err\n179|\t}\n180|\n181|\tbaseRepo, err := determineBaseRepo(apiClient, cmd, ctx)\n182|\tif err != nil {\n183|\t\treturn err\n184|\t}\n185|\n186|\tweb, err := cmd.Flags().GetBool(\"web\")\n187|\tif err != nil {\n188|\t\treturn err\n189|\t}\n190|\n191|\tstate, err := cmd.Flags().GetString(\"state\")\n192|\tif err != nil {\n193|\t\treturn err\n194|\t}\n195|\n196|\tlabels, err := cmd.Flags().GetStringSlice(\"label\")\n197|\tif err != nil {\n198|\t\treturn err\n199|\t}\n200|\n201|\tassignee, err := cmd.Flags().GetString(\"assignee\")\n202|\tif err != nil {\n203|\t\treturn err\n204|\t}\n205|\n206|\tlimit, err := cmd.Flags().GetInt(\"limit\")\n207|\tif err != nil {\n208|\t\treturn err\n209|\t}\n210|\tif limit <= 0 {\n211|\t\treturn fmt.Errorf(\"invalid limit: %v\", limit)\n212|\t}\n213|\n214|\tauthor, err := cmd.Flags().GetString(\"author\")\n215|\tif err != nil {\n216|\t\treturn err\n217|\t}\n218|\n219|\tmention, err := cmd.Flags().GetString(\"mention\")\n220|\tif err != nil {\n221|\t\treturn err\n222|\t}\n223|\n224|\tmilestone, err := cmd.Flags().GetString(\"milestone\")\n225|\tif err != nil {\n226|\t\treturn err\n227|\t}\n228|\n229|\tif web {\n230|\t\tissueListURL := ghrepo.GenerateRepoURL(baseRepo, \"issues\")\n231|\t\topenURL, err := listURLWithQuery(issueListURL, filterOptions{\n232|\t\t\tentity:    \"issue\",\n233|\t\t\tstate:     state,\n234|\t\t\tassignee:  assignee,\n235|\t\t\tlabels:    labels,\n236|\t\t\tauthor:    author,\n237|\t\t\tmention:   mention,\n238|\t\t\tmilestone: milestone,\n239|\t\t})\n240|\t\tif err != nil {\n241|\t\t\treturn err\n242|\t\t}\n243|\t\tfmt.Fprintf(cmd.ErrOrStderr(), \"Opening %s in your browser.\\n\", utils.DisplayURL(openURL))\n244|\t\treturn utils.OpenInBrowser(openURL)\n245|\t}\n246|\n247|\tlistResult, err := api.IssueList(apiClient, baseRepo, state, labels, assignee, limit, author, mention, milestone)\n248|\tif err != nil {\n249|\t\treturn err\n250|\t}\n251|\n252|\thasFilters := false\n253|\tcmd.Flags().Visit(func(f *pflag.Flag) {\n254|\t\tswitch f.Name {\n255|\t\tcase \"state\", \"label\", \"assignee\", \"author\", \"mention\", \"milestone\":\n256|\t\t\thasFilters = true\n257|\t\t}\n258|\t})\n259|\n260|\ttitle := listHeader(ghrepo.FullName(baseRepo), \"issue\", len(listResult.Issues), listResult.TotalCount, hasFilters)\n261|\tif connectedToTerminal(cmd) {\n262|\t\tfmt.Fprintf(colorableErr(cmd), \"\\n%s\\n\\n\", title)\n263|\t}\n264|\n265|\tout := cmd.OutOrStdout()\n266|\n267|\tprintIssues(out, \"\", len(listResult.Issues), listResult.Issues)\n268|\n269|\treturn nil\n270|}\n271|\n272|func issueStatus(cmd *cobra.Command, args []string) error {\n273|\tctx := contextForCommand(cmd)\n274|\tapiClient, err := apiClientForContext(ctx)\n275|\tif err != nil {\n276|\t\treturn err\n277|\t}\n278|\n279|\tbaseRepo, err := determineBaseRepo(apiClient, cmd, ctx)\n...\n352|\t\treturn printHumanIssuePreview(colorableOut(cmd), issue)\n353|\t}\n354|\n355|\treturn printRawIssuePreview(cmd.OutOrStdout(), issue)\n356|}\n357|\n358|func issueStateTitleWithColor(state string) string {\n359|\tcolorFunc := colorFuncForState(state)\n360|\treturn colorFunc(strings.Title(strings.ToLower(state)))\n361|}\n362|\n363|func listHeader(repoName string, itemName string, matchCount int, totalMatchCount int, hasFilters bool) string {\n364|\tif totalMatchCount == 0 {\n365|\t\tif hasFilters {\n366|\t\t\treturn fmt.Sprintf(\"No %ss match your search in %s\", itemName, repoName)\n367|\t\t}\n368|\t\treturn fmt.Sprintf(\"There are no open %ss in %s\", itemName, repoName)\n369|\t}\n370|\n371|\tif hasFilters {\n372|\t\tmatchVerb := \"match\"\n373|\t\tif totalMatchCount == 1 {\n374|\t\t\tmatchVerb = \"matches\"\n375|\t\t}\n376|\t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n377|\t}\n378|\n379|\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n380|}\n381|\n382|func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\n383|\tassignees := issueAssigneeList(*issue)\n384|\tlabels := issueLabelList(*issue)\n385|\tprojects := issueProjectList(*issue)\n386|\n387|\t// Print empty strings for empty values so the number of metadata lines is consistent when\n388|\t// processing many issues with head and grep.\n389|\tfmt.Fprintf(out, \"title:\\t%s\\n\", issue.Title)\n...\n\n\n### command/pr.go\n...\n185|\tprintHeader(out, \"Requesting a code review from you\")\n186|\tif prPayload.ReviewRequested.TotalCount > 0 {\n187|\t\tprintPrs(out, prPayload.ReviewRequested.TotalCount, prPayload.ReviewRequested.PullRequests...)\n188|\t} else {\n189|\t\tprintMessage(out, \"  You have no pull requests to review\")\n190|\t}\n191|\tfmt.Fprintln(out)\n192|\n193|\treturn nil\n194|}\n195|\n196|func prList(cmd *cobra.Command, args []string) error {\n197|\tctx := contextForCommand(cmd)\n198|\tapiClient, err := apiClientForContext(ctx)\n199|\tif err != nil {\n200|\t\treturn err\n201|\t}\n202|\n203|\tbaseRepo, err := determineBaseRepo(apiClient, cmd, ctx)\n204|\tif err != nil {\n205|\t\treturn err\n206|\t}\n207|\n208|\tweb, err := cmd.Flags().GetBool(\"web\")\n209|\tif err != nil {\n210|\t\treturn err\n211|\t}\n212|\n213|\tlimit, err := cmd.Flags().GetInt(\"limit\")\n214|\tif err != nil {\n215|\t\treturn err\n216|\t}\n217|\tif limit <= 0 {\n218|\t\treturn fmt.Errorf(\"invalid limit: %v\", limit)\n219|\t}\n220|\n221|\tstate, err := cmd.Flags().GetString(\"state\")\n222|\tif err != nil {\n223|\t\treturn err\n224|\t}\n225|\tbaseBranch, err := cmd.Flags().GetString(\"base\")\n226|\tif err != nil {\n227|\t\treturn err\n228|\t}\n229|\tlabels, err := cmd.Flags().GetStringSlice(\"label\")\n230|\tif err != nil {\n231|\t\treturn err\n232|\t}\n233|\tassignee, err := cmd.Flags().GetString(\"assignee\")\n234|\tif err != nil {\n235|\t\treturn err\n236|\t}\n237|\n238|\tif web {\n239|\t\tprListURL := ghrepo.GenerateRepoURL(baseRepo, \"pulls\")\n240|\t\topenURL, err := listURLWithQuery(prListURL, filterOptions{\n241|\t\t\tentity:     \"pr\",\n242|\t\t\tstate:      state,\n243|\t\t\tassignee:   assignee,\n244|\t\t\tlabels:     labels,\n245|\t\t\tbaseBranch: baseBranch,\n246|\t\t})\n247|\t\tif err != nil {\n248|\t\t\treturn err\n249|\t\t}\n250|\t\tfmt.Fprintf(cmd.ErrOrStderr(), \"Opening %s in your browser.\\n\", utils.DisplayURL(openURL))\n251|\t\treturn utils.OpenInBrowser(openURL)\n252|\t}\n253|\n254|\tvar graphqlState []string\n255|\tswitch state {\n256|\tcase \"open\":\n257|\t\tgraphqlState = []string{\"OPEN\"}\n258|\tcase \"closed\":\n259|\t\tgraphqlState = []string{\"CLOSED\", \"MERGED\"}\n260|\tcase \"merged\":\n261|\t\tgraphqlState = []string{\"MERGED\"}\n262|\tcase \"all\":\n263|\t\tgraphqlState = []string{\"OPEN\", \"CLOSED\", \"MERGED\"}\n264|\tdefault:\n265|\t\treturn fmt.Errorf(\"invalid state: %s\", state)\n266|\t}\n267|\n268|\tparams := map[string]interface{}{\n269|\t\t\"owner\": baseRepo.RepoOwner(),\n270|\t\t\"repo\":  baseRepo.RepoName(),\n271|\t\t\"state\": graphqlState,\n272|\t}\n273|\tif len(labels) > 0 {\n274|\t\tparams[\"labels\"] = labels\n275|\t}\n276|\tif baseBranch != \"\" {\n277|\t\tparams[\"baseBranch\"] = baseBranch\n278|\t}\n279|\tif assignee != \"\" {\n280|\t\tparams[\"assignee\"] = assignee\n281|\t}\n282|\n283|\tlistResult, err := api.PullRequestList(apiClient, params, limit)\n284|\tif err != nil {\n285|\t\treturn err\n286|\t}\n287|\n288|\thasFilters := false\n289|\tcmd.Flags().Visit(func(f *pflag.Flag) {\n290|\t\tswitch f.Name {\n291|\t\tcase \"state\", \"label\", \"base\", \"assignee\":\n292|\t\t\thasFilters = true\n293|\t\t}\n294|\t})\n295|\n296|\ttitle := listHeader(ghrepo.FullName(baseRepo), \"pull request\", len(listResult.PullRequests), listResult.TotalCount, hasFilters)\n297|\tif connectedToTerminal(cmd) {\n298|\t\tfmt.Fprintf(colorableErr(cmd), \"\\n%s\\n\\n\", title)\n299|\t}\n300|\n301|\ttable := utils.NewTablePrinter(cmd.OutOrStdout())\n302|\tfor _, pr := range listResult.PullRequests {\n303|\t\tprNum := strconv.Itoa(pr.Number)\n304|\t\tif table.IsTTY() {\n305|\t\t\tprNum = \"#\" + prNum\n306|\t\t}\n307|\t\ttable.AddField(prNum, nil, colorFuncForPR(pr))\n308|\t\ttable.AddField(replaceExcessiveWhitespace(pr.Title), nil, nil)\n309|\t\ttable.AddField(pr.HeadLabel(), nil, utils.Cyan)\n310|\t\tif !table.IsTTY() {\n311|\t\t\ttable.AddField(prStateWithDraft(&pr), nil, nil)\n312|\t\t}\n313|\t\ttable.EndRow()\n314|\t}\n315|\terr = table.Render()\n316|\tif err != nil {\n317|\t\treturn err\n318|\t}\n319|\n320|\treturn nil\n321|}\n322|\n323|func prStateTitleWithColor(pr api.PullRequest) string {\n324|\tprStateColorFunc := colorFuncForPR(pr)\n325|\tif pr.State == \"OPEN\" && pr.IsDraft {\n326|\t\treturn prStateColorFunc(strings.Title(strings.ToLower(\"Draft\")))\n327|\t}\n328|\treturn prStateColorFunc(strings.Title(strings.ToLower(pr.State)))\n329|}\n330|\n...\n\n\n### command/pr_test.go\n...\n286|  You have no open pull requests\n287|\n288|Requesting a code review from you\n289|  You have no pull requests to review\n290|\n291|`\n292|\tif output.String() != expected {\n293|\t\tt.Errorf(\"expected %q, got %q\", expected, output.String())\n294|\t}\n295|}\n296|\n297|func TestPRList(t *testing.T) {\n298|\tinitBlankContext(\"\", \"OWNER/REPO\", \"master\")\n299|\tdefer stubTerminal(true)()\n300|\thttp := initFakeHTTP()\n301|\thttp.StubRepoResponse(\"OWNER\", \"REPO\")\n302|\thttp.Register(httpmock.GraphQL(`query PullRequestList\\b`), httpmock.FileResponse(\"../test/fixtures/prList.json\"))\n303|\n304|\toutput, err := RunCommand(\"pr list\")\n305|\tif err != nil {\n306|\t\tt.Fatal(err)\n307|\t}\n308|\n309|\tassert.Equal(t, `\n310|Showing 3 of 3 pull requests in OWNER/REPO\n311|\n312|`, output.Stderr())\n313|\n314|\tlines := strings.Split(output.String(), \"\\n\")\n315|\tres := []*regexp.Regexp{\n316|\t\tregexp.MustCompile(`#32.*New feature.*feature`),\n317|\t\tregexp.MustCompile(`#29.*Fixed bad bug.*hubot:bug-fix`),\n318|\t\tregexp.MustCompile(`#28.*Improve documentation.*docs`),\n319|\t}\n320|\n321|\tfor i, r := range res {\n322|\t\tif !r.MatchString(lines[i]) {\n323|\t\t\tt.Errorf(\"%s did not match %s\", lines[i], r)\n324|\t\t}\n325|\t}\n326|}\n327|\n328|func TestPRList_nontty(t *testing.T) {\n329|\tinitBlankContext(\"\", \"OWNER/REPO\", \"master\")\n330|\tdefer stubTerminal(false)()\n331|\thttp := initFakeHTTP()\n332|\thttp.StubRepoResponse(\"OWNER\", \"REPO\")\n333|\thttp.Register(httpmock.GraphQL(`query PullRequestList\\b`), httpmock.FileResponse(\"../test/fixtures/prList.json\"))\n334|\n335|\toutput, err := RunCommand(\"pr list\")\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\ncommand/issue.go\nfunction: listHeader\nline: 260\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```",
          "```\ncommand/issue.go\nline: 260\nfunction: listHeader\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\ncommand/issue.go\nfunction: listHeader\nline: 260\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```",
            "```\ncommand/issue.go\nline: 260\nfunction: listHeader\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "command/issue.go": [
          "line: 260\nfunction: listHeader"
        ],
        "command/pr.go": [
          "line: 296"
        ],
        "command/pr_test.go": [
          "line: 310"
        ]
      },
      "patches": [
        "diff --git a/command/issue.go b/command/issue.go\nindex e6ea2dc..36e9a35 100644\n--- a/command/issue.go\n+++ b/command/issue.go\n@@ -376,7 +376,7 @@ func listHeader(repoName string, itemName string, matchCount int, totalMatchCoun\n \t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n \t}\n \n-\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n+\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, \"open \"+itemName), repoName)\n }\n \n func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\ndiff --git a/command/pr_test.go b/command/pr_test.go\nindex 66465d2..3947516 100644\n--- a/command/pr_test.go\n+++ b/command/pr_test.go\n@@ -307,7 +307,7 @@ func TestPRList(t *testing.T) {\n \t}\n \n \tassert.Equal(t, `\n-Showing 3 of 3 pull requests in OWNER/REPO\n+Showing 3 of 3 open pull requests in OWNER/REPO\n \n `, output.Stderr())\n \n",
        "diff --git a/command/issue.go b/command/issue.go\nindex e6ea2dc..36e9a35 100644\n--- a/command/issue.go\n+++ b/command/issue.go\n@@ -376,7 +376,7 @@ func listHeader(repoName string, itemName string, matchCount int, totalMatchCoun\n \t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n \t}\n \n-\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n+\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, \"open \"+itemName), repoName)\n }\n \n func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\ndiff --git a/command/pr_test.go b/command/pr_test.go\nindex 66465d2..3947516 100644\n--- a/command/pr_test.go\n+++ b/command/pr_test.go\n@@ -307,7 +307,7 @@ func TestPRList(t *testing.T) {\n \t}\n \n \tassert.Equal(t, `\n-Showing 3 of 3 pull requests in OWNER/REPO\n+Showing 3 of 3 open pull requests in OWNER/REPO\n \n `, output.Stderr())\n \n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nTweak wording on list headers to show state\nRight now, our headers on `gh pr list` and `gh issue list` say: \r\n\r\n> Showing 30 of 234 issues in cli/cli\r\n\r\n> Showing 30 of 234 pull requests in cli/cli \r\n\r\n\r\nBut it would be great to make it clear that this list is all the _open_ issues (or PRs), so we could adjust the wording to say: \r\n\r\n> Showing 30 of 234 open issues in cli/cli\r\n\r\n> Showing 30 of 234 open pull requests in cli/cli\n\n###\n### command/issue.go\n...\n163|\tu.RawQuery = q.Encode()\n164|\treturn u.String(), nil\n165|}\n166|\n167|func quoteValueForQuery(v string) string {\n168|\tif strings.ContainsAny(v, \" \\\"\\t\\r\\n\") {\n169|\t\treturn fmt.Sprintf(\"%q\", v)\n170|\t}\n171|\treturn v\n172|}\n173|\n174|func issueList(cmd *cobra.Command, args []string) error {\n175|\tctx := contextForCommand(cmd)\n176|\tapiClient, err := apiClientForContext(ctx)\n177|\tif err != nil {\n178|\t\treturn err\n179|\t}\n180|\n181|\tbaseRepo, err := determineBaseRepo(apiClient, cmd, ctx)\n182|\tif err != nil {\n183|\t\treturn err\n184|\t}\n185|\n186|\tweb, err := cmd.Flags().GetBool(\"web\")\n187|\tif err != nil {\n188|\t\treturn err\n189|\t}\n190|\n191|\tstate, err := cmd.Flags().GetString(\"state\")\n192|\tif err != nil {\n193|\t\treturn err\n194|\t}\n195|\n196|\tlabels, err := cmd.Flags().GetStringSlice(\"label\")\n197|\tif err != nil {\n198|\t\treturn err\n199|\t}\n200|\n201|\tassignee, err := cmd.Flags().GetString(\"assignee\")\n202|\tif err != nil {\n203|\t\treturn err\n204|\t}\n205|\n206|\tlimit, err := cmd.Flags().GetInt(\"limit\")\n207|\tif err != nil {\n208|\t\treturn err\n209|\t}\n210|\tif limit <= 0 {\n211|\t\treturn fmt.Errorf(\"invalid limit: %v\", limit)\n212|\t}\n213|\n214|\tauthor, err := cmd.Flags().GetString(\"author\")\n215|\tif err != nil {\n216|\t\treturn err\n217|\t}\n218|\n219|\tmention, err := cmd.Flags().GetString(\"mention\")\n220|\tif err != nil {\n221|\t\treturn err\n222|\t}\n223|\n224|\tmilestone, err := cmd.Flags().GetString(\"milestone\")\n225|\tif err != nil {\n226|\t\treturn err\n227|\t}\n228|\n229|\tif web {\n230|\t\tissueListURL := ghrepo.GenerateRepoURL(baseRepo, \"issues\")\n231|\t\topenURL, err := listURLWithQuery(issueListURL, filterOptions{\n232|\t\t\tentity:    \"issue\",\n233|\t\t\tstate:     state,\n234|\t\t\tassignee:  assignee,\n235|\t\t\tlabels:    labels,\n236|\t\t\tauthor:    author,\n237|\t\t\tmention:   mention,\n238|\t\t\tmilestone: milestone,\n239|\t\t})\n240|\t\tif err != nil {\n241|\t\t\treturn err\n242|\t\t}\n243|\t\tfmt.Fprintf(cmd.ErrOrStderr(), \"Opening %s in your browser.\\n\", utils.DisplayURL(openURL))\n244|\t\treturn utils.OpenInBrowser(openURL)\n245|\t}\n246|\n247|\tlistResult, err := api.IssueList(apiClient, baseRepo, state, labels, assignee, limit, author, mention, milestone)\n248|\tif err != nil {\n249|\t\treturn err\n250|\t}\n251|\n252|\thasFilters := false\n253|\tcmd.Flags().Visit(func(f *pflag.Flag) {\n254|\t\tswitch f.Name {\n255|\t\tcase \"state\", \"label\", \"assignee\", \"author\", \"mention\", \"milestone\":\n256|\t\t\thasFilters = true\n257|\t\t}\n258|\t})\n259|\n260|\ttitle := listHeader(ghrepo.FullName(baseRepo), \"issue\", len(listResult.Issues), listResult.TotalCount, hasFilters)\n261|\tif connectedToTerminal(cmd) {\n262|\t\tfmt.Fprintf(colorableErr(cmd), \"\\n%s\\n\\n\", title)\n263|\t}\n264|\n265|\tout := cmd.OutOrStdout()\n266|\n267|\tprintIssues(out, \"\", len(listResult.Issues), listResult.Issues)\n268|\n269|\treturn nil\n270|}\n271|\n272|func issueStatus(cmd *cobra.Command, args []string) error {\n273|\tctx := contextForCommand(cmd)\n274|\tapiClient, err := apiClientForContext(ctx)\n275|\tif err != nil {\n276|\t\treturn err\n277|\t}\n278|\n279|\tbaseRepo, err := determineBaseRepo(apiClient, cmd, ctx)\n...\n352|\t\treturn printHumanIssuePreview(colorableOut(cmd), issue)\n353|\t}\n354|\n355|\treturn printRawIssuePreview(cmd.OutOrStdout(), issue)\n356|}\n357|\n358|func issueStateTitleWithColor(state string) string {\n359|\tcolorFunc := colorFuncForState(state)\n360|\treturn colorFunc(strings.Title(strings.ToLower(state)))\n361|}\n362|\n363|func listHeader(repoName string, itemName string, matchCount int, totalMatchCount int, hasFilters bool) string {\n364|\tif totalMatchCount == 0 {\n365|\t\tif hasFilters {\n366|\t\t\treturn fmt.Sprintf(\"No %ss match your search in %s\", itemName, repoName)\n367|\t\t}\n368|\t\treturn fmt.Sprintf(\"There are no open %ss in %s\", itemName, repoName)\n369|\t}\n370|\n371|\tif hasFilters {\n372|\t\tmatchVerb := \"match\"\n373|\t\tif totalMatchCount == 1 {\n374|\t\t\tmatchVerb = \"matches\"\n375|\t\t}\n376|\t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n377|\t}\n378|\n379|\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n380|}\n381|\n382|func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\n383|\tassignees := issueAssigneeList(*issue)\n384|\tlabels := issueLabelList(*issue)\n385|\tprojects := issueProjectList(*issue)\n386|\n387|\t// Print empty strings for empty values so the number of metadata lines is consistent when\n388|\t// processing many issues with head and grep.\n389|\tfmt.Fprintf(out, \"title:\\t%s\\n\", issue.Title)\n...\n\n\n### command/pr.go\n...\n185|\tprintHeader(out, \"Requesting a code review from you\")\n186|\tif prPayload.ReviewRequested.TotalCount > 0 {\n187|\t\tprintPrs(out, prPayload.ReviewRequested.TotalCount, prPayload.ReviewRequested.PullRequests...)\n188|\t} else {\n189|\t\tprintMessage(out, \"  You have no pull requests to review\")\n190|\t}\n191|\tfmt.Fprintln(out)\n192|\n193|\treturn nil\n194|}\n195|\n196|func prList(cmd *cobra.Command, args []string) error {\n197|\tctx := contextForCommand(cmd)\n198|\tapiClient, err := apiClientForContext(ctx)\n199|\tif err != nil {\n200|\t\treturn err\n201|\t}\n202|\n203|\tbaseRepo, err := determineBaseRepo(apiClient, cmd, ctx)\n204|\tif err != nil {\n205|\t\treturn err\n206|\t}\n207|\n208|\tweb, err := cmd.Flags().GetBool(\"web\")\n209|\tif err != nil {\n210|\t\treturn err\n211|\t}\n212|\n213|\tlimit, err := cmd.Flags().GetInt(\"limit\")\n214|\tif err != nil {\n215|\t\treturn err\n216|\t}\n217|\tif limit <= 0 {\n218|\t\treturn fmt.Errorf(\"invalid limit: %v\", limit)\n219|\t}\n220|\n221|\tstate, err := cmd.Flags().GetString(\"state\")\n222|\tif err != nil {\n223|\t\treturn err\n224|\t}\n225|\tbaseBranch, err := cmd.Flags().GetString(\"base\")\n226|\tif err != nil {\n227|\t\treturn err\n228|\t}\n229|\tlabels, err := cmd.Flags().GetStringSlice(\"label\")\n230|\tif err != nil {\n231|\t\treturn err\n232|\t}\n233|\tassignee, err := cmd.Flags().GetString(\"assignee\")\n234|\tif err != nil {\n235|\t\treturn err\n236|\t}\n237|\n238|\tif web {\n239|\t\tprListURL := ghrepo.GenerateRepoURL(baseRepo, \"pulls\")\n240|\t\topenURL, err := listURLWithQuery(prListURL, filterOptions{\n241|\t\t\tentity:     \"pr\",\n242|\t\t\tstate:      state,\n243|\t\t\tassignee:   assignee,\n244|\t\t\tlabels:     labels,\n245|\t\t\tbaseBranch: baseBranch,\n246|\t\t})\n247|\t\tif err != nil {\n248|\t\t\treturn err\n249|\t\t}\n250|\t\tfmt.Fprintf(cmd.ErrOrStderr(), \"Opening %s in your browser.\\n\", utils.DisplayURL(openURL))\n251|\t\treturn utils.OpenInBrowser(openURL)\n252|\t}\n253|\n254|\tvar graphqlState []string\n255|\tswitch state {\n256|\tcase \"open\":\n257|\t\tgraphqlState = []string{\"OPEN\"}\n258|\tcase \"closed\":\n259|\t\tgraphqlState = []string{\"CLOSED\", \"MERGED\"}\n260|\tcase \"merged\":\n261|\t\tgraphqlState = []string{\"MERGED\"}\n262|\tcase \"all\":\n263|\t\tgraphqlState = []string{\"OPEN\", \"CLOSED\", \"MERGED\"}\n264|\tdefault:\n265|\t\treturn fmt.Errorf(\"invalid state: %s\", state)\n266|\t}\n267|\n268|\tparams := map[string]interface{}{\n269|\t\t\"owner\": baseRepo.RepoOwner(),\n270|\t\t\"repo\":  baseRepo.RepoName(),\n271|\t\t\"state\": graphqlState,\n272|\t}\n273|\tif len(labels) > 0 {\n274|\t\tparams[\"labels\"] = labels\n275|\t}\n276|\tif baseBranch != \"\" {\n277|\t\tparams[\"baseBranch\"] = baseBranch\n278|\t}\n279|\tif assignee != \"\" {\n280|\t\tparams[\"assignee\"] = assignee\n281|\t}\n282|\n283|\tlistResult, err := api.PullRequestList(apiClient, params, limit)\n284|\tif err != nil {\n285|\t\treturn err\n286|\t}\n287|\n288|\thasFilters := false\n289|\tcmd.Flags().Visit(func(f *pflag.Flag) {\n290|\t\tswitch f.Name {\n291|\t\tcase \"state\", \"label\", \"base\", \"assignee\":\n292|\t\t\thasFilters = true\n293|\t\t}\n294|\t})\n295|\n296|\ttitle := listHeader(ghrepo.FullName(baseRepo), \"pull request\", len(listResult.PullRequests), listResult.TotalCount, hasFilters)\n297|\tif connectedToTerminal(cmd) {\n298|\t\tfmt.Fprintf(colorableErr(cmd), \"\\n%s\\n\\n\", title)\n299|\t}\n300|\n301|\ttable := utils.NewTablePrinter(cmd.OutOrStdout())\n302|\tfor _, pr := range listResult.PullRequests {\n303|\t\tprNum := strconv.Itoa(pr.Number)\n304|\t\tif table.IsTTY() {\n305|\t\t\tprNum = \"#\" + prNum\n306|\t\t}\n307|\t\ttable.AddField(prNum, nil, colorFuncForPR(pr))\n308|\t\ttable.AddField(replaceExcessiveWhitespace(pr.Title), nil, nil)\n309|\t\ttable.AddField(pr.HeadLabel(), nil, utils.Cyan)\n310|\t\tif !table.IsTTY() {\n311|\t\t\ttable.AddField(prStateWithDraft(&pr), nil, nil)\n312|\t\t}\n313|\t\ttable.EndRow()\n314|\t}\n315|\terr = table.Render()\n316|\tif err != nil {\n317|\t\treturn err\n318|\t}\n319|\n320|\treturn nil\n321|}\n322|\n323|func prStateTitleWithColor(pr api.PullRequest) string {\n324|\tprStateColorFunc := colorFuncForPR(pr)\n325|\tif pr.State == \"OPEN\" && pr.IsDraft {\n326|\t\treturn prStateColorFunc(strings.Title(strings.ToLower(\"Draft\")))\n327|\t}\n328|\treturn prStateColorFunc(strings.Title(strings.ToLower(pr.State)))\n329|}\n330|\n...\n\n\n### command/pr_test.go\n...\n286|  You have no open pull requests\n287|\n288|Requesting a code review from you\n289|  You have no pull requests to review\n290|\n291|`\n292|\tif output.String() != expected {\n293|\t\tt.Errorf(\"expected %q, got %q\", expected, output.String())\n294|\t}\n295|}\n296|\n297|func TestPRList(t *testing.T) {\n298|\tinitBlankContext(\"\", \"OWNER/REPO\", \"master\")\n299|\tdefer stubTerminal(true)()\n300|\thttp := initFakeHTTP()\n301|\thttp.StubRepoResponse(\"OWNER\", \"REPO\")\n302|\thttp.Register(httpmock.GraphQL(`query PullRequestList\\b`), httpmock.FileResponse(\"../test/fixtures/prList.json\"))\n303|\n304|\toutput, err := RunCommand(\"pr list\")\n305|\tif err != nil {\n306|\t\tt.Fatal(err)\n307|\t}\n308|\n309|\tassert.Equal(t, `\n310|Showing 3 of 3 pull requests in OWNER/REPO\n311|\n312|`, output.Stderr())\n313|\n314|\tlines := strings.Split(output.String(), \"\\n\")\n315|\tres := []*regexp.Regexp{\n316|\t\tregexp.MustCompile(`#32.*New feature.*feature`),\n317|\t\tregexp.MustCompile(`#29.*Fixed bad bug.*hubot:bug-fix`),\n318|\t\tregexp.MustCompile(`#28.*Improve documentation.*docs`),\n319|\t}\n320|\n321|\tfor i, r := range res {\n322|\t\tif !r.MatchString(lines[i]) {\n323|\t\t\tt.Errorf(\"%s did not match %s\", lines[i], r)\n324|\t\t}\n325|\t}\n326|}\n327|\n328|func TestPRList_nontty(t *testing.T) {\n329|\tinitBlankContext(\"\", \"OWNER/REPO\", \"master\")\n330|\tdefer stubTerminal(false)()\n331|\thttp := initFakeHTTP()\n332|\thttp.StubRepoResponse(\"OWNER\", \"REPO\")\n333|\thttp.Register(httpmock.GraphQL(`query PullRequestList\\b`), httpmock.FileResponse(\"../test/fixtures/prList.json\"))\n334|\n335|\toutput, err := RunCommand(\"pr list\")\n...\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\ncommand/issue.go\nfunction: listHeader\nline: 260\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```",
          "```\ncommand/issue.go\nline: 260\nfunction: listHeader\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\ncommand/issue.go\nfunction: listHeader\nline: 260\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```",
            "```\ncommand/issue.go\nline: 260\nfunction: listHeader\n\ncommand/pr.go\nline: 296\n\ncommand/pr_test.go\nline: 310\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/command/issue.go b/command/issue.go\nindex e6ea2dc..36e9a35 100644\n--- a/command/issue.go\n+++ b/command/issue.go\n@@ -376,7 +376,7 @@ func listHeader(repoName string, itemName string, matchCount int, totalMatchCoun\n \t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n \t}\n \n-\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n+\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, \"open \"+itemName), repoName)\n }\n \n func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\ndiff --git a/command/pr_test.go b/command/pr_test.go\nindex 66465d2..3947516 100644\n--- a/command/pr_test.go\n+++ b/command/pr_test.go\n@@ -307,7 +307,7 @@ func TestPRList(t *testing.T) {\n \t}\n \n \tassert.Equal(t, `\n-Showing 3 of 3 pull requests in OWNER/REPO\n+Showing 3 of 3 open pull requests in OWNER/REPO\n \n `, output.Stderr())\n \n",
  "7_resolved": false
}