{
  "instance_id": "Multi-SWE-Bench__go__maintenance__bugfix__3e2d031f",
  "original_id": "cli__cli-6706",
  "1_model_selected_files": [
    "pkg/cmd/repo/edit/edit.go",
    "api/queries_repo.go",
    "pkg/cmd/repo/edit/edit_test.go"
  ],
  "2_embedding_selected_files": [
    "pkg/cmd/repo/edit/edit.go",
    "pkg/cmd/repo/edit/edit_test.go",
    "pkg/cmd/repo/create/create_test.go",
    "pkg/cmd/repo/create/create.go",
    "pkg/cmd/repo/fork/fork.go",
    "api/queries_pr.go",
    "pkg/cmd/repo/view/view.go",
    "pkg/cmd/repo/rename/rename.go",
    "api/queries_repo.go",
    "pkg/cmd/repo/deploy-key/add/add.go",
    "pkg/cmd/repo/delete/delete.go",
    "pkg/cmd/repo/sync/sync_test.go",
    "pkg/cmd/repo/sync/git.go",
    "pkg/cmd/repo/fork/fork_test.go",
    "pkg/cmd/repo/sync/http.go",
    "pkg/cmd/repo/rename/rename_test.go",
    "pkg/cmd/repo/sync/sync.go",
    "pkg/cmd/repo/clone/clone_test.go",
    "pkg/cmd/repo/sync/mocks.go",
    "pkg/cmd/repo/list/list_test.go",
    "pkg/cmd/repo/archive/archive.go",
    "pkg/cmd/repo/view/view_test.go",
    "pkg/cmd/repo/list/list.go",
    "pkg/cmd/repo/create/http_test.go",
    "pkg/cmd/repo/archive/archive_test.go",
    "pkg/cmd/repo/clone/clone.go",
    "api/queries_branch_issue_reference.go",
    "api/query_builder.go",
    "api/pull_request_test.go"
  ],
  "3_final_combined_files": [
    "pkg/cmd/repo/edit/edit.go",
    "pkg/cmd/repo/edit/edit_test.go",
    "api/queries_repo.go",
    "pkg/cmd/repo/create/create_test.go"
  ],
  "4_related_elements": {
    "pkg/cmd/repo/edit/edit.go": [
      "function: NewCmdEdit\nclass: EditRepositoryInput\nfunction: editRun\nfunction: interactiveRepoEdit\nfunction: interactiveChoice"
    ],
    "api/queries_repo.go": [
      "class: Repository\nfunction: FetchRepository"
    ],
    "pkg/cmd/repo/edit/edit_test.go": [
      "function: TestNewCmdEdit\nfunction: Test_editRun_interactive"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "pkg/cmd/repo/edit/edit.go": [
          "line: 59\nfunction: NewCmdEdit\nfunction: editRun\nfunction: interactiveRepoEdit"
        ],
        "api/queries_repo.go": [
          "line: 22"
        ],
        "pkg/cmd/repo/edit/edit_test.go": [
          "function: Test_editRun_interactive"
        ]
      },
      "patches": [
        "diff --git a/pkg/cmd/repo/edit/edit.go b/pkg/cmd/repo/edit/edit.go\nindex d4ac91a..c282ac3 100644\n--- a/pkg/cmd/repo/edit/edit.go\n+++ b/pkg/cmd/repo/edit/edit.go\n@@ -60,6 +60,7 @@ type EditRepositoryInput struct {\n \tAllowForking        *bool   `json:\"allow_forking,omitempty\"`\n \tDefaultBranch       *string `json:\"default_branch,omitempty\"`\n \tDeleteBranchOnMerge *bool   `json:\"delete_branch_on_merge,omitempty\"`\n+\tAllowUpdateBranch   *bool   `json:\"allow_update_branch,omitempty\"`\n \tDescription         *string `json:\"description,omitempty\"`\n \tEnableAutoMerge     *bool   `json:\"allow_auto_merge,omitempty\"`\n \tEnableIssues        *bool   `json:\"has_issues,omitempty\"`\n@@ -150,6 +151,7 @@ func NewCmdEdit(f *cmdutil.Factory, runF func(options *EditOptions) error) *cobr\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableRebaseMerge, \"enable-rebase-merge\", \"\", \"Enable merging pull requests via rebase\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableAutoMerge, \"enable-auto-merge\", \"\", \"Enable auto-merge functionality\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.DeleteBranchOnMerge, \"delete-branch-on-merge\", \"\", \"Delete head branch when pull requests are merged\")\n+\tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowUpdateBranch, \"allow-update-branch\", \"\", \"Always suggest updating pull request branches\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowForking, \"allow-forking\", \"\", \"Allow forking of an organization repository\")\n \tcmd.Flags().StringSliceVar(&opts.AddTopics, \"add-topic\", nil, \"Add repository topic\")\n \tcmd.Flags().StringSliceVar(&opts.RemoveTopics, \"remove-topic\", nil, \"Remove repository topic\")\n",
        "diff --git a/pkg/cmd/repo/edit/edit.go b/pkg/cmd/repo/edit/edit.go\nindex d4ac91a..c282ac3 100644\n--- a/pkg/cmd/repo/edit/edit.go\n+++ b/pkg/cmd/repo/edit/edit.go\n@@ -60,6 +60,7 @@ type EditRepositoryInput struct {\n \tAllowForking        *bool   `json:\"allow_forking,omitempty\"`\n \tDefaultBranch       *string `json:\"default_branch,omitempty\"`\n \tDeleteBranchOnMerge *bool   `json:\"delete_branch_on_merge,omitempty\"`\n+\tAllowUpdateBranch   *bool   `json:\"allow_update_branch,omitempty\"`\n \tDescription         *string `json:\"description,omitempty\"`\n \tEnableAutoMerge     *bool   `json:\"allow_auto_merge,omitempty\"`\n \tEnableIssues        *bool   `json:\"has_issues,omitempty\"`\n@@ -150,6 +151,7 @@ func NewCmdEdit(f *cmdutil.Factory, runF func(options *EditOptions) error) *cobr\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableRebaseMerge, \"enable-rebase-merge\", \"\", \"Enable merging pull requests via rebase\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableAutoMerge, \"enable-auto-merge\", \"\", \"Enable auto-merge functionality\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.DeleteBranchOnMerge, \"delete-branch-on-merge\", \"\", \"Delete head branch when pull requests are merged\")\n+\tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowUpdateBranch, \"allow-update-branch\", \"\", \"Always suggest updating pull request branches\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowForking, \"allow-forking\", \"\", \"Allow forking of an organization repository\")\n \tcmd.Flags().StringSliceVar(&opts.AddTopics, \"add-topic\", nil, \"Add repository topic\")\n \tcmd.Flags().StringSliceVar(&opts.RemoveTopics, \"remove-topic\", nil, \"Remove repository topic\")\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nAbility to set/unset \"Always suggest updating pull request branches\" in repo edit\n### Describe the feature or problem you’d like to solve\r\n\r\nI'd like to suggest adding an option to the `repo edit` command to enable the \"allow update branch\" checkbox. \r\n\r\n### Proposed solution\r\n\r\nIn line with the other options on this command, add a new flag `--allow-update-branch`. Should all options be editable in the interactive mode? I don't know whether this checkbox is always present or if it's feature dependant.\r\n\r\n### Additional context\r\n\r\nAs seen in the GitHub UI:\r\n\r\n<img width=\"820\" alt=\"image\" src=\"https://user-images.githubusercontent.com/861044/206558913-a14175d1-c712-44ea-ab1e-b9c0ff84c07c.png\">\r\n\n\n###\n### pkg/cmd/repo/edit/edit.go\n...\n48|\tIO              *iostreams.IOStreams\n49|\tEdits           EditRepositoryInput\n50|\tAddTopics       []string\n51|\tRemoveTopics    []string\n52|\tInteractiveMode bool\n53|\tDetector        fd.Detector\n54|\t// Cache of current repo topics to avoid retrieving them\n55|\t// in multiple flows.\n56|\ttopicsCache []string\n57|}\n58|\n59|type EditRepositoryInput struct {\n60|\tAllowForking        *bool   `json:\"allow_forking,omitempty\"`\n61|\tDefaultBranch       *string `json:\"default_branch,omitempty\"`\n62|\tDeleteBranchOnMerge *bool   `json:\"delete_branch_on_merge,omitempty\"`\n63|\tDescription         *string `json:\"description,omitempty\"`\n64|\tEnableAutoMerge     *bool   `json:\"allow_auto_merge,omitempty\"`\n65|\tEnableIssues        *bool   `json:\"has_issues,omitempty\"`\n66|\tEnableMergeCommit   *bool   `json:\"allow_merge_commit,omitempty\"`\n67|\tEnableProjects      *bool   `json:\"has_projects,omitempty\"`\n68|\tEnableRebaseMerge   *bool   `json:\"allow_rebase_merge,omitempty\"`\n69|\tEnableSquashMerge   *bool   `json:\"allow_squash_merge,omitempty\"`\n70|\tEnableWiki          *bool   `json:\"has_wiki,omitempty\"`\n71|\tHomepage            *string `json:\"homepage,omitempty\"`\n72|\tIsTemplate          *bool   `json:\"is_template,omitempty\"`\n73|\tVisibility          *string `json:\"visibility,omitempty\"`\n74|}\n75|\n76|func NewCmdEdit(f *cmdutil.Factory, runF func(options *EditOptions) error) *cobra.Command {\n77|\topts := &EditOptions{\n78|\t\tIO: f.IOStreams,\n79|\t}\n80|\n81|\tcmd := &cobra.Command{\n82|\t\tUse:   \"edit [<repository>]\",\n83|\t\tShort: \"Edit repository settings\",\n84|\t\tAnnotations: map[string]string{\n85|\t\t\t\"help:arguments\": heredoc.Doc(`\n86|\t\t\t\tA repository can be supplied as an argument in any of the following formats:\n87|\t\t\t\t- \"OWNER/REPO\"\n88|\t\t\t\t- by URL, e.g. \"https://github.com/OWNER/REPO\"\n89|\t\t\t`),\n90|\t\t},\n91|\t\tLong: heredoc.Docf(`\n92|\t\t\tEdit repository settings.\n93|\n94|\t\t\tTo toggle a setting off, use the %[1]s--flag=false%[1]s syntax.\n95|\t\t`, \"`\"),\n96|\t\tArgs: cobra.MaximumNArgs(1),\n97|\t\tExample: heredoc.Doc(`\n98|\t\t\t# enable issues and wiki\n99|\t\t\tgh repo edit --enable-issues --enable-wiki\n100|\n101|\t\t\t# disable projects\n102|\t\t\tgh repo edit --enable-projects=false\n103|\t\t`),\n104|\t\tRunE: func(cmd *cobra.Command, args []string) error {\n105|\t\t\tif len(args) > 0 {\n106|\t\t\t\tvar err error\n107|\t\t\t\topts.Repository, err = ghrepo.FromFullName(args[0])\n108|\t\t\t\tif err != nil {\n109|\t\t\t\t\treturn err\n110|\t\t\t\t}\n111|\t\t\t} else {\n112|\t\t\t\tvar err error\n113|\t\t\t\topts.Repository, err = f.BaseRepo()\n114|\t\t\t\tif err != nil {\n115|\t\t\t\t\treturn err\n116|\t\t\t\t}\n117|\t\t\t}\n118|\n119|\t\t\tif httpClient, err := f.HttpClient(); err == nil {\n120|\t\t\t\topts.HTTPClient = httpClient\n121|\t\t\t} else {\n122|\t\t\t\treturn err\n123|\t\t\t}\n124|\n125|\t\t\tif cmd.Flags().NFlag() == 0 {\n126|\t\t\t\topts.InteractiveMode = true\n127|\t\t\t}\n128|\n129|\t\t\tif opts.InteractiveMode && !opts.IO.CanPrompt() {\n130|\t\t\t\treturn cmdutil.FlagErrorf(\"specify properties to edit when not running interactively\")\n131|\t\t\t}\n132|\n133|\t\t\tif runF != nil {\n134|\t\t\t\treturn runF(opts)\n135|\t\t\t}\n136|\t\t\treturn editRun(cmd.Context(), opts)\n137|\t\t},\n138|\t}\n139|\n140|\tcmdutil.NilStringFlag(cmd, &opts.Edits.Description, \"description\", \"d\", \"Description of the repository\")\n141|\tcmdutil.NilStringFlag(cmd, &opts.Edits.Homepage, \"homepage\", \"h\", \"Repository home page `URL`\")\n142|\tcmdutil.NilStringFlag(cmd, &opts.Edits.DefaultBranch, \"default-branch\", \"\", \"Set the default branch `name` for the repository\")\n143|\tcmdutil.NilStringFlag(cmd, &opts.Edits.Visibility, \"visibility\", \"\", \"Change the visibility of the repository to {public,private,internal}\")\n144|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.IsTemplate, \"template\", \"\", \"Make the repository available as a template repository\")\n145|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableIssues, \"enable-issues\", \"\", \"Enable issues in the repository\")\n146|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableProjects, \"enable-projects\", \"\", \"Enable projects in the repository\")\n147|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableWiki, \"enable-wiki\", \"\", \"Enable wiki in the repository\")\n148|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableMergeCommit, \"enable-merge-commit\", \"\", \"Enable merging pull requests via merge commit\")\n149|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableSquashMerge, \"enable-squash-merge\", \"\", \"Enable merging pull requests via squashed commit\")\n150|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableRebaseMerge, \"enable-rebase-merge\", \"\", \"Enable merging pull requests via rebase\")\n151|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableAutoMerge, \"enable-auto-merge\", \"\", \"Enable auto-merge functionality\")\n152|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.DeleteBranchOnMerge, \"delete-branch-on-merge\", \"\", \"Delete head branch when pull requests are merged\")\n153|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowForking, \"allow-forking\", \"\", \"Allow forking of an organization repository\")\n154|\tcmd.Flags().StringSliceVar(&opts.AddTopics, \"add-topic\", nil, \"Add repository topic\")\n155|\tcmd.Flags().StringSliceVar(&opts.RemoveTopics, \"remove-topic\", nil, \"Remove repository topic\")\n156|\n157|\treturn cmd\n158|}\n159|\n160|func editRun(ctx context.Context, opts *EditOptions) error {\n161|\trepo := opts.Repository\n162|\n163|\tif opts.InteractiveMode {\n164|\t\tdetector := opts.Detector\n165|\t\tif detector == nil {\n166|\t\t\tcachedClient := api.NewCachedHTTPClient(opts.HTTPClient, time.Hour*24)\n167|\t\t\tdetector = fd.NewDetector(cachedClient, repo.RepoHost())\n168|\t\t}\n169|\t\trepoFeatures, err := detector.RepositoryFeatures()\n170|\t\tif err != nil {\n171|\t\t\treturn err\n172|\t\t}\n173|\n174|\t\tapiClient := api.NewClientFromHTTP(opts.HTTPClient)\n175|\t\tfieldsToRetrieve := []string{\n176|\t\t\t\"defaultBranchRef\",\n177|\t\t\t\"deleteBranchOnMerge\",\n178|\t\t\t\"description\",\n179|\t\t\t\"hasIssuesEnabled\",\n180|\t\t\t\"hasProjectsEnabled\",\n181|\t\t\t\"hasWikiEnabled\",\n182|\t\t\t\"homepageUrl\",\n183|\t\t\t\"isInOrganization\",\n184|\t\t\t\"isTemplate\",\n185|\t\t\t\"mergeCommitAllowed\",\n186|\t\t\t\"rebaseMergeAllowed\",\n187|\t\t\t\"repositoryTopics\",\n188|\t\t\t\"squashMergeAllowed\",\n189|\t\t}\n190|\t\tif repoFeatures.VisibilityField {\n191|\t\t\tfieldsToRetrieve = append(fieldsToRetrieve, \"visibility\")\n192|\t\t}\n193|\t\tif repoFeatures.AutoMerge {\n194|\t\t\tfieldsToRetrieve = append(fieldsToRetrieve, \"autoMergeAllowed\")\n195|\t\t}\n196|\n197|\t\topts.IO.StartProgressIndicator()\n198|\t\tfetchedRepo, err := api.FetchRepository(apiClient, opts.Repository, fieldsToRetrieve)\n199|\t\topts.IO.StopProgressIndicator()\n200|\t\tif err != nil {\n201|\t\t\treturn err\n202|\t\t}\n203|\t\terr = interactiveRepoEdit(opts, fetchedRepo)\n204|\t\tif err != nil {\n205|\t\t\treturn err\n206|\t\t}\n207|\t}\n208|\n209|\tapiPath := fmt.Sprintf(\"repos/%s/%s\", repo.RepoOwner(), repo.RepoName())\n210|\n211|\tbody := &bytes.Buffer{}\n212|\tenc := json.NewEncoder(body)\n213|\tif err := enc.Encode(opts.Edits); err != nil {\n214|\t\treturn err\n215|\t}\n216|\n217|\tg := errgroup.Group{}\n218|\n219|\tif body.Len() > 3 {\n220|\t\tg.Go(func() error {\n221|\t\t\tapiClient := api.NewClientFromHTTP(opts.HTTPClient)\n222|\t\t\t_, err := api.CreateRepoTransformToV4(apiClient, repo.RepoHost(), \"PATCH\", apiPath, body)\n223|\t\t\treturn err\n224|\t\t})\n225|\t}\n226|\n227|\tif len(opts.AddTopics) > 0 || len(opts.RemoveTopics) > 0 {\n228|\t\tg.Go(func() error {\n229|\t\t\t// opts.topicsCache gets populated in interactive mode\n230|\t\t\tif !opts.InteractiveMode {\n231|\t\t\t\tvar err error\n232|\t\t\t\topts.topicsCache, err = getTopics(ctx, opts.HTTPClient, repo)\n233|\t\t\t\tif err != nil {\n234|\t\t\t\t\treturn err\n235|\t\t\t\t}\n236|\t\t\t}\n237|\t\t\toldTopics := set.NewStringSet()\n238|\t\t\toldTopics.AddValues(opts.topicsCache)\n239|\n240|\t\t\tnewTopics := set.NewStringSet()\n241|\t\t\tnewTopics.AddValues(opts.topicsCache)\n242|\t\t\tnewTopics.AddValues(opts.AddTopics)\n243|\t\t\tnewTopics.RemoveValues(opts.RemoveTopics)\n244|\n245|\t\t\tif oldTopics.Equal(newTopics) {\n246|\t\t\t\treturn nil\n247|\t\t\t}\n248|\t\t\treturn setTopics(ctx, opts.HTTPClient, repo, newTopics.ToSlice())\n249|\t\t})\n250|\t}\n251|\n252|\terr := g.Wait()\n253|\tif err != nil {\n254|\t\treturn err\n255|\t}\n256|\n257|\tif opts.IO.IsStdoutTTY() {\n258|\t\tcs := opts.IO.ColorScheme()\n259|\t\tfmt.Fprintf(opts.IO.Out,\n260|\t\t\t\"%s Edited repository %s\\n\",\n261|\t\t\tcs.SuccessIcon(),\n262|\t\t\tghrepo.FullName(repo))\n263|\t}\n264|\n265|\treturn nil\n266|}\n267|\n268|func interactiveChoice(r *api.Repository) ([]string, error) {\n269|\toptions := []string{\n270|\t\toptionDefaultBranchName,\n271|\t\toptionDescription,\n272|\t\toptionHomePageURL,\n273|\t\toptionIssues,\n274|\t\toptionMergeOptions,\n275|\t\toptionProjects,\n276|\t\toptionTemplateRepo,\n277|\t\toptionTopics,\n278|\t\toptionVisibility,\n279|\t\toptionWikis,\n280|\t}\n281|\tif r.IsInOrganization {\n282|\t\toptions = append(options, optionAllowForking)\n283|\t}\n284|\tvar answers []string\n285|\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n286|\terr := prompt.SurveyAskOne(&survey.MultiSelect{\n287|\t\tMessage: \"What do you want to edit?\",\n288|\t\tOptions: options,\n289|\t}, &answers, survey.WithPageSize(11))\n290|\treturn answers, err\n291|}\n292|\n293|func interactiveRepoEdit(opts *EditOptions, r *api.Repository) error {\n294|\tfor _, v := range r.RepositoryTopics.Nodes {\n295|\t\topts.topicsCache = append(opts.topicsCache, v.Topic.Name)\n296|\t}\n297|\tchoices, err := interactiveChoice(r)\n298|\tif err != nil {\n299|\t\treturn err\n300|\t}\n301|\tfor _, c := range choices {\n302|\t\tswitch c {\n303|\t\tcase optionDescription:\n304|\t\t\topts.Edits.Description = &r.Description\n305|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n306|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n307|\t\t\t\tMessage: \"Description of the repository\",\n308|\t\t\t\tDefault: r.Description,\n309|\t\t\t}, opts.Edits.Description)\n310|\t\t\tif err != nil {\n311|\t\t\t\treturn err\n312|\t\t\t}\n313|\t\tcase optionHomePageURL:\n314|\t\t\topts.Edits.Homepage = &r.HomepageURL\n315|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n316|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n317|\t\t\t\tMessage: \"Repository home page URL\",\n318|\t\t\t\tDefault: r.HomepageURL,\n319|\t\t\t}, opts.Edits.Homepage)\n320|\t\t\tif err != nil {\n321|\t\t\t\treturn err\n322|\t\t\t}\n323|\t\tcase optionTopics:\n324|\t\t\tvar addTopics string\n325|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n326|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n327|\t\t\t\tMessage: \"Add topics?(csv format)\",\n328|\t\t\t}, &addTopics)\n329|\t\t\tif err != nil {\n330|\t\t\t\treturn err\n331|\t\t\t}\n332|\t\t\tif len(strings.TrimSpace(addTopics)) > 0 {\n333|\t\t\t\topts.AddTopics = parseTopics(addTopics)\n334|\t\t\t}\n335|\n336|\t\t\tif len(opts.topicsCache) > 0 {\n337|\t\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n338|\t\t\t\terr = prompt.SurveyAskOne(&survey.MultiSelect{\n339|\t\t\t\t\tMessage: \"Remove Topics\",\n340|\t\t\t\t\tOptions: opts.topicsCache,\n341|\t\t\t\t}, &opts.RemoveTopics)\n342|\t\t\t\tif err != nil {\n343|\t\t\t\t\treturn err\n344|\t\t\t\t}\n345|\t\t\t}\n346|\t\tcase optionDefaultBranchName:\n347|\t\t\topts.Edits.DefaultBranch = &r.DefaultBranchRef.Name\n348|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n349|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n350|\t\t\t\tMessage: \"Default branch name\",\n351|\t\t\t\tDefault: r.DefaultBranchRef.Name,\n352|\t\t\t}, opts.Edits.DefaultBranch)\n353|\t\t\tif err != nil {\n354|\t\t\t\treturn err\n355|\t\t\t}\n356|\t\tcase optionWikis:\n357|\t\t\topts.Edits.EnableWiki = &r.HasWikiEnabled\n358|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n359|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n360|\t\t\t\tMessage: \"Enable Wikis?\",\n361|\t\t\t\tDefault: r.HasWikiEnabled,\n362|\t\t\t}, opts.Edits.EnableWiki)\n363|\t\t\tif err != nil {\n364|\t\t\t\treturn err\n365|\t\t\t}\n366|\t\tcase optionIssues:\n367|\t\t\topts.Edits.EnableIssues = &r.HasIssuesEnabled\n368|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n369|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n370|\t\t\t\tMessage: \"Enable Issues?\",\n371|\t\t\t\tDefault: r.HasIssuesEnabled,\n372|\t\t\t}, opts.Edits.EnableIssues)\n373|\t\t\tif err != nil {\n374|\t\t\t\treturn err\n375|\t\t\t}\n376|\t\tcase optionProjects:\n377|\t\t\topts.Edits.EnableProjects = &r.HasProjectsEnabled\n378|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n379|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n380|\t\t\t\tMessage: \"Enable Projects?\",\n381|\t\t\t\tDefault: r.HasProjectsEnabled,\n382|\t\t\t}, opts.Edits.EnableProjects)\n383|\t\t\tif err != nil {\n384|\t\t\t\treturn err\n385|\t\t\t}\n386|\t\tcase optionVisibility:\n387|\t\t\topts.Edits.Visibility = &r.Visibility\n388|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n389|\t\t\terr = prompt.SurveyAskOne(&survey.Select{\n390|\t\t\t\tMessage: \"Visibility\",\n391|\t\t\t\tOptions: []string{\"public\", \"private\", \"internal\"},\n392|\t\t\t\tDefault: strings.ToLower(r.Visibility),\n393|\t\t\t}, opts.Edits.Visibility)\n394|\t\t\tif err != nil {\n395|\t\t\t\treturn err\n396|\t\t\t}\n397|\t\tcase optionMergeOptions:\n398|\t\t\tvar defaultMergeOptions []string\n399|\t\t\tvar selectedMergeOptions []string\n400|\t\t\tif r.MergeCommitAllowed {\n401|\t\t\t\tdefaultMergeOptions = append(defaultMergeOptions, allowMergeCommits)\n402|\t\t\t}\n403|\t\t\tif r.SquashMergeAllowed {\n404|\t\t\t\tdefaultMergeOptions = append(defaultMergeOptions, allowSquashMerge)\n405|\t\t\t}\n406|\t\t\tif r.RebaseMergeAllowed {\n407|\t\t\t\tdefaultMergeOptions = append(defaultMergeOptions, allowRebaseMerge)\n408|\t\t\t}\n409|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n410|\t\t\terr = prompt.SurveyAskOne(&survey.MultiSelect{\n411|\t\t\t\tMessage: \"Allowed merge strategies\",\n412|\t\t\t\tDefault: defaultMergeOptions,\n413|\t\t\t\tOptions: []string{allowMergeCommits, allowSquashMerge, allowRebaseMerge},\n414|\t\t\t}, &selectedMergeOptions)\n415|\t\t\tif err != nil {\n416|\t\t\t\treturn err\n417|\t\t\t}\n418|\t\t\tenableMergeCommit := isIncluded(allowMergeCommits, selectedMergeOptions)\n419|\t\t\topts.Edits.EnableMergeCommit = &enableMergeCommit\n420|\t\t\tenableSquashMerge := isIncluded(allowSquashMerge, selectedMergeOptions)\n421|\t\t\topts.Edits.EnableSquashMerge = &enableSquashMerge\n422|\t\t\tenableRebaseMerge := isIncluded(allowRebaseMerge, selectedMergeOptions)\n423|\t\t\topts.Edits.EnableRebaseMerge = &enableRebaseMerge\n424|\t\t\tif !enableMergeCommit && !enableSquashMerge && !enableRebaseMerge {\n425|\t\t\t\treturn fmt.Errorf(\"you need to allow at least one merge strategy\")\n426|\t\t\t}\n427|\n428|\t\t\topts.Edits.EnableAutoMerge = &r.AutoMergeAllowed\n429|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n430|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n431|\t\t\t\tMessage: \"Enable Auto Merge?\",\n432|\t\t\t\tDefault: r.AutoMergeAllowed,\n433|\t\t\t}, opts.Edits.EnableAutoMerge)\n434|\t\t\tif err != nil {\n435|\t\t\t\treturn err\n436|\t\t\t}\n437|\n438|\t\t\topts.Edits.DeleteBranchOnMerge = &r.DeleteBranchOnMerge\n439|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n440|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n441|\t\t\t\tMessage: \"Automatically delete head branches after merging?\",\n442|\t\t\t\tDefault: r.DeleteBranchOnMerge,\n443|\t\t\t}, opts.Edits.DeleteBranchOnMerge)\n444|\t\t\tif err != nil {\n445|\t\t\t\treturn err\n446|\t\t\t}\n447|\t\tcase optionTemplateRepo:\n448|\t\t\topts.Edits.IsTemplate = &r.IsTemplate\n449|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n450|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n451|\t\t\t\tMessage: \"Convert into a template repository?\",\n452|\t\t\t\tDefault: r.IsTemplate,\n453|\t\t\t}, opts.Edits.IsTemplate)\n454|\t\t\tif err != nil {\n455|\t\t\t\treturn err\n456|\t\t\t}\n457|\t\tcase optionAllowForking:\n458|\t\t\topts.Edits.AllowForking = &r.ForkingAllowed\n459|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n460|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n461|\t\t\t\tMessage: \"Allow forking (of an organization repository)?\",\n462|\t\t\t\tDefault: r.ForkingAllowed,\n463|\t\t\t}, opts.Edits.AllowForking)\n464|\t\t\tif err != nil {\n465|\t\t\t\treturn err\n466|\t\t\t}\n467|\t\t}\n468|\t}\n469|\treturn nil\n470|}\n471|\n472|func parseTopics(s string) []string {\n473|\ttopics := strings.Split(s, \",\")\n474|\tfor i, topic := range topics {\n475|\t\ttopics[i] = strings.TrimSpace(topic)\n476|\t}\n477|\treturn topics\n478|}\n479|\n...\n\n\n### api/queries_repo.go\n...\n11|\t\"strings\"\n12|\t\"time\"\n13|\n14|\t\"github.com/cli/cli/v2/internal/ghinstance\"\n15|\n16|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n17|\tghAPI \"github.com/cli/go-gh/pkg/api\"\n18|\t\"github.com/shurcooL/githubv4\"\n19|)\n20|\n21|// Repository contains information about a GitHub repo\n22|type Repository struct {\n23|\tID                       string\n24|\tName                     string\n25|\tNameWithOwner            string\n26|\tOwner                    RepositoryOwner\n27|\tParent                   *Repository\n28|\tTemplateRepository       *Repository\n29|\tDescription              string\n30|\tHomepageURL              string\n31|\tOpenGraphImageURL        string\n32|\tUsesCustomOpenGraphImage bool\n33|\tURL                      string\n34|\tSSHURL                   string\n35|\tMirrorURL                string\n36|\tSecurityPolicyURL        string\n37|\n38|\tCreatedAt time.Time\n39|\tPushedAt  *time.Time\n40|\tUpdatedAt time.Time\n41|\n42|\tIsBlankIssuesEnabled    bool\n43|\tIsSecurityPolicyEnabled bool\n44|\tHasIssuesEnabled        bool\n45|\tHasProjectsEnabled      bool\n46|\tHasWikiEnabled          bool\n47|\tMergeCommitAllowed      bool\n48|\tSquashMergeAllowed      bool\n49|\tRebaseMergeAllowed      bool\n50|\tAutoMergeAllowed        bool\n51|\n52|\tForkCount      int\n53|\tStargazerCount int\n54|\tWatchers       struct {\n55|\t\tTotalCount int `json:\"totalCount\"`\n56|\t}\n57|\tIssues struct {\n58|\t\tTotalCount int `json:\"totalCount\"`\n59|\t}\n60|\tPullRequests struct {\n61|\t\tTotalCount int `json:\"totalCount\"`\n62|\t}\n63|\n64|\tCodeOfConduct                 *CodeOfConduct\n65|\tContactLinks                  []ContactLink\n66|\tDefaultBranchRef              BranchRef\n67|\tDeleteBranchOnMerge           bool\n68|\tDiskUsage                     int\n69|\tFundingLinks                  []FundingLink\n70|\tIsArchived                    bool\n71|\tIsEmpty                       bool\n72|\tIsFork                        bool\n73|\tForkingAllowed                bool\n74|\tIsInOrganization              bool\n75|\tIsMirror                      bool\n76|\tIsPrivate                     bool\n77|\tIsTemplate                    bool\n78|\tIsUserConfigurationRepository bool\n79|\tLicenseInfo                   *RepositoryLicense\n80|\tViewerCanAdminister           bool\n81|\tViewerDefaultCommitEmail      string\n82|\tViewerDefaultMergeMethod      string\n83|\tViewerHasStarred              bool\n84|\tViewerPermission              string\n85|\tViewerPossibleCommitEmails    []string\n86|\tViewerSubscription            string\n87|\tVisibility                    string\n88|\n89|\tRepositoryTopics struct {\n90|\t\tNodes []struct {\n91|\t\t\tTopic RepositoryTopic\n92|\t\t}\n93|\t}\n94|\tPrimaryLanguage *CodingLanguage\n95|\tLanguages       struct {\n96|\t\tEdges []struct {\n97|\t\t\tSize int            `json:\"size\"`\n98|\t\t\tNode CodingLanguage `json:\"node\"`\n99|\t\t}\n100|\t}\n101|\tIssueTemplates       []IssueTemplate\n102|\tPullRequestTemplates []PullRequestTemplate\n103|\tLabels               struct {\n104|\t\tNodes []IssueLabel\n105|\t}\n106|\tMilestones struct {\n107|\t\tNodes []Milestone\n108|\t}\n109|\tLatestRelease *RepositoryRelease\n110|\n111|\tAssignableUsers struct {\n112|\t\tNodes []GitHubUser\n113|\t}\n114|\tMentionableUsers struct {\n115|\t\tNodes []GitHubUser\n116|\t}\n117|\tProjects struct {\n118|\t\tNodes []RepoProject\n119|\t}\n120|\n121|\t// pseudo-field that keeps track of host name of this repo\n122|\thostname string\n123|}\n124|\n125|// RepositoryOwner is the owner of a GitHub repository\n126|type RepositoryOwner struct {\n127|\tID    string `json:\"id\"`\n128|\tLogin string `json:\"login\"`\n129|}\n130|\n131|type GitHubUser struct {\n132|\tID    string `json:\"id\"`\n...\n228|\n229|// ViewerCanTriage is true when the requesting user can triage issues and pull requests\n230|func (r Repository) ViewerCanTriage() bool {\n231|\tswitch r.ViewerPermission {\n232|\tcase \"ADMIN\", \"MAINTAIN\", \"WRITE\", \"TRIAGE\":\n233|\t\treturn true\n234|\tdefault:\n235|\t\treturn false\n236|\t}\n237|}\n238|\n239|func FetchRepository(client *Client, repo ghrepo.Interface, fields []string) (*Repository, error) {\n240|\tquery := fmt.Sprintf(`query RepositoryInfo($owner: String!, $name: String!) {\n241|\t\trepository(owner: $owner, name: $name) {%s}\n242|\t}`, RepositoryGraphQL(fields))\n243|\n244|\tvariables := map[string]interface{}{\n245|\t\t\"owner\": repo.RepoOwner(),\n246|\t\t\"name\":  repo.RepoName(),\n247|\t}\n248|\n249|\tvar result struct {\n250|\t\tRepository *Repository\n251|\t}\n252|\tif err := client.GraphQL(repo.RepoHost(), query, variables, &result); err != nil {\n253|\t\treturn nil, err\n254|\t}\n255|\t// The GraphQL API should have returned an error in case of a missing repository, but this isn't\n256|\t// guaranteed to happen when an authentication token with insufficient permissions is being used.\n257|\tif result.Repository == nil {\n258|\t\treturn nil, GraphQLError{\n259|\t\t\tGQLError: ghAPI.GQLError{\n260|\t\t\t\tErrors: []ghAPI.GQLErrorItem{{\n261|\t\t\t\t\tType:    \"NOT_FOUND\",\n262|\t\t\t\t\tMessage: fmt.Sprintf(\"Could not resolve to a Repository with the name '%s/%s'.\", repo.RepoOwner(), repo.RepoName()),\n263|\t\t\t\t}},\n264|\t\t\t},\n265|\t\t}\n266|\t}\n267|\n268|\treturn InitRepoHostname(result.Repository, repo.RepoHost()), nil\n269|}\n270|\n271|func GitHubRepo(client *Client, repo ghrepo.Interface) (*Repository, error) {\n272|\tquery := `\n273|\tfragment repo on Repository {\n274|\t\tid\n275|\t\tname\n276|\t\towner { login }\n277|\t\thasIssuesEnabled\n278|\t\tdescription\n...\n\n\n### pkg/cmd/repo/edit/edit_test.go\n...\n10|\t\"github.com/cli/cli/v2/pkg/prompt\"\n11|\n12|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n13|\t\"github.com/cli/cli/v2/pkg/cmdutil\"\n14|\t\"github.com/cli/cli/v2/pkg/httpmock\"\n15|\t\"github.com/cli/cli/v2/pkg/iostreams\"\n16|\t\"github.com/google/shlex\"\n17|\t\"github.com/stretchr/testify/assert\"\n18|\t\"github.com/stretchr/testify/require\"\n19|)\n20|\n21|func TestNewCmdEdit(t *testing.T) {\n22|\ttests := []struct {\n23|\t\tname     string\n24|\t\targs     string\n25|\t\twantOpts EditOptions\n26|\t\twantErr  string\n27|\t}{\n28|\t\t{\n29|\t\t\tname: \"change repo description\",\n30|\t\t\targs: \"--description hello\",\n31|\t\t\twantOpts: EditOptions{\n32|\t\t\t\tRepository: ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n33|\t\t\t\tEdits: EditRepositoryInput{\n34|\t\t\t\t\tDescription: sp(\"hello\"),\n35|\t\t\t\t},\n36|\t\t\t},\n37|\t\t},\n38|\t}\n39|\n40|\tfor _, tt := range tests {\n41|\t\tt.Run(tt.name, func(t *testing.T) {\n42|\t\t\tios, _, _, _ := iostreams.Test()\n43|\t\t\tios.SetStdoutTTY(true)\n44|\t\t\tios.SetStdinTTY(true)\n45|\t\t\tios.SetStderrTTY(true)\n46|\n47|\t\t\tf := &cmdutil.Factory{\n48|\t\t\t\tIOStreams: ios,\n49|\t\t\t\tBaseRepo: func() (ghrepo.Interface, error) {\n50|\t\t\t\t\treturn ghrepo.New(\"OWNER\", \"REPO\"), nil\n51|\t\t\t\t},\n52|\t\t\t\tHttpClient: func() (*http.Client, error) {\n53|\t\t\t\t\treturn nil, nil\n54|\t\t\t\t},\n55|\t\t\t}\n56|\n57|\t\t\targv, err := shlex.Split(tt.args)\n58|\t\t\tassert.NoError(t, err)\n59|\n60|\t\t\tvar gotOpts *EditOptions\n61|\t\t\tcmd := NewCmdEdit(f, func(opts *EditOptions) error {\n62|\t\t\t\tgotOpts = opts\n63|\t\t\t\treturn nil\n64|\t\t\t})\n65|\t\t\tcmd.Flags().BoolP(\"help\", \"x\", false, \"\")\n66|\n67|\t\t\tcmd.SetArgs(argv)\n68|\t\t\tcmd.SetIn(&bytes.Buffer{})\n69|\t\t\tcmd.SetOut(io.Discard)\n70|\t\t\tcmd.SetErr(io.Discard)\n71|\n72|\t\t\t_, err = cmd.ExecuteC()\n73|\t\t\tif tt.wantErr != \"\" {\n74|\t\t\t\tassert.EqualError(t, err, tt.wantErr)\n75|\t\t\t\treturn\n76|\t\t\t}\n77|\t\t\trequire.NoError(t, err)\n78|\n79|\t\t\tassert.Equal(t, ghrepo.FullName(tt.wantOpts.Repository), ghrepo.FullName(gotOpts.Repository))\n80|\t\t\tassert.Equal(t, tt.wantOpts.Edits, gotOpts.Edits)\n81|\t\t})\n82|\t}\n83|}\n84|\n85|func Test_editRun(t *testing.T) {\n86|\ttests := []struct {\n87|\t\tname        string\n88|\t\topts        EditOptions\n89|\t\thttpStubs   func(*testing.T, *httpmock.Registry)\n90|\t\twantsStderr string\n91|\t\twantsErr    string\n92|\t}{\n...\n149|\t\t\terr := editRun(context.Background(), opts)\n150|\t\t\tif tt.wantsErr == \"\" {\n151|\t\t\t\trequire.NoError(t, err)\n152|\t\t\t} else {\n153|\t\t\t\tassert.EqualError(t, err, tt.wantsErr)\n154|\t\t\t\treturn\n155|\t\t\t}\n156|\t\t})\n157|\t}\n158|}\n159|\n160|func Test_editRun_interactive(t *testing.T) {\n161|\ttests := []struct {\n162|\t\tname        string\n163|\t\topts        EditOptions\n164|\t\taskStubs    func(*prompt.AskStubber)\n165|\t\thttpStubs   func(*testing.T, *httpmock.Registry)\n166|\t\twantsStderr string\n167|\t\twantsErr    string\n168|\t}{\n169|\t\t{\n170|\t\t\tname: \"updates repo description\",\n171|\t\t\topts: EditOptions{\n172|\t\t\t\tRepository:      ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n173|\t\t\t\tInteractiveMode: true,\n174|\t\t\t},\n175|\t\t\taskStubs: func(as *prompt.AskStubber) {\n176|\t\t\t\tas.StubPrompt(\"What do you want to edit?\").AnswerWith([]string{\"Description\"})\n177|\t\t\t\tas.StubPrompt(\"Description of the repository\").AnswerWith(\"awesome repo description\")\n178|\t\t\t},\n179|\t\t\thttpStubs: func(t *testing.T, reg *httpmock.Registry) {\n180|\t\t\t\treg.Register(\n181|\t\t\t\t\thttpmock.GraphQL(`query RepositoryInfo\\b`),\n182|\t\t\t\t\thttpmock.StringResponse(`\n183|\t\t\t\t\t{\n184|\t\t\t\t\t\t\"data\": {\n185|\t\t\t\t\t\t\t\"repository\": {\n186|\t\t\t\t\t\t\t\t\"description\": \"old description\",\n187|\t\t\t\t\t\t\t\t\"homePageUrl\": \"https://url.com\",\n188|\t\t\t\t\t\t\t\t\"defaultBranchRef\": {\n189|\t\t\t\t\t\t\t\t\t\"name\": \"main\"\n190|\t\t\t\t\t\t\t\t},\n191|\t\t\t\t\t\t\t\t\"isInOrganization\": false,\n192|\t\t\t\t\t\t\t\t\"repositoryTopics\": {\n193|\t\t\t\t\t\t\t\t\t\"nodes\": [{\n194|\t\t\t\t\t\t\t\t\t\t\"topic\": {\n195|\t\t\t\t\t\t\t\t\t\t\t\"name\": \"x\"\n196|\t\t\t\t\t\t\t\t\t\t}\n197|\t\t\t\t\t\t\t\t\t}]\n198|\t\t\t\t\t\t\t\t}\n199|\t\t\t\t\t\t\t}\n200|\t\t\t\t\t\t}\n201|\t\t\t\t\t}`))\n202|\t\t\t\treg.Register(\n203|\t\t\t\t\thttpmock.REST(\"PATCH\", \"repos/OWNER/REPO\"),\n204|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n205|\t\t\t\t\t\tassert.Equal(t, \"awesome repo description\", payload[\"description\"])\n206|\t\t\t\t\t}))\n207|\t\t\t},\n208|\t\t},\n209|\t\t{\n210|\t\t\tname: \"updates repo topics\",\n211|\t\t\topts: EditOptions{\n212|\t\t\t\tRepository:      ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n213|\t\t\t\tInteractiveMode: true,\n214|\t\t\t},\n215|\t\t\taskStubs: func(as *prompt.AskStubber) {\n216|\t\t\t\tas.StubPrompt(\"What do you want to edit?\").AnswerWith([]string{\"Description\", \"Topics\"})\n217|\t\t\t\tas.StubPrompt(\"Description of the repository\").AnswerWith(\"awesome repo description\")\n218|\t\t\t\tas.StubPrompt(\"Add topics?(csv format)\").AnswerWith(\"a, b,c,d \")\n219|\t\t\t\tas.StubPrompt(\"Remove Topics\").AnswerWith([]string{\"x\"})\n220|\t\t\t},\n221|\t\t\thttpStubs: func(t *testing.T, reg *httpmock.Registry) {\n222|\t\t\t\treg.Register(\n223|\t\t\t\t\thttpmock.GraphQL(`query RepositoryInfo\\b`),\n224|\t\t\t\t\thttpmock.StringResponse(`\n225|\t\t\t\t\t{\n226|\t\t\t\t\t\t\"data\": {\n227|\t\t\t\t\t\t\t\"repository\": {\n228|\t\t\t\t\t\t\t\t\"description\": \"old description\",\n229|\t\t\t\t\t\t\t\t\"homePageUrl\": \"https://url.com\",\n230|\t\t\t\t\t\t\t\t\"defaultBranchRef\": {\n231|\t\t\t\t\t\t\t\t\t\"name\": \"main\"\n232|\t\t\t\t\t\t\t\t},\n233|\t\t\t\t\t\t\t\t\"isInOrganization\": false,\n234|\t\t\t\t\t\t\t\t\"repositoryTopics\": {\n235|\t\t\t\t\t\t\t\t\t\"nodes\": [{\n236|\t\t\t\t\t\t\t\t\t\t\"topic\": {\n237|\t\t\t\t\t\t\t\t\t\t\t\"name\": \"x\"\n238|\t\t\t\t\t\t\t\t\t\t}\n239|\t\t\t\t\t\t\t\t\t}]\n240|\t\t\t\t\t\t\t\t}\n241|\t\t\t\t\t\t\t}\n242|\t\t\t\t\t\t}\n243|\t\t\t\t\t}`))\n244|\t\t\t\treg.Register(\n245|\t\t\t\t\thttpmock.REST(\"PATCH\", \"repos/OWNER/REPO\"),\n246|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n247|\t\t\t\t\t\tassert.Equal(t, \"awesome repo description\", payload[\"description\"])\n248|\t\t\t\t\t}))\n249|\t\t\t\treg.Register(\n250|\t\t\t\t\thttpmock.REST(\"PUT\", \"repos/OWNER/REPO/topics\"),\n251|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n252|\t\t\t\t\t\tassert.Equal(t, []interface{}{\"a\", \"b\", \"c\", \"d\"}, payload[\"names\"])\n253|\t\t\t\t\t}))\n254|\t\t\t},\n255|\t\t},\n256|\t\t{\n257|\t\t\tname: \"updates repo merge options\",\n258|\t\t\topts: EditOptions{\n259|\t\t\t\tRepository:      ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n260|\t\t\t\tInteractiveMode: true,\n261|\t\t\t},\n262|\t\t\taskStubs: func(as *prompt.AskStubber) {\n263|\t\t\t\tas.StubPrompt(\"What do you want to edit?\").AnswerWith([]string{\"Merge Options\"})\n264|\t\t\t\tas.StubPrompt(\"Allowed merge strategies\").AnswerWith([]string{allowMergeCommits, allowRebaseMerge})\n265|\t\t\t\tas.StubPrompt(\"Enable Auto Merge?\").AnswerWith(false)\n266|\t\t\t\tas.StubPrompt(\"Automatically delete head branches after merging?\").AnswerWith(false)\n267|\t\t\t},\n268|\t\t\thttpStubs: func(t *testing.T, reg *httpmock.Registry) {\n269|\t\t\t\treg.Register(\n270|\t\t\t\t\thttpmock.GraphQL(`query RepositoryInfo\\b`),\n271|\t\t\t\t\thttpmock.StringResponse(`\n272|\t\t\t\t\t{\n273|\t\t\t\t\t\t\"data\": {\n274|\t\t\t\t\t\t\t\"repository\": {\n275|\t\t\t\t\t\t\t\t\"description\": \"old description\",\n276|\t\t\t\t\t\t\t\t\"homePageUrl\": \"https://url.com\",\n277|\t\t\t\t\t\t\t\t\"defaultBranchRef\": {\n278|\t\t\t\t\t\t\t\t\t\"name\": \"main\"\n279|\t\t\t\t\t\t\t\t},\n280|\t\t\t\t\t\t\t\t\"isInOrganization\": false,\n281|\t\t\t\t\t\t\t\t\"squashMergeAllowed\": false,\n282|\t\t\t\t\t\t\t\t\"rebaseMergeAllowed\": true,\n283|\t\t\t\t\t\t\t\t\"mergeCommitAllowed\": true,\n284|\t\t\t\t\t\t\t\t\"deleteBranchOnMerge\": false,\n285|\t\t\t\t\t\t\t\t\"repositoryTopics\": {\n286|\t\t\t\t\t\t\t\t\t\"nodes\": [{\n287|\t\t\t\t\t\t\t\t\t\t\"topic\": {\n288|\t\t\t\t\t\t\t\t\t\t\t\"name\": \"x\"\n289|\t\t\t\t\t\t\t\t\t\t}\n290|\t\t\t\t\t\t\t\t\t}]\n291|\t\t\t\t\t\t\t\t}\n292|\t\t\t\t\t\t\t}\n293|\t\t\t\t\t\t}\n294|\t\t\t\t\t}`))\n295|\t\t\t\treg.Register(\n296|\t\t\t\t\thttpmock.REST(\"PATCH\", \"repos/OWNER/REPO\"),\n297|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n298|\t\t\t\t\t\tassert.Equal(t, true, payload[\"allow_merge_commit\"])\n299|\t\t\t\t\t\tassert.Equal(t, false, payload[\"allow_squash_merge\"])\n300|\t\t\t\t\t\tassert.Equal(t, true, payload[\"allow_rebase_merge\"])\n301|\t\t\t\t\t}))\n302|\t\t\t},\n303|\t\t},\n304|\t}\n305|\n306|\tfor _, tt := range tests {\n307|\t\tt.Run(tt.name, func(t *testing.T) {\n308|\t\t\tios, _, _, _ := iostreams.Test()\n309|\t\t\tios.SetStdoutTTY(true)\n310|\t\t\tios.SetStdinTTY(true)\n311|\t\t\tios.SetStderrTTY(true)\n312|\n313|\t\t\thttpReg := &httpmock.Registry{}\n314|\t\t\tdefer httpReg.Verify(t)\n315|\t\t\tif tt.httpStubs != nil {\n316|\t\t\t\ttt.httpStubs(t, httpReg)\n317|\t\t\t}\n318|\n319|\t\t\topts := &tt.opts\n320|\t\t\topts.HTTPClient = &http.Client{Transport: httpReg}\n321|\t\t\topts.IO = ios\n322|\t\t\t//nolint:staticcheck // SA1019: prompt.NewAskStubber is deprecated: use PrompterMock\n323|\t\t\tas := prompt.NewAskStubber(t)\n324|\t\t\tif tt.askStubs != nil {\n325|\t\t\t\ttt.askStubs(as)\n326|\t\t\t}\n327|\n328|\t\t\terr := editRun(context.Background(), opts)\n329|\t\t\tif tt.wantsErr == \"\" {\n330|\t\t\t\trequire.NoError(t, err)\n331|\t\t\t} else {\n332|\t\t\t\tassert.EqualError(t, err, tt.wantsErr)\n333|\t\t\t\treturn\n334|\t\t\t}\n335|\t\t})\n336|\t}\n337|}\n338|\n339|func sp(v string) *string {\n340|\treturn &v\n341|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npkg/cmd/repo/edit/edit.go\nline: 59\nfunction: NewCmdEdit\nfunction: editRun\nfunction: interactiveRepoEdit\n\napi/queries_repo.go\nline: 22\n\npkg/cmd/repo/edit/edit_test.go\nfunction: Test_editRun_interactive\n```",
          "```\npkg/cmd/repo/edit/edit.go\nclass: EditRepositoryInput\nfunction: NewCmdEdit\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npkg/cmd/repo/edit/edit.go\nline: 59\nfunction: NewCmdEdit\nfunction: editRun\nfunction: interactiveRepoEdit\n\napi/queries_repo.go\nline: 22\n\npkg/cmd/repo/edit/edit_test.go\nfunction: Test_editRun_interactive\n```",
            "```\npkg/cmd/repo/edit/edit.go\nclass: EditRepositoryInput\nfunction: NewCmdEdit\n```"
          ]
        }
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "pkg/cmd/repo/edit/edit.go": [
          "class: EditRepositoryInput\nfunction: NewCmdEdit"
        ],
        "pkg/cmd/repo/edit/edit_test.go": [
          ""
        ],
        "api/queries_repo.go": [
          ""
        ]
      },
      "patches": [
        "diff --git a/pkg/cmd/repo/edit/edit.go b/pkg/cmd/repo/edit/edit.go\nindex d4ac91a..c282ac3 100644\n--- a/pkg/cmd/repo/edit/edit.go\n+++ b/pkg/cmd/repo/edit/edit.go\n@@ -60,6 +60,7 @@ type EditRepositoryInput struct {\n \tAllowForking        *bool   `json:\"allow_forking,omitempty\"`\n \tDefaultBranch       *string `json:\"default_branch,omitempty\"`\n \tDeleteBranchOnMerge *bool   `json:\"delete_branch_on_merge,omitempty\"`\n+\tAllowUpdateBranch   *bool   `json:\"allow_update_branch,omitempty\"`\n \tDescription         *string `json:\"description,omitempty\"`\n \tEnableAutoMerge     *bool   `json:\"allow_auto_merge,omitempty\"`\n \tEnableIssues        *bool   `json:\"has_issues,omitempty\"`\n@@ -150,6 +151,7 @@ func NewCmdEdit(f *cmdutil.Factory, runF func(options *EditOptions) error) *cobr\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableRebaseMerge, \"enable-rebase-merge\", \"\", \"Enable merging pull requests via rebase\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableAutoMerge, \"enable-auto-merge\", \"\", \"Enable auto-merge functionality\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.DeleteBranchOnMerge, \"delete-branch-on-merge\", \"\", \"Delete head branch when pull requests are merged\")\n+\tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowUpdateBranch, \"allow-update-branch\", \"\", \"Always suggest updating pull request branches\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowForking, \"allow-forking\", \"\", \"Allow forking of an organization repository\")\n \tcmd.Flags().StringSliceVar(&opts.AddTopics, \"add-topic\", nil, \"Add repository topic\")\n \tcmd.Flags().StringSliceVar(&opts.RemoveTopics, \"remove-topic\", nil, \"Remove repository topic\")\n",
        "diff --git a/api/queries_repo.go b/api/queries_repo.go\nindex 931e2ad..f2d25d6 100644\n--- a/api/queries_repo.go\n+++ b/api/queries_repo.go\n@@ -30,6 +30,7 @@ type Repository struct {\n \tHomepageURL              string\n \tOpenGraphImageURL        string\n \tUsesCustomOpenGraphImage bool\n+\tAllowUpdateBranch        bool\n \tURL                      string\n \tSSHURL                   string\n \tMirrorURL                string\ndiff --git a/pkg/cmd/repo/edit/edit.go b/pkg/cmd/repo/edit/edit.go\nindex d4ac91a..2f3cbab 100644\n--- a/pkg/cmd/repo/edit/edit.go\n+++ b/pkg/cmd/repo/edit/edit.go\n@@ -70,6 +70,7 @@ type EditRepositoryInput struct {\n \tEnableWiki          *bool   `json:\"has_wiki,omitempty\"`\n \tHomepage            *string `json:\"homepage,omitempty\"`\n \tIsTemplate          *bool   `json:\"is_template,omitempty\"`\n+\tAllowUpdateBranch   *bool   `json:\"allow_update_branch,omitempty\"`\n \tVisibility          *string `json:\"visibility,omitempty\"`\n }\n \n@@ -150,6 +151,7 @@ func NewCmdEdit(f *cmdutil.Factory, runF func(options *EditOptions) error) *cobr\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableRebaseMerge, \"enable-rebase-merge\", \"\", \"Enable merging pull requests via rebase\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableAutoMerge, \"enable-auto-merge\", \"\", \"Enable auto-merge functionality\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.DeleteBranchOnMerge, \"delete-branch-on-merge\", \"\", \"Delete head branch when pull requests are merged\")\n+\tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowUpdateBranch, \"allow-update-branch\", \"\", \"Always suggest updating pull request branches\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowForking, \"allow-forking\", \"\", \"Allow forking of an organization repository\")\n \tcmd.Flags().StringSliceVar(&opts.AddTopics, \"add-topic\", nil, \"Add repository topic\")\n \tcmd.Flags().StringSliceVar(&opts.RemoveTopics, \"remove-topic\", nil, \"Remove repository topic\")\n@@ -175,6 +177,7 @@ func editRun(ctx context.Context, opts *EditOptions) error {\n \t\tfieldsToRetrieve := []string{\n \t\t\t\"defaultBranchRef\",\n \t\t\t\"deleteBranchOnMerge\",\n+\t\t\t\"allowUpdateBranch\",\n \t\t\t\"description\",\n \t\t\t\"hasIssuesEnabled\",\n \t\t\t\"hasProjectsEnabled\",\n@@ -444,6 +447,16 @@ func interactiveRepoEdit(opts *EditOptions, r *api.Repository) error {\n \t\t\tif err != nil {\n \t\t\t\treturn err\n \t\t\t}\n+\n+\t\t\topts.Edits.AllowUpdateBranch = &r.AllowUpdateBranch\n+\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n+\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n+\t\t\t\tMessage: \"Always suggest updating pull request branches?\",\n+\t\t\t\tDefault: r.AllowUpdateBranch,\n+\t\t\t}, opts.Edits.AllowUpdateBranch)\n+\t\t\tif err != nil {\n+\t\t\t\treturn err\n+\t\t\t}\n \t\tcase optionTemplateRepo:\n \t\t\topts.Edits.IsTemplate = &r.IsTemplate\n \t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n"
      ],
      "edit_loc_traj": {
        "prompt": "\nPlease review the following GitHub problem description and relevant files, and provide a set of locations that need to be edited to fix the issue.\nThe locations can be specified as class names, function or method names, or exact line numbers that require modification.\n\n### GitHub Problem Description ###\nAbility to set/unset \"Always suggest updating pull request branches\" in repo edit\n### Describe the feature or problem you’d like to solve\r\n\r\nI'd like to suggest adding an option to the `repo edit` command to enable the \"allow update branch\" checkbox. \r\n\r\n### Proposed solution\r\n\r\nIn line with the other options on this command, add a new flag `--allow-update-branch`. Should all options be editable in the interactive mode? I don't know whether this checkbox is always present or if it's feature dependant.\r\n\r\n### Additional context\r\n\r\nAs seen in the GitHub UI:\r\n\r\n<img width=\"820\" alt=\"image\" src=\"https://user-images.githubusercontent.com/861044/206558913-a14175d1-c712-44ea-ab1e-b9c0ff84c07c.png\">\r\n\n\n###\n### pkg/cmd/repo/edit/edit.go\n...\n48|\tIO              *iostreams.IOStreams\n49|\tEdits           EditRepositoryInput\n50|\tAddTopics       []string\n51|\tRemoveTopics    []string\n52|\tInteractiveMode bool\n53|\tDetector        fd.Detector\n54|\t// Cache of current repo topics to avoid retrieving them\n55|\t// in multiple flows.\n56|\ttopicsCache []string\n57|}\n58|\n59|type EditRepositoryInput struct {\n60|\tAllowForking        *bool   `json:\"allow_forking,omitempty\"`\n61|\tDefaultBranch       *string `json:\"default_branch,omitempty\"`\n62|\tDeleteBranchOnMerge *bool   `json:\"delete_branch_on_merge,omitempty\"`\n63|\tDescription         *string `json:\"description,omitempty\"`\n64|\tEnableAutoMerge     *bool   `json:\"allow_auto_merge,omitempty\"`\n65|\tEnableIssues        *bool   `json:\"has_issues,omitempty\"`\n66|\tEnableMergeCommit   *bool   `json:\"allow_merge_commit,omitempty\"`\n67|\tEnableProjects      *bool   `json:\"has_projects,omitempty\"`\n68|\tEnableRebaseMerge   *bool   `json:\"allow_rebase_merge,omitempty\"`\n69|\tEnableSquashMerge   *bool   `json:\"allow_squash_merge,omitempty\"`\n70|\tEnableWiki          *bool   `json:\"has_wiki,omitempty\"`\n71|\tHomepage            *string `json:\"homepage,omitempty\"`\n72|\tIsTemplate          *bool   `json:\"is_template,omitempty\"`\n73|\tVisibility          *string `json:\"visibility,omitempty\"`\n74|}\n75|\n76|func NewCmdEdit(f *cmdutil.Factory, runF func(options *EditOptions) error) *cobra.Command {\n77|\topts := &EditOptions{\n78|\t\tIO: f.IOStreams,\n79|\t}\n80|\n81|\tcmd := &cobra.Command{\n82|\t\tUse:   \"edit [<repository>]\",\n83|\t\tShort: \"Edit repository settings\",\n84|\t\tAnnotations: map[string]string{\n85|\t\t\t\"help:arguments\": heredoc.Doc(`\n86|\t\t\t\tA repository can be supplied as an argument in any of the following formats:\n87|\t\t\t\t- \"OWNER/REPO\"\n88|\t\t\t\t- by URL, e.g. \"https://github.com/OWNER/REPO\"\n89|\t\t\t`),\n90|\t\t},\n91|\t\tLong: heredoc.Docf(`\n92|\t\t\tEdit repository settings.\n93|\n94|\t\t\tTo toggle a setting off, use the %[1]s--flag=false%[1]s syntax.\n95|\t\t`, \"`\"),\n96|\t\tArgs: cobra.MaximumNArgs(1),\n97|\t\tExample: heredoc.Doc(`\n98|\t\t\t# enable issues and wiki\n99|\t\t\tgh repo edit --enable-issues --enable-wiki\n100|\n101|\t\t\t# disable projects\n102|\t\t\tgh repo edit --enable-projects=false\n103|\t\t`),\n104|\t\tRunE: func(cmd *cobra.Command, args []string) error {\n105|\t\t\tif len(args) > 0 {\n106|\t\t\t\tvar err error\n107|\t\t\t\topts.Repository, err = ghrepo.FromFullName(args[0])\n108|\t\t\t\tif err != nil {\n109|\t\t\t\t\treturn err\n110|\t\t\t\t}\n111|\t\t\t} else {\n112|\t\t\t\tvar err error\n113|\t\t\t\topts.Repository, err = f.BaseRepo()\n114|\t\t\t\tif err != nil {\n115|\t\t\t\t\treturn err\n116|\t\t\t\t}\n117|\t\t\t}\n118|\n119|\t\t\tif httpClient, err := f.HttpClient(); err == nil {\n120|\t\t\t\topts.HTTPClient = httpClient\n121|\t\t\t} else {\n122|\t\t\t\treturn err\n123|\t\t\t}\n124|\n125|\t\t\tif cmd.Flags().NFlag() == 0 {\n126|\t\t\t\topts.InteractiveMode = true\n127|\t\t\t}\n128|\n129|\t\t\tif opts.InteractiveMode && !opts.IO.CanPrompt() {\n130|\t\t\t\treturn cmdutil.FlagErrorf(\"specify properties to edit when not running interactively\")\n131|\t\t\t}\n132|\n133|\t\t\tif runF != nil {\n134|\t\t\t\treturn runF(opts)\n135|\t\t\t}\n136|\t\t\treturn editRun(cmd.Context(), opts)\n137|\t\t},\n138|\t}\n139|\n140|\tcmdutil.NilStringFlag(cmd, &opts.Edits.Description, \"description\", \"d\", \"Description of the repository\")\n141|\tcmdutil.NilStringFlag(cmd, &opts.Edits.Homepage, \"homepage\", \"h\", \"Repository home page `URL`\")\n142|\tcmdutil.NilStringFlag(cmd, &opts.Edits.DefaultBranch, \"default-branch\", \"\", \"Set the default branch `name` for the repository\")\n143|\tcmdutil.NilStringFlag(cmd, &opts.Edits.Visibility, \"visibility\", \"\", \"Change the visibility of the repository to {public,private,internal}\")\n144|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.IsTemplate, \"template\", \"\", \"Make the repository available as a template repository\")\n145|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableIssues, \"enable-issues\", \"\", \"Enable issues in the repository\")\n146|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableProjects, \"enable-projects\", \"\", \"Enable projects in the repository\")\n147|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableWiki, \"enable-wiki\", \"\", \"Enable wiki in the repository\")\n148|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableMergeCommit, \"enable-merge-commit\", \"\", \"Enable merging pull requests via merge commit\")\n149|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableSquashMerge, \"enable-squash-merge\", \"\", \"Enable merging pull requests via squashed commit\")\n150|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableRebaseMerge, \"enable-rebase-merge\", \"\", \"Enable merging pull requests via rebase\")\n151|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableAutoMerge, \"enable-auto-merge\", \"\", \"Enable auto-merge functionality\")\n152|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.DeleteBranchOnMerge, \"delete-branch-on-merge\", \"\", \"Delete head branch when pull requests are merged\")\n153|\tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowForking, \"allow-forking\", \"\", \"Allow forking of an organization repository\")\n154|\tcmd.Flags().StringSliceVar(&opts.AddTopics, \"add-topic\", nil, \"Add repository topic\")\n155|\tcmd.Flags().StringSliceVar(&opts.RemoveTopics, \"remove-topic\", nil, \"Remove repository topic\")\n156|\n157|\treturn cmd\n158|}\n159|\n160|func editRun(ctx context.Context, opts *EditOptions) error {\n161|\trepo := opts.Repository\n162|\n163|\tif opts.InteractiveMode {\n164|\t\tdetector := opts.Detector\n165|\t\tif detector == nil {\n166|\t\t\tcachedClient := api.NewCachedHTTPClient(opts.HTTPClient, time.Hour*24)\n167|\t\t\tdetector = fd.NewDetector(cachedClient, repo.RepoHost())\n168|\t\t}\n169|\t\trepoFeatures, err := detector.RepositoryFeatures()\n170|\t\tif err != nil {\n171|\t\t\treturn err\n172|\t\t}\n173|\n174|\t\tapiClient := api.NewClientFromHTTP(opts.HTTPClient)\n175|\t\tfieldsToRetrieve := []string{\n176|\t\t\t\"defaultBranchRef\",\n177|\t\t\t\"deleteBranchOnMerge\",\n178|\t\t\t\"description\",\n179|\t\t\t\"hasIssuesEnabled\",\n180|\t\t\t\"hasProjectsEnabled\",\n181|\t\t\t\"hasWikiEnabled\",\n182|\t\t\t\"homepageUrl\",\n183|\t\t\t\"isInOrganization\",\n184|\t\t\t\"isTemplate\",\n185|\t\t\t\"mergeCommitAllowed\",\n186|\t\t\t\"rebaseMergeAllowed\",\n187|\t\t\t\"repositoryTopics\",\n188|\t\t\t\"squashMergeAllowed\",\n189|\t\t}\n190|\t\tif repoFeatures.VisibilityField {\n191|\t\t\tfieldsToRetrieve = append(fieldsToRetrieve, \"visibility\")\n192|\t\t}\n193|\t\tif repoFeatures.AutoMerge {\n194|\t\t\tfieldsToRetrieve = append(fieldsToRetrieve, \"autoMergeAllowed\")\n195|\t\t}\n196|\n197|\t\topts.IO.StartProgressIndicator()\n198|\t\tfetchedRepo, err := api.FetchRepository(apiClient, opts.Repository, fieldsToRetrieve)\n199|\t\topts.IO.StopProgressIndicator()\n200|\t\tif err != nil {\n201|\t\t\treturn err\n202|\t\t}\n203|\t\terr = interactiveRepoEdit(opts, fetchedRepo)\n204|\t\tif err != nil {\n205|\t\t\treturn err\n206|\t\t}\n207|\t}\n208|\n209|\tapiPath := fmt.Sprintf(\"repos/%s/%s\", repo.RepoOwner(), repo.RepoName())\n210|\n211|\tbody := &bytes.Buffer{}\n212|\tenc := json.NewEncoder(body)\n213|\tif err := enc.Encode(opts.Edits); err != nil {\n214|\t\treturn err\n215|\t}\n216|\n217|\tg := errgroup.Group{}\n218|\n219|\tif body.Len() > 3 {\n220|\t\tg.Go(func() error {\n221|\t\t\tapiClient := api.NewClientFromHTTP(opts.HTTPClient)\n222|\t\t\t_, err := api.CreateRepoTransformToV4(apiClient, repo.RepoHost(), \"PATCH\", apiPath, body)\n223|\t\t\treturn err\n224|\t\t})\n225|\t}\n226|\n227|\tif len(opts.AddTopics) > 0 || len(opts.RemoveTopics) > 0 {\n228|\t\tg.Go(func() error {\n229|\t\t\t// opts.topicsCache gets populated in interactive mode\n230|\t\t\tif !opts.InteractiveMode {\n231|\t\t\t\tvar err error\n232|\t\t\t\topts.topicsCache, err = getTopics(ctx, opts.HTTPClient, repo)\n233|\t\t\t\tif err != nil {\n234|\t\t\t\t\treturn err\n235|\t\t\t\t}\n236|\t\t\t}\n237|\t\t\toldTopics := set.NewStringSet()\n238|\t\t\toldTopics.AddValues(opts.topicsCache)\n239|\n240|\t\t\tnewTopics := set.NewStringSet()\n241|\t\t\tnewTopics.AddValues(opts.topicsCache)\n242|\t\t\tnewTopics.AddValues(opts.AddTopics)\n243|\t\t\tnewTopics.RemoveValues(opts.RemoveTopics)\n244|\n245|\t\t\tif oldTopics.Equal(newTopics) {\n246|\t\t\t\treturn nil\n247|\t\t\t}\n248|\t\t\treturn setTopics(ctx, opts.HTTPClient, repo, newTopics.ToSlice())\n249|\t\t})\n250|\t}\n251|\n252|\terr := g.Wait()\n253|\tif err != nil {\n254|\t\treturn err\n255|\t}\n256|\n257|\tif opts.IO.IsStdoutTTY() {\n258|\t\tcs := opts.IO.ColorScheme()\n259|\t\tfmt.Fprintf(opts.IO.Out,\n260|\t\t\t\"%s Edited repository %s\\n\",\n261|\t\t\tcs.SuccessIcon(),\n262|\t\t\tghrepo.FullName(repo))\n263|\t}\n264|\n265|\treturn nil\n266|}\n267|\n268|func interactiveChoice(r *api.Repository) ([]string, error) {\n269|\toptions := []string{\n270|\t\toptionDefaultBranchName,\n271|\t\toptionDescription,\n272|\t\toptionHomePageURL,\n273|\t\toptionIssues,\n274|\t\toptionMergeOptions,\n275|\t\toptionProjects,\n276|\t\toptionTemplateRepo,\n277|\t\toptionTopics,\n278|\t\toptionVisibility,\n279|\t\toptionWikis,\n280|\t}\n281|\tif r.IsInOrganization {\n282|\t\toptions = append(options, optionAllowForking)\n283|\t}\n284|\tvar answers []string\n285|\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n286|\terr := prompt.SurveyAskOne(&survey.MultiSelect{\n287|\t\tMessage: \"What do you want to edit?\",\n288|\t\tOptions: options,\n289|\t}, &answers, survey.WithPageSize(11))\n290|\treturn answers, err\n291|}\n292|\n293|func interactiveRepoEdit(opts *EditOptions, r *api.Repository) error {\n294|\tfor _, v := range r.RepositoryTopics.Nodes {\n295|\t\topts.topicsCache = append(opts.topicsCache, v.Topic.Name)\n296|\t}\n297|\tchoices, err := interactiveChoice(r)\n298|\tif err != nil {\n299|\t\treturn err\n300|\t}\n301|\tfor _, c := range choices {\n302|\t\tswitch c {\n303|\t\tcase optionDescription:\n304|\t\t\topts.Edits.Description = &r.Description\n305|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n306|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n307|\t\t\t\tMessage: \"Description of the repository\",\n308|\t\t\t\tDefault: r.Description,\n309|\t\t\t}, opts.Edits.Description)\n310|\t\t\tif err != nil {\n311|\t\t\t\treturn err\n312|\t\t\t}\n313|\t\tcase optionHomePageURL:\n314|\t\t\topts.Edits.Homepage = &r.HomepageURL\n315|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n316|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n317|\t\t\t\tMessage: \"Repository home page URL\",\n318|\t\t\t\tDefault: r.HomepageURL,\n319|\t\t\t}, opts.Edits.Homepage)\n320|\t\t\tif err != nil {\n321|\t\t\t\treturn err\n322|\t\t\t}\n323|\t\tcase optionTopics:\n324|\t\t\tvar addTopics string\n325|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n326|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n327|\t\t\t\tMessage: \"Add topics?(csv format)\",\n328|\t\t\t}, &addTopics)\n329|\t\t\tif err != nil {\n330|\t\t\t\treturn err\n331|\t\t\t}\n332|\t\t\tif len(strings.TrimSpace(addTopics)) > 0 {\n333|\t\t\t\topts.AddTopics = parseTopics(addTopics)\n334|\t\t\t}\n335|\n336|\t\t\tif len(opts.topicsCache) > 0 {\n337|\t\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n338|\t\t\t\terr = prompt.SurveyAskOne(&survey.MultiSelect{\n339|\t\t\t\t\tMessage: \"Remove Topics\",\n340|\t\t\t\t\tOptions: opts.topicsCache,\n341|\t\t\t\t}, &opts.RemoveTopics)\n342|\t\t\t\tif err != nil {\n343|\t\t\t\t\treturn err\n344|\t\t\t\t}\n345|\t\t\t}\n346|\t\tcase optionDefaultBranchName:\n347|\t\t\topts.Edits.DefaultBranch = &r.DefaultBranchRef.Name\n348|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n349|\t\t\terr = prompt.SurveyAskOne(&survey.Input{\n350|\t\t\t\tMessage: \"Default branch name\",\n351|\t\t\t\tDefault: r.DefaultBranchRef.Name,\n352|\t\t\t}, opts.Edits.DefaultBranch)\n353|\t\t\tif err != nil {\n354|\t\t\t\treturn err\n355|\t\t\t}\n356|\t\tcase optionWikis:\n357|\t\t\topts.Edits.EnableWiki = &r.HasWikiEnabled\n358|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n359|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n360|\t\t\t\tMessage: \"Enable Wikis?\",\n361|\t\t\t\tDefault: r.HasWikiEnabled,\n362|\t\t\t}, opts.Edits.EnableWiki)\n363|\t\t\tif err != nil {\n364|\t\t\t\treturn err\n365|\t\t\t}\n366|\t\tcase optionIssues:\n367|\t\t\topts.Edits.EnableIssues = &r.HasIssuesEnabled\n368|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n369|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n370|\t\t\t\tMessage: \"Enable Issues?\",\n371|\t\t\t\tDefault: r.HasIssuesEnabled,\n372|\t\t\t}, opts.Edits.EnableIssues)\n373|\t\t\tif err != nil {\n374|\t\t\t\treturn err\n375|\t\t\t}\n376|\t\tcase optionProjects:\n377|\t\t\topts.Edits.EnableProjects = &r.HasProjectsEnabled\n378|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n379|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n380|\t\t\t\tMessage: \"Enable Projects?\",\n381|\t\t\t\tDefault: r.HasProjectsEnabled,\n382|\t\t\t}, opts.Edits.EnableProjects)\n383|\t\t\tif err != nil {\n384|\t\t\t\treturn err\n385|\t\t\t}\n386|\t\tcase optionVisibility:\n387|\t\t\topts.Edits.Visibility = &r.Visibility\n388|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n389|\t\t\terr = prompt.SurveyAskOne(&survey.Select{\n390|\t\t\t\tMessage: \"Visibility\",\n391|\t\t\t\tOptions: []string{\"public\", \"private\", \"internal\"},\n392|\t\t\t\tDefault: strings.ToLower(r.Visibility),\n393|\t\t\t}, opts.Edits.Visibility)\n394|\t\t\tif err != nil {\n395|\t\t\t\treturn err\n396|\t\t\t}\n397|\t\tcase optionMergeOptions:\n398|\t\t\tvar defaultMergeOptions []string\n399|\t\t\tvar selectedMergeOptions []string\n400|\t\t\tif r.MergeCommitAllowed {\n401|\t\t\t\tdefaultMergeOptions = append(defaultMergeOptions, allowMergeCommits)\n402|\t\t\t}\n403|\t\t\tif r.SquashMergeAllowed {\n404|\t\t\t\tdefaultMergeOptions = append(defaultMergeOptions, allowSquashMerge)\n405|\t\t\t}\n406|\t\t\tif r.RebaseMergeAllowed {\n407|\t\t\t\tdefaultMergeOptions = append(defaultMergeOptions, allowRebaseMerge)\n408|\t\t\t}\n409|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n410|\t\t\terr = prompt.SurveyAskOne(&survey.MultiSelect{\n411|\t\t\t\tMessage: \"Allowed merge strategies\",\n412|\t\t\t\tDefault: defaultMergeOptions,\n413|\t\t\t\tOptions: []string{allowMergeCommits, allowSquashMerge, allowRebaseMerge},\n414|\t\t\t}, &selectedMergeOptions)\n415|\t\t\tif err != nil {\n416|\t\t\t\treturn err\n417|\t\t\t}\n418|\t\t\tenableMergeCommit := isIncluded(allowMergeCommits, selectedMergeOptions)\n419|\t\t\topts.Edits.EnableMergeCommit = &enableMergeCommit\n420|\t\t\tenableSquashMerge := isIncluded(allowSquashMerge, selectedMergeOptions)\n421|\t\t\topts.Edits.EnableSquashMerge = &enableSquashMerge\n422|\t\t\tenableRebaseMerge := isIncluded(allowRebaseMerge, selectedMergeOptions)\n423|\t\t\topts.Edits.EnableRebaseMerge = &enableRebaseMerge\n424|\t\t\tif !enableMergeCommit && !enableSquashMerge && !enableRebaseMerge {\n425|\t\t\t\treturn fmt.Errorf(\"you need to allow at least one merge strategy\")\n426|\t\t\t}\n427|\n428|\t\t\topts.Edits.EnableAutoMerge = &r.AutoMergeAllowed\n429|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n430|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n431|\t\t\t\tMessage: \"Enable Auto Merge?\",\n432|\t\t\t\tDefault: r.AutoMergeAllowed,\n433|\t\t\t}, opts.Edits.EnableAutoMerge)\n434|\t\t\tif err != nil {\n435|\t\t\t\treturn err\n436|\t\t\t}\n437|\n438|\t\t\topts.Edits.DeleteBranchOnMerge = &r.DeleteBranchOnMerge\n439|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n440|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n441|\t\t\t\tMessage: \"Automatically delete head branches after merging?\",\n442|\t\t\t\tDefault: r.DeleteBranchOnMerge,\n443|\t\t\t}, opts.Edits.DeleteBranchOnMerge)\n444|\t\t\tif err != nil {\n445|\t\t\t\treturn err\n446|\t\t\t}\n447|\t\tcase optionTemplateRepo:\n448|\t\t\topts.Edits.IsTemplate = &r.IsTemplate\n449|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n450|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n451|\t\t\t\tMessage: \"Convert into a template repository?\",\n452|\t\t\t\tDefault: r.IsTemplate,\n453|\t\t\t}, opts.Edits.IsTemplate)\n454|\t\t\tif err != nil {\n455|\t\t\t\treturn err\n456|\t\t\t}\n457|\t\tcase optionAllowForking:\n458|\t\t\topts.Edits.AllowForking = &r.ForkingAllowed\n459|\t\t\t//nolint:staticcheck // SA1019: prompt.SurveyAskOne is deprecated: use Prompter\n460|\t\t\terr = prompt.SurveyAskOne(&survey.Confirm{\n461|\t\t\t\tMessage: \"Allow forking (of an organization repository)?\",\n462|\t\t\t\tDefault: r.ForkingAllowed,\n463|\t\t\t}, opts.Edits.AllowForking)\n464|\t\t\tif err != nil {\n465|\t\t\t\treturn err\n466|\t\t\t}\n467|\t\t}\n468|\t}\n469|\treturn nil\n470|}\n471|\n472|func parseTopics(s string) []string {\n473|\ttopics := strings.Split(s, \",\")\n474|\tfor i, topic := range topics {\n475|\t\ttopics[i] = strings.TrimSpace(topic)\n476|\t}\n477|\treturn topics\n478|}\n479|\n...\n\n\n### api/queries_repo.go\n...\n11|\t\"strings\"\n12|\t\"time\"\n13|\n14|\t\"github.com/cli/cli/v2/internal/ghinstance\"\n15|\n16|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n17|\tghAPI \"github.com/cli/go-gh/pkg/api\"\n18|\t\"github.com/shurcooL/githubv4\"\n19|)\n20|\n21|// Repository contains information about a GitHub repo\n22|type Repository struct {\n23|\tID                       string\n24|\tName                     string\n25|\tNameWithOwner            string\n26|\tOwner                    RepositoryOwner\n27|\tParent                   *Repository\n28|\tTemplateRepository       *Repository\n29|\tDescription              string\n30|\tHomepageURL              string\n31|\tOpenGraphImageURL        string\n32|\tUsesCustomOpenGraphImage bool\n33|\tURL                      string\n34|\tSSHURL                   string\n35|\tMirrorURL                string\n36|\tSecurityPolicyURL        string\n37|\n38|\tCreatedAt time.Time\n39|\tPushedAt  *time.Time\n40|\tUpdatedAt time.Time\n41|\n42|\tIsBlankIssuesEnabled    bool\n43|\tIsSecurityPolicyEnabled bool\n44|\tHasIssuesEnabled        bool\n45|\tHasProjectsEnabled      bool\n46|\tHasWikiEnabled          bool\n47|\tMergeCommitAllowed      bool\n48|\tSquashMergeAllowed      bool\n49|\tRebaseMergeAllowed      bool\n50|\tAutoMergeAllowed        bool\n51|\n52|\tForkCount      int\n53|\tStargazerCount int\n54|\tWatchers       struct {\n55|\t\tTotalCount int `json:\"totalCount\"`\n56|\t}\n57|\tIssues struct {\n58|\t\tTotalCount int `json:\"totalCount\"`\n59|\t}\n60|\tPullRequests struct {\n61|\t\tTotalCount int `json:\"totalCount\"`\n62|\t}\n63|\n64|\tCodeOfConduct                 *CodeOfConduct\n65|\tContactLinks                  []ContactLink\n66|\tDefaultBranchRef              BranchRef\n67|\tDeleteBranchOnMerge           bool\n68|\tDiskUsage                     int\n69|\tFundingLinks                  []FundingLink\n70|\tIsArchived                    bool\n71|\tIsEmpty                       bool\n72|\tIsFork                        bool\n73|\tForkingAllowed                bool\n74|\tIsInOrganization              bool\n75|\tIsMirror                      bool\n76|\tIsPrivate                     bool\n77|\tIsTemplate                    bool\n78|\tIsUserConfigurationRepository bool\n79|\tLicenseInfo                   *RepositoryLicense\n80|\tViewerCanAdminister           bool\n81|\tViewerDefaultCommitEmail      string\n82|\tViewerDefaultMergeMethod      string\n83|\tViewerHasStarred              bool\n84|\tViewerPermission              string\n85|\tViewerPossibleCommitEmails    []string\n86|\tViewerSubscription            string\n87|\tVisibility                    string\n88|\n89|\tRepositoryTopics struct {\n90|\t\tNodes []struct {\n91|\t\t\tTopic RepositoryTopic\n92|\t\t}\n93|\t}\n94|\tPrimaryLanguage *CodingLanguage\n95|\tLanguages       struct {\n96|\t\tEdges []struct {\n97|\t\t\tSize int            `json:\"size\"`\n98|\t\t\tNode CodingLanguage `json:\"node\"`\n99|\t\t}\n100|\t}\n101|\tIssueTemplates       []IssueTemplate\n102|\tPullRequestTemplates []PullRequestTemplate\n103|\tLabels               struct {\n104|\t\tNodes []IssueLabel\n105|\t}\n106|\tMilestones struct {\n107|\t\tNodes []Milestone\n108|\t}\n109|\tLatestRelease *RepositoryRelease\n110|\n111|\tAssignableUsers struct {\n112|\t\tNodes []GitHubUser\n113|\t}\n114|\tMentionableUsers struct {\n115|\t\tNodes []GitHubUser\n116|\t}\n117|\tProjects struct {\n118|\t\tNodes []RepoProject\n119|\t}\n120|\n121|\t// pseudo-field that keeps track of host name of this repo\n122|\thostname string\n123|}\n124|\n125|// RepositoryOwner is the owner of a GitHub repository\n126|type RepositoryOwner struct {\n127|\tID    string `json:\"id\"`\n128|\tLogin string `json:\"login\"`\n129|}\n130|\n131|type GitHubUser struct {\n132|\tID    string `json:\"id\"`\n...\n228|\n229|// ViewerCanTriage is true when the requesting user can triage issues and pull requests\n230|func (r Repository) ViewerCanTriage() bool {\n231|\tswitch r.ViewerPermission {\n232|\tcase \"ADMIN\", \"MAINTAIN\", \"WRITE\", \"TRIAGE\":\n233|\t\treturn true\n234|\tdefault:\n235|\t\treturn false\n236|\t}\n237|}\n238|\n239|func FetchRepository(client *Client, repo ghrepo.Interface, fields []string) (*Repository, error) {\n240|\tquery := fmt.Sprintf(`query RepositoryInfo($owner: String!, $name: String!) {\n241|\t\trepository(owner: $owner, name: $name) {%s}\n242|\t}`, RepositoryGraphQL(fields))\n243|\n244|\tvariables := map[string]interface{}{\n245|\t\t\"owner\": repo.RepoOwner(),\n246|\t\t\"name\":  repo.RepoName(),\n247|\t}\n248|\n249|\tvar result struct {\n250|\t\tRepository *Repository\n251|\t}\n252|\tif err := client.GraphQL(repo.RepoHost(), query, variables, &result); err != nil {\n253|\t\treturn nil, err\n254|\t}\n255|\t// The GraphQL API should have returned an error in case of a missing repository, but this isn't\n256|\t// guaranteed to happen when an authentication token with insufficient permissions is being used.\n257|\tif result.Repository == nil {\n258|\t\treturn nil, GraphQLError{\n259|\t\t\tGQLError: ghAPI.GQLError{\n260|\t\t\t\tErrors: []ghAPI.GQLErrorItem{{\n261|\t\t\t\t\tType:    \"NOT_FOUND\",\n262|\t\t\t\t\tMessage: fmt.Sprintf(\"Could not resolve to a Repository with the name '%s/%s'.\", repo.RepoOwner(), repo.RepoName()),\n263|\t\t\t\t}},\n264|\t\t\t},\n265|\t\t}\n266|\t}\n267|\n268|\treturn InitRepoHostname(result.Repository, repo.RepoHost()), nil\n269|}\n270|\n271|func GitHubRepo(client *Client, repo ghrepo.Interface) (*Repository, error) {\n272|\tquery := `\n273|\tfragment repo on Repository {\n274|\t\tid\n275|\t\tname\n276|\t\towner { login }\n277|\t\thasIssuesEnabled\n278|\t\tdescription\n...\n\n\n### pkg/cmd/repo/edit/edit_test.go\n...\n10|\t\"github.com/cli/cli/v2/pkg/prompt\"\n11|\n12|\t\"github.com/cli/cli/v2/internal/ghrepo\"\n13|\t\"github.com/cli/cli/v2/pkg/cmdutil\"\n14|\t\"github.com/cli/cli/v2/pkg/httpmock\"\n15|\t\"github.com/cli/cli/v2/pkg/iostreams\"\n16|\t\"github.com/google/shlex\"\n17|\t\"github.com/stretchr/testify/assert\"\n18|\t\"github.com/stretchr/testify/require\"\n19|)\n20|\n21|func TestNewCmdEdit(t *testing.T) {\n22|\ttests := []struct {\n23|\t\tname     string\n24|\t\targs     string\n25|\t\twantOpts EditOptions\n26|\t\twantErr  string\n27|\t}{\n28|\t\t{\n29|\t\t\tname: \"change repo description\",\n30|\t\t\targs: \"--description hello\",\n31|\t\t\twantOpts: EditOptions{\n32|\t\t\t\tRepository: ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n33|\t\t\t\tEdits: EditRepositoryInput{\n34|\t\t\t\t\tDescription: sp(\"hello\"),\n35|\t\t\t\t},\n36|\t\t\t},\n37|\t\t},\n38|\t}\n39|\n40|\tfor _, tt := range tests {\n41|\t\tt.Run(tt.name, func(t *testing.T) {\n42|\t\t\tios, _, _, _ := iostreams.Test()\n43|\t\t\tios.SetStdoutTTY(true)\n44|\t\t\tios.SetStdinTTY(true)\n45|\t\t\tios.SetStderrTTY(true)\n46|\n47|\t\t\tf := &cmdutil.Factory{\n48|\t\t\t\tIOStreams: ios,\n49|\t\t\t\tBaseRepo: func() (ghrepo.Interface, error) {\n50|\t\t\t\t\treturn ghrepo.New(\"OWNER\", \"REPO\"), nil\n51|\t\t\t\t},\n52|\t\t\t\tHttpClient: func() (*http.Client, error) {\n53|\t\t\t\t\treturn nil, nil\n54|\t\t\t\t},\n55|\t\t\t}\n56|\n57|\t\t\targv, err := shlex.Split(tt.args)\n58|\t\t\tassert.NoError(t, err)\n59|\n60|\t\t\tvar gotOpts *EditOptions\n61|\t\t\tcmd := NewCmdEdit(f, func(opts *EditOptions) error {\n62|\t\t\t\tgotOpts = opts\n63|\t\t\t\treturn nil\n64|\t\t\t})\n65|\t\t\tcmd.Flags().BoolP(\"help\", \"x\", false, \"\")\n66|\n67|\t\t\tcmd.SetArgs(argv)\n68|\t\t\tcmd.SetIn(&bytes.Buffer{})\n69|\t\t\tcmd.SetOut(io.Discard)\n70|\t\t\tcmd.SetErr(io.Discard)\n71|\n72|\t\t\t_, err = cmd.ExecuteC()\n73|\t\t\tif tt.wantErr != \"\" {\n74|\t\t\t\tassert.EqualError(t, err, tt.wantErr)\n75|\t\t\t\treturn\n76|\t\t\t}\n77|\t\t\trequire.NoError(t, err)\n78|\n79|\t\t\tassert.Equal(t, ghrepo.FullName(tt.wantOpts.Repository), ghrepo.FullName(gotOpts.Repository))\n80|\t\t\tassert.Equal(t, tt.wantOpts.Edits, gotOpts.Edits)\n81|\t\t})\n82|\t}\n83|}\n84|\n85|func Test_editRun(t *testing.T) {\n86|\ttests := []struct {\n87|\t\tname        string\n88|\t\topts        EditOptions\n89|\t\thttpStubs   func(*testing.T, *httpmock.Registry)\n90|\t\twantsStderr string\n91|\t\twantsErr    string\n92|\t}{\n...\n149|\t\t\terr := editRun(context.Background(), opts)\n150|\t\t\tif tt.wantsErr == \"\" {\n151|\t\t\t\trequire.NoError(t, err)\n152|\t\t\t} else {\n153|\t\t\t\tassert.EqualError(t, err, tt.wantsErr)\n154|\t\t\t\treturn\n155|\t\t\t}\n156|\t\t})\n157|\t}\n158|}\n159|\n160|func Test_editRun_interactive(t *testing.T) {\n161|\ttests := []struct {\n162|\t\tname        string\n163|\t\topts        EditOptions\n164|\t\taskStubs    func(*prompt.AskStubber)\n165|\t\thttpStubs   func(*testing.T, *httpmock.Registry)\n166|\t\twantsStderr string\n167|\t\twantsErr    string\n168|\t}{\n169|\t\t{\n170|\t\t\tname: \"updates repo description\",\n171|\t\t\topts: EditOptions{\n172|\t\t\t\tRepository:      ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n173|\t\t\t\tInteractiveMode: true,\n174|\t\t\t},\n175|\t\t\taskStubs: func(as *prompt.AskStubber) {\n176|\t\t\t\tas.StubPrompt(\"What do you want to edit?\").AnswerWith([]string{\"Description\"})\n177|\t\t\t\tas.StubPrompt(\"Description of the repository\").AnswerWith(\"awesome repo description\")\n178|\t\t\t},\n179|\t\t\thttpStubs: func(t *testing.T, reg *httpmock.Registry) {\n180|\t\t\t\treg.Register(\n181|\t\t\t\t\thttpmock.GraphQL(`query RepositoryInfo\\b`),\n182|\t\t\t\t\thttpmock.StringResponse(`\n183|\t\t\t\t\t{\n184|\t\t\t\t\t\t\"data\": {\n185|\t\t\t\t\t\t\t\"repository\": {\n186|\t\t\t\t\t\t\t\t\"description\": \"old description\",\n187|\t\t\t\t\t\t\t\t\"homePageUrl\": \"https://url.com\",\n188|\t\t\t\t\t\t\t\t\"defaultBranchRef\": {\n189|\t\t\t\t\t\t\t\t\t\"name\": \"main\"\n190|\t\t\t\t\t\t\t\t},\n191|\t\t\t\t\t\t\t\t\"isInOrganization\": false,\n192|\t\t\t\t\t\t\t\t\"repositoryTopics\": {\n193|\t\t\t\t\t\t\t\t\t\"nodes\": [{\n194|\t\t\t\t\t\t\t\t\t\t\"topic\": {\n195|\t\t\t\t\t\t\t\t\t\t\t\"name\": \"x\"\n196|\t\t\t\t\t\t\t\t\t\t}\n197|\t\t\t\t\t\t\t\t\t}]\n198|\t\t\t\t\t\t\t\t}\n199|\t\t\t\t\t\t\t}\n200|\t\t\t\t\t\t}\n201|\t\t\t\t\t}`))\n202|\t\t\t\treg.Register(\n203|\t\t\t\t\thttpmock.REST(\"PATCH\", \"repos/OWNER/REPO\"),\n204|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n205|\t\t\t\t\t\tassert.Equal(t, \"awesome repo description\", payload[\"description\"])\n206|\t\t\t\t\t}))\n207|\t\t\t},\n208|\t\t},\n209|\t\t{\n210|\t\t\tname: \"updates repo topics\",\n211|\t\t\topts: EditOptions{\n212|\t\t\t\tRepository:      ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n213|\t\t\t\tInteractiveMode: true,\n214|\t\t\t},\n215|\t\t\taskStubs: func(as *prompt.AskStubber) {\n216|\t\t\t\tas.StubPrompt(\"What do you want to edit?\").AnswerWith([]string{\"Description\", \"Topics\"})\n217|\t\t\t\tas.StubPrompt(\"Description of the repository\").AnswerWith(\"awesome repo description\")\n218|\t\t\t\tas.StubPrompt(\"Add topics?(csv format)\").AnswerWith(\"a, b,c,d \")\n219|\t\t\t\tas.StubPrompt(\"Remove Topics\").AnswerWith([]string{\"x\"})\n220|\t\t\t},\n221|\t\t\thttpStubs: func(t *testing.T, reg *httpmock.Registry) {\n222|\t\t\t\treg.Register(\n223|\t\t\t\t\thttpmock.GraphQL(`query RepositoryInfo\\b`),\n224|\t\t\t\t\thttpmock.StringResponse(`\n225|\t\t\t\t\t{\n226|\t\t\t\t\t\t\"data\": {\n227|\t\t\t\t\t\t\t\"repository\": {\n228|\t\t\t\t\t\t\t\t\"description\": \"old description\",\n229|\t\t\t\t\t\t\t\t\"homePageUrl\": \"https://url.com\",\n230|\t\t\t\t\t\t\t\t\"defaultBranchRef\": {\n231|\t\t\t\t\t\t\t\t\t\"name\": \"main\"\n232|\t\t\t\t\t\t\t\t},\n233|\t\t\t\t\t\t\t\t\"isInOrganization\": false,\n234|\t\t\t\t\t\t\t\t\"repositoryTopics\": {\n235|\t\t\t\t\t\t\t\t\t\"nodes\": [{\n236|\t\t\t\t\t\t\t\t\t\t\"topic\": {\n237|\t\t\t\t\t\t\t\t\t\t\t\"name\": \"x\"\n238|\t\t\t\t\t\t\t\t\t\t}\n239|\t\t\t\t\t\t\t\t\t}]\n240|\t\t\t\t\t\t\t\t}\n241|\t\t\t\t\t\t\t}\n242|\t\t\t\t\t\t}\n243|\t\t\t\t\t}`))\n244|\t\t\t\treg.Register(\n245|\t\t\t\t\thttpmock.REST(\"PATCH\", \"repos/OWNER/REPO\"),\n246|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n247|\t\t\t\t\t\tassert.Equal(t, \"awesome repo description\", payload[\"description\"])\n248|\t\t\t\t\t}))\n249|\t\t\t\treg.Register(\n250|\t\t\t\t\thttpmock.REST(\"PUT\", \"repos/OWNER/REPO/topics\"),\n251|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n252|\t\t\t\t\t\tassert.Equal(t, []interface{}{\"a\", \"b\", \"c\", \"d\"}, payload[\"names\"])\n253|\t\t\t\t\t}))\n254|\t\t\t},\n255|\t\t},\n256|\t\t{\n257|\t\t\tname: \"updates repo merge options\",\n258|\t\t\topts: EditOptions{\n259|\t\t\t\tRepository:      ghrepo.NewWithHost(\"OWNER\", \"REPO\", \"github.com\"),\n260|\t\t\t\tInteractiveMode: true,\n261|\t\t\t},\n262|\t\t\taskStubs: func(as *prompt.AskStubber) {\n263|\t\t\t\tas.StubPrompt(\"What do you want to edit?\").AnswerWith([]string{\"Merge Options\"})\n264|\t\t\t\tas.StubPrompt(\"Allowed merge strategies\").AnswerWith([]string{allowMergeCommits, allowRebaseMerge})\n265|\t\t\t\tas.StubPrompt(\"Enable Auto Merge?\").AnswerWith(false)\n266|\t\t\t\tas.StubPrompt(\"Automatically delete head branches after merging?\").AnswerWith(false)\n267|\t\t\t},\n268|\t\t\thttpStubs: func(t *testing.T, reg *httpmock.Registry) {\n269|\t\t\t\treg.Register(\n270|\t\t\t\t\thttpmock.GraphQL(`query RepositoryInfo\\b`),\n271|\t\t\t\t\thttpmock.StringResponse(`\n272|\t\t\t\t\t{\n273|\t\t\t\t\t\t\"data\": {\n274|\t\t\t\t\t\t\t\"repository\": {\n275|\t\t\t\t\t\t\t\t\"description\": \"old description\",\n276|\t\t\t\t\t\t\t\t\"homePageUrl\": \"https://url.com\",\n277|\t\t\t\t\t\t\t\t\"defaultBranchRef\": {\n278|\t\t\t\t\t\t\t\t\t\"name\": \"main\"\n279|\t\t\t\t\t\t\t\t},\n280|\t\t\t\t\t\t\t\t\"isInOrganization\": false,\n281|\t\t\t\t\t\t\t\t\"squashMergeAllowed\": false,\n282|\t\t\t\t\t\t\t\t\"rebaseMergeAllowed\": true,\n283|\t\t\t\t\t\t\t\t\"mergeCommitAllowed\": true,\n284|\t\t\t\t\t\t\t\t\"deleteBranchOnMerge\": false,\n285|\t\t\t\t\t\t\t\t\"repositoryTopics\": {\n286|\t\t\t\t\t\t\t\t\t\"nodes\": [{\n287|\t\t\t\t\t\t\t\t\t\t\"topic\": {\n288|\t\t\t\t\t\t\t\t\t\t\t\"name\": \"x\"\n289|\t\t\t\t\t\t\t\t\t\t}\n290|\t\t\t\t\t\t\t\t\t}]\n291|\t\t\t\t\t\t\t\t}\n292|\t\t\t\t\t\t\t}\n293|\t\t\t\t\t\t}\n294|\t\t\t\t\t}`))\n295|\t\t\t\treg.Register(\n296|\t\t\t\t\thttpmock.REST(\"PATCH\", \"repos/OWNER/REPO\"),\n297|\t\t\t\t\thttpmock.RESTPayload(200, `{}`, func(payload map[string]interface{}) {\n298|\t\t\t\t\t\tassert.Equal(t, true, payload[\"allow_merge_commit\"])\n299|\t\t\t\t\t\tassert.Equal(t, false, payload[\"allow_squash_merge\"])\n300|\t\t\t\t\t\tassert.Equal(t, true, payload[\"allow_rebase_merge\"])\n301|\t\t\t\t\t}))\n302|\t\t\t},\n303|\t\t},\n304|\t}\n305|\n306|\tfor _, tt := range tests {\n307|\t\tt.Run(tt.name, func(t *testing.T) {\n308|\t\t\tios, _, _, _ := iostreams.Test()\n309|\t\t\tios.SetStdoutTTY(true)\n310|\t\t\tios.SetStdinTTY(true)\n311|\t\t\tios.SetStderrTTY(true)\n312|\n313|\t\t\thttpReg := &httpmock.Registry{}\n314|\t\t\tdefer httpReg.Verify(t)\n315|\t\t\tif tt.httpStubs != nil {\n316|\t\t\t\ttt.httpStubs(t, httpReg)\n317|\t\t\t}\n318|\n319|\t\t\topts := &tt.opts\n320|\t\t\topts.HTTPClient = &http.Client{Transport: httpReg}\n321|\t\t\topts.IO = ios\n322|\t\t\t//nolint:staticcheck // SA1019: prompt.NewAskStubber is deprecated: use PrompterMock\n323|\t\t\tas := prompt.NewAskStubber(t)\n324|\t\t\tif tt.askStubs != nil {\n325|\t\t\t\ttt.askStubs(as)\n326|\t\t\t}\n327|\n328|\t\t\terr := editRun(context.Background(), opts)\n329|\t\t\tif tt.wantsErr == \"\" {\n330|\t\t\t\trequire.NoError(t, err)\n331|\t\t\t} else {\n332|\t\t\t\tassert.EqualError(t, err, tt.wantsErr)\n333|\t\t\t\treturn\n334|\t\t\t}\n335|\t\t})\n336|\t}\n337|}\n338|\n339|func sp(v string) *string {\n340|\treturn &v\n341|}\n\n\n\n\n###\n\nPlease provide the class name, function or method name, or the exact line numbers that need to be edited.\nThe possible location outputs should be either \"class\", \"function\" or \"line\".\n\n### Examples:\n```\nfull_path1/file1.go\nline: 10\nclass: MyClass1\nline: 51\n\nfull_path2/file2.go\nfunction: MyClass2.my_method\nline: 12\n\nfull_path3/file3.go\nfunction: my_function\nline: 24\nline: 156\n```\n\nReturn just the location(s) wrapped with ```.\n",
        "response": [
          "```\npkg/cmd/repo/edit/edit.go\nline: 59\nfunction: NewCmdEdit\nfunction: editRun\nfunction: interactiveRepoEdit\n\napi/queries_repo.go\nline: 22\n\npkg/cmd/repo/edit/edit_test.go\nfunction: Test_editRun_interactive\n```",
          "```\npkg/cmd/repo/edit/edit.go\nclass: EditRepositoryInput\nfunction: NewCmdEdit\n```"
        ],
        "usage": {
          "completion_tokens": 0,
          "prompt_tokens": 0
        }
      },
      "additional_artifact_loc_edit_location": [
        {
          "raw_output_loc": [
            "```\npkg/cmd/repo/edit/edit.go\nline: 59\nfunction: NewCmdEdit\nfunction: editRun\nfunction: interactiveRepoEdit\n\napi/queries_repo.go\nline: 22\n\npkg/cmd/repo/edit/edit_test.go\nfunction: Test_editRun_interactive\n```",
            "```\npkg/cmd/repo/edit/edit.go\nclass: EditRepositoryInput\nfunction: NewCmdEdit\n```"
          ]
        }
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/pkg/cmd/repo/edit/edit.go b/pkg/cmd/repo/edit/edit.go\nindex d4ac91a..c282ac3 100644\n--- a/pkg/cmd/repo/edit/edit.go\n+++ b/pkg/cmd/repo/edit/edit.go\n@@ -60,6 +60,7 @@ type EditRepositoryInput struct {\n \tAllowForking        *bool   `json:\"allow_forking,omitempty\"`\n \tDefaultBranch       *string `json:\"default_branch,omitempty\"`\n \tDeleteBranchOnMerge *bool   `json:\"delete_branch_on_merge,omitempty\"`\n+\tAllowUpdateBranch   *bool   `json:\"allow_update_branch,omitempty\"`\n \tDescription         *string `json:\"description,omitempty\"`\n \tEnableAutoMerge     *bool   `json:\"allow_auto_merge,omitempty\"`\n \tEnableIssues        *bool   `json:\"has_issues,omitempty\"`\n@@ -150,6 +151,7 @@ func NewCmdEdit(f *cmdutil.Factory, runF func(options *EditOptions) error) *cobr\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableRebaseMerge, \"enable-rebase-merge\", \"\", \"Enable merging pull requests via rebase\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.EnableAutoMerge, \"enable-auto-merge\", \"\", \"Enable auto-merge functionality\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.DeleteBranchOnMerge, \"delete-branch-on-merge\", \"\", \"Delete head branch when pull requests are merged\")\n+\tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowUpdateBranch, \"allow-update-branch\", \"\", \"Always suggest updating pull request branches\")\n \tcmdutil.NilBoolFlag(cmd, &opts.Edits.AllowForking, \"allow-forking\", \"\", \"Allow forking of an organization repository\")\n \tcmd.Flags().StringSliceVar(&opts.AddTopics, \"add-topic\", nil, \"Add repository topic\")\n \tcmd.Flags().StringSliceVar(&opts.RemoveTopics, \"remove-topic\", nil, \"Remove repository topic\")\n",
  "7_resolved": true
}