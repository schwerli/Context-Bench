{
    "instance_id": "SWE-PolyBench__typescript__maintenance__bugfix__27393dd8",
    "original_id": "mui__material-ui-19121",
    "1_model_selected_files": [
        "packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js",
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.js",
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.test.js",
        "docs/src/pages/components/autocomplete/Grouped.js",
        "docs/src/pages/components/autocomplete/UseAutocomplete.js"
    ],
    "2_embedding_selected_files": [
        "docs/src/pages/components/autocomplete/Grouped.js",
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.js",
        "packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js",
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.test.js",
        "docs/src/pages/components/selects/GroupedSelect.js",
        "packages/material-ui-lab/src/useAutocomplete/useAutocomplete.d.ts",
        "docs/src/pages/components/autocomplete/Virtualize.js",
        "docs/src/pages/components/autocomplete/Playground.js",
        "docs/src/pages/components/checkboxes/CheckboxesGroup.js",
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.d.ts",
        "docs/src/pages/components/autocomplete/UseAutocomplete.js",
        "docs/src/pages/components/autocomplete/GitHubLabel.js",
        "packages/material-ui/src/ButtonGroup/ButtonGroup.js",
        "packages/material-ui/src/ButtonGroup/ButtonGroup.test.js",
        "docs/src/pages/components/autocomplete/CustomizedHook.js",
        "packages/material-ui/src/RadioGroup/RadioGroup.test.js",
        "packages/material-ui/src/RadioGroup/RadioGroup.js",
        "packages/material-ui-lab/src/AvatarGroup/AvatarGroup.js",
        "docs/src/pages/components/autocomplete/CheckboxesTags.js",
        "packages/material-ui/src/InputBase/InputBase.test.js",
        "packages/material-ui-lab/src/ToggleButtonGroup/ToggleButtonGroup.js",
        "packages/material-ui/src/Breadcrumbs/Breadcrumbs.test.js",
        "packages/material-ui-lab/src/ToggleButtonGroup/ToggleButtonGroup.test.js",
        "docs/src/pages/components/autocomplete/Highlights.js",
        "packages/material-ui-lab/src/TreeItem/TreeItem.test.js",
        "docs/src/pages/components/autocomplete/Sizes.js",
        "docs/src/pages/components/autocomplete/Tags.js",
        "packages/material-ui/src/Select/Select.test.js",
        "packages/material-ui/src/FormGroup/FormGroup.js",
        "packages/material-ui/src/FormGroup/FormGroup.test.js",
        "packages/material-ui-lab/src/AvatarGroup/AvatarGroup.test.js",
        "packages/material-ui-styles/src/createGenerateClassName/createGenerateClassNameHash.test.js",
        "packages/material-ui/src/Select/SelectInput.js",
        "docs/src/pages/components/autocomplete/FixedTags.js",
        "packages/material-ui/src/ButtonGroup/ButtonGroup.d.ts",
        "packages/material-ui/src/TextField/TextField.test.js",
        "docs/src/pages/components/buttons/GroupedButtons.js",
        "docs/src/pages/components/autocomplete/CountrySelect.js",
        "packages/material-ui/src/InputLabel/InputLabel.test.js",
        "packages/material-ui-lab/src/AvatarGroup/AvatarGroup.d.ts",
        "packages/material-ui-lab/src/TreeView/TreeView.test.js",
        "packages/material-ui/src/FormLabel/FormLabel.test.js",
        "packages/material-ui-utils/src/elementAcceptingRef.test.js",
        "packages/material-ui-utils/src/elementTypeAcceptingRef.test.js",
        "docs/src/pages/components/autocomplete/ComboBox.js",
        "docs/src/pages/components/switches/SwitchesGroup.js",
        "docs/src/modules/components/AppSearch.js",
        "packages/material-ui/src/SwipeableDrawer/SwipeableDrawer.test.js",
        "packages/material-ui-codemod/src/v4.0.0/optimal-imports.test/expected.js",
        "docs/src/pages/components/chips/ChipsPlayground.js",
        "packages/material-ui-codemod/src/v4.0.0/optimal-imports.test/actual.js",
        "packages/material-ui/src/Breadcrumbs/Breadcrumbs.js",
        "packages/material-ui/src/GridList/GridList.test.js",
        "packages/material-ui/src/InputBase/InputBase.js",
        "packages/material-ui/src/Tabs/Tabs.test.js"
    ],
    "3_final_combined_files": [
        "packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js",
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.js",
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.test.js",
        "docs/src/pages/components/autocomplete/Grouped.js"
    ],
    "4_related_elements": {
        "packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js": [
            "function: useAutocomplete\nfunction: getOptionProps\nfunction: setHighlightedIndex\nfunction: validOptionIndex\nfunction: changeHighlightedIndex\nfunction: handleListboxRef"
        ],
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.js": [
            "function: Autocomplete\nfunction: defaultRenderGroup\nfunction: renderListOption"
        ],
        "packages/material-ui-lab/src/Autocomplete/Autocomplete.test.js": [
            ""
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js": [
                    "function: useAutocomplete\nline: 785\nline: 786\nline: 788\nline: 789\nline: 790\nline: 791\nline: 792\nline: 793\nline: 794\nline: 795\nline: 796\nline: 798\nline: 799"
                ],
                "packages/material-ui-lab/src/Autocomplete/Autocomplete.js": [
                    ""
                ],
                "packages/material-ui-lab/src/Autocomplete/Autocomplete.test.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\nindex 3175a41..562ab33 100644\n--- a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n@@ -782,21 +782,30 @@ export default function useAutocomplete(props) {\n \n   let groupedOptions = filteredOptions;\n   if (groupBy) {\n-    groupedOptions = filteredOptions.reduce((acc, option, index) => {\n+    // Group options by key while preserving the order of first appearance\n+    const groups = new Map();\n+    const order = [];\n+    filteredOptions.forEach(option => {\n       const key = groupBy(option);\n-\n-      if (acc.length > 0 && acc[acc.length - 1].key === key) {\n-        acc[acc.length - 1].options.push(option);\n-      } else {\n-        acc.push({\n-          key,\n-          index,\n-          options: [option],\n-        });\n+      if (!groups.has(key)) {\n+        groups.set(key, []);\n+        order.push(key);\n       }\n+      groups.get(key).push(option);\n+    });\n \n-      return acc;\n-    }, []);\n+    // Compute the starting index for each group based on cumulative option counts\n+    let offset = 0;\n+    groupedOptions = order.map(key => {\n+      const optionsInGroup = groups.get(key);\n+      const group = {\n+        key,\n+        index: offset,\n+        options: optionsInGroup,\n+      };\n+      offset += optionsInGroup.length;\n+      return group;\n+    });\n   }\n \n   return {\n",
                "diff --git a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\nindex 3175a41..d992026 100644\n--- a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n@@ -782,21 +782,33 @@ export default function useAutocomplete(props) {\n \n   let groupedOptions = filteredOptions;\n   if (groupBy) {\n-    groupedOptions = filteredOptions.reduce((acc, option, index) => {\n+    const result = [];\n+    const indexByKey = new Map();\n+    let groupIndex = 0;\n+\n+    filteredOptions.forEach(option => {\n       const key = groupBy(option);\n \n-      if (acc.length > 0 && acc[acc.length - 1].key === key) {\n-        acc[acc.length - 1].options.push(option);\n-      } else {\n-        acc.push({\n+      if (!indexByKey.has(key)) {\n+        indexByKey.set(key, groupIndex);\n+        result.push({\n           key,\n-          index,\n-          options: [option],\n+          index: groupIndex,\n+          options: [],\n         });\n+        groupIndex += 1;\n       }\n+      result[indexByKey.get(key)].options.push(option);\n+    });\n+\n+    // Compute the starting index of each group in the flattened list\n+    let offset = 0;\n+    result.forEach(group => {\n+      group.index = offset;\n+      offset += group.options.length;\n+    });\n \n-      return acc;\n-    }, []);\n+    groupedOptions = result;\n   }\n \n   return {\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js": [
                    "line: 783\nline: 784\nline: 785\nline: 786\nline: 787\nline: 788\nline: 789\nline: 790\nline: 791\nline: 792\nline: 793\nline: 794\nline: 795\nline: 796\nline: 797\nline: 798\nline: 799\nline: 800"
                ],
                "packages/material-ui-lab/src/Autocomplete/Autocomplete.js": [
                    ""
                ],
                "packages/material-ui-lab/src/Autocomplete/Autocomplete.test.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\nindex 3175a41..366297f 100644\n--- a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n@@ -267,7 +267,7 @@ export default function useAutocomplete(props) {\n \n   let popupOpen = open;\n \n-  const filteredOptions = popupOpen\n+  let filteredOptions = popupOpen\n     ? filterOptions(\n         options.filter(option => {\n           if (\n@@ -782,21 +782,38 @@ export default function useAutocomplete(props) {\n \n   let groupedOptions = filteredOptions;\n   if (groupBy) {\n-    groupedOptions = filteredOptions.reduce((acc, option, index) => {\n+    // Aggregate options by group key while preserving the order of first appearance.\n+    const indexByKey = {};\n+    const groups = [];\n+\n+    for (let i = 0; i < filteredOptions.length; i += 1) {\n+      const option = filteredOptions[i];\n       const key = groupBy(option);\n \n-      if (acc.length > 0 && acc[acc.length - 1].key === key) {\n-        acc[acc.length - 1].options.push(option);\n-      } else {\n-        acc.push({\n+      if (indexByKey[key] === undefined) {\n+        indexByKey[key] = groups.length;\n+        groups.push({\n           key,\n-          index,\n-          options: [option],\n+          index: 0, // will be computed below\n+          options: [],\n         });\n       }\n \n-      return acc;\n-    }, []);\n+      groups[indexByKey[key]].options.push(option);\n+    }\n+\n+    // Compute the starting index for each group and flatten ordered options\n+    let startIndex = 0;\n+    const orderedOptions = [];\n+    for (let g = 0; g < groups.length; g += 1) {\n+      groups[g].index = startIndex;\n+      orderedOptions.push(...groups[g].options);\n+      startIndex += groups[g].options.length;\n+    }\n+\n+    groupedOptions = groups;\n+    // Reorder filteredOptions to match the grouped display order so indices remain consistent.\n+    filteredOptions = orderedOptions;\n   }\n \n   return {\n",
                "diff --git a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\nindex 3175a41..187de7a 100644\n--- a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n@@ -782,21 +782,38 @@ export default function useAutocomplete(props) {\n \n   let groupedOptions = filteredOptions;\n   if (groupBy) {\n-    groupedOptions = filteredOptions.reduce((acc, option, index) => {\n+    // Group options by key across the entire list (not just contiguous items)\n+    // and compute the starting index for each group based on the cumulative\n+    // number of options in preceding groups.\n+    const indexByKey = {};\n+    const result = [];\n+    let groupOrder = 0;\n+\n+    for (let i = 0; i < filteredOptions.length; i += 1) {\n+      const option = filteredOptions[i];\n       const key = groupBy(option);\n \n-      if (acc.length > 0 && acc[acc.length - 1].key === key) {\n-        acc[acc.length - 1].options.push(option);\n-      } else {\n-        acc.push({\n+      if (indexByKey[key] === undefined) {\n+        indexByKey[key] = groupOrder;\n+        result.push({\n           key,\n-          index,\n-          options: [option],\n+          index: groupOrder,\n+          options: [],\n         });\n+        groupOrder += 1;\n       }\n \n-      return acc;\n-    }, []);\n+      result[indexByKey[key]].options.push(option);\n+    }\n+\n+    // Compute the starting index within the flattened list for each group.\n+    let offset = 0;\n+    for (let i = 0; i < result.length; i += 1) {\n+      result[i].index = offset;\n+      offset += result[i].options.length;\n+    }\n+\n+    groupedOptions = result;\n   }\n \n   return {\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\nindex 3175a41..562ab33 100644\n--- a/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n+++ b/packages/material-ui-lab/src/useAutocomplete/useAutocomplete.js\n@@ -782,21 +782,30 @@ export default function useAutocomplete(props) {\n \n   let groupedOptions = filteredOptions;\n   if (groupBy) {\n-    groupedOptions = filteredOptions.reduce((acc, option, index) => {\n+    // Group options by key while preserving the order of first appearance\n+    const groups = new Map();\n+    const order = [];\n+    filteredOptions.forEach(option => {\n       const key = groupBy(option);\n-\n-      if (acc.length > 0 && acc[acc.length - 1].key === key) {\n-        acc[acc.length - 1].options.push(option);\n-      } else {\n-        acc.push({\n-          key,\n-          index,\n-          options: [option],\n-        });\n+      if (!groups.has(key)) {\n+        groups.set(key, []);\n+        order.push(key);\n       }\n+      groups.get(key).push(option);\n+    });\n \n-      return acc;\n-    }, []);\n+    // Compute the starting index for each group based on cumulative option counts\n+    let offset = 0;\n+    groupedOptions = order.map(key => {\n+      const optionsInGroup = groups.get(key);\n+      const group = {\n+        key,\n+        index: offset,\n+        options: optionsInGroup,\n+      };\n+      offset += optionsInGroup.length;\n+      return group;\n+    });\n   }\n \n   return {\n"
}