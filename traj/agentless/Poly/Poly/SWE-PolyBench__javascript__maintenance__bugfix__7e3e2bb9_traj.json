{
    "instance_id": "SWE-PolyBench__javascript__maintenance__bugfix__7e3e2bb9",
    "original_id": "sveltejs__svelte-3702",
    "1_model_selected_files": [
        "src/compiler/compile/render_dom/wrappers/EachBlock.ts",
        "src/compiler/compile/render_dom/wrappers/shared/get_context_merger.ts",
        "src/compiler/compile/render_dom/wrappers/DebugTag.ts"
    ],
    "2_embedding_selected_files": [
        "src/compiler/compile/render_dom/wrappers/EachBlock.ts",
        "src/compiler/compile/render_dom/index.ts",
        "src/compiler/compile/nodes/EachBlock.ts",
        "src/compiler/compile/render_dom/wrappers/InlineComponent/index.ts",
        "src/compiler/compile/nodes/shared/Expression.ts",
        "src/compiler/parse/state/mustache.ts",
        "src/compiler/compile/render_ssr/handlers/EachBlock.ts",
        "src/compiler/compile/index.ts",
        "src/compiler/compile/Component.ts",
        "src/compiler/compile/render_dom/wrappers/DebugTag.ts",
        "src/compiler/compile/render_ssr/index.ts",
        "src/compiler/preprocess/index.ts",
        "src/runtime/internal/ssr.ts",
        "src/runtime/internal/keyed_each.ts",
        "src/runtime/internal/index.ts",
        "src/compiler/compile/render_dom/wrappers/shared/bind_this.ts",
        "src/compiler/parse/index.ts",
        "src/compiler/compile/utils/invalidate.ts",
        "src/compiler/compile/render_ssr/handlers/InlineComponent.ts",
        "src/compiler/compile/render_dom/wrappers/IfBlock.ts",
        "src/compiler/compile/nodes/shared/TemplateScope.ts",
        "src/compiler/compile/render_dom/wrappers/AwaitBlock.ts",
        "src/compiler/compile/nodes/InlineComponent.ts",
        "src/runtime/index.ts",
        "src/compiler/compile/render_dom/wrappers/Element/index.ts",
        "src/compiler/compile/utils/__test__.ts",
        "src/compiler/compile/render_dom/wrappers/Slot.ts",
        "src/compiler/compile/render_dom/wrappers/shared/create_debugging_comment.ts",
        "src/runtime/internal/loop.ts",
        "src/compiler/compile/render_ssr/handlers/DebugTag.ts",
        "src/compiler/compile/render_dom/wrappers/Element/Binding.ts",
        "src/compiler/compile/render_dom/Block.ts",
        "src/compiler/compile/render_dom/wrappers/Fragment.ts",
        "src/compiler/index.ts",
        "src/compiler/utils/get_code_frame.ts",
        "src/compiler/compile/utils/scope.ts",
        "src/compiler/compile/render_dom/Renderer.ts",
        "src/compiler/parse/state/tag.ts",
        "src/compiler/interfaces.ts",
        "src/compiler/compile/nodes/shared/map_children.ts",
        "src/compiler/compile/nodes/DebugTag.ts",
        "src/compiler/parse/read/context.ts",
        "src/compiler/compile/utils/CodeBuilder.ts",
        "src/compiler/compile/utils/check_graph_for_cycles.ts",
        "src/compiler/compile/render_dom/wrappers/shared/get_context_merger.ts",
        "src/compiler/compile/nodes/PendingBlock.ts",
        "src/compiler/utils/error.ts",
        "src/compiler/compile/render_ssr/Renderer.ts",
        "src/compiler/compile/css/Selector.ts",
        "src/compiler/compile/utils/flatten_reference.ts",
        "src/compiler/compile/render_ssr/handlers/shared/get_slot_scope.ts",
        "src/runtime/easing/index.ts",
        "src/runtime/internal/spread.ts",
        "src/compiler/compile/utils/deindent.ts",
        "src/compiler/compile/nodes/Element.ts",
        "svelte/.eslintrc.js",
        "src/compiler/compile/render_ssr/handlers/AwaitBlock.ts",
        "src/runtime/transition/index.ts",
        "src/compiler/compile/create_module.ts",
        "svelte/rollup.config.js"
    ],
    "3_final_combined_files": [
        "src/compiler/compile/render_dom/wrappers/EachBlock.ts",
        "src/compiler/compile/render_dom/wrappers/shared/get_context_merger.ts",
        "src/compiler/compile/render_dom/wrappers/DebugTag.ts",
        "src/compiler/compile/render_dom/index.ts",
        "src/compiler/compile/nodes/EachBlock.ts"
    ],
    "4_related_elements": {
        "src/compiler/compile/render_dom/wrappers/EachBlock.ts": [
            "class: EachBlockWrapper\nclass: ElseBlockWrapper\nfunction: EachBlockWrapper.render\nfunction: EachBlockWrapper.render_keyed\nfunction: EachBlockWrapper.render_unkeyed\nvariable: index_name\nvariable: context_props\nvariable: vars\nvariable: this.block.bindings\nvariable: this.block.dependencies\nvariable: this.node.index\nfunction: create_debugging_comment\nfunction: attach_head"
        ],
        "src/compiler/compile/render_dom/wrappers/DebugTag.ts": [
            "class: DebugTagWrapper\nfunction: DebugTagWrapper.render\nvariable: var_lookup\nvariable: code\nvariable: renderer.options.dev"
        ],
        "src/compiler/compile/render_dom/wrappers/shared/get_context_merger.ts": [
            "function: get_context_merger"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/compiler/compile/render_dom/wrappers/DebugTag.ts": [
                    "function: DebugTagWrapper.render\nline: 53\nline: 54\nline: 55\nline: 56\nline: 57\nline: 58\nline: 59\nline: 60\nline: 62\nline: 63\nline: 64\nline: 65\nline: 66\nline: 67\nline: 68\nline: 69\nline: 71\nline: 72\nline: 73\nline: 74\nline: 75\nline: 76\nline: 77"
                ],
                "src/compiler/compile/render_dom/wrappers/EachBlock.ts": [
                    ""
                ],
                "src/compiler/compile/render_dom/wrappers/shared/get_context_merger.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/compiler/compile/render_dom/wrappers/DebugTag.ts b/src/compiler/compile/render_dom/wrappers/DebugTag.ts\nindex 5581154..52ae053 100644\n--- a/src/compiler/compile/render_dom/wrappers/DebugTag.ts\n+++ b/src/compiler/compile/render_dom/wrappers/DebugTag.ts\n@@ -50,18 +50,26 @@ export default class DebugTagWrapper extends Wrapper {\n \n \t\t\tconst condition = Array.from(dependencies).map(d => `changed.${d}`).join(' || ');\n \n-\t\t\tconst ctx_identifiers = this.node.expressions\n-\t\t\t\t.filter(e => {\n+\t\t\tconst ctx_declarations = this.node.expressions\n+\t\t\t\t.map(e => {\n \t\t\t\t\tconst looked_up_var = var_lookup.get(e.node.name);\n-\t\t\t\t\treturn !(looked_up_var && looked_up_var.hoistable);\n+\t\t\t\t\t// skip hoistable variables (module scope etc.)\n+\t\t\t\t\tif (looked_up_var && looked_up_var.hoistable) return null;\n+\t\t\t\t\t// map to ctx index if available\n+\t\t\t\t\tconst idx = looked_up_var && looked_up_var.index;\n+\t\t\t\t\tif (idx == null) return null;\n+\t\t\t\t\treturn `${e.node.name} = ctx[${idx}]`;\n \t\t\t\t})\n-\t\t\t\t.map(e => e.node.name)\n+\t\t\t\t.filter(Boolean)\n \t\t\t\t.join(', ');\n \t\t\tconst logged_identifiers = this.node.expressions.map(e => e.node.name).join(', ');\n \n+\t\t\tconst maybe_ctx_decls_update = ctx_declarations ? `const ${ctx_declarations};` : '';\n+\t\t\tconst maybe_ctx_decls_create = maybe_ctx_decls_update;\n+\n \t\t\tblock.builders.update.add_block(deindent`\n \t\t\t\tif (${condition}) {\n-\t\t\t\t\tconst { ${ctx_identifiers} } = ctx;\n+\t\t\t\t\t${maybe_ctx_decls_update}\n \t\t\t\t\t@_console.${log}({ ${logged_identifiers} });\n \t\t\t\t\tdebugger;\n \t\t\t\t}\n@@ -69,11 +77,11 @@ export default class DebugTagWrapper extends Wrapper {\n \n \t\t\tblock.builders.create.add_block(deindent`\n \t\t\t\t{\n-\t\t\t\t\tconst { ${ctx_identifiers} } = ctx;\n+\t\t\t\t\t${maybe_ctx_decls_create}\n \t\t\t\t\t@_console.${log}({ ${logged_identifiers} });\n \t\t\t\t\tdebugger;\n \t\t\t\t}\n \t\t\t`);\n \t\t}\n \t}\n-}\n+}\n",
                "diff --git a/src/compiler/compile/render_dom/wrappers/EachBlock.ts b/src/compiler/compile/render_dom/wrappers/EachBlock.ts\nindex 7a77b1a..2a2fe88 100644\n--- a/src/compiler/compile/render_dom/wrappers/EachBlock.ts\n+++ b/src/compiler/compile/render_dom/wrappers/EachBlock.ts\n@@ -101,12 +101,6 @@ export default class EachBlockWrapper extends Wrapper {\n \t\t\t\t? node.expression.node.elements.length\n \t\t\t\t: null;\n \n-\t\t// hack the sourcemap, so that if data is missing the bug\n-\t\t// is easy to find\n-\t\tlet c = this.node.start + 2;\n-\t\twhile (renderer.component.source[c] !== 'e') c += 1;\n-\t\trenderer.component.code.overwrite(c, c + 4, 'length');\n-\n \t\tconst each_block_value = renderer.component.get_unique_name(`${this.var}_value`);\n \t\tconst iterations = block.get_unique_name(`${this.var}_blocks`);\n \n@@ -115,12 +109,12 @@ export default class EachBlockWrapper extends Wrapper {\n \t\t\teach_block_value,\n \t\t\tget_each_context: renderer.component.get_unique_name(`get_${this.var}_context`),\n \t\t\titerations,\n-\t\t\tlength: `[✂${c}-${c+4}✂]`,\n+\t\t\tlength: 'length',\n \n \t\t\t// optimisation for array literal\n \t\t\tfixed_length,\n-\t\t\tdata_length: fixed_length === null ? `${each_block_value}.[✂${c}-${c+4}✂]` : fixed_length,\n-\t\t\tview_length: fixed_length === null ? `${iterations}.[✂${c}-${c+4}✂]` : fixed_length\n+\t\t\tdata_length: fixed_length === null ? `${each_block_value}.length` : fixed_length,\n+\t\t\tview_length: fixed_length === null ? `${iterations}.length` : fixed_length\n \t\t};\n \n \t\tconst store = \n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/compiler/compile/render_dom/wrappers/EachBlock.ts": [
                    "line: 104\nline: 105\nline: 106\nline: 107\nline: 108\nline: 109\nline: 110\nline: 118\nline: 119\nline: 120\nline: 121\nline: 122\nline: 123\nline: 124"
                ],
                "src/compiler/compile/render_dom/wrappers/shared/get_context_merger.ts": [
                    ""
                ],
                "src/compiler/compile/render_dom/wrappers/DebugTag.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/compiler/compile/render_dom/wrappers/DebugTag.ts b/src/compiler/compile/render_dom/wrappers/DebugTag.ts\nindex 5581154..70e5974 100644\n--- a/src/compiler/compile/render_dom/wrappers/DebugTag.ts\n+++ b/src/compiler/compile/render_dom/wrappers/DebugTag.ts\n@@ -50,30 +50,28 @@ export default class DebugTagWrapper extends Wrapper {\n \n \t\t\tconst condition = Array.from(dependencies).map(d => `changed.${d}`).join(' || ');\n \n-\t\t\tconst ctx_identifiers = this.node.expressions\n-\t\t\t\t.filter(e => {\n-\t\t\t\t\tconst looked_up_var = var_lookup.get(e.node.name);\n-\t\t\t\t\treturn !(looked_up_var && looked_up_var.hoistable);\n+\t\t\t// Build properties mapping names to proper references (handles hoisted vars and ctx indices)\n+\t\t\tconst properties = this.node.expressions\n+\t\t\t\t.map(e => {\n+\t\t\t\t\tconst name = e.node.name;\n+\t\t\t\t\tconst ref = renderer.reference(name);\n+\t\t\t\t\treturn `${name}: ${ref}`;\n \t\t\t\t})\n-\t\t\t\t.map(e => e.node.name)\n \t\t\t\t.join(', ');\n-\t\t\tconst logged_identifiers = this.node.expressions.map(e => e.node.name).join(', ');\n \n \t\t\tblock.builders.update.add_block(deindent`\n \t\t\t\tif (${condition}) {\n-\t\t\t\t\tconst { ${ctx_identifiers} } = ctx;\n-\t\t\t\t\t@_console.${log}({ ${logged_identifiers} });\n+\t\t\t\t\t@_console.${log}({ ${properties} });\n \t\t\t\t\tdebugger;\n \t\t\t\t}\n \t\t\t`);\n \n \t\t\tblock.builders.create.add_block(deindent`\n \t\t\t\t{\n-\t\t\t\t\tconst { ${ctx_identifiers} } = ctx;\n-\t\t\t\t\t@_console.${log}({ ${logged_identifiers} });\n+\t\t\t\t\t@_console.${log}({ ${properties} });\n \t\t\t\t\tdebugger;\n \t\t\t\t}\n \t\t\t`);\n \t\t}\n \t}\n-}\n+}\n",
                "diff --git a/src/compiler/compile/render_dom/wrappers/EachBlock.ts b/src/compiler/compile/render_dom/wrappers/EachBlock.ts\nindex 7a77b1a..2a2fe88 100644\n--- a/src/compiler/compile/render_dom/wrappers/EachBlock.ts\n+++ b/src/compiler/compile/render_dom/wrappers/EachBlock.ts\n@@ -101,12 +101,6 @@ export default class EachBlockWrapper extends Wrapper {\n \t\t\t\t? node.expression.node.elements.length\n \t\t\t\t: null;\n \n-\t\t// hack the sourcemap, so that if data is missing the bug\n-\t\t// is easy to find\n-\t\tlet c = this.node.start + 2;\n-\t\twhile (renderer.component.source[c] !== 'e') c += 1;\n-\t\trenderer.component.code.overwrite(c, c + 4, 'length');\n-\n \t\tconst each_block_value = renderer.component.get_unique_name(`${this.var}_value`);\n \t\tconst iterations = block.get_unique_name(`${this.var}_blocks`);\n \n@@ -115,12 +109,12 @@ export default class EachBlockWrapper extends Wrapper {\n \t\t\teach_block_value,\n \t\t\tget_each_context: renderer.component.get_unique_name(`get_${this.var}_context`),\n \t\t\titerations,\n-\t\t\tlength: `[✂${c}-${c+4}✂]`,\n+\t\t\tlength: 'length',\n \n \t\t\t// optimisation for array literal\n \t\t\tfixed_length,\n-\t\t\tdata_length: fixed_length === null ? `${each_block_value}.[✂${c}-${c+4}✂]` : fixed_length,\n-\t\t\tview_length: fixed_length === null ? `${iterations}.[✂${c}-${c+4}✂]` : fixed_length\n+\t\t\tdata_length: fixed_length === null ? `${each_block_value}.length` : fixed_length,\n+\t\t\tview_length: fixed_length === null ? `${iterations}.length` : fixed_length\n \t\t};\n \n \t\tconst store = \n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/compiler/compile/render_dom/wrappers/EachBlock.ts b/src/compiler/compile/render_dom/wrappers/EachBlock.ts\nindex 7a77b1a..2a2fe88 100644\n--- a/src/compiler/compile/render_dom/wrappers/EachBlock.ts\n+++ b/src/compiler/compile/render_dom/wrappers/EachBlock.ts\n@@ -101,12 +101,6 @@ export default class EachBlockWrapper extends Wrapper {\n \t\t\t\t? node.expression.node.elements.length\n \t\t\t\t: null;\n \n-\t\t// hack the sourcemap, so that if data is missing the bug\n-\t\t// is easy to find\n-\t\tlet c = this.node.start + 2;\n-\t\twhile (renderer.component.source[c] !== 'e') c += 1;\n-\t\trenderer.component.code.overwrite(c, c + 4, 'length');\n-\n \t\tconst each_block_value = renderer.component.get_unique_name(`${this.var}_value`);\n \t\tconst iterations = block.get_unique_name(`${this.var}_blocks`);\n \n@@ -115,12 +109,12 @@ export default class EachBlockWrapper extends Wrapper {\n \t\t\teach_block_value,\n \t\t\tget_each_context: renderer.component.get_unique_name(`get_${this.var}_context`),\n \t\t\titerations,\n-\t\t\tlength: `[✂${c}-${c+4}✂]`,\n+\t\t\tlength: 'length',\n \n \t\t\t// optimisation for array literal\n \t\t\tfixed_length,\n-\t\t\tdata_length: fixed_length === null ? `${each_block_value}.[✂${c}-${c+4}✂]` : fixed_length,\n-\t\t\tview_length: fixed_length === null ? `${iterations}.[✂${c}-${c+4}✂]` : fixed_length\n+\t\t\tdata_length: fixed_length === null ? `${each_block_value}.length` : fixed_length,\n+\t\t\tview_length: fixed_length === null ? `${iterations}.length` : fixed_length\n \t\t};\n \n \t\tconst store = \n"
}