{
    "instance_id": "SWE-PolyBench__typescript__maintenance__bugfix__16d1ff7a",
    "original_id": "microsoft__vscode-153857",
    "1_model_selected_files": [
        "src/vs/editor/common/languages/linkComputer.ts",
        "src/vs/editor/contrib/links/browser/getLinks.ts",
        "src/vs/editor/contrib/links/browser/links.ts"
    ],
    "2_embedding_selected_files": [
        "src/vs/workbench/contrib/debug/browser/linkDetector.ts",
        "src/vs/base/common/marked/marked.js",
        "extensions/markdown-language-features/src/languageFeatures/documentLinks.ts",
        "extensions/markdown-language-features/preview-src/index.ts",
        "extensions/notebook-renderers/src/linkify.ts",
        "src/vs/workbench/contrib/terminal/browser/links/terminalLocalLinkDetector.ts",
        "src/vs/editor/contrib/snippet/browser/snippetParser.ts",
        "extensions/markdown-language-features/src/languageFeatures/copyPaste.ts",
        "src/vs/base/common/htmlContent.ts",
        "src/vs/code/electron-sandbox/issue/issueReporterMain.ts",
        "extensions/emmet/src/toggleComment.ts",
        "extensions/typescript-language-features/src/utils/previewer.ts",
        "src/vs/base/common/stripComments.js",
        "src/vs/workbench/contrib/output/common/outputLinkComputer.ts",
        "src/vs/editor/common/languages/textToHtmlTokenizer.ts",
        "extensions/markdown-language-features/src/util/openDocumentLink.ts",
        "extensions/github/src/links.ts",
        "src/vs/workbench/contrib/welcomeWalkthrough/browser/editor/vs_code_editor_walkthrough.ts",
        "extensions/markdown-language-features/src/markdownEngine.ts",
        "build/lib/eslint/code-no-look-behind-regex.ts",
        "src/vs/code/electron-sandbox/issue/issueReporterPage.ts",
        "extensions/search-result/src/extension.ts",
        "extensions/markdown-language-features/src/util/dom.ts",
        "src/vs/workbench/contrib/markdown/browser/markdownDocumentRenderer.ts",
        "src/vs/workbench/contrib/comments/browser/commentsEditorContribution.ts",
        "extensions/markdown-language-features/src/languageFeatures/smartSelect.ts",
        "src/vs/base/browser/markdownRenderer.ts",
        "src/vs/editor/contrib/comment/browser/blockCommentCommand.ts",
        "src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts",
        "extensions/markdown-language-features/src/util/url.ts",
        "src/vs/editor/contrib/links/browser/links.ts",
        "src/vs/editor/common/languages/linkComputer.ts",
        "src/vs/workbench/contrib/terminal/browser/links/terminalLinkOpeners.ts",
        "src/vs/platform/issue/common/issueReporterUtil.ts",
        "extensions/php-language-features/src/features/utils/markedTextUtil.ts",
        "src/vs/base/common/linkedText.ts",
        "extensions/markdown-language-features/src/commands/openDocumentLink.ts",
        "extensions/markdown-language-features/src/preview/security.ts",
        "extensions/typescript-language-features/src/utils/regexp.ts",
        "src/vs/workbench/contrib/comments/browser/simpleCommentEditor.ts",
        "build/lib/eslint/code-no-look-behind-regex.js",
        "extensions/markdown-language-features/notebook/index.ts",
        "src/vs/workbench/contrib/debug/browser/debugANSIHandling.ts",
        "extensions/markdown-language-features/src/languageFeatures/pathCompletions.ts",
        "src/vs/editor/contrib/find/browser/replacePattern.ts",
        "src/vs/workbench/contrib/remote/browser/urlFinder.ts",
        "src/vs/editor/contrib/comment/browser/lineCommentCommand.ts",
        "src/vs/workbench/contrib/comments/browser/commentNode.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/languages.test.ts",
        "src/vs/workbench/contrib/update/browser/releaseNotesEditor.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/webview.test.ts",
        "src/vs/workbench/contrib/terminal/browser/links/terminalExternalLinkDetector.ts",
        "extensions/markdown-language-features/src/languageFeatures/dropIntoEditor.ts",
        "src/vs/workbench/services/search/node/ripgrepTextSearchEngine.ts",
        "src/vs/base/browser/formattedTextRenderer.ts"
    ],
    "3_final_combined_files": [
        "src/vs/editor/common/languages/linkComputer.ts",
        "src/vs/editor/contrib/links/browser/getLinks.ts",
        "src/vs/editor/contrib/links/browser/links.ts",
        "src/vs/workbench/contrib/debug/browser/linkDetector.ts",
        "src/vs/base/common/marked/marked.js",
        "extensions/markdown-language-features/src/languageFeatures/documentLinks.ts"
    ],
    "4_related_elements": {
        "src/vs/editor/common/languages/linkComputer.ts": [
            "class: LinkComputer\nfunction: getClassifier\nvariable: _classifier\nvariable: FORCE_TERMINATION_CHARACTERS\nfunction: computeLinks"
        ],
        "src/vs/editor/contrib/links/browser/getLinks.ts": [
            "function: getLinks\nclass: LinksList"
        ],
        "src/vs/editor/contrib/links/browser/links.ts": [
            "class: LinkDetector"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/vs/editor/common/languages/linkComputer.ts": [
                    "line: 261\nline: 262\nline: 263\nline: 264\nline: 265\nline: 266\nline: 267\nline: 268\nline: 269\nline: 270"
                ],
                "src/vs/editor/contrib/links/browser/getLinks.ts": [
                    ""
                ],
                "src/vs/editor/contrib/links/browser/links.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/vs/editor/common/languages/linkComputer.ts b/src/vs/editor/common/languages/linkComputer.ts\nindex 1cd3c2e..3cd8c47 100644\n--- a/src/vs/editor/common/languages/linkComputer.ts\n+++ b/src/vs/editor/common/languages/linkComputer.ts\n@@ -258,15 +258,18 @@ export class LinkComputer {\n \t\t\t\t\t\tcase CharCode.CloseCurlyBrace:\n \t\t\t\t\t\t\tchClass = (hasOpenCurlyBracket ? CharacterClass.None : CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t/* The following three rules make it that ' or \" or ` are allowed inside links if the link began with a different one */\n+\t\t\t\t\t\t/* Allow quotes inside links by default; only terminate when matching the starting quote of the link */\n \t\t\t\t\t\tcase CharCode.SingleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\t// \"'\" terminates a link only if the link began with \"'\"\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.DoubleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\t// '\"' terminates a link only if the link began with '\"'\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.BackTick:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\t// '`' terminates a link only if the link began with '`'\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.BackTick) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.Asterisk:\n \t\t\t\t\t\t\t// `*` terminates a link if the link began with `*`\n",
                "diff --git a/src/vs/editor/common/languages/linkComputer.ts b/src/vs/editor/common/languages/linkComputer.ts\nindex 1cd3c2e..c5fa660 100644\n--- a/src/vs/editor/common/languages/linkComputer.ts\n+++ b/src/vs/editor/common/languages/linkComputer.ts\n@@ -226,6 +226,7 @@ export class LinkComputer {\n \t\t\tlet hasOpenSquareBracket = false;\n \t\t\tlet inSquareBrackets = false;\n \t\t\tlet hasOpenCurlyBracket = false;\n+\t\t\tlet inFragment = false;\n \n \t\t\twhile (j < len) {\n \n@@ -258,15 +259,33 @@ export class LinkComputer {\n \t\t\t\t\t\tcase CharCode.CloseCurlyBrace:\n \t\t\t\t\t\t\tchClass = (hasOpenCurlyBracket ? CharacterClass.None : CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t/* The following three rules make it that ' or \" or ` are allowed inside links if the link began with a different one */\n+\t\t\t\t\t\t// Track the start of the fragment part of the URL\n+\t\t\t\t\t\tcase CharCode.Hash:\n+\t\t\t\t\t\t\tinFragment = true;\n+\t\t\t\t\t\t\tchClass = CharacterClass.None;\n+\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t/* Allow quotes/backticks inside links when in the fragment part,\n+\t\t\t\t\t\t   or if the link began with a different delimiter character */\n \t\t\t\t\t\tcase CharCode.SingleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (inFragment\n+\t\t\t\t\t\t\t\t? CharacterClass.None\n+\t\t\t\t\t\t\t\t: (linkBeginChCode === CharCode.DoubleQuote || linkBeginChCode === CharCode.BackTick)\n+\t\t\t\t\t\t\t\t\t? CharacterClass.None\n+\t\t\t\t\t\t\t\t\t: CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.DoubleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (inFragment\n+\t\t\t\t\t\t\t\t? CharacterClass.None\n+\t\t\t\t\t\t\t\t: (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.BackTick)\n+\t\t\t\t\t\t\t\t\t? CharacterClass.None\n+\t\t\t\t\t\t\t\t\t: CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.BackTick:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (inFragment\n+\t\t\t\t\t\t\t\t? CharacterClass.None\n+\t\t\t\t\t\t\t\t: (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.DoubleQuote)\n+\t\t\t\t\t\t\t\t\t? CharacterClass.None\n+\t\t\t\t\t\t\t\t\t: CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.Asterisk:\n \t\t\t\t\t\t\t// `*` terminates a link if the link began with `*`\n@@ -318,6 +337,7 @@ export class LinkComputer {\n \t\t\t\t\thasOpenParens = false;\n \t\t\t\t\thasOpenSquareBracket = false;\n \t\t\t\t\thasOpenCurlyBracket = false;\n+\t\t\t\t\tinFragment = false;\n \n \t\t\t\t\t// Record where the link started\n \t\t\t\t\tlinkBeginIndex = j + 1;\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/vs/editor/common/languages/linkComputer.ts": [
                    "function: LinkComputer.computeLinks\nline: 158\nline: 263\nline: 266\nline: 269"
                ],
                "src/vs/editor/contrib/links/browser/getLinks.ts": [
                    ""
                ],
                "src/vs/editor/contrib/links/browser/links.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/vs/editor/common/languages/linkComputer.ts b/src/vs/editor/common/languages/linkComputer.ts\nindex 1cd3c2e..20f0b43 100644\n--- a/src/vs/editor/common/languages/linkComputer.ts\n+++ b/src/vs/editor/common/languages/linkComputer.ts\n@@ -258,15 +258,15 @@ export class LinkComputer {\n \t\t\t\t\t\tcase CharCode.CloseCurlyBrace:\n \t\t\t\t\t\t\tchClass = (hasOpenCurlyBracket ? CharacterClass.None : CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t/* The following three rules make it that ' or \" or ` are allowed inside links if the link began with a different one */\n+\t\t\t\t\t\t/* Quotes are allowed inside unquoted links; they terminate only if they match the link-begin quote */\n \t\t\t\t\t\tcase CharCode.SingleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.DoubleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.BackTick:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.BackTick) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.Asterisk:\n \t\t\t\t\t\t\t// `*` terminates a link if the link began with `*`\n",
                "diff --git a/src/vs/editor/common/languages/linkComputer.ts b/src/vs/editor/common/languages/linkComputer.ts\nindex 1cd3c2e..7520ca4 100644\n--- a/src/vs/editor/common/languages/linkComputer.ts\n+++ b/src/vs/editor/common/languages/linkComputer.ts\n@@ -258,15 +258,15 @@ export class LinkComputer {\n \t\t\t\t\t\tcase CharCode.CloseCurlyBrace:\n \t\t\t\t\t\t\tchClass = (hasOpenCurlyBracket ? CharacterClass.None : CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t/* The following three rules make it that ' or \" or ` are allowed inside links if the link began with a different one */\n+\t\t\t\t\t\t/* Quotes (', \", `) are allowed inside links and only terminate the link if the link began with the same quote character */\n \t\t\t\t\t\tcase CharCode.SingleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.DoubleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.BackTick:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.BackTick) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.Asterisk:\n \t\t\t\t\t\t\t// `*` terminates a link if the link began with `*`\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/vs/editor/common/languages/linkComputer.ts b/src/vs/editor/common/languages/linkComputer.ts\nindex 1cd3c2e..3cd8c47 100644\n--- a/src/vs/editor/common/languages/linkComputer.ts\n+++ b/src/vs/editor/common/languages/linkComputer.ts\n@@ -258,15 +258,18 @@ export class LinkComputer {\n \t\t\t\t\t\tcase CharCode.CloseCurlyBrace:\n \t\t\t\t\t\t\tchClass = (hasOpenCurlyBracket ? CharacterClass.None : CharacterClass.ForceTermination);\n \t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t/* The following three rules make it that ' or \" or ` are allowed inside links if the link began with a different one */\n+\t\t\t\t\t\t/* Allow quotes inside links by default; only terminate when matching the starting quote of the link */\n \t\t\t\t\t\tcase CharCode.SingleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\t// \"'\" terminates a link only if the link began with \"'\"\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.DoubleQuote:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\t// '\"' terminates a link only if the link began with '\"'\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.BackTick:\n-\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.None : CharacterClass.ForceTermination;\n+\t\t\t\t\t\t\t// '`' terminates a link only if the link began with '`'\n+\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.BackTick) ? CharacterClass.ForceTermination : CharacterClass.None;\n \t\t\t\t\t\t\tbreak;\n \t\t\t\t\t\tcase CharCode.Asterisk:\n \t\t\t\t\t\t\t// `*` terminates a link if the link began with `*`\n"
}