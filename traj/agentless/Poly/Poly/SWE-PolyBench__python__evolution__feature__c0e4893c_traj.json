{
    "instance_id": "SWE-PolyBench__python__evolution__feature__c0e4893c",
    "original_id": "huggingface__transformers-23126",
    "1_model_selected_files": [
        "src/transformers/hf_argparser.py"
    ],
    "2_embedding_selected_files": [],
    "3_final_combined_files": [
        "src/transformers/hf_argparser.py"
    ],
    "4_related_elements": {
        "src/transformers/hf_argparser.py": [
            "class: HfArgumentParser\nvariable: UnionType"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/transformers/hf_argparser.py": [
                    "function: HfArgumentParser._parse_dataclass_field\nline: 162\nline: 1"
                ]
            },
            "patches": [
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 41200d8..941b1e0 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -1,3 +1,4 @@\n+\n # Copyright 2020 The HuggingFace Team. All rights reserved.\n #\n # Licensed under the Apache License, Version 2.0 (the \"License\");\n@@ -158,8 +159,13 @@ class HfArgumentParser(ArgumentParser):\n         if isinstance(aliases, str):\n             aliases = [aliases]\n \n+        # Support typing.Union and PEP 604 (X | Y) unions\n+        try:\n+            from types import UnionType as _UnionType\n+        except Exception:\n+            _UnionType = None\n         origin_type = getattr(field.type, \"__origin__\", field.type)\n-        if origin_type is Union:\n+        if origin_type is Union or (_UnionType is not None and (type(origin_type) is _UnionType or type(field.type) is _UnionType)):\n             if str not in field.type.__args__ and (\n                 len(field.type.__args__) != 2 or type(None) not in field.type.__args__\n             ):\n",
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 41200d8..5d20614 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -1,3 +1,4 @@\n+\n # Copyright 2020 The HuggingFace Team. All rights reserved.\n #\n # Licensed under the Apache License, Version 2.0 (the \"License\");\n@@ -159,7 +160,8 @@ class HfArgumentParser(ArgumentParser):\n             aliases = [aliases]\n \n         origin_type = getattr(field.type, \"__origin__\", field.type)\n-        if origin_type is Union:\n+        # Support both typing.Union and PEP 604 unions (X | Y)\n+        if origin_type is Union or type(origin_type).__name__ == \"UnionType\":\n             if str not in field.type.__args__ and (\n                 len(field.type.__args__) != 2 or type(None) not in field.type.__args__\n             ):\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/transformers/hf_argparser.py": [
                    "line: 1\nfunction: HfArgumentParser._parse_dataclass_field\nline: 162\nline: 197"
                ]
            },
            "patches": [
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 41200d8..b41eaab 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -1,3 +1,4 @@\n+\n # Copyright 2020 The HuggingFace Team. All rights reserved.\n #\n # Licensed under the Apache License, Version 2.0 (the \"License\");\n@@ -159,7 +160,12 @@ class HfArgumentParser(ArgumentParser):\n             aliases = [aliases]\n \n         origin_type = getattr(field.type, \"__origin__\", field.type)\n-        if origin_type is Union:\n+        # Support PEP 604 unions (X | Y) which are instances of types.UnionType\n+        try:\n+            from types import UnionType as _UnionType\n+        except Exception:\n+            _UnionType = None\n+        if origin_type is Union or (_UnionType is not None and type(origin_type) is _UnionType):\n             if str not in field.type.__args__ and (\n                 len(field.type.__args__) != 2 or type(None) not in field.type.__args__\n             ):\n@@ -194,7 +200,16 @@ class HfArgumentParser(ArgumentParser):\n                 kwargs[\"default\"] = field.default\n             else:\n                 kwargs[\"required\"] = True\n-        elif field.type is bool or field.type == Optional[bool]:\n+        elif (\n+            field.type is bool\n+            or field.type == Optional[bool]\n+            or (\n+                getattr(field.type, \"__args__\", None) is not None\n+                and len(field.type.__args__) == 2\n+                and bool in field.type.__args__\n+                and type(None) in field.type.__args__\n+            )\n+        ):\n             # Copy the currect kwargs to use to instantiate a `no_*` complement argument below.\n             # We do not initialize it here because the `no_*` alternative must be instantiated after the real argument\n             bool_kwargs = copy(kwargs)\n@@ -231,7 +246,16 @@ class HfArgumentParser(ArgumentParser):\n         # Order is important for arguments with the same destination!\n         # We use a copy of earlier kwargs because the original kwargs have changed a lot before reaching down\n         # here and we do not need those changes/additional keys.\n-        if field.default is True and (field.type is bool or field.type == Optional[bool]):\n+        if field.default is True and (\n+            field.type is bool\n+            or field.type == Optional[bool]\n+            or (\n+                getattr(field.type, \"__args__\", None) is not None\n+                and len(field.type.__args__) == 2\n+                and bool in field.type.__args__\n+                and type(None) in field.type.__args__\n+            )\n+        ):\n             bool_kwargs[\"default\"] = False\n             parser.add_argument(f\"--no_{field.name}\", action=\"store_false\", dest=field.name, **bool_kwargs)\n \n",
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 41200d8..bab82c1 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -1,3 +1,4 @@\n+\n # Copyright 2020 The HuggingFace Team. All rights reserved.\n #\n # Licensed under the Apache License, Version 2.0 (the \"License\");\n@@ -159,7 +160,10 @@ class HfArgumentParser(ArgumentParser):\n             aliases = [aliases]\n \n         origin_type = getattr(field.type, \"__origin__\", field.type)\n-        if origin_type is Union:\n+        # Support typing.Union and PEP 604 unions (X | Y), where type(origin_type) is types.UnionType\n+        if origin_type is Union or (\n+            type(origin_type).__name__ == \"UnionType\" and type(origin_type).__module__ == \"types\"\n+        ):\n             if str not in field.type.__args__ and (\n                 len(field.type.__args__) != 2 or type(None) not in field.type.__args__\n             ):\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 41200d8..941b1e0 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -1,3 +1,4 @@\n+\n # Copyright 2020 The HuggingFace Team. All rights reserved.\n #\n # Licensed under the Apache License, Version 2.0 (the \"License\");\n@@ -158,8 +159,13 @@ class HfArgumentParser(ArgumentParser):\n         if isinstance(aliases, str):\n             aliases = [aliases]\n \n+        # Support typing.Union and PEP 604 (X | Y) unions\n+        try:\n+            from types import UnionType as _UnionType\n+        except Exception:\n+            _UnionType = None\n         origin_type = getattr(field.type, \"__origin__\", field.type)\n-        if origin_type is Union:\n+        if origin_type is Union or (_UnionType is not None and (type(origin_type) is _UnionType or type(field.type) is _UnionType)):\n             if str not in field.type.__args__ and (\n                 len(field.type.__args__) != 2 or type(None) not in field.type.__args__\n             ):\n"
}