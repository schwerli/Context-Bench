{
    "instance_id": "SWE-PolyBench__javascript__maintenance__bugfix__4d090fc6",
    "original_id": "serverless__serverless-2576",
    "1_model_selected_files": [
        "lib/plugins/aws/lib/monitorStack.js"
    ],
    "2_embedding_selected_files": [
        "lib/plugins/aws/deploy/index.js",
        "lib/plugins/aws/deploy/lib/createStack.js",
        "lib/plugins/aws/lib/updateStack.js",
        "lib/plugins/aws/deployList/index.js",
        "lib/plugins/aws/deploy/lib/configureStack.js",
        "lib/plugins/aws/lib/monitorStack.js",
        "lib/plugins/deploy/deploy.js",
        "lib/plugins/aws/deployFunction/index.js",
        "lib/plugins/aws/deploy/lib/mergeIamTemplates.js",
        "lib/plugins/aws/utils/findAndGroupDeployments.js",
        "lib/plugins/aws/deploy/lib/mergeCustomProviderResources.js",
        "lib/Serverless.js",
        "lib/plugins/aws/rollback/index.js",
        "lib/plugins/aws/deploy/compile/functions/index.js",
        "lib/plugins/aws/deploy/lib/cleanupS3Bucket.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/methods.js",
        "lib/plugins/aws/provider/awsProvider.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/deployment.js",
        "lib/plugins/aws/deploy/lib/uploadArtifacts.js",
        "lib/plugins/aws/deploy/compile/events/stream/index.js",
        "lib/plugins/aws/deploy/compile/events/s3/index.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/validate.js",
        "lib/plugins/create/create.js",
        "lib/plugins/aws/provider/awsProvider.js",
        "lib/Serverless.test.js",
        "lib/plugins/aws/deploy/compile/events/sns/index.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/authorizers.js",
        "lib/classes/PluginManager.test.js",
        "lib/plugins/aws/deploy/compile/events/schedule/index.js",
        "lib/classes/CLI.test.js",
        "lib/plugins/aws/deploy/lib/generateArtifactDirectoryName.js",
        "lib/plugins/aws/lib/validate.js",
        "lib/plugins/aws/remove/lib/stack.js",
        "lib/classes/Service.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/resources.js",
        "lib/classes/Service.js",
        "lib/plugins/aws/info/index.js",
        "lib/plugins/aws/logs/index.js",
        "lib/plugins/aws/remove/lib/bucket.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/permissions.js",
        "lib/plugins/aws/remove/index.js",
        "lib/classes/Error.js",
        "lib/plugins/install/install.js",
        "lib/plugins/package/lib/validate.js",
        "lib/plugins/package/index.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/index.js",
        "lib/plugins/aws/invoke/index.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/apiKeys.js",
        "serverless/.eslintrc.js",
        "lib/classes/CLI.js",
        "lib/classes/Utils.test.js",
        "lib/plugins/rollback/index.js",
        "lib/classes/PluginManager.js",
        "lib/plugins/aws/lib/setBucketName.js",
        "lib/plugins/aws/utils/getS3ObjectsFromStacks.js",
        "lib/plugins/create/templates/aws-nodejs/handler.js",
        "lib/plugins/package/lib/packageService.js",
        "lib/classes/Utils.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/restApi.js",
        "lib/plugins/logs/logs.js",
        "lib/plugins/package/lib/zipService.js",
        "lib/plugins/info/info.js",
        "lib/plugins/invoke/invoke.js",
        "lib/plugins/remove/remove.js",
        "docs/providers/aws/examples/hello-world/node/handler.js",
        "lib/plugins/package/lib/cleanup.js",
        "lib/classes/Variables.test.js",
        "lib/classes/Variables.js",
        "lib/plugins/slstats/slstats.js"
    ],
    "3_final_combined_files": [
        "lib/plugins/aws/lib/monitorStack.js",
        "lib/plugins/aws/deploy/index.js",
        "lib/plugins/aws/deploy/lib/createStack.js",
        "lib/plugins/aws/lib/updateStack.js"
    ],
    "4_related_elements": {
        "lib/plugins/aws/lib/monitorStack.js": [
            "function: monitorStack"
        ],
        "lib/plugins/aws/deploy/index.js": [
            "class: AwsDeploy"
        ],
        "lib/plugins/aws/deploy/lib/createStack.js": [
            "function: create\nfunction: createStack"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "lib/plugins/aws/lib/monitorStack.js": [
                    "line: 55\nline: 60\nline: 62\nline: 64\nline: 80"
                ],
                "lib/plugins/aws/deploy/index.js": [
                    ""
                ],
                "lib/plugins/aws/deploy/lib/createStack.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/plugins/aws/lib/monitorStack.js b/lib/plugins/aws/lib/monitorStack.js\nindex 03a9452..e97b85b 100644\n--- a/lib/plugins/aws/lib/monitorStack.js\n+++ b/lib/plugins/aws/lib/monitorStack.js\n@@ -52,16 +52,16 @@ module.exports = {\n                       stackStatus = eventStatus;\n                     }\n                     // Keep track of first failed event\n-                    if (eventStatus.endsWith('FAILED') && stackLatestError === null) {\n+                    if (eventStatus && eventStatus.endsWith('FAILED') && stackLatestError === null) {\n                       stackLatestError = event;\n                     }\n                     // Log stack events\n                     if (this.options.verbose) {\n-                      if (eventStatus.endsWith('FAILED')) {\n+                      if (eventStatus && eventStatus.endsWith('FAILED')) {\n                         eventStatus = chalk.red(eventStatus);\n-                      } else if (eventStatus.endsWith('PROGRESS')) {\n+                      } else if (eventStatus && eventStatus.endsWith('PROGRESS')) {\n                         eventStatus = chalk.yellow(eventStatus);\n-                      } else if (eventStatus.endsWith('COMPLETE')) {\n+                      } else if (eventStatus && eventStatus.endsWith('COMPLETE')) {\n                         eventStatus = chalk.green(eventStatus);\n                       }\n                       let eventLog = `CloudFormation - ${eventStatus} - `;\n@@ -77,11 +77,11 @@ module.exports = {\n                 });\n                 // Handle stack create/update/delete failures\n                 if ((stackLatestError && !this.options.verbose)\n-                || (stackStatus.endsWith('ROLLBACK_COMPLETE') && this.options.verbose)) {\n+                || ((stackStatus && stackStatus.endsWith('ROLLBACK_COMPLETE')) && this.options.verbose)) {\n                   this.serverless.cli.log('Deployment failed!');\n                   let errorMessage = 'An error occurred while provisioning your stack: ';\n-                  errorMessage += `${stackLatestError.LogicalResourceId} - `;\n-                  errorMessage += `${stackLatestError.ResourceStatusReason}.`;\n+                  errorMessage += `${stackLatestError && stackLatestError.LogicalResourceId ? stackLatestError.LogicalResourceId : 'Stack'} - `;\n+                  errorMessage += `${stackLatestError && stackLatestError.ResourceStatusReason ? stackLatestError.ResourceStatusReason : 'ROLLBACK_COMPLETE'}.`;\n                   return reject(new this.serverless.classes.Error(errorMessage));\n                 }\n                 // Trigger next monitoring action\n",
                "diff --git a/lib/plugins/aws/lib/monitorStack.js b/lib/plugins/aws/lib/monitorStack.js\nindex 03a9452..f4e825d 100644\n--- a/lib/plugins/aws/lib/monitorStack.js\n+++ b/lib/plugins/aws/lib/monitorStack.js\n@@ -52,16 +52,16 @@ module.exports = {\n                       stackStatus = eventStatus;\n                     }\n                     // Keep track of first failed event\n-                    if (eventStatus.endsWith('FAILED') && stackLatestError === null) {\n+                    if (eventStatus && eventStatus.endsWith('FAILED') && stackLatestError === null) {\n                       stackLatestError = event;\n                     }\n                     // Log stack events\n                     if (this.options.verbose) {\n-                      if (eventStatus.endsWith('FAILED')) {\n+                      if (eventStatus && eventStatus.endsWith('FAILED')) {\n                         eventStatus = chalk.red(eventStatus);\n-                      } else if (eventStatus.endsWith('PROGRESS')) {\n+                      } else if (eventStatus && eventStatus.endsWith('PROGRESS')) {\n                         eventStatus = chalk.yellow(eventStatus);\n-                      } else if (eventStatus.endsWith('COMPLETE')) {\n+                      } else if (eventStatus && eventStatus.endsWith('COMPLETE')) {\n                         eventStatus = chalk.green(eventStatus);\n                       }\n                       let eventLog = `CloudFormation - ${eventStatus} - `;\n@@ -77,7 +77,7 @@ module.exports = {\n                 });\n                 // Handle stack create/update/delete failures\n                 if ((stackLatestError && !this.options.verbose)\n-                || (stackStatus.endsWith('ROLLBACK_COMPLETE') && this.options.verbose)) {\n+                || (stackStatus && stackStatus.endsWith('ROLLBACK_COMPLETE') && this.options.verbose)) {\n                   this.serverless.cli.log('Deployment failed!');\n                   let errorMessage = 'An error occurred while provisioning your stack: ';\n                   errorMessage += `${stackLatestError.LogicalResourceId} - `;\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "lib/plugins/aws/lib/monitorStack.js": [
                    "line: 55\nline: 60\nline: 62\nline: 64\nline: 80"
                ],
                "lib/plugins/aws/deploy/index.js": [
                    ""
                ],
                "lib/plugins/aws/deploy/lib/createStack.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/plugins/aws/lib/monitorStack.js b/lib/plugins/aws/lib/monitorStack.js\nindex 03a9452..fdad28b 100644\n--- a/lib/plugins/aws/lib/monitorStack.js\n+++ b/lib/plugins/aws/lib/monitorStack.js\n@@ -45,23 +45,23 @@ module.exports = {\n                 data.StackEvents.reverse().forEach((event) => {\n                   const eventInRange = (monitoredSince < event.Timestamp);\n                   const eventNotLogged = (loggedEvents.indexOf(event.EventId) === -1);\n-                  let eventStatus = event.ResourceStatus;\n+                  let eventStatus = event.ResourceStatus || 'UNKNOWN';\n                   if (eventInRange && eventNotLogged) {\n                     // Keep track of stack status\n                     if (event.ResourceType === 'AWS::CloudFormation::Stack') {\n                       stackStatus = eventStatus;\n                     }\n                     // Keep track of first failed event\n-                    if (eventStatus.endsWith('FAILED') && stackLatestError === null) {\n+                    if (eventStatus && eventStatus.endsWith('FAILED') && stackLatestError === null) {\n                       stackLatestError = event;\n                     }\n                     // Log stack events\n                     if (this.options.verbose) {\n-                      if (eventStatus.endsWith('FAILED')) {\n+                      if (eventStatus && eventStatus.endsWith('FAILED')) {\n                         eventStatus = chalk.red(eventStatus);\n-                      } else if (eventStatus.endsWith('PROGRESS')) {\n+                      } else if (eventStatus && eventStatus.endsWith('PROGRESS')) {\n                         eventStatus = chalk.yellow(eventStatus);\n-                      } else if (eventStatus.endsWith('COMPLETE')) {\n+                      } else if (eventStatus && eventStatus.endsWith('COMPLETE')) {\n                         eventStatus = chalk.green(eventStatus);\n                       }\n                       let eventLog = `CloudFormation - ${eventStatus} - `;\n@@ -77,11 +77,15 @@ module.exports = {\n                 });\n                 // Handle stack create/update/delete failures\n                 if ((stackLatestError && !this.options.verbose)\n-                || (stackStatus.endsWith('ROLLBACK_COMPLETE') && this.options.verbose)) {\n+                || ((stackStatus && stackStatus.endsWith('ROLLBACK_COMPLETE')) && this.options.verbose)) {\n                   this.serverless.cli.log('Deployment failed!');\n                   let errorMessage = 'An error occurred while provisioning your stack: ';\n-                  errorMessage += `${stackLatestError.LogicalResourceId} - `;\n-                  errorMessage += `${stackLatestError.ResourceStatusReason}.`;\n+                  if (stackLatestError) {\n+                    errorMessage += `${stackLatestError.LogicalResourceId} - `;\n+                    errorMessage += `${stackLatestError.ResourceStatusReason}.`;\n+                  } else {\n+                    errorMessage += 'Check CloudFormation console for details.';\n+                  }\n                   return reject(new this.serverless.classes.Error(errorMessage));\n                 }\n                 // Trigger next monitoring action\n",
                "diff --git a/lib/plugins/aws/lib/monitorStack.js b/lib/plugins/aws/lib/monitorStack.js\nindex 03a9452..ff5b7a1 100644\n--- a/lib/plugins/aws/lib/monitorStack.js\n+++ b/lib/plugins/aws/lib/monitorStack.js\n@@ -46,25 +46,26 @@ module.exports = {\n                   const eventInRange = (monitoredSince < event.Timestamp);\n                   const eventNotLogged = (loggedEvents.indexOf(event.EventId) === -1);\n                   let eventStatus = event.ResourceStatus;\n+                  const statusStr = typeof eventStatus === 'string' ? eventStatus : '';\n                   if (eventInRange && eventNotLogged) {\n                     // Keep track of stack status\n                     if (event.ResourceType === 'AWS::CloudFormation::Stack') {\n                       stackStatus = eventStatus;\n                     }\n                     // Keep track of first failed event\n-                    if (eventStatus.endsWith('FAILED') && stackLatestError === null) {\n+                    if (statusStr.endsWith('FAILED') && stackLatestError === null) {\n                       stackLatestError = event;\n                     }\n                     // Log stack events\n                     if (this.options.verbose) {\n-                      if (eventStatus.endsWith('FAILED')) {\n-                        eventStatus = chalk.red(eventStatus);\n-                      } else if (eventStatus.endsWith('PROGRESS')) {\n-                        eventStatus = chalk.yellow(eventStatus);\n-                      } else if (eventStatus.endsWith('COMPLETE')) {\n-                        eventStatus = chalk.green(eventStatus);\n+                      if (statusStr.endsWith('FAILED')) {\n+                        eventStatus = chalk.red(statusStr);\n+                      } else if (statusStr.endsWith('PROGRESS')) {\n+                        eventStatus = chalk.yellow(statusStr);\n+                      } else if (statusStr.endsWith('COMPLETE')) {\n+                        eventStatus = chalk.green(statusStr);\n                       }\n-                      let eventLog = `CloudFormation - ${eventStatus} - `;\n+                      let eventLog = `CloudFormation - ${eventStatus || statusStr} - `;\n                       eventLog += `${event.ResourceType} - `;\n                       eventLog += `${event.LogicalResourceId}`;\n                       this.serverless.cli.consoleLog(eventLog);\n@@ -76,8 +77,9 @@ module.exports = {\n                   }\n                 });\n                 // Handle stack create/update/delete failures\n+                const stackStatusStr = typeof stackStatus === 'string' ? stackStatus : '';\n                 if ((stackLatestError && !this.options.verbose)\n-                || (stackStatus.endsWith('ROLLBACK_COMPLETE') && this.options.verbose)) {\n+                || (stackStatusStr.endsWith('ROLLBACK_COMPLETE') && this.options.verbose)) {\n                   this.serverless.cli.log('Deployment failed!');\n                   let errorMessage = 'An error occurred while provisioning your stack: ';\n                   errorMessage += `${stackLatestError.LogicalResourceId} - `;\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/lib/plugins/aws/lib/monitorStack.js b/lib/plugins/aws/lib/monitorStack.js\nindex 03a9452..e97b85b 100644\n--- a/lib/plugins/aws/lib/monitorStack.js\n+++ b/lib/plugins/aws/lib/monitorStack.js\n@@ -52,16 +52,16 @@ module.exports = {\n                       stackStatus = eventStatus;\n                     }\n                     // Keep track of first failed event\n-                    if (eventStatus.endsWith('FAILED') && stackLatestError === null) {\n+                    if (eventStatus && eventStatus.endsWith('FAILED') && stackLatestError === null) {\n                       stackLatestError = event;\n                     }\n                     // Log stack events\n                     if (this.options.verbose) {\n-                      if (eventStatus.endsWith('FAILED')) {\n+                      if (eventStatus && eventStatus.endsWith('FAILED')) {\n                         eventStatus = chalk.red(eventStatus);\n-                      } else if (eventStatus.endsWith('PROGRESS')) {\n+                      } else if (eventStatus && eventStatus.endsWith('PROGRESS')) {\n                         eventStatus = chalk.yellow(eventStatus);\n-                      } else if (eventStatus.endsWith('COMPLETE')) {\n+                      } else if (eventStatus && eventStatus.endsWith('COMPLETE')) {\n                         eventStatus = chalk.green(eventStatus);\n                       }\n                       let eventLog = `CloudFormation - ${eventStatus} - `;\n@@ -77,11 +77,11 @@ module.exports = {\n                 });\n                 // Handle stack create/update/delete failures\n                 if ((stackLatestError && !this.options.verbose)\n-                || (stackStatus.endsWith('ROLLBACK_COMPLETE') && this.options.verbose)) {\n+                || ((stackStatus && stackStatus.endsWith('ROLLBACK_COMPLETE')) && this.options.verbose)) {\n                   this.serverless.cli.log('Deployment failed!');\n                   let errorMessage = 'An error occurred while provisioning your stack: ';\n-                  errorMessage += `${stackLatestError.LogicalResourceId} - `;\n-                  errorMessage += `${stackLatestError.ResourceStatusReason}.`;\n+                  errorMessage += `${stackLatestError && stackLatestError.LogicalResourceId ? stackLatestError.LogicalResourceId : 'Stack'} - `;\n+                  errorMessage += `${stackLatestError && stackLatestError.ResourceStatusReason ? stackLatestError.ResourceStatusReason : 'ROLLBACK_COMPLETE'}.`;\n                   return reject(new this.serverless.classes.Error(errorMessage));\n                 }\n                 // Trigger next monitoring action\n"
}