{
    "instance_id": "SWE-PolyBench__javascript__maintenance__bugfix__9d623e73",
    "original_id": "sveltejs__svelte-728",
    "1_model_selected_files": [],
    "2_embedding_selected_files": [
        "src/generators/dom/visitors/EachBlock.ts",
        "src/generators/dom/visitors/Element/Binding.ts",
        "src/generators/dom/visitors/Component/Binding.ts",
        "src/generators/server-side-rendering/visitors/EachBlock.ts",
        "src/generators/dom/preprocess.ts",
        "src/generators/dom/visitors/Element/meta/Window.ts",
        "src/generators/Generator.ts",
        "src/generators/dom/index.ts",
        "src/generators/dom/visitors/IfBlock.ts",
        "src/generators/dom/Block.ts",
        "src/generators/server-side-rendering/Block.ts",
        "src/generators/dom/visitors/Component/Ref.ts",
        "src/generators/dom/visitors/shared/binding/getSetter.ts",
        "src/parse/state/mustache.ts",
        "src/generators/dom/visitors/Element/Element.ts",
        "src/generators/dom/visitors/Component/Component.ts",
        "src/shared/index.js",
        "src/generators/dom/visitors/Element/Ref.ts",
        "src/utils/reservedNames.ts",
        "src/css/Selector.ts",
        "src/shared/transitions.js",
        "src/generators/dom/visitors/index.ts",
        "src/generators/dom/visitors/Element/addTransitions.ts",
        "src/generators/dom/visitors/YieldTag.ts",
        "src/generators/server-side-rendering/index.ts",
        "src/generators/server-side-rendering/visitors/IfBlock.ts",
        "src/generators/server-side-rendering/visitors/Component.ts",
        "src/generators/dom/visitors/Element/EventHandler.ts",
        "src/generators/server-side-rendering/visitors/index.ts",
        "src/validate/js/propValidators/components.ts",
        "src/css/Stylesheet.ts",
        "src/utils/flattenReference.ts",
        "src/validate/js/utils/checkForComputedKeys.ts",
        "svelte/rollup.config.js",
        "src/generators/dom/visitors/Component/EventHandler.ts",
        "src/utils/__test__.ts",
        "src/validate/js/propValidators/transitions.ts",
        "src/generators/dom/visitors/Element/lookup.ts",
        "src/validate/js/propValidators/computed.ts",
        "src/generators/dom/visitors/Element/Attribute.ts",
        "src/validate/js/propValidators/helpers.ts",
        "src/generators/server-side-rendering/visitors/Element.ts",
        "src/generators/server-side-rendering/preprocess.ts",
        "src/generators/server-side-rendering/visit.ts",
        "src/generators/dom/visitors/Component/Attribute.ts",
        "src/utils/removeNode.ts",
        "src/validate/js/utils/checkForDupes.ts",
        "src/shared/dom.js",
        "src/shared/_build.js",
        "src/validate/js/propValidators/onrender.ts",
        "src/generators/dom/interfaces.ts",
        "src/index.ts",
        "src/generators/dom/visit.ts",
        "src/generators/dom/visitors/MustacheTag.ts",
        "src/validate/js/propValidators/onteardown.ts",
        "src/validate/js/propValidators/events.ts",
        "src/utils/CodeBuilder.ts",
        "src/utils/isReference.ts",
        "src/parse/state/tag.ts",
        "src/validate/html/validateWindow.ts",
        "src/generators/dom/visitors/RawMustacheTag.ts",
        "src/parse/utils/entities.ts",
        "src/generators/server-side-rendering/visitors/Text.ts",
        "src/validate/js/index.ts",
        "src/generators/server-side-rendering/visitors/MustacheTag.ts",
        "src/utils/globalWhitelist.ts",
        "src/validate/js/propValidators/ondestroy.ts",
        "src/validate/js/propValidators/methods.ts",
        "src/utils/getCodeFrame.ts"
    ],
    "3_final_combined_files": [
        "src/generators/dom/visitors/EachBlock.ts",
        "src/generators/dom/visitors/Element/Binding.ts",
        "src/generators/dom/visitors/Component/Binding.ts"
    ],
    "4_related_elements": {
        "src/generators/dom/visitors/EachBlock.ts": [
            "function: visitEachBlock\nfunction: keyed\nfunction: unkeyed"
        ],
        "src/generators/dom/visitors/Element/Binding.ts": [
            "function: visitBinding\nfunction: getBindingEventName\nfunction: getBindingValue\nfunction: getBindingGroup\nvariable: generator.hasComplexBindings\nvariable: generator.bindingGroups"
        ],
        "src/generators/dom/visitors/Component/Binding.ts": [
            "function: visitBinding"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/generators/dom/visitors/EachBlock.ts": [
                    "function: keyed\nline: 304\nline: 305\nline: 306\nline: 331\nline: 332"
                ],
                "src/generators/dom/visitors/Element/Binding.ts": [
                    ""
                ],
                "src/generators/dom/visitors/Component/Binding.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/generators/dom/visitors/EachBlock.ts b/src/generators/dom/visitors/EachBlock.ts\nindex 46d91fc..561671a 100644\n--- a/src/generators/dom/visitors/EachBlock.ts\n+++ b/src/generators/dom/visitors/EachBlock.ts\n@@ -290,7 +290,7 @@ function keyed(\n \t\t\t\t\t${expected} = ${expected}.next;\n \t\t\t\t} else {\n \t\t\t\t\tif ( ${iteration} ) {\n-\t\t\t\t\t\t// probably a deletion\n+\t\t\t\t\t\t// existing item moved or deletion before it\n \t\t\t\t\t\twhile ( ${expected} && ${expected}.key !== ${key} ) {\n \t\t\t\t\t\t\t${expected}.discard = true;\n \t\t\t\t\t\t\tdiscard_pile.push( ${expected} );\n@@ -301,15 +301,13 @@ function keyed(\n \t\t\t\t\t\t${iteration}.discard = false;\n \t\t\t\t\t\t${iteration}.last = ${last};\n \n-\t\t\t\t\t\tif (!${expected}) ${iteration}.mount( ${parentNode}, ${anchor} );\n+\t\t\t\t\t\t// ensure existing DOM is moved to the correct position\n+\t\t\t\t\t\t${iteration}.mount( ${parentNode}, ${expected} ? ${expected}.first : ${anchor} );\n \t\t\t\t\t} else {\n \t\t\t\t\t\t// key is being inserted\n \t\t\t\t\t\t${iteration} = ${lookup}[${key}] = ${create_each_block}( ${params}, ${each_block_value}, ${each_block_value}[#i], #i, #component, ${key} );\n \t\t\t\t\t\t${iteration}.create();\n \t\t\t\t\t\t${iteration}.${mountOrIntro}( ${parentNode}, ${expected}.first );\n-\n-\t\t\t\t\t\t${expected}.last = ${iteration};\n-\t\t\t\t\t\t${iteration}.next = ${expected};\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t} else {\n",
                "diff --git a/src/generators/dom/visitors/EachBlock.ts b/src/generators/dom/visitors/EachBlock.ts\nindex 46d91fc..8699397 100644\n--- a/src/generators/dom/visitors/EachBlock.ts\n+++ b/src/generators/dom/visitors/EachBlock.ts\n@@ -158,6 +158,7 @@ function keyed(\n \tconst head = block.getUniqueName(`${each_block}_head`);\n \tconst last = block.getUniqueName(`${each_block}_last`);\n \tconst expected = block.getUniqueName(`${each_block}_expected`);\n+\tconst new_head = block.getUniqueName(`${each_block}_new_head`);\n \n \tblock.addVariable(lookup, `Object.create( null )`);\n \tblock.addVariable(head);\n@@ -278,10 +279,14 @@ function keyed(\n \n \t\tvar discard_pile = [];\n \n+\t\tvar ${new_head} = null;\n+\n \t\tfor ( #i = 0; #i < ${each_block_value}.${length}; #i += 1 ) {\n \t\t\tvar ${key} = ${each_block_value}[#i].${node.key};\n \t\t\tvar ${iteration} = ${lookup}[${key}];\n \n+\t\t\tif ( ${last} === null ) ${new_head} = ${iteration};\n+\n \t\t\t${dynamic &&\n \t\t\t\t`if ( ${iteration} ) ${iteration}.update( changed, ${params}, ${each_block_value}, ${each_block_value}[#i], #i );`}\n \n@@ -336,7 +341,7 @@ function keyed(\n \n \t\t${destroy}\n \n-\t\t${head} = ${lookup}[${each_block_value}[0] && ${each_block_value}[0].${node.key}];\n+\t\t${head} = ${new_head};\n \t`);\n \n \tif (!state.parentNode) {\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/generators/dom/visitors/EachBlock.ts": [
                    "function: keyed\nline: 304\nline: 307"
                ],
                "src/generators/dom/visitors/Element/Binding.ts": [
                    ""
                ],
                "src/generators/dom/visitors/Component/Binding.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/generators/dom/visitors/EachBlock.ts b/src/generators/dom/visitors/EachBlock.ts\nindex 46d91fc..727bc38 100644\n--- a/src/generators/dom/visitors/EachBlock.ts\n+++ b/src/generators/dom/visitors/EachBlock.ts\n@@ -301,7 +301,7 @@ function keyed(\n \t\t\t\t\t\t${iteration}.discard = false;\n \t\t\t\t\t\t${iteration}.last = ${last};\n \n-\t\t\t\t\t\tif (!${expected}) ${iteration}.mount( ${parentNode}, ${anchor} );\n+\t\t\t\t\t\tif (!${expected}) ${iteration}.mount( ${parentNode}, ${anchorNode} );\n \t\t\t\t\t} else {\n \t\t\t\t\t\t// key is being inserted\n \t\t\t\t\t\t${iteration} = ${lookup}[${key}] = ${create_each_block}( ${params}, ${each_block_value}, ${each_block_value}[#i], #i, #component, ${key} );\n@@ -317,18 +317,18 @@ function keyed(\n \t\t\t\tif ( ${iteration} ) {\n \t\t\t\t\t${iteration}.discard = false;\n \t\t\t\t\t${iteration}.next = null;\n-\t\t\t\t\t${iteration}.mount( ${parentNode}, ${anchor} );\n+\t\t\t\t\t${iteration}.mount( ${parentNode}, ${anchorNode} );\n \t\t\t\t} else {\n \t\t\t\t\t${iteration} = ${lookup}[${key}] = ${create_each_block}( ${params}, ${each_block_value}, ${each_block_value}[#i], #i, #component, ${key} );\n \t\t\t\t\t${iteration}.create();\n-\t\t\t\t\t${iteration}.${mountOrIntro}( ${parentNode}, ${anchor} );\n+\t\t\t\t\t${iteration}.${mountOrIntro}( ${parentNode}, ${anchorNode} );\n \t\t\t\t}\n \t\t\t}\n \n \t\t\tif ( ${last} ) ${last}.next = ${iteration};\n \t\t\t${iteration}.last = ${last};\n \t\t\t${node._block.hasIntroMethod &&\n-\t\t\t\t`${iteration}.intro( ${parentNode}, ${anchor} );`}\n+\t\t\t\t`${iteration}.intro( ${parentNode}, ${anchorNode} );`}\n \t\t\t${last} = ${iteration};\n \t\t}\n \n",
                "diff --git a/src/generators/dom/visitors/EachBlock.ts b/src/generators/dom/visitors/EachBlock.ts\nindex 46d91fc..801c84d 100644\n--- a/src/generators/dom/visitors/EachBlock.ts\n+++ b/src/generators/dom/visitors/EachBlock.ts\n@@ -290,18 +290,24 @@ function keyed(\n \t\t\t\t\t${expected} = ${expected}.next;\n \t\t\t\t} else {\n \t\t\t\t\tif ( ${iteration} ) {\n-\t\t\t\t\t\t// probably a deletion\n+\t\t\t\t\t\t// probably a deletion or a move\n \t\t\t\t\t\twhile ( ${expected} && ${expected}.key !== ${key} ) {\n \t\t\t\t\t\t\t${expected}.discard = true;\n \t\t\t\t\t\t\tdiscard_pile.push( ${expected} );\n \t\t\t\t\t\t\t${expected} = ${expected}.next;\n \t\t\t\t\t\t};\n \n-\t\t\t\t\t\t${expected} = ${expected} && ${expected}.next;\n \t\t\t\t\t\t${iteration}.discard = false;\n \t\t\t\t\t\t${iteration}.last = ${last};\n \n-\t\t\t\t\t\tif (!${expected}) ${iteration}.mount( ${parentNode}, ${anchor} );\n+\t\t\t\t\t\tif ( ${expected} ) {\n+\t\t\t\t\t\t\t${iteration}.mount( ${parentNode}, ${expected}.first );\n+\t\t\t\t\t\t\t${iteration}.next = ${expected};\n+\t\t\t\t\t\t\t${expected}.last = ${iteration};\n+\t\t\t\t\t\t\t${expected} = ${expected}.next;\n+\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t${iteration}.mount( ${parentNode}, ${anchor} );\n+\t\t\t\t\t\t}\n \t\t\t\t\t} else {\n \t\t\t\t\t\t// key is being inserted\n \t\t\t\t\t\t${iteration} = ${lookup}[${key}] = ${create_each_block}( ${params}, ${each_block_value}, ${each_block_value}[#i], #i, #component, ${key} );\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/generators/dom/visitors/EachBlock.ts b/src/generators/dom/visitors/EachBlock.ts\nindex 46d91fc..561671a 100644\n--- a/src/generators/dom/visitors/EachBlock.ts\n+++ b/src/generators/dom/visitors/EachBlock.ts\n@@ -290,7 +290,7 @@ function keyed(\n \t\t\t\t\t${expected} = ${expected}.next;\n \t\t\t\t} else {\n \t\t\t\t\tif ( ${iteration} ) {\n-\t\t\t\t\t\t// probably a deletion\n+\t\t\t\t\t\t// existing item moved or deletion before it\n \t\t\t\t\t\twhile ( ${expected} && ${expected}.key !== ${key} ) {\n \t\t\t\t\t\t\t${expected}.discard = true;\n \t\t\t\t\t\t\tdiscard_pile.push( ${expected} );\n@@ -301,15 +301,13 @@ function keyed(\n \t\t\t\t\t\t${iteration}.discard = false;\n \t\t\t\t\t\t${iteration}.last = ${last};\n \n-\t\t\t\t\t\tif (!${expected}) ${iteration}.mount( ${parentNode}, ${anchor} );\n+\t\t\t\t\t\t// ensure existing DOM is moved to the correct position\n+\t\t\t\t\t\t${iteration}.mount( ${parentNode}, ${expected} ? ${expected}.first : ${anchor} );\n \t\t\t\t\t} else {\n \t\t\t\t\t\t// key is being inserted\n \t\t\t\t\t\t${iteration} = ${lookup}[${key}] = ${create_each_block}( ${params}, ${each_block_value}, ${each_block_value}[#i], #i, #component, ${key} );\n \t\t\t\t\t\t${iteration}.create();\n \t\t\t\t\t\t${iteration}.${mountOrIntro}( ${parentNode}, ${expected}.first );\n-\n-\t\t\t\t\t\t${expected}.last = ${iteration};\n-\t\t\t\t\t\t${iteration}.next = ${expected};\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t} else {\n"
}