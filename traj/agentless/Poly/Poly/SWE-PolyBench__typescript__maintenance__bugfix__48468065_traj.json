{
    "instance_id": "SWE-PolyBench__typescript__maintenance__bugfix__48468065",
    "original_id": "microsoft__vscode-160342",
    "1_model_selected_files": [
        "src/vs/workbench/contrib/files/browser/files.ts",
        "src/vs/workbench/contrib/files/browser/fileActions.ts",
        "src/vs/workbench/contrib/files/browser/fileCommands.ts",
        "src/vs/workbench/browser/actions/listCommands.ts",
        "src/vs/workbench/contrib/files/browser/views/explorerView.ts"
    ],
    "2_embedding_selected_files": [
        "src/vs/workbench/contrib/files/browser/fileActions.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/workspace.event.test.ts",
        "src/vs/editor/common/cursor/cursorDeleteOperations.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/workspace.test.ts",
        "src/vs/workbench/contrib/files/browser/fileActions.contribution.ts",
        "src/vs/editor/browser/coreCommands.ts",
        "src/vs/editor/contrib/linesOperations/browser/linesOperations.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/window.test.ts",
        "src/vs/workbench/contrib/welcomeWalkthrough/browser/editor/vs_code_editor_walkthrough.ts",
        "src/vs/code/electron-sandbox/issue/issueReporterMain.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/editor.test.ts",
        "src/vs/workbench/contrib/localHistory/electron-sandbox/localHistoryCommands.ts",
        "src/vs/workbench/contrib/localHistory/browser/localHistoryCommands.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/quickInput.test.ts",
        "src/vs/workbench/contrib/bulkEdit/browser/bulkFileEdits.ts",
        "src/vs/workbench/browser/actions/listCommands.ts",
        "src/vs/workbench/contrib/notebook/browser/controller/cellOperations.ts",
        "extensions/emmet/src/selectItem.ts",
        "src/vs/code/electron-browser/sharedProcess/contrib/storageDataCleaner.ts",
        "extensions/emmet/src/removeTag.ts",
        "extensions/git/src/commands.ts",
        "src/vs/workbench/contrib/files/browser/fileCommands.ts",
        "src/vs/editor/common/cursor/cursorWordOperations.ts",
        "src/vs/workbench/contrib/format/browser/formatActionsMultiple.ts",
        "src/vs/editor/contrib/wordOperations/browser/wordOperations.ts",
        "src/vs/editor/contrib/multicursor/browser/multicursor.ts",
        "src/vs/workbench/contrib/searchEditor/browser/searchEditor.ts",
        "src/vs/base/parts/quickinput/browser/quickInputList.ts",
        "extensions/npm/src/commands.ts",
        "src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts",
        "src/vs/workbench/contrib/performance/electron-sandbox/startupProfiler.ts",
        "src/vs/editor/contrib/lineSelection/browser/lineSelection.ts",
        "extensions/emmet/src/selectItemHTML.ts",
        "src/vs/code/electron-sandbox/processExplorer/processExplorerMain.ts",
        "src/vs/editor/browser/editorExtensions.ts",
        "src/vs/editor/contrib/smartSelect/browser/smartSelect.ts",
        "extensions/merge-conflict/src/commandHandler.ts",
        "src/vs/workbench/contrib/codeEditor/electron-sandbox/selectionClipboard.ts",
        "src/vs/editor/common/tokens/contiguousMultilineTokens.ts",
        "src/vs/editor/contrib/rename/browser/rename.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/commands.test.ts",
        "src/vs/workbench/contrib/files/browser/views/explorerViewer.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/workspace.fs.test.ts",
        "src/vs/editor/common/cursor/cursorCollection.ts",
        "src/vs/base/browser/ui/list/listView.ts",
        "src/vs/workbench/api/common/extHostSCM.ts",
        "src/vs/workbench/api/common/extHostQuickOpen.ts",
        "src/vs/editor/contrib/wordPartOperations/browser/wordPartOperations.ts",
        "extensions/emmet/src/selectItemStylesheet.ts",
        "extensions/typescript-language-features/src/languageFeatures/updatePathsOnRename.ts",
        "src/vs/workbench/api/browser/mainThreadFileSystemEventService.ts",
        "src/vs/editor/common/commands/shiftCommand.ts",
        "src/vs/workbench/browser/actions/windowActions.ts"
    ],
    "3_final_combined_files": [
        "src/vs/workbench/contrib/files/browser/fileActions.ts",
        "src/vs/workbench/contrib/files/browser/files.ts",
        "src/vs/workbench/contrib/files/browser/fileCommands.ts",
        "extensions/vscode-api-tests/src/singlefolder-tests/workspace.event.test.ts",
        "src/vs/editor/common/cursor/cursorDeleteOperations.ts"
    ],
    "4_related_elements": {
        "src/vs/workbench/contrib/files/browser/fileActions.ts": [
            "function: deleteFiles\nfunction: moveFileToTrashHandler\nfunction: deleteFileHandler\nfunction: getMoveToTrashMessage\nfunction: getDeleteMessage"
        ],
        "src/vs/workbench/contrib/files/browser/files.ts": [
            "function: getMultiSelectedResources\nfunction: getResourceForCommand\nfunction: getOpenEditorsViewMultiSelection\nfunction: getFocus\nfunction: IExplorerService.getContext\nfunction: IExplorerView.getContext"
        ],
        "src/vs/workbench/contrib/files/browser/fileCommands.ts": [
            ""
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/vs/workbench/contrib/files/browser/fileActions.ts": [
                    "function: moveFileToTrashHandler\nline: 930\nfunction: deleteFileHandler\nline: 939"
                ],
                "src/vs/workbench/contrib/files/browser/files.ts": [
                    ""
                ],
                "src/vs/workbench/contrib/files/browser/fileCommands.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/vs/workbench/contrib/files/browser/fileActions.ts b/src/vs/workbench/contrib/files/browser/fileActions.ts\nindex d6e33e4..546305c 100644\n--- a/src/vs/workbench/contrib/files/browser/fileActions.ts\n+++ b/src/vs/workbench/contrib/files/browser/fileActions.ts\n@@ -1,3 +1,4 @@\n+\n /*---------------------------------------------------------------------------------------------\n  *  Copyright (c) Microsoft Corporation. All rights reserved.\n  *  Licensed under the MIT License. See License.txt in the project root for license information.\n@@ -927,7 +928,10 @@ export const renameHandler = async (accessor: ServicesAccessor) => {\n \n export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tlet stats = explorerService.getContext(false).filter(s => !s.isRoot);\n+\tif (!stats.length) {\n+\t\tstats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\t}\n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, true);\n \t}\n@@ -935,7 +939,11 @@ export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \n export const deleteFileHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tlet stats = explorerService.getContext(false).filter(s => !s.isRoot);\n+\n+\tif (!stats.length) {\n+\t\tstats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\t}\n \n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, false);\n@@ -1109,4 +1117,4 @@ export const openFilePreserveFocusHandler = async (accessor: ServicesAccessor) =\n \t\tresource: s.resource,\n \t\toptions: { preserveFocus: true }\n \t})));\n-};\n+};\n",
                "diff --git a/src/vs/workbench/contrib/files/browser/fileActions.ts b/src/vs/workbench/contrib/files/browser/fileActions.ts\nindex d6e33e4..27562e3 100644\n--- a/src/vs/workbench/contrib/files/browser/fileActions.ts\n+++ b/src/vs/workbench/contrib/files/browser/fileActions.ts\n@@ -1,3 +1,4 @@\n+\n /*---------------------------------------------------------------------------------------------\n  *  Copyright (c) Microsoft Corporation. All rights reserved.\n  *  Licensed under the MIT License. See License.txt in the project root for license information.\n@@ -927,7 +928,13 @@ export const renameHandler = async (accessor: ServicesAccessor) => {\n \n export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\n+\t// Prefer any existing selection (even if focus moved to an unselected item),\n+\t// otherwise fall back to the focused context item.\n+\tconst selection = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst context = explorerService.getContext(false).filter(s => !s.isRoot);\n+\tconst stats = selection.length > 0 ? selection : context;\n+\n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, true);\n \t}\n@@ -935,7 +942,12 @@ export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \n export const deleteFileHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\n+\t// Prefer any existing selection (even if focus moved to an unselected item),\n+\t// otherwise fall back to the focused context item.\n+\tconst selection = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst context = explorerService.getContext(false).filter(s => !s.isRoot);\n+\tconst stats = selection.length > 0 ? selection : context;\n \n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, false);\n@@ -1109,4 +1121,4 @@ export const openFilePreserveFocusHandler = async (accessor: ServicesAccessor) =\n \t\tresource: s.resource,\n \t\toptions: { preserveFocus: true }\n \t})));\n-};\n+};\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/vs/workbench/contrib/files/browser/fileActions.ts": [
                    "function: moveFileToTrashHandler\nfunction: deleteFileHandler"
                ],
                "src/vs/workbench/contrib/files/browser/files.ts": [
                    ""
                ],
                "src/vs/workbench/contrib/files/browser/fileCommands.ts": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/vs/workbench/contrib/files/browser/fileActions.ts b/src/vs/workbench/contrib/files/browser/fileActions.ts\nindex d6e33e4..13cad3e 100644\n--- a/src/vs/workbench/contrib/files/browser/fileActions.ts\n+++ b/src/vs/workbench/contrib/files/browser/fileActions.ts\n@@ -1,3 +1,4 @@\n+\n /*---------------------------------------------------------------------------------------------\n  *  Copyright (c) Microsoft Corporation. All rights reserved.\n  *  Licensed under the MIT License. See License.txt in the project root for license information.\n@@ -927,7 +928,7 @@ export const renameHandler = async (accessor: ServicesAccessor) => {\n \n export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst stats = explorerService.getContext(false).filter(s => !s.isRoot);\n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, true);\n \t}\n@@ -935,7 +936,7 @@ export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \n export const deleteFileHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst stats = explorerService.getContext(false).filter(s => !s.isRoot);\n \n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, false);\n@@ -1109,4 +1110,4 @@ export const openFilePreserveFocusHandler = async (accessor: ServicesAccessor) =\n \t\tresource: s.resource,\n \t\toptions: { preserveFocus: true }\n \t})));\n-};\n+};\n",
                "diff --git a/src/vs/workbench/contrib/files/browser/fileActions.ts b/src/vs/workbench/contrib/files/browser/fileActions.ts\nindex d6e33e4..13cad3e 100644\n--- a/src/vs/workbench/contrib/files/browser/fileActions.ts\n+++ b/src/vs/workbench/contrib/files/browser/fileActions.ts\n@@ -1,3 +1,4 @@\n+\n /*---------------------------------------------------------------------------------------------\n  *  Copyright (c) Microsoft Corporation. All rights reserved.\n  *  Licensed under the MIT License. See License.txt in the project root for license information.\n@@ -927,7 +928,7 @@ export const renameHandler = async (accessor: ServicesAccessor) => {\n \n export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst stats = explorerService.getContext(false).filter(s => !s.isRoot);\n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, true);\n \t}\n@@ -935,7 +936,7 @@ export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \n export const deleteFileHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst stats = explorerService.getContext(false).filter(s => !s.isRoot);\n \n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, false);\n@@ -1109,4 +1110,4 @@ export const openFilePreserveFocusHandler = async (accessor: ServicesAccessor) =\n \t\tresource: s.resource,\n \t\toptions: { preserveFocus: true }\n \t})));\n-};\n+};\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/vs/workbench/contrib/files/browser/fileActions.ts b/src/vs/workbench/contrib/files/browser/fileActions.ts\nindex d6e33e4..13cad3e 100644\n--- a/src/vs/workbench/contrib/files/browser/fileActions.ts\n+++ b/src/vs/workbench/contrib/files/browser/fileActions.ts\n@@ -1,3 +1,4 @@\n+\n /*---------------------------------------------------------------------------------------------\n  *  Copyright (c) Microsoft Corporation. All rights reserved.\n  *  Licensed under the MIT License. See License.txt in the project root for license information.\n@@ -927,7 +928,7 @@ export const renameHandler = async (accessor: ServicesAccessor) => {\n \n export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst stats = explorerService.getContext(false).filter(s => !s.isRoot);\n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, true);\n \t}\n@@ -935,7 +936,7 @@ export const moveFileToTrashHandler = async (accessor: ServicesAccessor) => {\n \n export const deleteFileHandler = async (accessor: ServicesAccessor) => {\n \tconst explorerService = accessor.get(IExplorerService);\n-\tconst stats = explorerService.getContext(true).filter(s => !s.isRoot);\n+\tconst stats = explorerService.getContext(false).filter(s => !s.isRoot);\n \n \tif (stats.length) {\n \t\tawait deleteFiles(accessor.get(IExplorerService), accessor.get(IWorkingCopyFileService), accessor.get(IDialogService), accessor.get(IConfigurationService), stats, false);\n@@ -1109,4 +1110,4 @@ export const openFilePreserveFocusHandler = async (accessor: ServicesAccessor) =\n \t\tresource: s.resource,\n \t\toptions: { preserveFocus: true }\n \t})));\n-};\n+};\n"
}