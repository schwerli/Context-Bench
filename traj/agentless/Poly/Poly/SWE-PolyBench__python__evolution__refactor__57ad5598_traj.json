{
    "instance_id": "SWE-PolyBench__python__evolution__refactor__57ad5598",
    "original_id": "keras-team__keras-18871",
    "1_model_selected_files": [
        "keras/models/model.py",
        "keras/saving/saving_api.py"
    ],
    "2_embedding_selected_files": [
        "keras/saving/saving_lib_test.py",
        "keras/saving/saving_lib.py",
        "keras/legacy/saving/legacy_h5_format_test.py",
        "keras/saving/saving_api.py",
        "keras/legacy/saving/saving_utils.py",
        "keras/legacy/saving/__init__.py",
        "keras/legacy/saving/legacy_h5_format.py",
        "keras/models/cloning.py",
        "keras/callbacks/model_checkpoint_test.py",
        "keras/models/model.py",
        "keras/callbacks/backup_and_restore_callback.py",
        "keras/saving/saving_api_test.py",
        "keras/saving/serialization_lib.py",
        "keras/saving/__init__.py",
        "keras/models/cloning_test.py",
        "keras/utils/torch_utils_test.py",
        "keras/legacy/saving/saving_options.py",
        "examples/keras_io/tensorflow/keras_recipes/trainer_pattern.py",
        "keras/callbacks/model_checkpoint.py",
        "guides/functional_api.py",
        "keras/utils/torch_utils.py",
        "keras/legacy/saving/serialization.py",
        "guides/training_with_built_in_methods.py",
        "keras/trainers/trainer_test.py",
        "keras/layers/preprocessing/feature_space.py",
        "keras/backend/jax/trainer.py",
        "keras/saving/serialization_lib_test.py",
        "keras/export/export_lib.py",
        "keras/models/variable_mapping.py",
        "keras/export/export_lib_test.py",
        "keras/backend/tensorflow/trainer.py",
        "keras/backend/tensorflow/saved_model_test.py",
        "keras/models/model_test.py",
        "keras/models/__init__.py",
        "examples/keras_io/vision/super_resolution_sub_pixel.py",
        "integration_tests/model_visualization_test.py",
        "guides/sequential_model.py",
        "benchmarks/model_benchmark/bert_benchmark.py",
        "guides/transfer_learning.py",
        "keras/utils/python_utils_test.py",
        "keras/models/variable_mapping_test.py",
        "guides/custom_train_step_in_tensorflow.py",
        "keras/utils/summary_utils_test.py",
        "keras/models/functional_test.py",
        "examples/keras_io/vision/video_transformers.py",
        "keras/callbacks/early_stopping_test.py",
        "keras/legacy/__init__.py",
        "examples/keras_io/tensorflow/generative/ddim.py",
        "keras/callbacks/__init__.py",
        "guides/custom_train_step_in_torch.py"
    ],
    "3_final_combined_files": [
        "keras/models/model.py",
        "keras/saving/saving_api.py",
        "keras/saving/saving_lib_test.py",
        "keras/saving/saving_lib.py",
        "keras/legacy/saving/legacy_h5_format_test.py"
    ],
    "4_related_elements": {
        "keras/models/model.py": [
            "function: Model.save\nfunction: Model.load_weights"
        ],
        "keras/saving/saving_api.py": [
            "function: save_model\nfunction: load_model\nfunction: load_weights"
        ],
        "keras/saving/saving_lib_test.py": [
            "class: SavingTest\nclass: SavingAPITest"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "keras/models/model.py": [
                    "function: Model.save"
                ],
                "keras/saving/saving_api.py": [
                    ""
                ],
                "keras/saving/saving_lib_test.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/keras/models/model.py b/keras/models/model.py\nindex 4baad3a..6e202cc 100644\n--- a/keras/models/model.py\n+++ b/keras/models/model.py\n@@ -266,97 +266,11 @@ class Model(Trainer, Layer):\n \n     @traceback_utils.filter_traceback\n     def save(self, filepath, overwrite=True, **kwargs):\n-        \"\"\"Saves a model as a `.keras` file.\n+        \"\"\"Saves a model.\n \n-        Args:\n-            filepath: `str` or `pathlib.Path` object.\n-                Path where to save the model. Must end in `.keras`.\n-            overwrite: Whether we should overwrite any existing model\n-                at the target location, or instead ask the user\n-                via an interactive prompt.\n-            save_format: Format to use, as a string. Only the `\"keras\"`\n-                format is supported at this time.\n-\n-        Example:\n-\n-        ```python\n-        model = keras.Sequential(\n-            [\n-                keras.layers.Dense(5, input_shape=(3,)),\n-                keras.layers.Softmax(),\n-            ],\n-        )\n-        model.save(\"model.keras\")\n-        loaded_model = keras.saving.load_model(\"model.keras\")\n-        x = keras.random.uniform((10, 3))\n-        assert np.allclose(model.predict(x), loaded_model.predict(x))\n-        ```\n-\n-        Note that `model.save()` is an alias for\n-        `keras.saving.save_model()`.\n-\n-        The saved `.keras` file contains:\n-\n-        - The model's configuration (architecture)\n-        - The model's weights\n-        - The model's optimizer's state (if any)\n-\n-        Thus models can be reinstantiated in the exact same state.\n+        Note that `model.save()` is an alias for `keras.saving.save_model()`.\n         \"\"\"\n-        include_optimizer = kwargs.pop(\"include_optimizer\", True)\n-        save_format = kwargs.pop(\"save_format\", None)\n-        if kwargs:\n-            raise ValueError(\n-                \"The following argument(s) are not supported: \"\n-                f\"{list(kwargs.keys())}\"\n-            )\n-        if save_format:\n-            if str(filepath).endswith((\".h5\", \".hdf5\")) or str(\n-                filepath\n-            ).endswith(\".keras\"):\n-                warnings.warn(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"We recommend removing this argument as it can be inferred \"\n-                    \"from the file path. \"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-            else:\n-                raise ValueError(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"Please remove this argument and pass a file path with \"\n-                    \"either `.keras` or `.h5` extension.\"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-        try:\n-            exists = os.path.exists(filepath)\n-        except TypeError:\n-            exists = False\n-        if exists and not overwrite:\n-            proceed = io_utils.ask_to_proceed_with_overwrite(filepath)\n-            if not proceed:\n-                return\n-        if str(filepath).endswith(\".keras\"):\n-            saving_lib.save_model(self, filepath)\n-        elif str(filepath).endswith((\".h5\", \".hdf5\")):\n-            # Deprecation warnings\n-            warnings.warn(\n-                \"You are saving your model as an HDF5 file via `model.save()`. \"\n-                \"This file format is considered legacy. \"\n-                \"We recommend using instead the native Keras format, \"\n-                \"e.g. `model.save('my_model.keras')`.\"\n-            )\n-            legacy_h5_format.save_model_to_hdf5(\n-                self, filepath, overwrite, include_optimizer\n-            )\n-        else:\n-            raise ValueError(\n-                \"Invalid filepath extension for saving. \"\n-                \"Please add either a `.keras` extension for the native Keras \"\n-                f\"format (recommended) or a `.h5` extension. \"\n-                \"Use `tf.saved_model.save()` if you want to export a \"\n-                \"SavedModel for use with TFLite/TFServing/etc. \"\n-                f\"Received: filepath={filepath}.\"\n-            )\n+        return saving_lib.save_model(self, filepath, overwrite=overwrite, **kwargs)\n \n     @traceback_utils.filter_traceback\n     def save_weights(self, filepath, overwrite=True):\n",
                "diff --git a/keras/models/model.py b/keras/models/model.py\nindex 4baad3a..6627a61 100644\n--- a/keras/models/model.py\n+++ b/keras/models/model.py\n@@ -303,60 +303,8 @@ class Model(Trainer, Layer):\n \n         Thus models can be reinstantiated in the exact same state.\n         \"\"\"\n-        include_optimizer = kwargs.pop(\"include_optimizer\", True)\n-        save_format = kwargs.pop(\"save_format\", None)\n-        if kwargs:\n-            raise ValueError(\n-                \"The following argument(s) are not supported: \"\n-                f\"{list(kwargs.keys())}\"\n-            )\n-        if save_format:\n-            if str(filepath).endswith((\".h5\", \".hdf5\")) or str(\n-                filepath\n-            ).endswith(\".keras\"):\n-                warnings.warn(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"We recommend removing this argument as it can be inferred \"\n-                    \"from the file path. \"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-            else:\n-                raise ValueError(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"Please remove this argument and pass a file path with \"\n-                    \"either `.keras` or `.h5` extension.\"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-        try:\n-            exists = os.path.exists(filepath)\n-        except TypeError:\n-            exists = False\n-        if exists and not overwrite:\n-            proceed = io_utils.ask_to_proceed_with_overwrite(filepath)\n-            if not proceed:\n-                return\n-        if str(filepath).endswith(\".keras\"):\n-            saving_lib.save_model(self, filepath)\n-        elif str(filepath).endswith((\".h5\", \".hdf5\")):\n-            # Deprecation warnings\n-            warnings.warn(\n-                \"You are saving your model as an HDF5 file via `model.save()`. \"\n-                \"This file format is considered legacy. \"\n-                \"We recommend using instead the native Keras format, \"\n-                \"e.g. `model.save('my_model.keras')`.\"\n-            )\n-            legacy_h5_format.save_model_to_hdf5(\n-                self, filepath, overwrite, include_optimizer\n-            )\n-        else:\n-            raise ValueError(\n-                \"Invalid filepath extension for saving. \"\n-                \"Please add either a `.keras` extension for the native Keras \"\n-                f\"format (recommended) or a `.h5` extension. \"\n-                \"Use `tf.saved_model.save()` if you want to export a \"\n-                \"SavedModel for use with TFLite/TFServing/etc. \"\n-                f\"Received: filepath={filepath}.\"\n-            )\n+        # Delegate to the centralized saving API to avoid duplication.\n+        return saving_lib.save_model(self, filepath, overwrite=overwrite, **kwargs)\n \n     @traceback_utils.filter_traceback\n     def save_weights(self, filepath, overwrite=True):\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "keras/models/model.py": [
                    "function: Model.save"
                ],
                "keras/saving/saving_api.py": [
                    ""
                ],
                "keras/saving/saving_lib_test.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/keras/models/model.py b/keras/models/model.py\nindex 4baad3a..87223a1 100644\n--- a/keras/models/model.py\n+++ b/keras/models/model.py\n@@ -266,97 +266,21 @@ class Model(Trainer, Layer):\n \n     @traceback_utils.filter_traceback\n     def save(self, filepath, overwrite=True, **kwargs):\n-        \"\"\"Saves a model as a `.keras` file.\n+        \"\"\"Saves a model to disk.\n+\n+        This method is an alias for `keras.saving.save_model()`.\n \n         Args:\n             filepath: `str` or `pathlib.Path` object.\n-                Path where to save the model. Must end in `.keras`.\n-            overwrite: Whether we should overwrite any existing model\n-                at the target location, or instead ask the user\n-                via an interactive prompt.\n-            save_format: Format to use, as a string. Only the `\"keras\"`\n-                format is supported at this time.\n-\n-        Example:\n-\n-        ```python\n-        model = keras.Sequential(\n-            [\n-                keras.layers.Dense(5, input_shape=(3,)),\n-                keras.layers.Softmax(),\n-            ],\n-        )\n-        model.save(\"model.keras\")\n-        loaded_model = keras.saving.load_model(\"model.keras\")\n-        x = keras.random.uniform((10, 3))\n-        assert np.allclose(model.predict(x), loaded_model.predict(x))\n-        ```\n-\n-        Note that `model.save()` is an alias for\n-        `keras.saving.save_model()`.\n-\n-        The saved `.keras` file contains:\n-\n-        - The model's configuration (architecture)\n-        - The model's weights\n-        - The model's optimizer's state (if any)\n-\n-        Thus models can be reinstantiated in the exact same state.\n+                Target path for the model. Typically ends in `.keras`\n+                (recommended) or `.h5` for legacy HDF5 format.\n+            overwrite: Whether to overwrite any existing file at the target\n+                path, or instead ask the user via an interactive prompt.\n+            **kwargs: Additional keyword arguments forwarded to\n+                `keras.saving.save_model()` (e.g. `include_optimizer`,\n+                or the deprecated `save_format`).\n         \"\"\"\n-        include_optimizer = kwargs.pop(\"include_optimizer\", True)\n-        save_format = kwargs.pop(\"save_format\", None)\n-        if kwargs:\n-            raise ValueError(\n-                \"The following argument(s) are not supported: \"\n-                f\"{list(kwargs.keys())}\"\n-            )\n-        if save_format:\n-            if str(filepath).endswith((\".h5\", \".hdf5\")) or str(\n-                filepath\n-            ).endswith(\".keras\"):\n-                warnings.warn(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"We recommend removing this argument as it can be inferred \"\n-                    \"from the file path. \"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-            else:\n-                raise ValueError(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"Please remove this argument and pass a file path with \"\n-                    \"either `.keras` or `.h5` extension.\"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-        try:\n-            exists = os.path.exists(filepath)\n-        except TypeError:\n-            exists = False\n-        if exists and not overwrite:\n-            proceed = io_utils.ask_to_proceed_with_overwrite(filepath)\n-            if not proceed:\n-                return\n-        if str(filepath).endswith(\".keras\"):\n-            saving_lib.save_model(self, filepath)\n-        elif str(filepath).endswith((\".h5\", \".hdf5\")):\n-            # Deprecation warnings\n-            warnings.warn(\n-                \"You are saving your model as an HDF5 file via `model.save()`. \"\n-                \"This file format is considered legacy. \"\n-                \"We recommend using instead the native Keras format, \"\n-                \"e.g. `model.save('my_model.keras')`.\"\n-            )\n-            legacy_h5_format.save_model_to_hdf5(\n-                self, filepath, overwrite, include_optimizer\n-            )\n-        else:\n-            raise ValueError(\n-                \"Invalid filepath extension for saving. \"\n-                \"Please add either a `.keras` extension for the native Keras \"\n-                f\"format (recommended) or a `.h5` extension. \"\n-                \"Use `tf.saved_model.save()` if you want to export a \"\n-                \"SavedModel for use with TFLite/TFServing/etc. \"\n-                f\"Received: filepath={filepath}.\"\n-            )\n+        return saving_lib.save_model(self, filepath, overwrite=overwrite, **kwargs)\n \n     @traceback_utils.filter_traceback\n     def save_weights(self, filepath, overwrite=True):\n",
                "diff --git a/keras/models/model.py b/keras/models/model.py\nindex 4baad3a..26f521d 100644\n--- a/keras/models/model.py\n+++ b/keras/models/model.py\n@@ -303,60 +303,7 @@ class Model(Trainer, Layer):\n \n         Thus models can be reinstantiated in the exact same state.\n         \"\"\"\n-        include_optimizer = kwargs.pop(\"include_optimizer\", True)\n-        save_format = kwargs.pop(\"save_format\", None)\n-        if kwargs:\n-            raise ValueError(\n-                \"The following argument(s) are not supported: \"\n-                f\"{list(kwargs.keys())}\"\n-            )\n-        if save_format:\n-            if str(filepath).endswith((\".h5\", \".hdf5\")) or str(\n-                filepath\n-            ).endswith(\".keras\"):\n-                warnings.warn(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"We recommend removing this argument as it can be inferred \"\n-                    \"from the file path. \"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-            else:\n-                raise ValueError(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"Please remove this argument and pass a file path with \"\n-                    \"either `.keras` or `.h5` extension.\"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-        try:\n-            exists = os.path.exists(filepath)\n-        except TypeError:\n-            exists = False\n-        if exists and not overwrite:\n-            proceed = io_utils.ask_to_proceed_with_overwrite(filepath)\n-            if not proceed:\n-                return\n-        if str(filepath).endswith(\".keras\"):\n-            saving_lib.save_model(self, filepath)\n-        elif str(filepath).endswith((\".h5\", \".hdf5\")):\n-            # Deprecation warnings\n-            warnings.warn(\n-                \"You are saving your model as an HDF5 file via `model.save()`. \"\n-                \"This file format is considered legacy. \"\n-                \"We recommend using instead the native Keras format, \"\n-                \"e.g. `model.save('my_model.keras')`.\"\n-            )\n-            legacy_h5_format.save_model_to_hdf5(\n-                self, filepath, overwrite, include_optimizer\n-            )\n-        else:\n-            raise ValueError(\n-                \"Invalid filepath extension for saving. \"\n-                \"Please add either a `.keras` extension for the native Keras \"\n-                f\"format (recommended) or a `.h5` extension. \"\n-                \"Use `tf.saved_model.save()` if you want to export a \"\n-                \"SavedModel for use with TFLite/TFServing/etc. \"\n-                f\"Received: filepath={filepath}.\"\n-            )\n+        return saving_lib.save_model(self, filepath, overwrite=overwrite, **kwargs)\n \n     @traceback_utils.filter_traceback\n     def save_weights(self, filepath, overwrite=True):\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/keras/models/model.py b/keras/models/model.py\nindex 4baad3a..6e202cc 100644\n--- a/keras/models/model.py\n+++ b/keras/models/model.py\n@@ -266,97 +266,11 @@ class Model(Trainer, Layer):\n \n     @traceback_utils.filter_traceback\n     def save(self, filepath, overwrite=True, **kwargs):\n-        \"\"\"Saves a model as a `.keras` file.\n+        \"\"\"Saves a model.\n \n-        Args:\n-            filepath: `str` or `pathlib.Path` object.\n-                Path where to save the model. Must end in `.keras`.\n-            overwrite: Whether we should overwrite any existing model\n-                at the target location, or instead ask the user\n-                via an interactive prompt.\n-            save_format: Format to use, as a string. Only the `\"keras\"`\n-                format is supported at this time.\n-\n-        Example:\n-\n-        ```python\n-        model = keras.Sequential(\n-            [\n-                keras.layers.Dense(5, input_shape=(3,)),\n-                keras.layers.Softmax(),\n-            ],\n-        )\n-        model.save(\"model.keras\")\n-        loaded_model = keras.saving.load_model(\"model.keras\")\n-        x = keras.random.uniform((10, 3))\n-        assert np.allclose(model.predict(x), loaded_model.predict(x))\n-        ```\n-\n-        Note that `model.save()` is an alias for\n-        `keras.saving.save_model()`.\n-\n-        The saved `.keras` file contains:\n-\n-        - The model's configuration (architecture)\n-        - The model's weights\n-        - The model's optimizer's state (if any)\n-\n-        Thus models can be reinstantiated in the exact same state.\n+        Note that `model.save()` is an alias for `keras.saving.save_model()`.\n         \"\"\"\n-        include_optimizer = kwargs.pop(\"include_optimizer\", True)\n-        save_format = kwargs.pop(\"save_format\", None)\n-        if kwargs:\n-            raise ValueError(\n-                \"The following argument(s) are not supported: \"\n-                f\"{list(kwargs.keys())}\"\n-            )\n-        if save_format:\n-            if str(filepath).endswith((\".h5\", \".hdf5\")) or str(\n-                filepath\n-            ).endswith(\".keras\"):\n-                warnings.warn(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"We recommend removing this argument as it can be inferred \"\n-                    \"from the file path. \"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-            else:\n-                raise ValueError(\n-                    \"The `save_format` argument is deprecated in Keras 3. \"\n-                    \"Please remove this argument and pass a file path with \"\n-                    \"either `.keras` or `.h5` extension.\"\n-                    f\"Received: save_format={save_format}\"\n-                )\n-        try:\n-            exists = os.path.exists(filepath)\n-        except TypeError:\n-            exists = False\n-        if exists and not overwrite:\n-            proceed = io_utils.ask_to_proceed_with_overwrite(filepath)\n-            if not proceed:\n-                return\n-        if str(filepath).endswith(\".keras\"):\n-            saving_lib.save_model(self, filepath)\n-        elif str(filepath).endswith((\".h5\", \".hdf5\")):\n-            # Deprecation warnings\n-            warnings.warn(\n-                \"You are saving your model as an HDF5 file via `model.save()`. \"\n-                \"This file format is considered legacy. \"\n-                \"We recommend using instead the native Keras format, \"\n-                \"e.g. `model.save('my_model.keras')`.\"\n-            )\n-            legacy_h5_format.save_model_to_hdf5(\n-                self, filepath, overwrite, include_optimizer\n-            )\n-        else:\n-            raise ValueError(\n-                \"Invalid filepath extension for saving. \"\n-                \"Please add either a `.keras` extension for the native Keras \"\n-                f\"format (recommended) or a `.h5` extension. \"\n-                \"Use `tf.saved_model.save()` if you want to export a \"\n-                \"SavedModel for use with TFLite/TFServing/etc. \"\n-                f\"Received: filepath={filepath}.\"\n-            )\n+        return saving_lib.save_model(self, filepath, overwrite=overwrite, **kwargs)\n \n     @traceback_utils.filter_traceback\n     def save_weights(self, filepath, overwrite=True):\n"
}