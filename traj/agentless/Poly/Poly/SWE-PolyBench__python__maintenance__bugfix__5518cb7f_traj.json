{
    "instance_id": "SWE-PolyBench__python__maintenance__bugfix__5518cb7f",
    "original_id": "huggingface__transformers-13865",
    "1_model_selected_files": [
        "src/transformers/hf_argparser.py",
        "examples/pytorch/language-modeling/run_clm.py",
        "src/transformers/training_args.py"
    ],
    "2_embedding_selected_files": [],
    "3_final_combined_files": [
        "src/transformers/hf_argparser.py",
        "examples/pytorch/language-modeling/run_clm.py",
        "src/transformers/training_args.py"
    ],
    "4_related_elements": {
        "src/transformers/hf_argparser.py": [
            "function: string_to_bool\nfunction: HfArgumentParser._add_dataclass_arguments"
        ],
        "examples/pytorch/language-modeling/run_clm.py": [
            "class: DataTrainingArguments\nclass: ModelArguments\nfunction: main"
        ],
        "src/transformers/training_args.py": [
            "class: TrainingArguments"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/transformers/hf_argparser.py": [
                    "function: HfArgumentParser._add_dataclass_arguments\nline: 111\nline: 113\nline: 116\nline: 121\nline: 146"
                ],
                "examples/pytorch/language-modeling/run_clm.py": [
                    ""
                ],
                "src/transformers/training_args.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 44030d8..4161581 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -70,6 +70,7 @@ class HfArgumentParser(ArgumentParser):\n             self._add_dataclass_arguments(dtype)\n \n     def _add_dataclass_arguments(self, dtype: DataClassType):\n+        import argparse\n         if hasattr(dtype, \"_argument_group_name\"):\n             parser = self.add_argument_group(dtype._argument_group_name)\n         else:\n@@ -109,8 +110,12 @@ class HfArgumentParser(ArgumentParser):\n                 else:\n                     kwargs[\"required\"] = True\n             elif field.type is bool or field.type == Optional[bool]:\n+                # For booleans with default True, expose only the negative flag in help to avoid confusion.\n                 if field.default is True:\n+                    # Add a \"--no_{name}\" flag that sets the value to False.\n                     parser.add_argument(f\"--no_{field.name}\", action=\"store_false\", dest=field.name, **kwargs)\n+                    # Hide the positive form from help to avoid showing two options with the same default.\n+                    kwargs[\"help\"] = argparse.SUPPRESS\n \n                 # Hack because type=bool in argparse does not behave as we want.\n                 kwargs[\"type\"] = string_to_bool\n",
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 44030d8..8b245b1 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -109,8 +109,12 @@ class HfArgumentParser(ArgumentParser):\n                 else:\n                     kwargs[\"required\"] = True\n             elif field.type is bool or field.type == Optional[bool]:\n+                # For boolean fields with a default of True, expose only a negative flag (--no_<name>)\n+                # to avoid having both the positive and negative forms in --help, which is confusing.\n                 if field.default is True:\n                     parser.add_argument(f\"--no_{field.name}\", action=\"store_false\", dest=field.name, **kwargs)\n+                    # Skip adding the positive form to prevent duplicate/confusing options in help.\n+                    continue\n \n                 # Hack because type=bool in argparse does not behave as we want.\n                 kwargs[\"type\"] = string_to_bool\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/transformers/hf_argparser.py": [
                    "function: HfArgumentParser._add_dataclass_arguments\nline: 111\nline: 146"
                ],
                "examples/pytorch/language-modeling/run_clm.py": [
                    ""
                ],
                "src/transformers/training_args.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 44030d8..9ff754b 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -79,6 +79,7 @@ class HfArgumentParser(ArgumentParser):\n                 continue\n             field_name = f\"--{field.name}\"\n             kwargs = field.metadata.copy()\n+            add_positive_variant = True\n             # field.metadata is not used at all by Data Classes,\n             # it is provided as a third-party extension mechanism.\n             if isinstance(field.type, str):\n@@ -110,19 +111,24 @@ class HfArgumentParser(ArgumentParser):\n                     kwargs[\"required\"] = True\n             elif field.type is bool or field.type == Optional[bool]:\n                 if field.default is True:\n-                    parser.add_argument(f\"--no_{field.name}\", action=\"store_false\", dest=field.name, **kwargs)\n+                    # When the default is True, expose only the negative flag to disable it.\n+                    kwargs_no = kwargs.copy()\n+                    kwargs_no[\"default\"] = True\n+                    parser.add_argument(f\"--no_{field.name}\", action=\"store_false\", dest=field.name, **kwargs_no)\n+                    add_positive_variant = False\n \n                 # Hack because type=bool in argparse does not behave as we want.\n-                kwargs[\"type\"] = string_to_bool\n-                if field.type is bool or (field.default is not None and field.default is not dataclasses.MISSING):\n-                    # Default value is False if we have no default when of type bool.\n-                    default = False if field.default is dataclasses.MISSING else field.default\n-                    # This is the value that will get picked if we don't include --field_name in any way\n-                    kwargs[\"default\"] = default\n-                    # This tells argparse we accept 0 or 1 value after --field_name\n-                    kwargs[\"nargs\"] = \"?\"\n-                    # This is the value that will get picked if we do --field_name (without value)\n-                    kwargs[\"const\"] = True\n+                if add_positive_variant:\n+                    kwargs[\"type\"] = string_to_bool\n+                    if field.type is bool or (field.default is not None and field.default is not dataclasses.MISSING):\n+                        # Default value is False if we have no default when of type bool.\n+                        default = False if field.default is dataclasses.MISSING else field.default\n+                        # This is the value that will get picked if we don't include --field_name in any way\n+                        kwargs[\"default\"] = default\n+                        # This tells argparse we accept 0 or 1 value after --field_name\n+                        kwargs[\"nargs\"] = \"?\"\n+                        # This is the value that will get picked if we do --field_name (without value)\n+                        kwargs[\"const\"] = True\n             elif (\n                 hasattr(field.type, \"__origin__\") and re.search(r\"^typing\\.List\\[(.*)\\]$\", str(field.type)) is not None\n             ):\n@@ -143,7 +149,8 @@ class HfArgumentParser(ArgumentParser):\n                     kwargs[\"default\"] = field.default_factory()\n                 else:\n                     kwargs[\"required\"] = True\n-            parser.add_argument(field_name, **kwargs)\n+            if add_positive_variant:\n+                parser.add_argument(field_name, **kwargs)\n \n     def parse_args_into_dataclasses(\n         self, args=None, return_remaining_strings=False, look_for_args_file=True, args_filename=None\n",
                "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 44030d8..1a89d2b 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -110,7 +110,10 @@ class HfArgumentParser(ArgumentParser):\n                     kwargs[\"required\"] = True\n             elif field.type is bool or field.type == Optional[bool]:\n                 if field.default is True:\n+                    # For booleans that default to True, expose only a negative flag to avoid duplicate/confusing options.\n+                    kwargs[\"default\"] = True\n                     parser.add_argument(f\"--no_{field.name}\", action=\"store_false\", dest=field.name, **kwargs)\n+                    continue\n \n                 # Hack because type=bool in argparse does not behave as we want.\n                 kwargs[\"type\"] = string_to_bool\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/transformers/hf_argparser.py b/src/transformers/hf_argparser.py\nindex 44030d8..4161581 100644\n--- a/src/transformers/hf_argparser.py\n+++ b/src/transformers/hf_argparser.py\n@@ -70,6 +70,7 @@ class HfArgumentParser(ArgumentParser):\n             self._add_dataclass_arguments(dtype)\n \n     def _add_dataclass_arguments(self, dtype: DataClassType):\n+        import argparse\n         if hasattr(dtype, \"_argument_group_name\"):\n             parser = self.add_argument_group(dtype._argument_group_name)\n         else:\n@@ -109,8 +110,12 @@ class HfArgumentParser(ArgumentParser):\n                 else:\n                     kwargs[\"required\"] = True\n             elif field.type is bool or field.type == Optional[bool]:\n+                # For booleans with default True, expose only the negative flag in help to avoid confusion.\n                 if field.default is True:\n+                    # Add a \"--no_{name}\" flag that sets the value to False.\n                     parser.add_argument(f\"--no_{field.name}\", action=\"store_false\", dest=field.name, **kwargs)\n+                    # Hide the positive form from help to avoid showing two options with the same default.\n+                    kwargs[\"help\"] = argparse.SUPPRESS\n \n                 # Hack because type=bool in argparse does not behave as we want.\n                 kwargs[\"type\"] = string_to_bool\n"
}