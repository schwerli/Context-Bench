{
    "instance_id": "SWE-PolyBench__javascript__maintenance__bugfix__3b6e6f3a",
    "original_id": "prettier__prettier-8046",
    "1_model_selected_files": [
        "src/language-js/parser-babel.js",
        "src/main/parser.js",
        "src/common/parser-create-error.js",
        "src/language-js/index.js",
        "src/language-js/postprocess.js"
    ],
    "2_embedding_selected_files": [
        "src/language-js/parser-babel.js",
        "src/language-js/printer-estree.js",
        "src/language-js/parser-typescript.js",
        "src/language-js/needs-parens.js",
        "src/language-css/printer-postcss.js",
        "src/language-js/print/call-arguments.js",
        "src/language-js/postprocess.js",
        "src/language-js/utils.js",
        "src/language-js/print/member-chain.js",
        "src/common/parser-create-error.js",
        "src/language-css/parser-postcss.js",
        "website/playground/codeSamples.js",
        "src/language-graphql/printer-graphql.js",
        "src/main/ast-to-doc.js",
        "src/language-js/embed.js",
        "src/language-yaml/printer-yaml.js",
        "src/language-html/printer-html.js",
        "src/language-js/parser-flow.js",
        "src/language-js/print/misc.js",
        "src/language-handlebars/printer-glimmer.js",
        "src/language-handlebars/parser-glimmer.js",
        "src/main/parser.js",
        "src/language-graphql/parser-graphql.js",
        "src/main/comments.js",
        "src/language-js/printer-estree-json.js",
        "src/main/range-util.js",
        "src/language-markdown/printer-markdown.js",
        "src/main/core.js"
    ],
    "3_final_combined_files": [
        "src/language-js/parser-babel.js",
        "src/main/parser.js",
        "src/common/parser-create-error.js",
        "src/language-js/printer-estree.js",
        "src/language-js/parser-typescript.js"
    ],
    "4_related_elements": {
        "src/language-js/parser-babel.js": [
            "function: babelOptions\nfunction: createParse\nfunction: tryCombinations\nvariable: parseTypeScript\nvariable: postprocess"
        ],
        "src/main/parser.js": [
            "function: parse"
        ],
        "src/common/parser-create-error.js": [
            "function: createError"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/language-js/parser-babel.js": [
                    "function: createParse"
                ],
                "src/main/parser.js": [
                    ""
                ],
                "src/common/parser-create-error.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/language-js/parser-babel.js b/src/language-js/parser-babel.js\nindex 88dc79e..c9aa8bb 100644\n--- a/src/language-js/parser-babel.js\n+++ b/src/language-js/parser-babel.js\n@@ -81,9 +81,13 @@ function createParse(parseMethod, ...pluginCombinations) {\n       );\n       ast = tryCombinations(\n         (options) => babel[parseMethod](text, options),\n-        combinations.map((extraPlugins) =>\n-          babelOptions({ sourceType, extraPlugins })\n-        )\n+        combinations.map((extraPlugins) => {\n+          const options = babelOptions({ sourceType, extraPlugins });\n+          // Disable Babel error recovery so invalid syntax throws,\n+          // letting Prettier report a regular parse error instead of crashing later.\n+          options.errorRecovery = false;\n+          return options;\n+        })\n       );\n     } catch (error) {\n       throw createError(\n",
                "diff --git a/src/language-js/parser-babel.js b/src/language-js/parser-babel.js\nindex 88dc79e..886d9b5 100644\n--- a/src/language-js/parser-babel.js\n+++ b/src/language-js/parser-babel.js\n@@ -6,6 +6,10 @@ const locFns = require(\"./loc\");\n const postprocess = require(\"./postprocess\");\n \n function babelOptions({ sourceType, extraPlugins = [] }) {\n+  const hasTypeScript = extraPlugins.some(\n+    (plugin) => (Array.isArray(plugin) ? plugin[0] : plugin) === \"typescript\"\n+  );\n+\n   return {\n     sourceType,\n     allowAwaitOutsideFunction: true,\n@@ -13,7 +17,8 @@ function babelOptions({ sourceType, extraPlugins = [] }) {\n     allowReturnOutsideFunction: true,\n     allowSuperOutsideMethod: true,\n     allowUndeclaredExports: true,\n-    errorRecovery: true,\n+    // Disable error recovery when using the TypeScript plugin to surface proper parse errors\n+    errorRecovery: hasTypeScript ? false : true,\n     createParenthesizedExpressions: true,\n     plugins: [\n       \"doExpressions\",\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/language-js/parser-babel.js": [
                    "line: 16\nfunction: createParse"
                ],
                "src/main/parser.js": [
                    ""
                ],
                "src/common/parser-create-error.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/language-js/parser-babel.js b/src/language-js/parser-babel.js\nindex 88dc79e..8ab217d 100644\n--- a/src/language-js/parser-babel.js\n+++ b/src/language-js/parser-babel.js\n@@ -99,6 +99,39 @@ function createParse(parseMethod, ...pluginCombinations) {\n       );\n     }\n     delete ast.tokens;\n+\n+    // Detect Flow-style type casts \"(a: T)\" when using the TypeScript parser.\n+    // Babel's TypeScript plugin currently parses this without throwing,\n+    // which later causes Prettier to crash during printing.\n+    // To provide a better UX, raise a parse error instead.\n+    const isTypeScriptParser =\n+      pluginCombinations.some((plugins) =>\n+        Array.isArray(plugins) &&\n+        plugins.some((p) => (Array.isArray(p) ? p[0] : p) === \"typescript\")\n+      );\n+\n+    if (isTypeScriptParser) {\n+      const flowTypeCastOnlyExpression = /^\\s*\\(\\s*[$_\\p{L}][$_\\p{L}\\p{N}]*\\s*:\\s*[^)]+\\s*\\)\\s*;?\\s*$/u;\n+      if (flowTypeCastOnlyExpression.test(text)) {\n+        // Compute the location of the ':' to point at the problematic syntax\n+        const colonIndex = text.indexOf(\":\");\n+        let line = 1;\n+        let column = 1;\n+        for (let i = 0; i < colonIndex; i++) {\n+          if (text.charCodeAt(i) === 10) {\n+            line++;\n+            column = 1;\n+          } else {\n+            column++;\n+          }\n+        }\n+        throw createError(\n+          \"Expression type annotations like '(a: T)' are not valid in TypeScript. Use 'a as T' or '<T>a' instead.\",\n+          { start: { line, column } }\n+        );\n+      }\n+    }\n+\n     return postprocess(ast, { ...opts, originalText: text });\n   };\n }\n",
                "diff --git a/src/language-js/parser-babel.js b/src/language-js/parser-babel.js\nindex 88dc79e..672ff58 100644\n--- a/src/language-js/parser-babel.js\n+++ b/src/language-js/parser-babel.js\n@@ -6,6 +6,12 @@ const locFns = require(\"./loc\");\n const postprocess = require(\"./postprocess\");\n \n function babelOptions({ sourceType, extraPlugins = [] }) {\n+  const hasTypeScript =\n+    Array.isArray(extraPlugins) &&\n+    extraPlugins.some((plugin) =>\n+      Array.isArray(plugin) ? plugin[0] === \"typescript\" : plugin === \"typescript\"\n+    );\n+\n   return {\n     sourceType,\n     allowAwaitOutsideFunction: true,\n@@ -13,7 +19,8 @@ function babelOptions({ sourceType, extraPlugins = [] }) {\n     allowReturnOutsideFunction: true,\n     allowSuperOutsideMethod: true,\n     allowUndeclaredExports: true,\n-    errorRecovery: true,\n+    // Disable errorRecovery for TypeScript so invalid code throws a SyntaxError\n+    errorRecovery: !hasTypeScript,\n     createParenthesizedExpressions: true,\n     plugins: [\n       \"doExpressions\",\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/language-js/parser-babel.js b/src/language-js/parser-babel.js\nindex 88dc79e..c9aa8bb 100644\n--- a/src/language-js/parser-babel.js\n+++ b/src/language-js/parser-babel.js\n@@ -81,9 +81,13 @@ function createParse(parseMethod, ...pluginCombinations) {\n       );\n       ast = tryCombinations(\n         (options) => babel[parseMethod](text, options),\n-        combinations.map((extraPlugins) =>\n-          babelOptions({ sourceType, extraPlugins })\n-        )\n+        combinations.map((extraPlugins) => {\n+          const options = babelOptions({ sourceType, extraPlugins });\n+          // Disable Babel error recovery so invalid syntax throws,\n+          // letting Prettier report a regular parse error instead of crashing later.\n+          options.errorRecovery = false;\n+          return options;\n+        })\n       );\n     } catch (error) {\n       throw createError(\n"
}