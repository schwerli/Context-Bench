{
    "instance_id": "SWE-PolyBench__javascript__maintenance__bugfix__c017c9ba",
    "original_id": "prettier__prettier-6604",
    "1_model_selected_files": [
        "src/language-js/printer-estree.js",
        "src/language-js/clean.js",
        "src/language-js/needs-parens.js",
        "src/main/massage-ast.js",
        "src/language-js/parser-typescript.js"
    ],
    "2_embedding_selected_files": [
        "src/language-js/needs-parens.js",
        "src/language-js/printer-estree.js",
        "src/language-js/parser-typescript.js",
        "src/language-js/utils.js",
        "website/playground/codeSamples.js",
        "src/common/util.js",
        "src/language-css/printer-postcss.js",
        "src/language-js/postprocess.js",
        "src/language-js/comments.js",
        "website/playground/util.js",
        "src/language-graphql/printer-graphql.js",
        "src/language-js/clean.js",
        "src/language-css/utils.js",
        "website/playground/PrettierFormat.js",
        "scripts/build/babel-plugins/replace-array-includes-with-indexof.js",
        "src/language-js/options.js",
        "src/language-html/preprocess.js",
        "src/language-html/utils.js",
        "src/main/comments.js",
        "src/main/range-util.js",
        "website/playground/markdown.js",
        "src/language-html/printer-html.js",
        "src/language-js/embed.js",
        "src/language-js/parser-babylon.js",
        "src/doc/doc-debug.js",
        "src/language-css/parser-postcss.js",
        "src/language-handlebars/printer-glimmer.js",
        "src/language-css/clean.js"
    ],
    "3_final_combined_files": [
        "src/language-js/printer-estree.js",
        "src/language-js/needs-parens.js",
        "src/language-js/clean.js",
        "src/language-js/parser-typescript.js"
    ],
    "4_related_elements": {
        "src/language-js/clean.js": [
            "function: clean"
        ],
        "src/language-js/printer-estree.js": [
            "function: genericPrint\nfunction: printTernaryOperator\nfunction: printPathNoParens"
        ],
        "src/language-js/needs-parens.js": [
            "function: needsParens\nfunction: getUnparenthesizedNode"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "src/language-js/clean.js": [
                    "line: 64\nline: 65\nline: 66"
                ],
                "src/language-js/printer-estree.js": [
                    "function: printPathNoParens\nline: 3209\nline: 3210\nline: 3211\nline: 3212\nline: 3213\nline: 3214\nline: 3215\nline: 3216\nfunction: printPathNoParens\nline: 3438\nline: 3439\nline: 3440\nline: 3441\nline: 3442\nline: 3443\nline: 3444\nline: 3445\nline: 3446\nline: 3447\nline: 3448\nline: 3449\nline: 3450\nline: 3451\nline: 3452\nline: 3453\nline: 3454\nfunction: printPathNoParens\nline: 2769\nline: 2819\nline: 2847"
                ],
                "src/language-js/needs-parens.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/language-js/clean.js b/src/language-js/clean.js\nindex 1b55f9e..d3865ce 100644\n--- a/src/language-js/clean.js\n+++ b/src/language-js/clean.js\n@@ -60,10 +60,7 @@ function clean(ast, newObj, parent) {\n     delete newObj.specifiers;\n   }\n \n-  // (TypeScript) bypass TSParenthesizedType\n-  if (ast.type === \"TSParenthesizedType\") {\n-    return newObj.typeAnnotation;\n-  }\n+  // (TypeScript) preserve TSParenthesizedType to maintain necessary parentheses in types\n \n   // (TypeScript) Bypass `& foo` and `| foo` into `foo`\n   // https://github.com/microsoft/TypeScript/issues/30995\ndiff --git a/src/language-js/printer-estree.js b/src/language-js/printer-estree.js\nindex d989b9d..32b937c 100644\n--- a/src/language-js/printer-estree.js\n+++ b/src/language-js/printer-estree.js\n@@ -3169,7 +3169,12 @@ function printPathNoParens(path, options, print, args) {\n     case \"TSTypeQuery\":\n       return concat([\"typeof \", path.call(print, \"exprName\")]);\n     case \"TSParenthesizedType\": {\n-      return path.call(print, \"typeAnnotation\");\n+      const inner = n.typeAnnotation;\n+      // Collapse nested parentheses: ((T)) -> (T)\n+      if (inner && inner.type === \"TSParenthesizedType\") {\n+        return path.call(print, \"typeAnnotation\");\n+      }\n+      return concat([\"(\", path.call(print, \"typeAnnotation\"), \")\"]);\n     }\n     case \"TSIndexSignature\": {\n       const parent = path.getParentNode();\n",
                "diff --git a/src/language-js/printer-estree.js b/src/language-js/printer-estree.js\nindex d989b9d..f832ddb 100644\n--- a/src/language-js/printer-estree.js\n+++ b/src/language-js/printer-estree.js\n@@ -3169,7 +3169,13 @@ function printPathNoParens(path, options, print, args) {\n     case \"TSTypeQuery\":\n       return concat([\"typeof \", path.call(print, \"exprName\")]);\n     case \"TSParenthesizedType\": {\n-      return path.call(print, \"typeAnnotation\");\n+      const n = path.getValue();\n+      // Preserve parentheses around types to maintain precedence,\n+      // but avoid printing duplicate parens for nested TSParenthesizedType.\n+      if (n.typeAnnotation && n.typeAnnotation.type === \"TSParenthesizedType\") {\n+        return path.call(print, \"typeAnnotation\");\n+      }\n+      return concat([\"(\", path.call(print, \"typeAnnotation\"), \")\"]);\n     }\n     case \"TSIndexSignature\": {\n       const parent = path.getParentNode();\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "src/language-js/printer-estree.js": [
                    "function: printPathNoParens"
                ],
                "src/language-js/needs-parens.js": [
                    "function: needsParens"
                ],
                "src/language-js/clean.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/src/language-js/clean.js b/src/language-js/clean.js\nindex 1b55f9e..de990eb 100644\n--- a/src/language-js/clean.js\n+++ b/src/language-js/clean.js\n@@ -60,9 +60,15 @@ function clean(ast, newObj, parent) {\n     delete newObj.specifiers;\n   }\n \n-  // (TypeScript) bypass TSParenthesizedType\n+  // (TypeScript) normalize TSParenthesizedType\n+  // Collapse nested TSParenthesizedType nodes into a single one\n   if (ast.type === \"TSParenthesizedType\") {\n-    return newObj.typeAnnotation;\n+    let inner = newObj.typeAnnotation;\n+    while (inner && inner.type === \"TSParenthesizedType\") {\n+      inner = inner.typeAnnotation;\n+    }\n+    newObj.typeAnnotation = inner;\n+    return newObj;\n   }\n \n   // (TypeScript) Bypass `& foo` and `| foo` into `foo`\ndiff --git a/src/language-js/printer-estree.js b/src/language-js/printer-estree.js\nindex d989b9d..a21ee2f 100644\n--- a/src/language-js/printer-estree.js\n+++ b/src/language-js/printer-estree.js\n@@ -3169,7 +3169,7 @@ function printPathNoParens(path, options, print, args) {\n     case \"TSTypeQuery\":\n       return concat([\"typeof \", path.call(print, \"exprName\")]);\n     case \"TSParenthesizedType\": {\n-      return path.call(print, \"typeAnnotation\");\n+      return concat([\"(\", path.call(print, \"typeAnnotation\"), \")\"]);\n     }\n     case \"TSIndexSignature\": {\n       const parent = path.getParentNode();\n",
                "diff --git a/src/language-js/printer-estree.js b/src/language-js/printer-estree.js\nindex d989b9d..a21ee2f 100644\n--- a/src/language-js/printer-estree.js\n+++ b/src/language-js/printer-estree.js\n@@ -3169,7 +3169,7 @@ function printPathNoParens(path, options, print, args) {\n     case \"TSTypeQuery\":\n       return concat([\"typeof \", path.call(print, \"exprName\")]);\n     case \"TSParenthesizedType\": {\n-      return path.call(print, \"typeAnnotation\");\n+      return concat([\"(\", path.call(print, \"typeAnnotation\"), \")\"]);\n     }\n     case \"TSIndexSignature\": {\n       const parent = path.getParentNode();\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/src/language-js/clean.js b/src/language-js/clean.js\nindex 1b55f9e..d3865ce 100644\n--- a/src/language-js/clean.js\n+++ b/src/language-js/clean.js\n@@ -60,10 +60,7 @@ function clean(ast, newObj, parent) {\n     delete newObj.specifiers;\n   }\n \n-  // (TypeScript) bypass TSParenthesizedType\n-  if (ast.type === \"TSParenthesizedType\") {\n-    return newObj.typeAnnotation;\n-  }\n+  // (TypeScript) preserve TSParenthesizedType to maintain necessary parentheses in types\n \n   // (TypeScript) Bypass `& foo` and `| foo` into `foo`\n   // https://github.com/microsoft/TypeScript/issues/30995\ndiff --git a/src/language-js/printer-estree.js b/src/language-js/printer-estree.js\nindex d989b9d..32b937c 100644\n--- a/src/language-js/printer-estree.js\n+++ b/src/language-js/printer-estree.js\n@@ -3169,7 +3169,12 @@ function printPathNoParens(path, options, print, args) {\n     case \"TSTypeQuery\":\n       return concat([\"typeof \", path.call(print, \"exprName\")]);\n     case \"TSParenthesizedType\": {\n-      return path.call(print, \"typeAnnotation\");\n+      const inner = n.typeAnnotation;\n+      // Collapse nested parentheses: ((T)) -> (T)\n+      if (inner && inner.type === \"TSParenthesizedType\") {\n+        return path.call(print, \"typeAnnotation\");\n+      }\n+      return concat([\"(\", path.call(print, \"typeAnnotation\"), \")\"]);\n     }\n     case \"TSIndexSignature\": {\n       const parent = path.getParentNode();\n"
}