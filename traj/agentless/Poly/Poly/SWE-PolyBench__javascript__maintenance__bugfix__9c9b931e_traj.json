{
    "instance_id": "SWE-PolyBench__javascript__maintenance__bugfix__9c9b931e",
    "original_id": "serverless__serverless-2945",
    "1_model_selected_files": [],
    "2_embedding_selected_files": [
        "lib/plugins/aws/deploy/lib/mergeIamTemplates.test.js",
        "lib/plugins/aws/deploy/lib/mergeIamTemplates.js",
        "lib/plugins/aws/deploy/compile/events/stream/index.test.js",
        "lib/plugins/aws/deploy/compile/events/stream/index.js",
        "lib/plugins/aws/deploy/compile/functions/index.test.js",
        "lib/plugins/aws/deploy/compile/functions/index.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/validate.test.js",
        "lib/plugins/aws/provider/awsProvider.js",
        "lib/plugins/aws/lib/updateStack.js",
        "lib/plugins/aws/deploy/lib/createStack.test.js",
        "lib/plugins/aws/rollback/index.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/validate.js",
        "lib/plugins/aws/lib/naming.test.js",
        "lib/plugins/aws/deploy/lib/createStack.js",
        "lib/plugins/aws/rollback/index.test.js",
        "lib/plugins/aws/lib/monitorStack.test.js",
        "lib/classes/Service.test.js",
        "lib/plugins/aws/deploy/compile/events/s3/index.js",
        "lib/plugins/aws/lib/updateStack.test.js",
        "lib/plugins/aws/deploy/compile/events/s3/index.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/apiKeys.test.js",
        "lib/plugins/aws/deploy/compile/events/sns/index.test.js",
        "lib/plugins/aws/logs/index.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/method/index.test.js",
        "lib/plugins/aws/deploy/compile/events/schedule/index.js",
        "lib/plugins/aws/deploy/compile/events/schedule/index.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/permissions.test.js",
        "lib/plugins/aws/deploy/lib/mergeCustomProviderResources.test.js",
        "lib/plugins/aws/deploy/lib/configureStack.js",
        "serverless/.eslintrc.js",
        "lib/plugins/aws/deploy/lib/mergeCustomProviderResources.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/resources.test.js",
        "lib/plugins/aws/info/display.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/permissions.js",
        "lib/plugins/aws/provider/awsProvider.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/authorizers.js",
        "lib/plugins/aws/remove/lib/stack.test.js",
        "lib/plugins/aws/lib/validate.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/authorizers.test.js",
        "lib/plugins/aws/lib/naming.js",
        "lib/plugins/aws/deploy/lib/configureStack.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/deployment.test.js",
        "lib/classes/Service.js",
        "lib/plugins/aws/lib/monitorStack.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/deployment.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/apiKeys.js",
        "lib/plugins/aws/info/getStackInfo.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/cors.test.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/resources.js",
        "lib/classes/YamlParser.test.js",
        "lib/plugins/aws/info/getStackInfo.js",
        "lib/plugins/aws/deploy/compile/events/sns/index.js",
        "lib/plugins/aws/deploy/compile/events/apiGateway/lib/restApi.test.js",
        "lib/plugins/aws/deploy/index.test.js"
    ],
    "3_final_combined_files": [
        "lib/plugins/aws/deploy/lib/mergeIamTemplates.test.js",
        "lib/plugins/aws/deploy/lib/mergeIamTemplates.js",
        "lib/plugins/aws/deploy/compile/events/stream/index.test.js"
    ],
    "4_related_elements": {
        "lib/plugins/aws/deploy/lib/mergeIamTemplates.js": [
            "function: mergeIamTemplates\nvariable: serverless.service.provider.iamRoleStatements"
        ],
        "lib/plugins/aws/deploy/lib/mergeIamTemplates.test.js": [
            ""
        ],
        "lib/plugins/aws/deploy/compile/events/stream/index.test.js": [
            ""
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "lib/plugins/aws/deploy/lib/mergeIamTemplates.js": [
                    "function: mergeIamTemplates\nline: 122\nline: 123\nline: 124\nline: 133\nline: 134"
                ],
                "lib/plugins/aws/deploy/lib/mergeIamTemplates.test.js": [
                    ""
                ],
                "lib/plugins/aws/deploy/compile/events/stream/index.test.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\nindex 52cddb5..f6372f2 100644\n--- a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n+++ b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n@@ -1,3 +1,4 @@\n+\n 'use strict';\n \n const _ = require('lodash');\n@@ -121,7 +122,7 @@ module.exports = {\n \n       // add custom iam role statements\n       if (this.serverless.service.provider.iamRoleStatements &&\n-        this.serverless.service.provider.iamRoleStatements instanceof Array) {\n+        Array.isArray(this.serverless.service.provider.iamRoleStatements)) {\n         this.serverless.service.provider.compiledCloudFormationTemplate\n           .Resources[this.provider.naming.getPolicyLogicalId()]\n           .Properties\n@@ -131,10 +132,13 @@ module.exports = {\n           .Properties\n           .PolicyDocument\n           .Statement.concat(this.serverless.service.provider.iamRoleStatements);\n+      } else if (this.serverless.service.provider.iamRoleStatements) {\n+        // Warn if iamRoleStatements is present but not in the expected format (array of statements)\n+        this.serverless.cli.log('Warning: \"provider.iamRoleStatements\" must be an array of IAM policy statements. The provided value is not an array and will be ignored.');\n       }\n     }\n \n     return BbPromise.resolve();\n   },\n \n-};\n+};\n",
                "diff --git a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\nindex 52cddb5..45005b5 100644\n--- a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n+++ b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n@@ -1,3 +1,4 @@\n+\n 'use strict';\n \n const _ = require('lodash');\n@@ -120,21 +121,28 @@ module.exports = {\n       }\n \n       // add custom iam role statements\n-      if (this.serverless.service.provider.iamRoleStatements &&\n-        this.serverless.service.provider.iamRoleStatements instanceof Array) {\n-        this.serverless.service.provider.compiledCloudFormationTemplate\n-          .Resources[this.provider.naming.getPolicyLogicalId()]\n-          .Properties\n-          .PolicyDocument\n-          .Statement = this.serverless.service.provider.compiledCloudFormationTemplate\n-          .Resources[this.provider.naming.getPolicyLogicalId()]\n-          .Properties\n-          .PolicyDocument\n-          .Statement.concat(this.serverless.service.provider.iamRoleStatements);\n+      const customIamRoleStatements = this.serverless.service.provider.iamRoleStatements;\n+      if (customIamRoleStatements) {\n+        if (Array.isArray(customIamRoleStatements)) {\n+          this.serverless.service.provider.compiledCloudFormationTemplate\n+            .Resources[this.provider.naming.getPolicyLogicalId()]\n+            .Properties\n+            .PolicyDocument\n+            .Statement = this.serverless.service.provider.compiledCloudFormationTemplate\n+            .Resources[this.provider.naming.getPolicyLogicalId()]\n+            .Properties\n+            .PolicyDocument\n+            .Statement.concat(customIamRoleStatements);\n+        } else {\n+          this.serverless.cli.log(\n+            'WARNING: provider.iamRoleStatements must be an array of IAM policy statements. ' +\n+            'The provided value is not an array and will be ignored.'\n+          );\n+        }\n       }\n     }\n \n     return BbPromise.resolve();\n   },\n \n-};\n+};\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "lib/plugins/aws/deploy/lib/mergeIamTemplates.js": [
                    "function: mergeIamTemplates\nline: 122\nline: 123\nline: 124\nline: 125\nline: 126\nline: 127\nline: 128\nline: 129\nline: 130\nline: 131\nline: 132\nline: 133\nline: 134"
                ],
                "lib/plugins/aws/deploy/lib/mergeIamTemplates.test.js": [
                    ""
                ],
                "lib/plugins/aws/deploy/compile/events/stream/index.test.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\nindex 52cddb5..1785a38 100644\n--- a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n+++ b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n@@ -1,3 +1,4 @@\n+\n 'use strict';\n \n const _ = require('lodash');\n@@ -120,21 +121,29 @@ module.exports = {\n       }\n \n       // add custom iam role statements\n-      if (this.serverless.service.provider.iamRoleStatements &&\n-        this.serverless.service.provider.iamRoleStatements instanceof Array) {\n-        this.serverless.service.provider.compiledCloudFormationTemplate\n-          .Resources[this.provider.naming.getPolicyLogicalId()]\n-          .Properties\n-          .PolicyDocument\n-          .Statement = this.serverless.service.provider.compiledCloudFormationTemplate\n-          .Resources[this.provider.naming.getPolicyLogicalId()]\n-          .Properties\n-          .PolicyDocument\n-          .Statement.concat(this.serverless.service.provider.iamRoleStatements);\n+      if (this.serverless.service.provider.iamRoleStatements) {\n+        if (Array.isArray(this.serverless.service.provider.iamRoleStatements)) {\n+          this.serverless.service.provider.compiledCloudFormationTemplate\n+            .Resources[this.provider.naming.getPolicyLogicalId()]\n+            .Properties\n+            .PolicyDocument\n+            .Statement = this.serverless.service.provider.compiledCloudFormationTemplate\n+            .Resources[this.provider.naming.getPolicyLogicalId()]\n+            .Properties\n+            .PolicyDocument\n+            .Statement.concat(this.serverless.service.provider.iamRoleStatements);\n+        } else {\n+          const warningMessage = 'Warning: \"provider.iamRoleStatements\" must be an array of IAM policy statement objects. The provided value will be ignored.';\n+          if (this.serverless && this.serverless.cli && typeof this.serverless.cli.log === 'function') {\n+            this.serverless.cli.log(warningMessage);\n+          } else {\n+            console.warn(warningMessage);\n+          }\n+        }\n       }\n     }\n \n     return BbPromise.resolve();\n   },\n \n-};\n+};\n",
                "diff --git a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\nindex 52cddb5..471b132 100644\n--- a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n+++ b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n@@ -1,3 +1,4 @@\n+\n 'use strict';\n \n const _ = require('lodash');\n@@ -120,21 +121,28 @@ module.exports = {\n       }\n \n       // add custom iam role statements\n-      if (this.serverless.service.provider.iamRoleStatements &&\n-        this.serverless.service.provider.iamRoleStatements instanceof Array) {\n-        this.serverless.service.provider.compiledCloudFormationTemplate\n-          .Resources[this.provider.naming.getPolicyLogicalId()]\n-          .Properties\n-          .PolicyDocument\n-          .Statement = this.serverless.service.provider.compiledCloudFormationTemplate\n-          .Resources[this.provider.naming.getPolicyLogicalId()]\n-          .Properties\n-          .PolicyDocument\n-          .Statement.concat(this.serverless.service.provider.iamRoleStatements);\n+      if (this.serverless.service.provider.iamRoleStatements) {\n+        if (Array.isArray(this.serverless.service.provider.iamRoleStatements)) {\n+          this.serverless.service.provider.compiledCloudFormationTemplate\n+            .Resources[this.provider.naming.getPolicyLogicalId()]\n+            .Properties\n+            .PolicyDocument\n+            .Statement = this.serverless.service.provider.compiledCloudFormationTemplate\n+            .Resources[this.provider.naming.getPolicyLogicalId()]\n+            .Properties\n+            .PolicyDocument\n+            .Statement.concat(this.serverless.service.provider.iamRoleStatements);\n+        } else {\n+          const providedType = typeof this.serverless.service.provider.iamRoleStatements;\n+          this.serverless.cli.log(\n+            `WARNING: Invalid format for provider.iamRoleStatements. Expected an array of IAM policy statement objects, but received ${providedType}. ` +\n+            'Additional role statements will not be included. If using $ref, ensure the referenced file contains a JSON/YAML array of IAM statement objects.'\n+          );\n+        }\n       }\n     }\n \n     return BbPromise.resolve();\n   },\n \n-};\n+};\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\nindex 52cddb5..f6372f2 100644\n--- a/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n+++ b/lib/plugins/aws/deploy/lib/mergeIamTemplates.js\n@@ -1,3 +1,4 @@\n+\n 'use strict';\n \n const _ = require('lodash');\n@@ -121,7 +122,7 @@ module.exports = {\n \n       // add custom iam role statements\n       if (this.serverless.service.provider.iamRoleStatements &&\n-        this.serverless.service.provider.iamRoleStatements instanceof Array) {\n+        Array.isArray(this.serverless.service.provider.iamRoleStatements)) {\n         this.serverless.service.provider.compiledCloudFormationTemplate\n           .Resources[this.provider.naming.getPolicyLogicalId()]\n           .Properties\n@@ -131,10 +132,13 @@ module.exports = {\n           .Properties\n           .PolicyDocument\n           .Statement.concat(this.serverless.service.provider.iamRoleStatements);\n+      } else if (this.serverless.service.provider.iamRoleStatements) {\n+        // Warn if iamRoleStatements is present but not in the expected format (array of statements)\n+        this.serverless.cli.log('Warning: \"provider.iamRoleStatements\" must be an array of IAM policy statements. The provided value is not an array and will be ignored.');\n       }\n     }\n \n     return BbPromise.resolve();\n   },\n \n-};\n+};\n"
}