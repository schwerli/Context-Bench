{
    "instance_id": "SWE-PolyBench__javascript__maintenance__bugfix__59dd675b",
    "original_id": "serverless__serverless-7374",
    "1_model_selected_files": [
        "scripts/postinstall.js",
        "bin/serverless.js"
    ],
    "2_embedding_selected_files": [
        "lib/utils/config/initialSetup.js",
        "lib/utils/tracking.js",
        "lib/plugins/aws/deploy/lib/checkForChanges.test.js",
        "lib/classes/Utils.test.js",
        "lib/plugins/aws/deploy/lib/checkForChanges.js",
        "lib/utils/config/index.js",
        "lib/utils/tracking.test.js",
        "lib/Serverless.js",
        "lib/plugins/plugin/install/install.test.js",
        "lib/plugins/aws/customResources/index.js",
        "bin/serverless.js",
        "lib/classes/Service.test.js",
        "lib/classes/Service.js",
        "lib/classes/Utils.js",
        "lib/plugins/aws/package/lib/mergeCustomProviderResources.js",
        "lib/classes/Variables.js",
        "lib/plugins/aws/package/lib/saveServiceState.test.js",
        "scripts/pkg/config.js",
        "lib/plugins/aws/package/lib/saveServiceState.js",
        "lib/plugins/aws/package/lib/generateCoreTemplate.test.js",
        "lib/utils/getServerlessConfigFile.js",
        "lib/classes/Config.js",
        "scripts/update-sfe-dep.js",
        "lib/plugins/aws/deployFunction/index.test.js",
        "lib/plugins/aws/package/lib/mergeIamTemplates.test.js",
        "lib/utils/renameService.test.js",
        "scripts/pre-release.js",
        "lib/classes/Variables.test.js",
        "serverless/commitlint.config.js",
        "lib/plugins/aws/configCredentials/awsConfigCredentials.js",
        "lib/plugins/interactiveCli/setupAws.test.js",
        "lib/utils/config/config.test.js",
        "lib/plugins/aws/provider/awsProvider.test.js",
        "lib/plugins/aws/lib/updateStack.js",
        "lib/utils/sentry.js",
        "lib/plugins/aws/configCredentials/awsConfigCredentials.test.js",
        "lib/plugins/aws/provider/awsProvider.js",
        "lib/utils/isTrackingDisabled.js",
        "lib/plugins/create/templates/aws-nodejs-typescript/webpack.config.js",
        "lib/plugins/aws/customResources/resources/s3/lib/bucket.js",
        "lib/plugins/aws/lib/normalizeFiles.test.js",
        "lib/Serverless.test.js",
        "lib/plugins/aws/lib/monitorStack.test.js",
        "lib/plugins/aws/customResources/index.test.js",
        "lib/plugins/config/config.js",
        "lib/classes/Config.test.js",
        "lib/plugins/slstats/slstats.js",
        "lib/utils/getServerlessConfigFile.test.js",
        "lib/utils/renameService.js",
        "lib/plugins/aws/lib/monitorStack.js",
        "lib/plugins/interactiveCli/initializeService.test.js",
        "lib/plugins/interactiveCli/setupAws.js",
        "lib/plugins/aws/rollback/index.js",
        "lib/plugins/aws/package/lib/mergeCustomProviderResources.test.js",
        "lib/plugins/plugin/uninstall/uninstall.test.js",
        "lib/plugins/aws/invokeLocal/index.test.js",
        "lib/plugins/remove/remove.js",
        "lib/utils/getServerlessDir.js"
    ],
    "3_final_combined_files": [
        "scripts/postinstall.js",
        "bin/serverless.js",
        "lib/utils/config/initialSetup.js",
        "lib/utils/tracking.js",
        "lib/plugins/aws/deploy/lib/checkForChanges.test.js"
    ],
    "4_related_elements": {
        "scripts/postinstall.js": [
            "class: Serverless\nfunction: Utils.logStat"
        ],
        "bin/serverless.js": [
            "function: tracking.sendPending\nclass: Serverless\nfunction: initializeErrorReporter"
        ],
        "lib/utils/config/initialSetup.js": [
            "function: configureTrack\nfunction: generateFrameworkId\nfunction: removeLegacyFrameworkIdFiles\nvariable: slsHomePath\nvariable: statsEnabledFile\nvariable: statsDisabledFile\nfunction: getServerlessDir\nfunction: readFileSync\nfunction: fileExistsSync\nfunction: removeFileSync"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "lib/utils/config/initialSetup.js": [
                    "function: module.exports.configureTrack\nfunction: module.exports.generateFrameworkId\nfunction: module.exports.removeLegacyFrameworkIdFiles"
                ],
                "scripts/postinstall.js": [
                    ""
                ],
                "bin/serverless.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/utils/config/initialSetup.js b/lib/utils/config/initialSetup.js\nindex a9c3eba..8637d9d 100644\n--- a/lib/utils/config/initialSetup.js\n+++ b/lib/utils/config/initialSetup.js\n@@ -1,6 +1,8 @@\n+\n 'use strict';\n \n const path = require('path');\n+const os = require('os');\n const uuid = require('uuid');\n const readFileSync = require('../fs/readFileSync');\n const removeFileSync = require('../fs/removeFileSync');\n@@ -10,10 +12,20 @@ const getServerlessDir = require('../getServerlessDir');\n const slsHomePath = getServerlessDir();\n const statsEnabledFile = path.join(slsHomePath, 'stats-enabled');\n const statsDisabledFile = path.join(slsHomePath, 'stats-disabled');\n+const serverlessRcPath = path.join(os.homedir(), '.serverlessrc');\n \n module.exports.configureTrack = function configureTrack() {\n-  // to be updated to .serverlessrc\n-  if (fileExistsSync(path.join(slsHomePath, 'stats-disabled'))) {\n+  // Prefer trackingDisabled from ~/.serverlessrc if present\n+  try {\n+    if (fileExistsSync(serverlessRcPath)) {\n+      const rc = JSON.parse(readFileSync(serverlessRcPath).toString());\n+      if (typeof rc.trackingDisabled === 'boolean') return rc.trackingDisabled;\n+    }\n+  } catch (err) {\n+    // ignore malformed ~/.serverlessrc\n+  }\n+  // Fallback to legacy stats files\n+  if (fileExistsSync(statsDisabledFile)) {\n     return true;\n   }\n   return false;\n@@ -21,6 +33,15 @@ module.exports.configureTrack = function configureTrack() {\n \n /* Reuse existing tracking ID from stat file or generate new one */\n module.exports.generateFrameworkId = function generateFrameworkId() {\n+  // Prefer existing frameworkId from ~/.serverlessrc if present\n+  try {\n+    if (fileExistsSync(serverlessRcPath)) {\n+      const rc = JSON.parse(readFileSync(serverlessRcPath).toString());\n+      if (rc && rc.frameworkId) return rc.frameworkId;\n+    }\n+  } catch (err) {\n+    // ignore malformed ~/.serverlessrc\n+  }\n   if (fileExistsSync(statsEnabledFile)) {\n     const idFromStatsEnabled = readFileSync(statsEnabledFile).toString();\n     if (idFromStatsEnabled) return idFromStatsEnabled;\n@@ -42,4 +63,4 @@ module.exports.removeLegacyFrameworkIdFiles = function cleanUp() {\n   if (fileExistsSync(statsDisabledFile)) {\n     removeFileSync(statsDisabledFile);\n   }\n-};\n+};\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "lib/utils/config/initialSetup.js": [
                    "function: configureTrack\nfunction: generateFrameworkId\nfunction: removeLegacyFrameworkIdFiles"
                ],
                "scripts/postinstall.js": [
                    ""
                ],
                "bin/serverless.js": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/utils/config/initialSetup.js b/lib/utils/config/initialSetup.js\nindex a9c3eba..891a6f2 100644\n--- a/lib/utils/config/initialSetup.js\n+++ b/lib/utils/config/initialSetup.js\n@@ -1,3 +1,4 @@\n+\n 'use strict';\n \n const path = require('path');\n@@ -10,10 +11,22 @@ const getServerlessDir = require('../getServerlessDir');\n const slsHomePath = getServerlessDir();\n const statsEnabledFile = path.join(slsHomePath, 'stats-enabled');\n const statsDisabledFile = path.join(slsHomePath, 'stats-disabled');\n+const serverlessRcPath = path.join(slsHomePath, '.serverlessrc');\n \n module.exports.configureTrack = function configureTrack() {\n-  // to be updated to .serverlessrc\n-  if (fileExistsSync(path.join(slsHomePath, 'stats-disabled'))) {\n+  // Prefer configuration from .serverlessrc if available\n+  if (fileExistsSync(serverlessRcPath)) {\n+    try {\n+      const rc = JSON.parse(readFileSync(serverlessRcPath).toString());\n+      if (rc && typeof rc.trackingDisabled === 'boolean') {\n+        return rc.trackingDisabled;\n+      }\n+    } catch (error) {\n+      // Ignore parse errors and fall back to legacy behavior\n+    }\n+  }\n+  // Fallback to legacy stats files: if stats-disabled exists, tracking is disabled\n+  if (fileExistsSync(statsDisabledFile)) {\n     return true;\n   }\n   return false;\n@@ -21,6 +34,17 @@ module.exports.configureTrack = function configureTrack() {\n \n /* Reuse existing tracking ID from stat file or generate new one */\n module.exports.generateFrameworkId = function generateFrameworkId() {\n+  // Prefer ID from .serverlessrc if available\n+  if (fileExistsSync(serverlessRcPath)) {\n+    try {\n+      const rc = JSON.parse(readFileSync(serverlessRcPath).toString());\n+      if (rc && rc.frameworkId) return rc.frameworkId;\n+    } catch (error) {\n+      // Ignore parse errors and fall back to legacy behavior\n+    }\n+  }\n+\n+  // Reuse existing tracking ID from legacy stat files\n   if (fileExistsSync(statsEnabledFile)) {\n     const idFromStatsEnabled = readFileSync(statsEnabledFile).toString();\n     if (idFromStatsEnabled) return idFromStatsEnabled;\n@@ -29,7 +53,8 @@ module.exports.generateFrameworkId = function generateFrameworkId() {\n     const idFromStatsDisabled = readFileSync(statsDisabledFile).toString();\n     if (idFromStatsDisabled) return idFromStatsDisabled;\n   }\n-  // no frameworkID, generate a new one\n+\n+  // No frameworkID found, generate a new one\n   return uuid.v1();\n };\n \n@@ -42,4 +67,4 @@ module.exports.removeLegacyFrameworkIdFiles = function cleanUp() {\n   if (fileExistsSync(statsDisabledFile)) {\n     removeFileSync(statsDisabledFile);\n   }\n-};\n+};\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/lib/utils/config/initialSetup.js b/lib/utils/config/initialSetup.js\nindex a9c3eba..8637d9d 100644\n--- a/lib/utils/config/initialSetup.js\n+++ b/lib/utils/config/initialSetup.js\n@@ -1,6 +1,8 @@\n+\n 'use strict';\n \n const path = require('path');\n+const os = require('os');\n const uuid = require('uuid');\n const readFileSync = require('../fs/readFileSync');\n const removeFileSync = require('../fs/removeFileSync');\n@@ -10,10 +12,20 @@ const getServerlessDir = require('../getServerlessDir');\n const slsHomePath = getServerlessDir();\n const statsEnabledFile = path.join(slsHomePath, 'stats-enabled');\n const statsDisabledFile = path.join(slsHomePath, 'stats-disabled');\n+const serverlessRcPath = path.join(os.homedir(), '.serverlessrc');\n \n module.exports.configureTrack = function configureTrack() {\n-  // to be updated to .serverlessrc\n-  if (fileExistsSync(path.join(slsHomePath, 'stats-disabled'))) {\n+  // Prefer trackingDisabled from ~/.serverlessrc if present\n+  try {\n+    if (fileExistsSync(serverlessRcPath)) {\n+      const rc = JSON.parse(readFileSync(serverlessRcPath).toString());\n+      if (typeof rc.trackingDisabled === 'boolean') return rc.trackingDisabled;\n+    }\n+  } catch (err) {\n+    // ignore malformed ~/.serverlessrc\n+  }\n+  // Fallback to legacy stats files\n+  if (fileExistsSync(statsDisabledFile)) {\n     return true;\n   }\n   return false;\n@@ -21,6 +33,15 @@ module.exports.configureTrack = function configureTrack() {\n \n /* Reuse existing tracking ID from stat file or generate new one */\n module.exports.generateFrameworkId = function generateFrameworkId() {\n+  // Prefer existing frameworkId from ~/.serverlessrc if present\n+  try {\n+    if (fileExistsSync(serverlessRcPath)) {\n+      const rc = JSON.parse(readFileSync(serverlessRcPath).toString());\n+      if (rc && rc.frameworkId) return rc.frameworkId;\n+    }\n+  } catch (err) {\n+    // ignore malformed ~/.serverlessrc\n+  }\n   if (fileExistsSync(statsEnabledFile)) {\n     const idFromStatsEnabled = readFileSync(statsEnabledFile).toString();\n     if (idFromStatsEnabled) return idFromStatsEnabled;\n@@ -42,4 +63,4 @@ module.exports.removeLegacyFrameworkIdFiles = function cleanUp() {\n   if (fileExistsSync(statsDisabledFile)) {\n     removeFileSync(statsDisabledFile);\n   }\n-};\n+};\n"
}