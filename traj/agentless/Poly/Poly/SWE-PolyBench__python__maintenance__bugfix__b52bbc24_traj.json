{
    "instance_id": "SWE-PolyBench__python__maintenance__bugfix__b52bbc24",
    "original_id": "langchain-ai__langchain-5584",
    "1_model_selected_files": [
        "langchain/vectorstores/chroma.py"
    ],
    "2_embedding_selected_files": [
        "langchain/vectorstores/chroma.py",
        "langchain/embeddings/__init__.py",
        "langchain/chains/hyde/base.py",
        "langchain/document_transformers.py",
        "langchain/chains/hyde/__init__.py",
        "langchain/docstore/document.py",
        "langchain/embeddings/aleph_alpha.py",
        "langchain/chains/combine_documents/stuff.py",
        "langchain/indexes/vectorstore.py",
        "langchain/document_loaders/youtube.py",
        "langchain/document_loaders/docugami.py",
        "langchain/chains/combine_documents/refine.py",
        "langchain/chains/question_answering/__init__.py",
        "langchain/embeddings/fake.py",
        "langchain/embeddings/base.py",
        "langchain/chains/combine_documents/base.py",
        "langchain/retrievers/document_compressors/embeddings_filter.py",
        "langchain/retrievers/document_compressors/chain_extract.py",
        "langchain/embeddings/openai.py",
        "langchain/retrievers/document_compressors/__init__.py",
        "langchain/chains/combine_documents/map_rerank.py",
        "langchain/chains/combine_documents/__init__.py",
        "langchain/embeddings/self_hosted.py",
        "langchain/embeddings/llamacpp.py",
        "langchain/document_loaders/__init__.py",
        "langchain/chains/loading.py",
        "langchain/chains/combine_documents/map_reduce.py",
        "langchain/embeddings/elasticsearch.py",
        "langchain/embeddings/mosaicml.py",
        "langchain/retrievers/self_query/chroma.py",
        "langchain/vectorstores/analyticdb.py",
        "langchain/document_loaders/onedrive_file.py",
        "langchain/retrievers/time_weighted_retriever.py",
        "langchain/schema.py",
        "langchain/vectorstores/faiss.py",
        "langchain/chains/conversational_retrieval/base.py",
        "langchain/embeddings/cohere.py",
        "langchain/chains/summarize/__init__.py",
        "langchain/vectorstores/annoy.py",
        "langchain/document_loaders/evernote.py",
        "langchain/embeddings/minimax.py",
        "langchain/document_loaders/trello.py",
        "langchain/embeddings/huggingface_hub.py",
        "langchain/vectorstores/qdrant.py",
        "langchain/chains/qa_with_sources/vector_db.py",
        "langchain/retrievers/weaviate_hybrid_search.py",
        "langchain/vectorstores/pgvector.py",
        "langchain/retrievers/svm.py",
        "langchain/document_loaders/apify_dataset.py",
        "langchain/chains/retrieval_qa/base.py",
        "langchain/document_loaders/base.py",
        "langchain/document_loaders/slack_directory.py",
        "langchain/embeddings/bedrock.py",
        "langchain/vectorstores/base.py",
        "langchain/embeddings/sagemaker_endpoint.py",
        "langchain/document_loaders/blackboard.py",
        "langchain/embeddings/self_hosted_hugging_face.py",
        "langchain/document_loaders/reddit.py",
        "langchain/retrievers/document_compressors/cohere_rerank.py",
        "langchain/chains/qa_with_sources/base.py",
        "langchain/embeddings/vertexai.py",
        "langchain/vectorstores/supabase.py",
        "langchain/document_loaders/helpers.py",
        "langchain/embeddings/huggingface.py",
        "langchain/vectorstores/docarray/base.py",
        "langchain/chains/__init__.py",
        "langchain/vectorstores/matching_engine.py",
        "langchain/document_loaders/college_confidential.py",
        "langchain/document_loaders/blockchain.py",
        "langchain/document_loaders/hugging_face_dataset.py",
        "langchain/retrievers/remote_retriever.py",
        "langchain/document_loaders/blob_loaders/schema.py",
        "langchain/document_loaders/ifixit.py",
        "langchain/retrievers/document_compressors/chain_filter.py",
        "langchain/chains/qa_with_sources/loading.py",
        "langchain/document_loaders/confluence.py",
        "langchain/embeddings/google_palm.py"
    ],
    "3_final_combined_files": [
        "langchain/vectorstores/chroma.py",
        "langchain/embeddings/__init__.py",
        "langchain/chains/hyde/base.py"
    ],
    "4_related_elements": {
        "langchain/vectorstores/chroma.py": [
            "function: Chroma.update_document\nfunction: Chroma.add_texts\nfunction: Chroma.from_texts\nfunction: Chroma.from_documents"
        ],
        "langchain/embeddings/__init__.py": [
            ""
        ],
        "langchain/chains/hyde/base.py": [
            ""
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "langchain/vectorstores/chroma.py": [
                    "function: Chroma.update_document\nline: 359"
                ],
                "langchain/embeddings/__init__.py": [
                    ""
                ],
                "langchain/chains/hyde/base.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/langchain/vectorstores/chroma.py b/langchain/vectorstores/chroma.py\nindex 300be32..af4ac3e 100644\n--- a/langchain/vectorstores/chroma.py\n+++ b/langchain/vectorstores/chroma.py\n@@ -356,7 +356,7 @@ class Chroma(VectorStore):\n             raise ValueError(\n                 \"For update, you must specify an embedding function on creation.\"\n             )\n-        embeddings = self._embedding_function.embed_documents(list(text))\n+        embeddings = self._embedding_function.embed_documents([text])\n \n         self._collection.update(\n             ids=[document_id],\n",
                "diff --git a/langchain/vectorstores/chroma.py b/langchain/vectorstores/chroma.py\nindex 300be32..0aa9bd6 100644\n--- a/langchain/vectorstores/chroma.py\n+++ b/langchain/vectorstores/chroma.py\n@@ -356,11 +356,12 @@ class Chroma(VectorStore):\n             raise ValueError(\n                 \"For update, you must specify an embedding function on creation.\"\n             )\n-        embeddings = self._embedding_function.embed_documents(list(text))\n+        # Embed the full document text as a single item, not per character\n+        embeddings = self._embedding_function.embed_documents([text])\n \n         self._collection.update(\n             ids=[document_id],\n-            embeddings=[embeddings[0]],\n+            embeddings=embeddings,\n             documents=[text],\n             metadatas=[metadata],\n         )\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "langchain/vectorstores/chroma.py": [
                    "function: Chroma.update_document\nline: 359"
                ],
                "langchain/embeddings/__init__.py": [
                    ""
                ],
                "langchain/chains/hyde/base.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/langchain/vectorstores/chroma.py b/langchain/vectorstores/chroma.py\nindex 300be32..41028bb 100644\n--- a/langchain/vectorstores/chroma.py\n+++ b/langchain/vectorstores/chroma.py\n@@ -356,11 +356,12 @@ class Chroma(VectorStore):\n             raise ValueError(\n                 \"For update, you must specify an embedding function on creation.\"\n             )\n-        embeddings = self._embedding_function.embed_documents(list(text))\n+        # Embed the entire document as a single item, not per-character.\n+        embeddings = self._embedding_function.embed_documents([text])\n \n         self._collection.update(\n             ids=[document_id],\n-            embeddings=[embeddings[0]],\n+            embeddings=embeddings,\n             documents=[text],\n             metadatas=[metadata],\n         )\n",
                "diff --git a/langchain/vectorstores/chroma.py b/langchain/vectorstores/chroma.py\nindex 300be32..af4ac3e 100644\n--- a/langchain/vectorstores/chroma.py\n+++ b/langchain/vectorstores/chroma.py\n@@ -356,7 +356,7 @@ class Chroma(VectorStore):\n             raise ValueError(\n                 \"For update, you must specify an embedding function on creation.\"\n             )\n-        embeddings = self._embedding_function.embed_documents(list(text))\n+        embeddings = self._embedding_function.embed_documents([text])\n \n         self._collection.update(\n             ids=[document_id],\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/langchain/vectorstores/chroma.py b/langchain/vectorstores/chroma.py\nindex 300be32..af4ac3e 100644\n--- a/langchain/vectorstores/chroma.py\n+++ b/langchain/vectorstores/chroma.py\n@@ -356,7 +356,7 @@ class Chroma(VectorStore):\n             raise ValueError(\n                 \"For update, you must specify an embedding function on creation.\"\n             )\n-        embeddings = self._embedding_function.embed_documents(list(text))\n+        embeddings = self._embedding_function.embed_documents([text])\n \n         self._collection.update(\n             ids=[document_id],\n"
}