{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__765e5e14",
  "original_id": "sphinx-doc__sphinx-10449",
  "1_model_selected_files": [
    "sphinx/ext/autodoc/typehints.py",
    "sphinx/domains/python.py",
    "sphinx/ext/autodoc/__init__.py",
    "sphinx/ext/autodoc/directive.py",
    "sphinx/util/typing.py"
  ],
  "2_embedding_selected_files": [
    "sphinx/ext/autodoc/typehints.py",
    "sphinx/setup.py",
    "sphinx/ext/autodoc/__init__.py",
    "sphinx/ext/doctest.py",
    "sphinx/util/typing.py",
    "sphinx/ext/apidoc.py",
    "sphinx/__init__.py",
    "sphinx/application.py",
    "sphinx/ext/viewcode.py",
    "sphinx/util/docutils.py",
    "sphinx/setup_command.py",
    "sphinx/roles.py",
    "sphinx/util/inspect.py",
    "sphinx/util/__init__.py",
    "sphinx/__main__.py",
    "sphinx/ext/autodoc/mock.py",
    "sphinx/ext/autodoc/importer.py",
    "sphinx/io.py",
    "sphinx/domains/c.py",
    "sphinx/ext/coverage.py",
    "sphinx/domains/python.py",
    "sphinx/errors.py",
    "sphinx/ext/graphviz.py",
    "sphinx/ext/todo.py",
    "sphinx/ext/autodoc/directive.py",
    "sphinx/ext/inheritance_diagram.py",
    "sphinx/project.py",
    "sphinx/domains/__init__.py",
    "sphinx/domains/std.py",
    "sphinx/domains/cpp.py",
    "sphinx/theming.py",
    "sphinx/pygments_styles.py",
    "sphinx/config.py",
    "sphinx/ext/autodoc/type_comment.py",
    "sphinx/domains/javascript.py",
    "sphinx/registry.py",
    "sphinx/util/cfamily.py",
    "sphinx/ext/githubpages.py",
    "sphinx/addnodes.py",
    "sphinx/highlighting.py",
    "sphinx/jinja2glue.py",
    "sphinx/ext/__init__.py",
    "sphinx/ext/linkcode.py",
    "sphinx/ext/autodoc/preserve_defaults.py",
    "sphinx/domains/rst.py",
    "sphinx/ext/mathjax.py",
    "sphinx/deprecation.py",
    "sphinx/ext/autosectionlabel.py",
    "sphinx/ext/intersphinx.py",
    "sphinx/domains/citation.py"
  ],
  "3_final_combined_files": [
    "sphinx/ext/autodoc/typehints.py",
    "sphinx/ext/autodoc/__init__.py",
    "sphinx/domains/python.py",
    "sphinx/setup.py"
  ],
  "4_related_elements": {
    "sphinx/ext/autodoc/typehints.py": [
      "function: record_typehints\nfunction: merge_typehints\nfunction: insert_field_list\nfunction: modify_field_list\nfunction: augment_descriptions_with_types\nfunction: setup"
    ],
    "sphinx/ext/autodoc/__init__.py": [
      "function: Documenter.format_signature\nclass: ClassDocumenter\nclass: DocstringSignatureMixin\nfunction: setup"
    ],
    "sphinx/domains/python.py": [
      "class: PyObject\nfunction: filter_meta_fields\nclass: PyClasslike\nfunction: setup"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "sphinx/ext/autodoc/typehints.py": [
          "\nfunction: modify_field_list\nline: 126\nline: 127\nline: 128\nline: 129\nline: 130"
        ]
      },
      "patches": [
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..e0bfa1a 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -124,10 +124,13 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             node += field\n \n     if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+        rtype = annotations.get('return')\n+        # Avoid injecting a meaningless rtype for constructors or functions returning None\n+        if rtype and rtype != 'None':\n+            field = nodes.field()\n+            field += nodes.field_name('', 'rtype')\n+            field += nodes.field_body('', nodes.paragraph('', rtype))\n+            node += field\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..8fcaf10 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -124,10 +124,16 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             node += field\n \n     if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+        # Do not add rtype for constructors (__init__) or when the return\n+        # annotation explicitly denotes 'None'. Class constructors typically\n+        # have a return type of None, and showing it is confusing in class\n+        # documentation.\n+        return_annotation = annotations.get('return')\n+        if return_annotation and return_annotation.strip().lower() not in ('none', ''):\n+            field = nodes.field()\n+            field += nodes.field_name('', 'rtype')\n+            field += nodes.field_body('', nodes.paragraph('', return_annotation))\n+            node += field\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..4cc8289 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -76,7 +76,7 @@ def insert_field_list(node: Element) -> nodes.field_list:\n     if desc:\n         # insert just before sub object descriptions (ex. methods, nested classes, etc.)\n         index = node.index(desc[0])\n-        node.insert(index - 1, [field_list])\n+        node.insert(index - 1, field_list)\n     else:\n         node += field_list\n \n@@ -123,11 +123,9 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             field += nodes.field_body('', nodes.paragraph('', ''))\n             node += field\n \n-    if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+    # Intentionally do not create an 'rtype' field here.\n+    # Return type handling is performed by augment_descriptions_with_types(),\n+    # which can respect context (e.g., classes) and configuration.\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..32912c2 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -124,10 +124,20 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             node += field\n \n     if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+        # Do not add a return type for class descriptions\n+        parent = node\n+        is_class = False\n+        while parent is not None:\n+            objtype = getattr(parent, 'attributes', {}).get('objtype')\n+            if objtype == 'class':\n+                is_class = True\n+                break\n+            parent = getattr(parent, 'parent', None)\n+        if not is_class:\n+            field = nodes.field()\n+            field += nodes.field_name('', 'rtype')\n+            field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n+            node += field\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..48cc558 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -124,10 +124,13 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             node += field\n \n     if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+        # Suppress rtype for constructors that annotate a None return (e.g. __init__)\n+        return_ann = annotations.get('return')\n+        if return_ann and return_ann.strip() not in ('None', 'NoneType'):\n+            field = nodes.field()\n+            field += nodes.field_name('', 'rtype')\n+            field += nodes.field_body('', nodes.paragraph('', return_ann))\n+            node += field\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..e11ec86 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -124,10 +124,14 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             node += field\n \n     if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+        # Do not add a return type for constructors (__init__) which are annotated as returning None.\n+        # Also, use the correct return annotation value instead of the last loop variable.\n+        retann = annotations['return'].strip()\n+        if retann not in ('None', 'NoneType'):\n+            field = nodes.field()\n+            field += nodes.field_name('', 'rtype')\n+            field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n+            node += field\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..5b1031b 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -123,10 +123,13 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             field += nodes.field_body('', nodes.paragraph('', ''))\n             node += field\n \n-    if 'return' in annotations and 'return' not in arguments:\n+    # Only add a return type if it is meaningful. For constructors (__init__/__new__)\n+    # the return annotation is commonly \"None\", which should not be displayed on classes.\n+    return_anno = annotations.get('return')\n+    if return_anno and 'return' not in arguments and return_anno not in ('None', 'NoneType'):\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', return_anno))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..af04742 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -123,11 +123,9 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             field += nodes.field_body('', nodes.paragraph('', ''))\n             node += field\n \n-    if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+    # Return types are handled by augment_descriptions_with_types(), which\n+    # takes context into account. Do not add an 'rtype' field here to avoid\n+    # incorrectly showing a return type for classes when autodoc_typehints=\"description\".\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..a8b565e 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -124,10 +124,13 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             node += field\n \n     if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+        # avoid spurious return type for initializers (__init__/__new__) and other None returns\n+        return_annotation = annotations['return']\n+        if return_annotation and return_annotation.strip() not in ('None', 'NoneType'):\n+            field = nodes.field()\n+            field += nodes.field_name('', 'rtype')\n+            field += nodes.field_body('', nodes.paragraph('', return_annotation))\n+            node += field\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..9bb899b 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -84,6 +84,8 @@ def insert_field_list(node: Element) -> nodes.field_list:\n \n \n def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> None:\n+    from sphinx import addnodes  # local import to avoid circular dependencies\n+\n     arguments: Dict[str, Dict[str, bool]] = {}\n     fields = cast(Iterable[nodes.field], node)\n     for field in fields:\n@@ -107,6 +109,17 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n         elif parts[0] == 'rtype':\n             arguments['return'] = {'type': True}\n \n+    # Determine if this field list belongs to a class/exception description.\n+    is_class = False\n+    parent = node.parent\n+    while parent is not None:\n+        if isinstance(parent, addnodes.desc):\n+            desctype = getattr(parent, 'desctype', None) or getattr(parent, 'objtype', None)\n+            if desctype in ('class', 'exception'):\n+                is_class = True\n+            break\n+        parent = getattr(parent, 'parent', None)\n+\n     for name, annotation in annotations.items():\n         if name == 'return':\n             continue\n@@ -123,10 +136,11 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             field += nodes.field_body('', nodes.paragraph('', ''))\n             node += field\n \n-    if 'return' in annotations and 'return' not in arguments:\n+    # Only add :rtype: for non-class items and use the correct return annotation.\n+    if not is_class and 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "sphinx/ext/autodoc/typehints.py": [
          "\nfunction: record_typehints\nfunction: merge_typehints\nfunction: modify_field_list"
        ]
      },
      "patches": [
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..df2a0bf 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not add return type for classes (constructor signatures)\n+            if sig.return_annotation is not sig.empty and not isinstance(obj, type):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +127,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..b7b5714 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return type for classes; __init__'s return annotation\n+            # should not be rendered for autoclass entries.\n+            if sig.return_annotation is not sig.empty and objtype != 'class':\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..29f2d62 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a \"return\" type for classes; classes are documented by\n+            # autoclass and should not display a return type.\n+            if objtype != 'class' and sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -61,8 +63,9 @@ def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element\n             if app.config.autodoc_typehints_description_target == \"all\":\n                 modify_field_list(field_list, annotations[fullname])\n             elif app.config.autodoc_typehints_description_target == \"documented_params\":\n+                # Do not force rtype for classes; classes do not have a return type\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=True\n+                    field_list, annotations[fullname], force_rtype=(objtype != 'class')\n                 )\n             else:\n                 augment_descriptions_with_types(\n@@ -126,7 +129,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..cf33657 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -57,16 +57,22 @@ def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element\n             field_list = insert_field_list(contentnode)\n             field_lists.append(field_list)\n \n+        # For classes, do not include a return type (constructor return annotations are not meaningful)\n         for field_list in field_lists:\n+            annos = annotations[fullname]\n+            if objtype == 'class' and 'return' in annos:\n+                annos = annos.copy()\n+                annos.pop('return', None)\n+\n             if app.config.autodoc_typehints_description_target == \"all\":\n-                modify_field_list(field_list, annotations[fullname])\n+                modify_field_list(field_list, annos)\n             elif app.config.autodoc_typehints_description_target == \"documented_params\":\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=True\n+                    field_list, annos, force_rtype=True\n                 )\n             else:\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=False\n+                    field_list, annos, force_rtype=False\n                 )\n \n \n@@ -126,7 +132,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..ffa7360 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record return type for classes to avoid adding rtype to autoclass docs\n+            if objtype != 'class' and sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +127,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..5b8a87e 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,10 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return annotation for classes/exceptions.\n+            # For classes, the signature refers to __init__/__call__ which is not a \"return type\"\n+            # of the class itself and should not create an rtype field for autoclass.\n+            if sig.return_annotation is not sig.empty and objtype not in ('class', 'exception'):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +129,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..85731ca 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Avoid recording a return type for classes/exceptions (e.g., autoclass),\n+            # since classes do not have a meaningful return type in the docs context.\n+            if sig.return_annotation is not sig.empty and objtype not in ('class', 'exception'):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..89852e5 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -51,7 +51,12 @@ def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element\n         return\n \n     annotations = app.env.temp_data.get('annotations', {})\n-    if annotations.get(fullname, {}):\n+    ann = annotations.get(fullname, {}).copy()\n+    # For classes, do not include a \"return\" type (typically None from __init__)\n+    if objtype == 'class' and 'return' in ann:\n+        del ann['return']\n+\n+    if ann:\n         field_lists = [n for n in contentnode if isinstance(n, nodes.field_list)]\n         if field_lists == []:\n             field_list = insert_field_list(contentnode)\n@@ -59,14 +64,14 @@ def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element\n \n         for field_list in field_lists:\n             if app.config.autodoc_typehints_description_target == \"all\":\n-                modify_field_list(field_list, annotations[fullname])\n+                modify_field_list(field_list, ann)\n             elif app.config.autodoc_typehints_description_target == \"documented_params\":\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=True\n+                    field_list, ann, force_rtype=True\n                 )\n             else:\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=False\n+                    field_list, ann, force_rtype=False\n                 )\n \n \n@@ -126,7 +131,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..734ccb3 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return type for classes (e.g. __init__ -> None)\n+            is_class = isinstance(obj, type)\n+            if sig.return_annotation is not sig.empty and not is_class:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -58,15 +60,21 @@ def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element\n             field_lists.append(field_list)\n \n         for field_list in field_lists:\n-            if app.config.autodoc_typehints_description_target == \"all\":\n-                modify_field_list(field_list, annotations[fullname])\n-            elif app.config.autodoc_typehints_description_target == \"documented_params\":\n+            ann = annotations[fullname]\n+            if objtype == 'class' and 'return' in ann:\n+                # Classes should not have a return type recorded in the description\n+                ann = {k: v for k, v in ann.items() if k != 'return'}\n+\n+            target = app.config.autodoc_typehints_description_target\n+            if target == \"all\":\n+                modify_field_list(field_list, ann)\n+            elif target == \"documented_params\":\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=True\n+                    field_list, ann, force_rtype=(False if objtype == 'class' else True)\n                 )\n             else:\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=False\n+                    field_list, ann, force_rtype=False\n                 )\n \n \n@@ -126,7 +134,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..7a49cd6 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -51,7 +51,15 @@ def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element\n         return\n \n     annotations = app.env.temp_data.get('annotations', {})\n-    if annotations.get(fullname, {}):\n+    ann = annotations.get(fullname, {})\n+    if ann:\n+        # For classes, do not include a return type (often from __init__)\n+        # Make a shallow copy so we don't mutate shared state in env.temp_data\n+        if objtype == 'class':\n+            ann = dict(ann)\n+            ann.pop('return', None)\n+\n+    if ann:\n         field_lists = [n for n in contentnode if isinstance(n, nodes.field_list)]\n         if field_lists == []:\n             field_list = insert_field_list(contentnode)\n@@ -59,14 +67,14 @@ def merge_typehints(app: Sphinx, domain: str, objtype: str, contentnode: Element\n \n         for field_list in field_lists:\n             if app.config.autodoc_typehints_description_target == \"all\":\n-                modify_field_list(field_list, annotations[fullname])\n+                modify_field_list(field_list, ann)\n             elif app.config.autodoc_typehints_description_target == \"documented_params\":\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=True\n+                    field_list, ann, force_rtype=True\n                 )\n             else:\n                 augment_descriptions_with_types(\n-                    field_list, annotations[fullname], force_rtype=False\n+                    field_list, ann, force_rtype=False\n                 )\n \n \n@@ -76,7 +84,7 @@ def insert_field_list(node: Element) -> nodes.field_list:\n     if desc:\n         # insert just before sub object descriptions (ex. methods, nested classes, etc.)\n         index = node.index(desc[0])\n-        node.insert(index - 1, [field_list])\n+        node.insert(index, field_list)\n     else:\n         node += field_list\n \n@@ -126,7 +134,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "sphinx/ext/autodoc/typehints.py": [
          "\nfunction: record_typehints\nline: 31\nline: 32\nfunction: modify_field_list\nline: 126\nline: 129"
        ]
      },
      "patches": [
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..576c7e3 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -123,11 +123,9 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             field += nodes.field_body('', nodes.paragraph('', ''))\n             node += field\n \n-    if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+    # Return type fields should not be inserted here.\n+    # They are handled in augment_descriptions_with_types(), which respects object type and configuration.\n+    # This prevents unwanted 'rtype' fields for classes when autodoc_typehints='description'.\n \n \n def augment_descriptions_with_types(\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..cc01850 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return type for classes (e.g. __init__ -> None),\n+            # as autoclass should not display an rtype in descriptions.\n+            if objtype != 'class' and sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..840817a 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return type for classes (e.g. __init__ -> None),\n+            # as autoclass should not display an rtype for class declarations.\n+            if objtype != 'class' and sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..cd0b8aa 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return type for classes; autoclass should not show rtype\n+            if sig.return_annotation is not sig.empty and objtype != 'class':\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +127,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..70931d2 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -3,6 +3,7 @@\n import re\n from collections import OrderedDict\n from typing import Any, Dict, Iterable, Set, cast\n+from collections import OrderedDict\n \n from docutils import nodes\n from docutils.nodes import Element\n@@ -28,7 +29,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # For classes, do not record a 'return' type based on __init__/__new__\n+            if sig.return_annotation is not sig.empty and objtype != 'class':\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..1e2b252 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,7 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            if sig.return_annotation is not sig.empty and not inspect.isclass(obj):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +126,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..56e23a1 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -21,6 +21,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n         mode = 'fully-qualified'\n \n     try:\n+        # Classes are callable, but autoclass should not have a return type.\n+        # Skip recording return annotations for classes.\n         if callable(obj):\n             annotations = app.env.temp_data.setdefault('annotations', {})\n             annotation = annotations.setdefault(name, OrderedDict())\n@@ -28,7 +30,7 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            if sig.return_annotation is not sig.empty and objtype != 'class':\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..d50147c 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -2,6 +2,7 @@\n \n import re\n from collections import OrderedDict\n+from collections import OrderedDict\n from typing import Any, Dict, Iterable, Set, cast\n \n from docutils import nodes\n@@ -28,7 +29,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return type for classes (e.g. __init__/__call__)\n+            if objtype != 'class' and sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..b866b83 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a \"return\" annotation for classes (e.g. __init__ -> None),\n+            # as autoclass should not show a return type.\n+            if sig.return_annotation is not sig.empty and objtype != 'class':\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..2299b9f 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            is_class = isinstance(obj, type)\n+            if sig.return_annotation is not sig.empty and not is_class:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +127,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "sphinx/ext/autodoc/typehints.py": [
          "\nfunction: record_typehints\nline: 31\nline: 32\nfunction: modify_field_list\nline: 126\nline: 129"
        ]
      },
      "patches": [
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..4ee3f9c 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a return type for classes/exceptions (e.g., __init__ -> None)\n+            if sig.return_annotation is not sig.empty and objtype not in ('class', 'exception'):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +127,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..21596b2 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,7 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            if sig.return_annotation is not sig.empty and objtype not in ('class', 'exception'):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +126,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..ee38397 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -21,7 +21,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n         mode = 'fully-qualified'\n \n     try:\n-        if callable(obj):\n+        # Do not record a \"return\" type for classes (e.g. __init__/__new__)\n+        # to avoid inserting an rtype field for autoclass.\n+        if callable(obj) and not isinstance(obj, type):\n             annotations = app.env.temp_data.setdefault('annotations', {})\n             annotation = annotations.setdefault(name, OrderedDict())\n             sig = inspect.signature(obj, type_aliases=app.config.autodoc_type_aliases)\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..d5428e2 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -22,13 +22,16 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n \n     try:\n         if callable(obj):\n+            # classes are callable, but we should not record a return type for them\n+            is_class = isinstance(obj, type)\n+\n             annotations = app.env.temp_data.setdefault('annotations', {})\n             annotation = annotations.setdefault(name, OrderedDict())\n             sig = inspect.signature(obj, type_aliases=app.config.autodoc_type_aliases)\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            if sig.return_annotation is not sig.empty and not is_class:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +129,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..0019b55 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,7 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            if objtype != 'class' and sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +126,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..ef95012 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,9 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a \"return\" type for classes (e.g. autoclass),\n+            # as this would produce an unwanted rtype field in class docs.\n+            if sig.return_annotation is not sig.empty and not isinstance(obj, type):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +128,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..85e017d 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,10 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Only record return type for non-class objects. For classes, the signature\n+            # reflects __init__/__call__, whose return annotation should not produce\n+            # an rtype field on the class description.\n+            if sig.return_annotation is not sig.empty and objtype != 'class':\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +129,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..edcb0ad 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,7 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            if sig.return_annotation is not sig.empty and objtype != 'class':\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +126,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..ccebae0 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,10 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a \"return\" type for classes/exceptions (e.g., autoclass),\n+            # otherwise a spurious \"Return type\" field appears in class documentation\n+            # when autodoc_typehints is set to \"description\".\n+            if sig.return_annotation is not sig.empty and objtype not in ('class', 'exception'):\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n",
        "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..ac22ed1 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -28,7 +28,8 @@ def record_typehints(app: Sphinx, objtype: str, name: str, obj: Any,\n             for param in sig.parameters.values():\n                 if param.annotation is not param.empty:\n                     annotation[param.name] = typing.stringify(param.annotation, mode)\n-            if sig.return_annotation is not sig.empty:\n+            # Do not record a \"return\" type for classes (e.g. autoclass)\n+            if not isinstance(obj, type) and sig.return_annotation is not sig.empty:\n                 annotation['return'] = typing.stringify(sig.return_annotation, mode)\n     except (TypeError, ValueError):\n         pass\n@@ -126,7 +127,7 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n     if 'return' in annotations and 'return' not in arguments:\n         field = nodes.field()\n         field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n+        field += nodes.field_body('', nodes.paragraph('', annotations['return']))\n         node += field\n \n \n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/sphinx/ext/autodoc/typehints.py b/sphinx/ext/autodoc/typehints.py\nindex 671dde0..e0bfa1a 100644\n--- a/sphinx/ext/autodoc/typehints.py\n+++ b/sphinx/ext/autodoc/typehints.py\n@@ -124,10 +124,13 @@ def modify_field_list(node: nodes.field_list, annotations: Dict[str, str]) -> No\n             node += field\n \n     if 'return' in annotations and 'return' not in arguments:\n-        field = nodes.field()\n-        field += nodes.field_name('', 'rtype')\n-        field += nodes.field_body('', nodes.paragraph('', annotation))\n-        node += field\n+        rtype = annotations.get('return')\n+        # Avoid injecting a meaningless rtype for constructors or functions returning None\n+        if rtype and rtype != 'None':\n+            field = nodes.field()\n+            field += nodes.field_name('', 'rtype')\n+            field += nodes.field_body('', nodes.paragraph('', rtype))\n+            node += field\n \n \n def augment_descriptions_with_types(\n",
  "7_resolved": false
}