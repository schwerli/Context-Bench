{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__af69d880",
  "original_id": "sympy__sympy-22080",
  "1_model_selected_files": [
    "sympy/printing/pycode.py",
    "sympy/utilities/lambdify.py",
    "sympy/printing/python.py",
    "sympy/printing/precedence.py",
    "sympy/core/mod.py"
  ],
  "2_embedding_selected_files": [
    "sympy/utilities/lambdify.py",
    "sympy/core/mod.py",
    "sympy/core/function.py",
    "sympy/core/sympify.py",
    "sympy/core/expr.py",
    "sympy/core/power.py",
    "sympy/core/numbers.py",
    "sympy/core/__init__.py",
    "sympy/printing/str.py",
    "sympy/core/operations.py",
    "sympy/core/mul.py",
    "sympy/printing/latex.py",
    "sympy/printing/llvmjitcode.py",
    "sympy/core/exprtools.py",
    "sympy/core/add.py",
    "sympy/printing/fortran.py",
    "sympy/printing/lambdarepr.py",
    "sympy/printing/mathml.py",
    "sympy/utilities/autowrap.py",
    "sympy/core/basic.py",
    "sympy/utilities/__init__.py",
    "sympy/printing/mathematica.py",
    "sympy/core/evalf.py",
    "sympy/utilities/matchpy_connector.py",
    "sympy/core/symbol.py",
    "sympy/core/relational.py",
    "sympy/printing/codeprinter.py",
    "sympy/core/backend.py",
    "sympy/core/benchmarks/bench_sympify.py",
    "sympy/utilities/misc.py",
    "sympy/core/parameters.py"
  ],
  "3_final_combined_files": [
    "sympy/utilities/lambdify.py",
    "sympy/printing/pycode.py",
    "sympy/printing/python.py",
    "sympy/core/mod.py",
    "sympy/core/function.py"
  ],
  "4_related_elements": {
    "sympy/printing/pycode.py": [
      "class: AbstractPythonCodePrinter\nfunction: AbstractPythonCodePrinter._print_Mod\nclass: PythonCodePrinter\nfunction: pycode"
    ],
    "sympy/utilities/lambdify.py": [
      "function: lambdify\nclass: _EvaluatorPrinter\nfunction: lambdastr\nfunction: _imp_namespace\nvariable: MODULES"
    ],
    "sympy/printing/python.py": [
      "class: PythonPrinter\nfunction: python\nfunction: print_python"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "sympy/printing/pycode.py": [
          "\nfunction: AbstractPythonCodePrinter._print_Mod\nline: 237"
        ]
      },
      "patches": [
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..cabeff1 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to preserve correct precedence\n+        # in contexts like unary minus or multiplication when modules=[].\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..e5c9659 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,13 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Wrap modulo operation in parentheses to preserve intended grouping.\n+        # This ensures:\n+        # - -Mod(x, y) prints as -(x % y) (not (-x % y))\n+        # - expr * Mod(a, b) prints as expr * (a % b), avoiding (expr * a) % b\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        left, right = map(lambda x: self.parenthesize(x, PREC), expr.args)\n+        return '({} % {})'.format(left, right)\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..4c693f0 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo operation in parentheses to ensure correct precedence\n+        # when used within other operations (e.g., unary minus or multiplication).\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..18b5ac7 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to preserve intended grouping\n+        # and avoid precedence issues (e.g., with unary minus or multiplication).\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..6f40263 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to ensure correct binding\n+        # with unary minus or multiplication when generating pure Python code.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ab12a33 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..eab68b4 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to ensure correct\n+        # semantics when combined with unary minus or multiplication in pure\n+        # Python code generation (modules=[] in lambdify).\n+        return '({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..aa47fe4 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,13 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Always parenthesize the modulo expression to preserve correct\n+        # binding when used inside larger expressions (e.g. unary minus or\n+        # multiplication). Python's % has the same precedence as * and is\n+        # left-associative, so without parentheses \"a*Mod(b,c)\" would be\n+        # printed as \"a*b % c\" and interpreted as \"(a*b) % c\".\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..1f021d1 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,12 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Wrap the entire modulo expression in parentheses. This prevents\n+        # incorrect binding when the Mod appears with unary minus or in\n+        # expressions with operators of the same precedence (e.g. '*', '%').\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        a, b = map(lambda x: self.parenthesize(x, PREC), expr.args)\n+        return '({} % {})'.format(a, b)\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ad58b5c 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,13 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Ensure Python operator precedence is preserved.\n+        # In particular, unary minus binds tighter than modulo in Python.\n+        # Wrapping the entire modulo expression in parentheses prevents\n+        # cases like '-(Mod(x, y))' from printing as '-x % y' which would\n+        # be interpreted as (-x) % y.\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "sympy/printing/pycode.py": [
          "\nfunction: AbstractPythonCodePrinter._print_Mod\nline: 235\nline: 236\nline: 237\nline: 238"
        ]
      },
      "patches": [
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..e903a76 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to ensure correct\n+        # binding when used with unary minus or as part of larger expressions.\n+        s = '{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args))\n+        return '({})'.format(s)\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..2a2ca9f 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Parenthesize the entire modulo expression to preserve semantics in Python,\n+        # preventing issues like \"-Mod(x, y)\" becoming \"(-x % y)\" or\n+        # \"expr * Mod(a, b)\" becoming \"(expr * a) % b\" due to operator precedence.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..a431688 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,11 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the whole modulo expression in parentheses to preserve correct precedence\n+        # when used with unary minus or operators of the same precedence (e.g. '*').\n+        # Without parentheses, Python could interpret -Mod(x, y) as (-x) % y and\n+        # expr*Mod(a, b) as (expr*a) % b.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..a69cb3b 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo operation in parentheses to preserve semantics\n+        # when combined with unary operators and other higher-precedence constructs.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..276e34c 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the whole modulo expression in parentheses to preserve operator precedence,\n+        # e.g., avoid \"-x % y\" (which is (-x) % y) and \"a * x % y\" (which is (a * x) % y).\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ab12a33 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..795a09c 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Parenthesize the entire modulo expression to prevent outer operators\n+        # (like unary minus or multiplication) from binding to the left operand.\n+        left, right = map(lambda x: self.parenthesize(x, PREC), expr.args)\n+        return '({} % {})'.format(left, right)\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..0bd42d7 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to ensure correct\n+        # operator precedence when used with unary minus or with operators\n+        # of the same precedence (e.g., multiplication) in Python code.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..9e9fbee 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return '({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ab12a33 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "sympy/printing/pycode.py": [
          "\nfunction: AbstractPythonCodePrinter._print_Mod\nline: 235\nline: 236\nline: 237\nline: 238"
        ]
      },
      "patches": [
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..cb71ae2 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,8 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        lhs, rhs = map(lambda x: self.parenthesize(x, PREC), expr.args)\n+        return ('({} % {})'.format(lhs, rhs))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ab12a33 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..2f2ed3b 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,11 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Parenthesize the entire modulo expression to preserve correct precedence in Python\n+        # For example, without parentheses: -Mod(x, y) -> \"-x % y\" (parsed as (-x) % y), or\n+        # expr * Mod(a, b) -> \"expr * a % b\" (parsed as (expr * a) % b).\n+        # Wrapping ensures: \"-(x % y)\" and \"expr * (a % b)\".\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..9af2a61 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,12 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Wrap the entire modulo expression in parentheses to preserve correct\n+        # binding, especially under unary minus or when combined with other\n+        # multiplicative operators in Python (e.g. to avoid \"-x % y\" being parsed\n+        # as \"(-x) % y\" or \"expr * a % b\" becoming \"(expr * a) % b\").\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..d694ade 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,12 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to preserve semantics\n+        # in contexts with unary minus or operations of the same precedence.\n+        # Examples:\n+        #   -Mod(x, y) -> -(x % y)   (not -x % y)\n+        #   a * Mod(x, y) -> a * (x % y)   (avoids (a * x) % y)\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..637c4dc 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,11 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Wrap the entire modulo expression in parentheses so that\n+        # higher-precedence operations (like unary minus or multiplication)\n+        # do not bind to the left operand, e.g. \"-(x % y)\" and \"a*(x % y)\".\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..a62fd90 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,12 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Always parenthesize modulo to avoid precedence issues when combined\n+        # with unary minus or multiplication in pure Python code generation.\n+        # E.g., -(x % y) should not become (-x) % y, and a*Mod(x, y) should not\n+        # be interpreted as (a*x) % y.\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..607d6e4 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to prevent external unary\n+        # negation or multiplication from binding to the left operand only (e.g. -x % y).\n+        # This ensures expressions like -Mod(x, y) become -(x % y), not (-x % y).\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ff7476a 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to preserve semantics\n+        # when used within larger expressions (e.g., unary minus or multiplication).\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..d09ce83 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to preserve correct precedence\n+        # in Python when used in larger expressions (e.g. -Mod(x, y) or a*Mod(x, y)).\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "sympy/printing/pycode.py": [
          "\nfunction: AbstractPythonCodePrinter._print_Mod\nline: 237"
        ]
      },
      "patches": [
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..c01c7be 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,14 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Wrap modulo operation in parentheses to preserve correct precedence\n+        # when used within other operations (e.g., unary minus or multiplication).\n+        # Without parentheses, expressions like -Mod(x, y) or a*Mod(x, y)\n+        # could be rendered as -x % y or a * x % y, which changes the intended\n+        # grouping due to Python's operator precedence and associativity.\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        left, right = map(lambda x: self.parenthesize(x, PREC), expr.args)\n+        return '({} % {})'.format(left, right)\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..0971d55 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the whole modulo operation in parentheses to preserve grouping.\n+        # This prevents cases like \"-Mod(x, y)\" from becoming \"-x % y\"\n+        # and \"expr * Mod(a, b)\" from becoming \"(expr * a) % b\" in pure Python code.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ab12a33 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..9a049c1 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,10 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression in parentheses to prevent\n+        # surrounding operations (like unary minus or multiplication)\n+        # from binding tighter and altering evaluation order.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..1cbe10c 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,11 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the modulo expression in parentheses to ensure correct Python evaluation order.\n+        # Without parentheses, expressions like \"a * Mod(x, y)\" become \"a * x % y\",\n+        # which Python parses as \"(a * x) % y\". Parentheses preserve \"a * (x % y)\".\n+        # They also ensure unary negation applies to the whole Mod: \"-(x % y)\".\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..9a77510 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -233,8 +233,11 @@ class AbstractPythonCodePrinter(CodePrinter):\n         return self._print_NaN(expr)\n \n     def _print_Mod(self, expr):\n+        # Wrap modulo operation in parentheses to preserve correct precedence\n+        # when used with unary minus or multiplication in Python (e.g., to avoid\n+        # printing \"-x % y\" for \"-Mod(x, y)\" which evaluates as (-x) % y).\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..3bcb3e1 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Parenthesize the entire modulo expression to maintain correct precedence,\n+        # especially under unary minus or when multiplied, e.g., -(a % b) vs (-a) % b.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..44bc820 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,11 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Wrap the entire modulo expression to preserve correct grouping\n+        # in Python when combined with unary minus or multiplication.\n+        # Without parentheses, expressions like x * Mod(a, b) become\n+        # x * a % b, which evaluates as (x * a) % b.\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ab12a33 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
        "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..69b4c61 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,9 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        # Always parenthesize modulo to avoid precedence issues in Python (e.g., -x % y vs -(x % y),\n+        # and expr * (x % y) vs (expr * x) % y)\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/sympy/printing/pycode.py b/sympy/printing/pycode.py\nindex 0831e79..ab12a33 100644\n--- a/sympy/printing/pycode.py\n+++ b/sympy/printing/pycode.py\n@@ -234,7 +234,7 @@ class AbstractPythonCodePrinter(CodePrinter):\n \n     def _print_Mod(self, expr):\n         PREC = precedence(expr)\n-        return ('{} % {}'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n+        return ('({} % {})'.format(*map(lambda x: self.parenthesize(x, PREC), expr.args)))\n \n     def _print_Piecewise(self, expr):\n         result = []\n",
  "7_resolved": false
}