{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__7489fdd8",
  "original_id": "django__django-11451",
  "1_model_selected_files": [
    "django/contrib/auth/backends.py"
  ],
  "2_embedding_selected_files": [
    "django/contrib/auth/backends.py",
    "django/contrib/auth/__init__.py",
    "django/contrib/auth/middleware.py",
    "django/contrib/auth/models.py",
    "django/contrib/auth/forms.py",
    "django/contrib/auth/hashers.py",
    "django/contrib/auth/base_user.py",
    "django/contrib/auth/password_validation.py",
    "django/contrib/auth/checks.py",
    "django/contrib/auth/admin.py",
    "django/contrib/auth/views.py",
    "django/contrib/auth/apps.py",
    "django/contrib/auth/context_processors.py",
    "django/contrib/auth/tokens.py",
    "django/contrib/auth/urls.py",
    "django/contrib/auth/mixins.py",
    "django/contrib/auth/validators.py",
    "django/contrib/auth/decorators.py",
    "django/setup.py",
    "django/shortcuts.py",
    "django/contrib/auth/signals.py",
    "django/__init__.py",
    "django/contrib/__init__.py",
    "django/__main__.py"
  ],
  "3_final_combined_files": [
    "django/contrib/auth/backends.py",
    "django/contrib/auth/__init__.py",
    "django/contrib/auth/middleware.py"
  ],
  "4_related_elements": {
    "django/contrib/auth/backends.py": [
      "function: ModelBackend.authenticate\nvariable: UserModel"
    ],
    "django/contrib/auth/__init__.py": [
      "function: authenticate\nfunction: _clean_credentials\nfunction: get_user_model"
    ],
    "django/contrib/auth/middleware.py": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "django/contrib/auth/backends.py": [
          "\nfunction: ModelBackend.authenticate"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..9da4e85 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If either credential is missing, don't hit the database or run the hasher.\n+        # This commonly happens when another backend supplies different credentials.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..5a16dad 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary DB queries and password hasher work when either\n+        # credential is missing (e.g., when another backend handles auth).\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..2fdd032 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,12 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # At this point, username and password can be None,\n+        # typically if credentials are provided for another backend.\n+        # Short-circuit to avoid unnecessary database queries and password\n+        # hasher work when this backend isn't being used.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..298fed9 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and password hashing when\n+        # credentials are intended for a different authentication backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..ac69587 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary DB queries and password hasher work when credentials\n+        # are intended for another backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..1787cac 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Short-circuit if credentials for this backend aren't provided to\n+        # avoid unnecessary database queries and password hasher work.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..7142328 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and password hashing if credentials\n+        # for this backend aren't provided (e.g., another backend is handling them).\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..dbb72d4 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid a useless database query and password hashing when credentials\n+        # are intended for a different backend or are incomplete.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..ff1f4b5 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If no username or password is provided, avoid an unnecessary database\n+        # query and hashing work. This often happens when another backend is\n+        # handling authentication with different credentials.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..dd7d40a 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If credentials weren't provided for this backend, avoid a useless\n+        # database query and password hasher work.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "django/contrib/auth/backends.py": [
          "\nfunction: ModelBackend.authenticate\nline: 41"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..8aec709 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If no username or password was provided, avoid a database query and\n+        # running the password hasher. This can happen when credentials are for\n+        # another authentication backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..a905c11 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and password hasher runs when\n+        # credentials are intended for a different authentication backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..4c4e125 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database lookups and password hasher work when\n+        # credentials for this backend aren't provided. This scenario often\n+        # occurs when another authentication backend supplies its own inputs.\n+        if username is None or password is None:\n+            return None\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..712d1a2 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and password hashing when either\n+        # credential is missing (e.g., when another backend is being used).\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..50d0518 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If no username or password is provided, don't hit the database\n+        # or run the password hasher. This typically means credentials are\n+        # intended for a different authentication backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..127bea3 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If either username or password is missing, avoid a useless database\n+        # query and expensive password hasher run. Another backend may handle\n+        # these credentials.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..cf7ac67 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If credentials are not provided for this backend, avoid a useless\n+        # database query and password hasher work.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..58fd0cc 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and password hashing when\n+        # credentials aren't provided for this backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..ef92a41 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and hasher work when credentials\n+        # aren't provided (e.g., when another backend handles authentication).\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..e069a0c 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If either the username or password is missing, don't proceed. This\n+        # avoids a useless database query and unnecessary password hasher work\n+        # when credentials are intended for a different authentication backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "django/contrib/auth/backends.py": [
          "\nfunction: ModelBackend.authenticate"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..a99eac1 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Short-circuit if credentials aren't provided for this backend to\n+        # avoid unnecessary DB queries and password hasher work.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..6eac7e2 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If either credential is missing, avoid unnecessary DB queries\n+        # and password hasher work. Another backend may handle auth.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..92a192f 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Short-circuit if credentials aren't provided for this backend.\n+        # Avoid a useless database query and running the password hasher.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..d630122 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and password hasher runs when\n+        # credentials are not provided for this backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..94c7ceb 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,9 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Short-circuit if credentials are incomplete; avoid DB and hasher work.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..4e0f64f 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Short-circuit to avoid unnecessary DB query and password hasher work\n+        # when credentials for another backend are provided or incomplete.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..903828e 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database queries and password hashing when\n+        # credentials for another backend are provided (username/password None).\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..1257644 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If no username or password was provided, don't hit the database.\n+        # This can happen when credentials are intended for a different backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..4e0cd56 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If no username or password was provided, don't attempt to authenticate.\n+        # Avoid unnecessary database queries and password hasher work when\n+        # credentials are intended for a different backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..1f18550 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid a useless database query and password hasher work when\n+        # credentials are intended for a different backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "django/contrib/auth/backends.py": [
          "\nfunction: ModelBackend.authenticate"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..c3f4483 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Short-circuit if username or password is not provided to avoid\n+        # unnecessary database queries and password hasher work.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..bd7a51a 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database hits and hasher work when credentials are incomplete.\n+        # username and password can be None if another backend handles authentication.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..5331067 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # At this point, username and password can be None if credentials are\n+        # meant for a different authentication backend. Avoid a useless database\n+        # query and password hashing in that case.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..ffde3e7 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Short-circuit if either credential is missing to avoid useless DB queries\n+        # and unnecessary password hasher work when another backend is being used.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..d46ceb8 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary database query and password hasher call when\n+        # credentials aren't intended for this backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..6c46f18 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If either username or password is None, avoid a useless database query\n+        # and password hasher work. This typically happens when credentials are\n+        # intended for a different authentication backend.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..29d49e6 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,9 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If no username or password is provided, don't hit the DB or run hashers.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..c52fa77 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary DB queries and password hasher work when credentials\n+        # are incomplete (e.g., when another backend handles authentication).\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..cf48b49 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,11 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # At this point, username and password can be None, typically if\n+        # credentials are provided for another backend. Avoid making a\n+        # database query or running the password hasher in that case.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
        "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..cfc9ae9 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # Avoid unnecessary DB queries and hasher work if credentials for this\n+        # backend aren't provided (e.g., another backend is handling auth).\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/django/contrib/auth/backends.py b/django/contrib/auth/backends.py\nindex ada7461..9da4e85 100644\n--- a/django/contrib/auth/backends.py\n+++ b/django/contrib/auth/backends.py\n@@ -39,6 +39,10 @@ class ModelBackend(BaseBackend):\n     def authenticate(self, request, username=None, password=None, **kwargs):\n         if username is None:\n             username = kwargs.get(UserModel.USERNAME_FIELD)\n+        # If either credential is missing, don't hit the database or run the hasher.\n+        # This commonly happens when another backend supplies different credentials.\n+        if username is None or password is None:\n+            return\n         try:\n             user = UserModel._default_manager.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n",
  "7_resolved": true
}