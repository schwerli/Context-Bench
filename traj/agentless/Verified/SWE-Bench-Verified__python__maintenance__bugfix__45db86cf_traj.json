{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__45db86cf",
  "original_id": "django__django-14140",
  "1_model_selected_files": [
    "django/db/models/query_utils.py"
  ],
  "2_embedding_selected_files": [
    "django/db/models/sql/query.py",
    "django/db/models/sql/subqueries.py",
    "django/db/models/query_utils.py",
    "django/db/models/__init__.py",
    "django/db/models/query.py",
    "django/db/models/expressions.py",
    "django/db/models/constraints.py",
    "django/db/models/sql/compiler.py",
    "django/db/models/sql/where.py",
    "django/db/models/base.py",
    "django/db/models/fields/related.py",
    "django/db/models/deletion.py",
    "django/db/models/sql/datastructures.py",
    "django/db/models/sql/__init__.py",
    "django/db/models/fields/__init__.py",
    "django/db/models/fields/related_descriptors.py",
    "django/db/models/options.py",
    "django/db/models/manager.py",
    "django/db/models/utils.py",
    "django/db/models/lookups.py",
    "django/db/__init__.py",
    "django/db/models/functions/text.py",
    "django/db/models/fields/related_lookups.py",
    "django/db/models/indexes.py",
    "django/db/models/functions/mixins.py",
    "django/db/models/enums.py",
    "django/db/models/functions/window.py",
    "django/db/models/fields/json.py",
    "django/db/models/fields/reverse_related.py",
    "django/db/utils.py",
    "django/db/models/functions/datetime.py",
    "django/db/models/functions/comparison.py",
    "django/db/models/fields/proxy.py",
    "django/db/models/aggregates.py"
  ],
  "3_final_combined_files": [
    "django/db/models/query_utils.py",
    "django/db/models/sql/query.py",
    "django/db/models/sql/subqueries.py"
  ],
  "4_related_elements": {
    "django/db/models/query_utils.py": [
      "function: Q.deconstruct\nfunction: Q.__init__\nfunction: Q.__or__\nfunction: Q.__and__\nfunction: Q.__invert__\nfunction: Q.resolve_expression\nclass: FilteredRelation"
    ],
    "django/db/models/sql/query.py": [
      "function: get_children_from_q\nfunction: Query.add_q\nfunction: Query._add_q\nfunction: Query.build_filtered_relation_q\nfunction: Query.build_filter\nfunction: Query.add_filter\nfunction: Query.build_where\nfunction: Query.resolve_lookup_value\nfunction: Query.resolve_expression\nfunction: Query.combine"
    ],
    "django/db/models/sql/subqueries.py": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "django/db/models/query_utils.py": [
          "\nfunction: Q.deconstruct\nline: 88\nline: 89\nline: 90\nline: 91\nline: 92\nline: 93"
        ]
      },
      "patches": [
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..616b7bd 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,9 +85,16 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if len(self.children) == 1:\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            if isinstance(child, tuple) and len(child) == 2:\n+                # Backward-compatible special case: single (key, value) child as kwargs.\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                # Non 2-tuple single child (e.g., boolean expressions) should be in args.\n+                args = (child,)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..0a2f47f 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,7 +85,16 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        # Only use kwargs deconstruction for single-child Q objects when the\n+        # child is a 2-tuple representing a keyword filter, e.g., ('x', 1).\n+        # Otherwise, deconstruct into args to avoid errors with non-subscriptable\n+        # expressions like Exists, Subquery, or other expressions.\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+            and isinstance(self.children[0], tuple)\n+            and len(self.children[0]) == 2\n+        ):\n             child = self.children[0]\n             kwargs = {child[0]: child[1]}\n         else:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..c5a8e69 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,7 +85,12 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+            and isinstance(self.children[0], tuple)\n+            and len(self.children[0]) == 2\n+        ):\n             child = self.children[0]\n             kwargs = {child[0]: child[1]}\n         else:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..26d9db0 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,9 +85,20 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+        ):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            # Preserve kwargs form only for traditional (key, value) child tuples.\n+            if isinstance(child, (list, tuple)) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                # For non-subscriptable or non-(key, value) children, deconstruct\n+                # into args to avoid TypeError and capture connector if needed.\n+                args = (child,)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "django/db/models/query_utils.py": [
          "\nfunction: Q.deconstruct\nline: 88\nline: 90\nline: 92"
        ]
      },
      "patches": [
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..c5a8e69 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,7 +85,12 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+            and isinstance(self.children[0], tuple)\n+            and len(self.children[0]) == 2\n+        ):\n             child = self.children[0]\n             kwargs = {child[0]: child[1]}\n         else:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..c5a8e69 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,7 +85,12 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+            and isinstance(self.children[0], tuple)\n+            and len(self.children[0]) == 2\n+        ):\n             child = self.children[0]\n             kwargs = {child[0]: child[1]}\n         else:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..4501e1e 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,9 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args, kwargs = tuple(self.children), {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..c5a8e69 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,7 +85,12 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+            and isinstance(self.children[0], tuple)\n+            and len(self.children[0]) == 2\n+        ):\n             child = self.children[0]\n             kwargs = {child[0]: child[1]}\n         else:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..42df269 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,11 +87,16 @@ class Q(tree.Node):\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            # Only treat single child as kwargs if it's a 2-tuple/list (key, value).\n+            if isinstance(child, (tuple, list)) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = (child,)\n         else:\n             args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        # Include connector when using args.\n+        if args and self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..a301aa7 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,13 +85,17 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n+        # Only treat single-child Q specially if the child is a 2-tuple (key, value).\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            if isinstance(child, tuple) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = tuple(self.children)\n         else:\n             args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        if args and self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "django/db/models/query_utils.py": [
          "\nfunction: Q.deconstruct\nline: 88\nline: 89\nline: 90\nline: 91"
        ]
      },
      "patches": [
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..09cc97d 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,13 +85,9 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        if self.connector != self.default:\n+            kwargs = {'_connector': self.connector}\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..aff73fa 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,7 +87,12 @@ class Q(tree.Node):\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            if isinstance(child, tuple) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = tuple(self.children)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..e257e1d 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,11 +87,15 @@ class Q(tree.Node):\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            # Only treat a single (key, value) child specially; otherwise serialize as args.\n+            if isinstance(child, (list, tuple)) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = (child,)\n         else:\n             args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        if args and self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..d45853d 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,9 +85,15 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if len(self.children) == 1:\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            # Preserve historic behavior only when the single child is a (key, value) pair.\n+            if (not isinstance(child, Q)) and isinstance(child, (list, tuple)) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = (child,)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6788622 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,7 +87,12 @@ class Q(tree.Node):\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            if isinstance(child, tuple) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = (child,)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..e100734 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,7 +85,15 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        # Preserve backward compatibility only when the single child is a\n+        # (key, value) pair. Avoid indexing into non-subscriptable children\n+        # such as expressions (e.g., Exists).\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+            and isinstance(self.children[0], (tuple, list))\n+            and len(self.children[0]) == 2\n+        ):\n             child = self.children[0]\n             kwargs = {child[0]: child[1]}\n         else:\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "django/db/models/query_utils.py": [
          "\nfunction: Q.deconstruct\nline: 88\nline: 89\nline: 90\nline: 91\nline: 92\nline: 93\nline: 94"
        ]
      },
      "patches": [
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..d595379 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,7 +87,13 @@ class Q(tree.Node):\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            # Only treat a single child as kwargs if it's a (key, value) tuple.\n+            if isinstance(child, tuple) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = (child,)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..c49eacd 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,11 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        # Always deconstruct children into args to avoid assuming tuple structure.\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..c5a8e69 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,7 +85,12 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n+        if (\n+            len(self.children) == 1\n+            and not isinstance(self.children[0], Q)\n+            and isinstance(self.children[0], tuple)\n+            and len(self.children[0]) == 2\n+        ):\n             child = self.children[0]\n             kwargs = {child[0]: child[1]}\n         else:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6788622 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,7 +87,12 @@ class Q(tree.Node):\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            if isinstance(child, tuple) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = (child,)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..52650c2 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,13 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        # Deconstruct all children as positional args to avoid relying on a\n+        # special-case for single-child Q objects, which breaks with\n+        # non-subscriptable expressions (e.g., Exists()).\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..b491fcf 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -87,7 +87,13 @@ class Q(tree.Node):\n         args, kwargs = (), {}\n         if len(self.children) == 1 and not isinstance(self.children[0], Q):\n             child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n+            # Only treat single child as kwargs if it's a 2-tuple (key, value).\n+            if isinstance(child, tuple) and len(child) == 2:\n+                kwargs = {child[0]: child[1]}\n+            else:\n+                args = (child,)\n+                if self.connector != self.default:\n+                    kwargs = {'_connector': self.connector}\n         else:\n             args = tuple(self.children)\n             if self.connector != self.default:\n",
        "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..09cc97d 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -85,13 +85,9 @@ class Q(tree.Node):\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n         args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        if self.connector != self.default:\n+            kwargs = {'_connector': self.connector}\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/django/db/models/query_utils.py b/django/db/models/query_utils.py\nindex b9069df..6e9d597 100644\n--- a/django/db/models/query_utils.py\n+++ b/django/db/models/query_utils.py\n@@ -84,14 +84,10 @@ class Q(tree.Node):\n         path = '%s.%s' % (self.__class__.__module__, self.__class__.__name__)\n         if path.startswith('django.db.models.query_utils'):\n             path = path.replace('django.db.models.query_utils', 'django.db.models')\n-        args, kwargs = (), {}\n-        if len(self.children) == 1 and not isinstance(self.children[0], Q):\n-            child = self.children[0]\n-            kwargs = {child[0]: child[1]}\n-        else:\n-            args = tuple(self.children)\n-            if self.connector != self.default:\n-                kwargs = {'_connector': self.connector}\n+        args = tuple(self.children)\n+        kwargs = {}\n+        if self.connector != self.default:\n+            kwargs['_connector'] = self.connector\n         if self.negated:\n             kwargs['_negated'] = True\n         return path, args, kwargs\n",
  "7_resolved": true
}