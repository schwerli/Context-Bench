{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__b91692e0",
  "original_id": "scikit-learn__scikit-learn-25931",
  "1_model_selected_files": [
    "sklearn/ensemble/_iforest.py",
    "sklearn/base.py",
    "sklearn/utils/validation.py"
  ],
  "2_embedding_selected_files": [
    "sklearn/utils/estimator_checks.py",
    "sklearn/ensemble/_iforest.py",
    "sklearn/ensemble/_forest.py",
    "sklearn/kernel_approximation.py",
    "sklearn/ensemble/_voting.py",
    "sklearn/ensemble/_gb.py",
    "sklearn/exceptions.py",
    "sklearn/utils/validation.py",
    "sklearn/__init__.py",
    "sklearn/utils/__init__.py",
    "sklearn/ensemble/_weight_boosting.py",
    "sklearn/naive_bayes.py",
    "sklearn/ensemble/__init__.py",
    "sklearn/ensemble/_bagging.py",
    "sklearn/calibration.py",
    "sklearn/multiclass.py",
    "sklearn/multioutput.py",
    "sklearn/base.py",
    "sklearn/ensemble/_stacking.py",
    "sklearn/discriminant_analysis.py",
    "sklearn/utils/fixes.py",
    "sklearn/conftest.py",
    "sklearn/utils/_joblib.py",
    "sklearn/utils/_mocking.py",
    "sklearn/ensemble/_base.py"
  ],
  "3_final_combined_files": [
    "sklearn/ensemble/_iforest.py",
    "sklearn/base.py",
    "sklearn/utils/validation.py",
    "sklearn/utils/estimator_checks.py",
    "sklearn/ensemble/_forest.py"
  ],
  "4_related_elements": {
    "sklearn/ensemble/_iforest.py": [
      "function: IsolationForest.fit\nfunction: IsolationForest.decision_function\nfunction: IsolationForest.score_samples\nfunction: IsolationForest.predict\nfunction: IsolationForest._compute_chunked_score_samples\nfunction: IsolationForest._compute_score_samples"
    ],
    "sklearn/base.py": [
      "function: BaseEstimator._validate_data\nfunction: BaseEstimator._check_feature_names\nfunction: BaseEstimator._check_n_features"
    ],
    "sklearn/utils/validation.py": [
      "function: check_array\nfunction: _get_feature_names\nfunction: _check_feature_names_in"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "sklearn/ensemble/_iforest.py": [
          "\nfunction: IsolationForest.fit\nline: 291\nline: 348"
        ]
      },
      "patches": [
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..8dc87c3 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,11 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use original input X with feature names if available to avoid warnings\n+        X_with_feature_names = X_original if hasattr(X_original, \"columns\") else X\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_with_feature_names), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..c6cbd9b 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names for later checks\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input with feature names to avoid spurious warnings during fit\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..c48d2f9 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input X to preserve feature names, avoiding warning when contamination != \"auto\".\n+        self.offset_ = np.percentile(self.score_samples(X_original), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..7b93acc 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,7 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n-        X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n+        # Keep original X to preserve feature names for internal score computation\n+        X_input = X\n+        X = self._validate_data(X_input, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n             # ensemble sorts the indices.\n@@ -345,7 +347,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use original X to avoid spurious feature name warnings during fit\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..9efe178 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep original input to preserve feature names during offset computation\n+        X_with_feature_names = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,11 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (which may carry feature names, e.g., a pandas DataFrame)\n+        # to avoid spurious warnings when checking feature names in score_samples.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_with_feature_names), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..9a3bbcb 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_orig = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input X (with feature names if provided) to avoid\n+        # spurious feature name warnings when computing offset_ during fit.\n+        self.offset_ = np.percentile(self.score_samples(X_orig), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..4d74c9a 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (e.g. pandas DataFrame) to preserve feature names\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..2a1ced3 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -344,8 +346,11 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             self.offset_ = -0.5\n             return self\n \n-        # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # else, define offset_ wrt contamination parameter.\n+        # Use the original input object to preserve feature names and avoid warnings.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..2e24bda 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,7 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n-        X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n+        # Keep a reference to the original input to preserve feature names\n+        X_input = X\n+        X = self._validate_data(X_input, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n             # ensemble sorts the indices.\n@@ -345,7 +347,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input to preserve feature names and avoid spurious warnings\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..4b1b0f4 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Preserve original input (and feature names, if any) for internal scoring\n+        X_for_offset = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_for_offset), 100.0 * self.contamination\n+        )\n \n         return self\n \n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "sklearn/ensemble/_iforest.py": [
          "\nfunction: IsolationForest.fit\nline: 291\nline: 348"
        ]
      },
      "patches": [
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..dc7a979 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Preserve original input to keep feature names if provided (e.g., pandas DataFrame)\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use original input to avoid spurious feature names warning during internal call\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..896a7d8 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Preserve original input to retain feature names for downstream checks.\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (with potential feature names) to avoid spurious warnings.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..71d45e4 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        X_for_offset = X_original if hasattr(self, \"feature_names_in_\") else X\n+        self.offset_ = np.percentile(self.score_samples(X_for_offset), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..d2e85db 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_input = X  # preserve original input (e.g., DataFrame) for downstream methods that check feature names\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -344,8 +345,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             self.offset_ = -0.5\n             return self\n \n-        # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # else, define offset_ wrt contamination parameter. Use original input to preserve feature names and avoid spurious warnings.\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..5a0d565 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Preserve the original input to keep feature names for internal calls\n+        # (e.g., score_samples) during fit when contamination != \"auto\".\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +348,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (X_input) to preserve feature names and avoid warnings.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..0706ca7 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names\n+        # for internal calls (e.g., score computation for offset) during fit.\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +348,11 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (potentially a DataFrame with feature names)\n+        # to avoid triggering a feature-name mismatch warning during fit.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..f98c060 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names for internal calls.\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input to preserve feature names and avoid warnings during fit.\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..9f7d8c4 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names\n+        X_orig = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input so feature names match those stored during fit\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_orig), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..611583f 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,7 +288,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n-        X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n+        # Preserve the original input (and its feature names, if any) to avoid\n+        # spurious warnings when score_samples is called during fit.\n+        X_input = X\n+        X = self._validate_data(X_input, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n             # ensemble sorts the indices.\n@@ -345,7 +348,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input to retain feature names consistency.\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..8efd5bf 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_in = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_in), 100.0 * self.contamination\n+        )\n \n         return self\n \n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "sklearn/ensemble/_iforest.py": [
          "\nfunction: IsolationForest.fit\nline: 291\nline: 348"
        ]
      },
      "patches": [
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..18c13bf 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_orig = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input X (e.g., a DataFrame) to preserve feature names\n+        self.offset_ = np.percentile(self.score_samples(X_orig), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..6a9b11d 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input X to preserve feature names and avoid warnings.\n+        self.offset_ = np.percentile(self.score_samples(X_original), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..de2b270 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_orig = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (with feature names) to avoid spurious warnings\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_orig), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..9de20e7 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names (e.g., pandas DataFrame)\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,11 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (e.g., DataFrame) to avoid spurious feature name warnings\n+        X_for_offset = X_original if hasattr(X_original, \"columns\") else X\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_for_offset), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..b471c35 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input to preserve feature names during validation,\n+        # preventing spurious warnings when contamination != \"auto\".\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..c6eae96 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep original input to preserve feature names when computing offset_\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use original X to avoid feature-name mismatch warning raised by score_samples\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_original), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..e3a15eb 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep the original input to preserve feature names when calling\n+        # score_samples during fit (e.g., for contamination != \"auto\").\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +348,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input X_input so that feature names are available.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..16e4654 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_raw = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input to preserve feature names and avoid warnings.\n+        self.offset_ = np.percentile(self.score_samples(X_raw), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..988fd9d 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep original input to preserve feature names for internal calls\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        self.offset_ = np.percentile(self.score_samples(X_original), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..6b87d8b 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep original input to preserve feature names for internal scoring\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use original input (with feature names if any) to avoid spurious warnings\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "sklearn/ensemble/_iforest.py": [
          "\nfunction: IsolationForest.fit\nline: 291\nline: 348"
        ]
      },
      "patches": [
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..067c31c 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names\n+        # for internal calls (e.g., score_samples during fit when contamination != \"auto\").\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +348,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input to avoid spurious feature-name warnings.\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..979fdb8 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..77a6ddb 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep original input to preserve feature names for internal calls (e.g., score_samples)\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,11 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (with feature names if available) to avoid spurious warnings\n+        X_for_offset = X_input\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_for_offset), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..d4b922c 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_input = X  # Preserve original input to keep feature names for internal calls\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -344,8 +345,12 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             self.offset_ = -0.5\n             return self\n \n-        # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # else, define offset_ wrt contamination parameter.\n+        # Use the original input X_input to avoid spurious \"feature names\" warnings\n+        # when the estimator was fitted with feature names.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..61b811f 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Preserve the original input to keep feature names for internal calls\n+        # (e.g., when computing offset_ with contamination != \"auto\").\n+        # Using the original X avoids spurious warnings about missing feature names.\n+        X_input = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +349,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (with feature names, if any) to avoid warnings.\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..198a346 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Preserve the original input (e.g. DataFrame with feature names)\n+        X_input = X\n+        # Validate and convert input for fitting\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +348,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (with feature names) to avoid spurious warnings\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_input), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..ee6659d 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        self.offset_ = np.percentile(self.score_samples(X_original), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..10fd89b 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_for_offset = X  # keep original data (and feature names) for score_samples within fit\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (with feature names preserved) to avoid false warnings during fit.\n+        self.offset_ = np.percentile(self.score_samples(X_for_offset), 100.0 * self.contamination)\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..5a980e1 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        # Keep a reference to the original input to preserve feature names\n+        X_with_feature_names = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +347,10 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input with feature names to avoid spurious warnings\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_with_feature_names), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
        "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..0c80f19 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,7 +288,9 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n-        X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n+        # Preserve the original input to avoid feature-name warning when computing offset_\n+        X_input = X\n+        X = self._validate_data(X_input, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n             # ensemble sorts the indices.\n@@ -345,7 +347,8 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use the original input (e.g., DataFrame) to respect feature names and avoid warnings.\n+        self.offset_ = np.percentile(self.score_samples(X_input), 100.0 * self.contamination)\n \n         return self\n \n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/sklearn/ensemble/_iforest.py b/sklearn/ensemble/_iforest.py\nindex d995c25..8dc87c3 100644\n--- a/sklearn/ensemble/_iforest.py\n+++ b/sklearn/ensemble/_iforest.py\n@@ -288,6 +288,7 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             Fitted estimator.\n         \"\"\"\n         self._validate_params()\n+        X_original = X\n         X = self._validate_data(X, accept_sparse=[\"csc\"], dtype=tree_dtype)\n         if issparse(X):\n             # Pre-sort indices to avoid that each individual tree of the\n@@ -345,7 +346,11 @@ class IsolationForest(OutlierMixin, BaseBagging):\n             return self\n \n         # else, define offset_ wrt contamination parameter\n-        self.offset_ = np.percentile(self.score_samples(X), 100.0 * self.contamination)\n+        # Use original input X with feature names if available to avoid warnings\n+        X_with_feature_names = X_original if hasattr(X_original, \"columns\") else X\n+        self.offset_ = np.percentile(\n+            self.score_samples(X_with_feature_names), 100.0 * self.contamination\n+        )\n \n         return self\n \n",
  "7_resolved": true
}