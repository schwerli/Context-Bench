{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__986c9e85",
  "original_id": "django__django-12193",
  "1_model_selected_files": [
    "django/forms/widgets.py",
    "django/contrib/postgres/forms/array.py"
  ],
  "2_embedding_selected_files": [
    "django/contrib/postgres/forms/array.py",
    "django/forms/widgets.py",
    "django/forms/fields.py",
    "django/forms/boundfield.py",
    "django/forms/forms.py",
    "django/contrib/postgres/fields/array.py",
    "django/contrib/postgres/forms/ranges.py",
    "django/forms/models.py",
    "django/contrib/postgres/aggregates/general.py",
    "django/contrib/postgres/fields/__init__.py",
    "django/forms/formsets.py",
    "django/contrib/postgres/forms/jsonb.py",
    "django/contrib/postgres/fields/hstore.py",
    "django/contrib/postgres/forms/__init__.py",
    "django/contrib/postgres/fields/utils.py",
    "django/contrib/postgres/fields/ranges.py",
    "django/contrib/postgres/fields/citext.py",
    "django/forms/__init__.py",
    "django/contrib/postgres/forms/hstore.py",
    "django/contrib/postgres/validators.py",
    "django/contrib/__init__.py",
    "django/contrib/postgres/aggregates/statistics.py",
    "django/contrib/postgres/apps.py",
    "django/forms/utils.py",
    "django/contrib/postgres/lookups.py",
    "django/contrib/postgres/signals.py",
    "django/contrib/postgres/constraints.py",
    "django/__init__.py",
    "django/contrib/postgres/fields/jsonb.py",
    "django/contrib/postgres/__init__.py",
    "django/contrib/postgres/aggregates/__init__.py",
    "django/forms/renderers.py",
    "django/contrib/postgres/search.py",
    "django/contrib/postgres/indexes.py",
    "django/setup.py",
    "django/contrib/postgres/aggregates/mixins.py",
    "django/contrib/postgres/functions.py",
    "django/__main__.py",
    "django/contrib/postgres/utils.py",
    "django/contrib/postgres/serializers.py",
    "django/contrib/postgres/operations.py",
    "django/shortcuts.py"
  ],
  "3_final_combined_files": [
    "django/forms/widgets.py",
    "django/contrib/postgres/forms/array.py",
    "django/forms/fields.py"
  ],
  "4_related_elements": {
    "django/forms/widgets.py": [
      "function: CheckboxInput.get_context\nfunction: boolean_check\nfunction: Widget.get_context\nfunction: Widget.build_attrs\nfunction: Input.get_context"
    ],
    "django/contrib/postgres/forms/array.py": [
      "function: SplitArrayWidget.get_context\nclass: SplitArrayWidget\nclass: SplitArrayField"
    ],
    "django/forms/fields.py": [
      "class: BooleanField"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "django/forms/widgets.py": [
          "\nfunction: CheckboxInput.get_context\nline: 523\nline: 527"
        ],
        "django/contrib/postgres/forms/array.py": [
          "\nfunction: SplitArrayWidget.get_context\nline: 140\nline: 142\nline: 148\nline: 150"
        ]
      },
      "patches": [
        "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex dc396a1..f3f9d59 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -521,9 +521,9 @@ class CheckboxInput(Input):\n         return str(value)\n \n     def get_context(self, name, value, attrs):\n+        # Avoid mutating the attrs dict passed in, since callers may reuse it.\n+        attrs = {} if attrs is None else {**attrs}\n         if self.check_test(value):\n-            if attrs is None:\n-                attrs = {}\n             attrs['checked'] = True\n         return super().get_context(name, value, attrs)\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..42b032d 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,18 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            per_attrs = {**base_attrs}\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                per_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, per_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..107bc29 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,20 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        base_id = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n-            if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+            # Copy base_attrs per subwidget to avoid leakage from widgets that\n+            # mutate attrs (e.g., CheckboxInput sets 'checked': True).\n+            widget_attrs = {**base_attrs}\n+            if base_id:\n+                widget_attrs['id'] = '%s_%s' % (base_id, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, widget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..76b32be 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict per subwidget to avoid mutation side-effects.\n+            subwidget_attrs = {**base_attrs}\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..8531d1b 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,15 +137,17 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_final_attrs = self.build_attrs(attrs)\n+        id_ = base_final_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Create a fresh attrs dict per subwidget to avoid mutation from widget.get_context().\n+            final_attrs = base_final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                final_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n                 self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n             )\n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..e7746ba 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,18 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            widget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                widget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, widget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..cc74d35 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict for each subwidget to avoid mutation by widget.get_context().\n+            widget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                widget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, widget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..07b08bb 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Build per-subwidget attrs to avoid leaking mutations from widget.get_context().\n+            sub_attrs = {**base_attrs}\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                sub_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, sub_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..66faf6a 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,18 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        base_id = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n-            if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+            iter_attrs = base_attrs.copy()\n+            if base_id:\n+                iter_attrs['id'] = '%s_%s' % (base_id, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, iter_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex dc396a1..32b9cba 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -522,8 +522,7 @@ class CheckboxInput(Input):\n \n     def get_context(self, name, value, attrs):\n         if self.check_test(value):\n-            if attrs is None:\n-                attrs = {}\n+            attrs = {} if attrs is None else attrs.copy()\n             attrs['checked'] = True\n         return super().get_context(name, value, attrs)\n \n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "django/forms/widgets.py": [
          "\nfunction: CheckboxInput.get_context\nline: 527"
        ],
        "django/contrib/postgres/forms/array.py": [
          "\nfunction: SplitArrayWidget.get_context"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..8646a0a 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        base_id = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n-            if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+            # Create fresh attrs per subwidget to avoid mutation bleed-through.\n+            sub_attrs = dict(base_attrs)\n+            if base_id:\n+                sub_attrs['id'] = '%s_%s' % (base_id, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, sub_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..19bc1e1 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_final_attrs = self.build_attrs(attrs)\n+        id_ = base_final_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict per subwidget to avoid mutation side effects.\n+            subwidget_attrs = base_final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..1730564 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,20 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh dict for each subwidget to avoid mutations\n+            # by widget.get_context() (e.g., CheckboxInput sets 'checked').\n+            subwidget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..949bca9 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_final_attrs = self.build_attrs(attrs)\n+        base_id = base_final_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n-            if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+            # Create a fresh attrs dict per subwidget to avoid mutations leaking between iterations.\n+            subwidget_attrs = dict(base_final_attrs)\n+            if base_id:\n+                subwidget_attrs['id'] = '%s_%s' % (base_id, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..ed63275 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict for each subwidget to avoid mutations by widget.get_context().\n+            subwidget_attrs = dict(base_attrs)\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..06b6f4d 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,15 +137,17 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_final_attrs = self.build_attrs(attrs)\n+        id_ = base_final_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a per-subwidget copy to avoid mutations (e.g., 'checked') leaking between iterations.\n+            final_attrs = base_final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                final_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n                 self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n             )\n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..9d8262a 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Create a fresh attrs dict per subwidget to avoid mutation side-effects.\n+            sub_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                sub_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, sub_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..4f77d07 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Build a fresh attrs dict per subwidget to avoid in-place mutation by widgets.\n+            subwidget_attrs = {**base_attrs}\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex dc396a1..ffb425f 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -522,9 +522,9 @@ class CheckboxInput(Input):\n \n     def get_context(self, name, value, attrs):\n         if self.check_test(value):\n-            if attrs is None:\n-                attrs = {}\n-            attrs['checked'] = True\n+            base_attrs = {} if attrs is None else attrs.copy()\n+            base_attrs['checked'] = True\n+            attrs = base_attrs\n         return super().get_context(name, value, attrs)\n \n     def value_from_datadict(self, data, files, name):\n",
        "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex dc396a1..e92ff79 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -521,9 +521,9 @@ class CheckboxInput(Input):\n         return str(value)\n \n     def get_context(self, name, value, attrs):\n+        # Don't mutate the incoming attrs dict; build a new one to avoid side effects.\n+        attrs = {} if attrs is None else attrs.copy()\n         if self.check_test(value):\n-            if attrs is None:\n-                attrs = {}\n             attrs['checked'] = True\n         return super().get_context(name, value, attrs)\n \n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "django/forms/widgets.py": [
          "\nfunction: CheckboxInput.get_context\nline: 523\nline: 527-528"
        ],
        "django/contrib/postgres/forms/array.py": [
          "\nfunction: SplitArrayWidget.get_context\nline: 140\nline: 148-151"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..60982a1 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Build a fresh attrs dict per subwidget to avoid leakage of state (e.g., 'checked').\n+            subwidget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \ndiff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex dc396a1..506f7a1 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -521,10 +521,11 @@ class CheckboxInput(Input):\n         return str(value)\n \n     def get_context(self, name, value, attrs):\n+        # Avoid mutating the attrs dict in place as it may be reused by callers.\n         if self.check_test(value):\n-            if attrs is None:\n-                attrs = {}\n-            attrs['checked'] = True\n+            new_attrs = {} if attrs is None else attrs.copy()\n+            new_attrs['checked'] = True\n+            return super().get_context(name, value, new_attrs)\n         return super().get_context(name, value, attrs)\n \n     def value_from_datadict(self, data, files, name):\n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..b180743 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,18 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            subwidget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..ce66fdd 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,18 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            iteration_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                iteration_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, iteration_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..416cde5 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,22 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh copy of attributes for each subwidget so that any\n+            # in-place modifications done by the underlying widget (e.g.,\n+            # CheckboxInput setting 'checked') don't leak into subsequent\n+            # subwidgets.\n+            subattrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subattrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subattrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..7b6a639 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_final_attrs = self.build_attrs(attrs)\n+        id_ = base_final_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Create a fresh attrs dict for each subwidget to avoid mutation\n+            widget_attrs = base_final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                widget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, widget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..f772be0 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_final_attrs = self.build_attrs(attrs)\n+        id_ = base_final_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Build a fresh attrs dict for each subwidget to avoid mutations leaking across iterations.\n+            subwidget_attrs = base_final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..b0c75fb 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,20 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Build a fresh attrs dict for each subwidget to avoid leaking mutations\n+            # from widget.get_context() (e.g., CheckboxInput adding 'checked').\n+            item_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                item_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, item_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..60cae71 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a per-subwidget copy of attributes to avoid leaking mutations.\n+            subwidget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex dc396a1..ff73137 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -521,9 +521,9 @@ class CheckboxInput(Input):\n         return str(value)\n \n     def get_context(self, name, value, attrs):\n+        # Avoid mutating the attrs dict passed in.\n+        attrs = {} if attrs is None else attrs.copy()\n         if self.check_test(value):\n-            if attrs is None:\n-                attrs = {}\n             attrs['checked'] = True\n         return super().get_context(name, value, attrs)\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..300d906 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        base_id = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n-            if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+            # Create a fresh attrs dict per subwidget to avoid leaking mutations\n+            iteration_attrs = dict(base_attrs)\n+            if base_id:\n+                iteration_attrs['id'] = '%s_%s' % (base_id, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, iteration_attrs)['widget']\n             )\n         return context\n \n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "django/forms/widgets.py": [
          "\nfunction: CheckboxInput.get_context"
        ],
        "django/contrib/postgres/forms/array.py": [
          "\nfunction: SplitArrayWidget.get_context"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..4a09bb2 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict for each subwidget to avoid mutations leaking between iterations.\n+            subwidget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..a93ac1f 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict for each subwidget to avoid mutations\n+            widget_attrs = {**base_attrs}\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                widget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, widget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..3904feb 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Create a fresh attrs dict for each subwidget to avoid in-place mutations by widget.get_context().\n+            subwidget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..f397512 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,20 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Build a fresh attrs dict for each subwidget to avoid side-effects\n+            # from widgets that mutate the attrs in get_context (e.g., CheckboxInput).\n+            iteration_attrs = {**base_attrs}\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                iteration_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, iteration_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..834e5a2 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        base_id = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n-            if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+            # Create a fresh attrs dict per subwidget to avoid cross-contamination\n+            sub_attrs = {**base_attrs}\n+            if base_id:\n+                sub_attrs['id'] = '%s_%s' % (base_id, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, sub_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..b45e07f 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        base_id = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n-            if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+            # Create a fresh attrs dict per subwidget to avoid mutations leaking.\n+            item_attrs = base_attrs.copy()\n+            if base_id:\n+                item_attrs['id'] = '%s_%s' % (base_id, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, item_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..85545fa 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,19 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict per subwidget to avoid in-place mutations\n+            sub_attrs = {**base_attrs}\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                sub_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, sub_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..559b25c 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -144,10 +144,12 @@ class SplitArrayWidget(forms.Widget):\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a fresh attrs dict for each subwidget to avoid side effects\n+            subwidget_attrs = final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..b180743 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -137,17 +137,18 @@ class SplitArrayWidget(forms.Widget):\n             self.widget.is_localized = self.is_localized\n         value = value or []\n         context['widget']['subwidgets'] = []\n-        final_attrs = self.build_attrs(attrs)\n-        id_ = final_attrs.get('id')\n+        base_attrs = self.build_attrs(attrs)\n+        id_ = base_attrs.get('id')\n         for i in range(max(len(value), self.size)):\n             try:\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            subwidget_attrs = base_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n",
        "diff --git a/django/contrib/postgres/forms/array.py b/django/contrib/postgres/forms/array.py\nindex 9bc059d..c4593a3 100644\n--- a/django/contrib/postgres/forms/array.py\n+++ b/django/contrib/postgres/forms/array.py\n@@ -144,10 +144,12 @@ class SplitArrayWidget(forms.Widget):\n                 widget_value = value[i]\n             except IndexError:\n                 widget_value = None\n+            # Use a per-subwidget copy of attrs to avoid mutations from widget.get_context().\n+            subwidget_attrs = final_attrs.copy()\n             if id_:\n-                final_attrs = {**final_attrs, 'id': '%s_%s' % (id_, i)}\n+                subwidget_attrs['id'] = '%s_%s' % (id_, i)\n             context['widget']['subwidgets'].append(\n-                self.widget.get_context(name + '_%s' % i, widget_value, final_attrs)['widget']\n+                self.widget.get_context(name + '_%s' % i, widget_value, subwidget_attrs)['widget']\n             )\n         return context\n \n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex dc396a1..f3f9d59 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -521,9 +521,9 @@ class CheckboxInput(Input):\n         return str(value)\n \n     def get_context(self, name, value, attrs):\n+        # Avoid mutating the attrs dict passed in, since callers may reuse it.\n+        attrs = {} if attrs is None else {**attrs}\n         if self.check_test(value):\n-            if attrs is None:\n-                attrs = {}\n             attrs['checked'] = True\n         return super().get_context(name, value, attrs)\n \n",
  "7_resolved": true
}