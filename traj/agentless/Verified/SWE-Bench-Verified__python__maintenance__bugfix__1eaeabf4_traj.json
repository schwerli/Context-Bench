{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__1eaeabf4",
  "original_id": "sympy__sympy-23262",
  "1_model_selected_files": [
    "sympy/utilities/lambdify.py",
    "sympy/printing/pycode.py",
    "sympy/printing/lambdarepr.py",
    "sympy/printing/python.py",
    "sympy/printing/codeprinter.py"
  ],
  "2_embedding_selected_files": [
    "sympy/utilities/lambdify.py",
    "sympy/printing/rust.py",
    "sympy/printing/printer.py",
    "sympy/printing/pycode.py",
    "sympy/printing/__init__.py",
    "sympy/printing/julia.py",
    "sympy/printing/str.py",
    "sympy/printing/fortran.py",
    "sympy/printing/glsl.py",
    "sympy/printing/tensorflow.py",
    "sympy/printing/octave.py",
    "sympy/printing/mathematica.py",
    "sympy/utilities/misc.py",
    "sympy/printing/llvmjitcode.py",
    "sympy/printing/lambdarepr.py",
    "sympy/printing/maple.py",
    "sympy/printing/cxx.py",
    "sympy/printing/numpy.py",
    "sympy/this.py",
    "sympy/printing/cxxcode.py",
    "sympy/printing/jscode.py",
    "sympy/printing/rcode.py",
    "sympy/printing/defaults.py",
    "sympy/printing/repr.py",
    "sympy/printing/codeprinter.py",
    "sympy/release.py",
    "sympy/printing/pretty/pretty.py",
    "sympy/utilities/iterables.py",
    "sympy/printing/latex.py",
    "sympy/printing/fcode.py",
    "sympy/printing/ccode.py",
    "sympy/printing/python.py",
    "sympy/__init__.py",
    "sympy/printing/c.py",
    "sympy/printing/pretty/pretty_symbology.py",
    "sympy/printing/tree.py",
    "sympy/utilities/pytest.py",
    "sympy/isympy.py",
    "sympy/printing/pretty/__init__.py",
    "sympy/printing/mathml.py",
    "sympy/utilities/__init__.py",
    "sympy/utilities/exceptions.py",
    "sympy/abc.py",
    "sympy/utilities/source.py",
    "sympy/printing/theanocode.py",
    "sympy/utilities/benchmarking.py",
    "sympy/utilities/runtests.py",
    "sympy/utilities/autowrap.py",
    "sympy/utilities/_compilation/runners.py",
    "sympy/galgebra.py"
  ],
  "3_final_combined_files": [
    "sympy/utilities/lambdify.py",
    "sympy/printing/pycode.py",
    "sympy/printing/lambdarepr.py",
    "sympy/printing/rust.py",
    "sympy/printing/printer.py"
  ],
  "4_related_elements": {
    "sympy/utilities/lambdify.py": [
      "function: lambdify\nfunction: lambdastr\nfunction: _recursive_to_string\nclass: _EvaluatorPrinter\nclass: _TensorflowEvaluatorPrinter\nvariable: _lambdify_generated_counter"
    ],
    "sympy/printing/pycode.py": [
      "class: AbstractPythonCodePrinter\nclass: PythonCodePrinter\nfunction: AbstractPythonCodePrinter._print_Return\nfunction: pycode"
    ],
    "sympy/printing/lambdarepr.py": [
      "class: LambdaPrinter\nclass: NumExprPrinter\nfunction: NumExprPrinter._print_seq\nfunction: lambdarepr"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "sympy/utilities/lambdify.py": [
          "\nfunction: _recursive_to_string\nline: 958\nline: 960\nline: 964"
        ]
      },
      "patches": [
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..1062ede 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -959,6 +959,9 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"[]\"\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            # Ensure single-element tuples are printed with a trailing comma\n+            if len(arg) == 1:\n+                return left + _recursive_to_string(doprint, arg[0]) + ',' + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n         return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..ac6b1bb 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -956,12 +956,16 @@ def _recursive_to_string(doprint, arg):\n         return doprint(arg)\n     elif iterable(arg):\n         if isinstance(arg, list):\n-            left, right = \"[]\"\n+            # Lists are printed with square brackets.\n+            return \"[\" + ', '.join(_recursive_to_string(doprint, e) for e in arg) + \"]\"\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            # Tuples need a trailing comma when they have a single element.\n+            if len(arg) == 1:\n+                return \"(\" + _recursive_to_string(doprint, arg[0]) + \",)\"\n+            else:\n+                return \"(\" + ', '.join(_recursive_to_string(doprint, e) for e in arg) + \")\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..a0155aa 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,12 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        items = [_recursive_to_string(doprint, e) for e in arg]\n+        s = ', '.join(items)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            # Ensure singleton tuples include a trailing comma: (x,)\n+            s += ','\n+        return left + s + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..6a64041 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -956,12 +956,17 @@ def _recursive_to_string(doprint, arg):\n         return doprint(arg)\n     elif iterable(arg):\n         if isinstance(arg, list):\n-            left, right = \"[]\"\n+            # Lists are printed with standard Python list syntax\n+            return \"[\" + ', '.join(_recursive_to_string(doprint, e) for e in arg) + \"]\"\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            # Tuples need a trailing comma when they have a single element\n+            elems = [_recursive_to_string(doprint, e) for e in arg]\n+            if len(arg) == 1:\n+                return \"(\" + elems[0] + \",)\"\n+            else:\n+                return \"(\" + ', '.join(elems) + \")\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..5104eaf 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -958,10 +958,12 @@ def _recursive_to_string(doprint, arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n         elif isinstance(arg, tuple):\n+            if len(arg) == 1:\n+                return \"(\" + _recursive_to_string(doprint, arg[0]) + \",)\"\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        return left + ', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..9fdb5c6 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -956,12 +956,16 @@ def _recursive_to_string(doprint, arg):\n         return doprint(arg)\n     elif iterable(arg):\n         if isinstance(arg, list):\n-            left, right = \"[]\"\n+            elements = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return '[' + elements + ']'\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            elements = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            # For a single-element tuple, Python requires a trailing comma\n+            if len(arg) == 1:\n+                elements += ','\n+            return '(' + elements + ')'\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..ee1908b 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -956,12 +956,17 @@ def _recursive_to_string(doprint, arg):\n         return doprint(arg)\n     elif iterable(arg):\n         if isinstance(arg, list):\n-            left, right = \"[]\"\n+            items = [_recursive_to_string(doprint, e) for e in arg]\n+            return \"[\" + ', '.join(items) + \"]\"\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            items = [_recursive_to_string(doprint, e) for e in arg]\n+            if len(arg) == 1:\n+                # Single-element tuple must include a trailing comma\n+                return \"(\" + items[0] + \",)\"\n+            else:\n+                return \"(\" + ', '.join(items) + \")\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..98a752a 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,16 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            add_trailing_comma = False\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            add_trailing_comma = (len(arg) == 1)\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        items_str = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if add_trailing_comma and items_str:\n+            items_str += ','\n+        return left + items_str + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..5ed7fbb 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,16 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + inner + right\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            if len(arg) == 1:\n+                inner += ','\n+            return left + inner + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..984d41e 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,11 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        items_str = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        # In Python a one-element tuple requires a trailing comma: (1,)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            items_str += ','\n+        return left + items_str + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "sympy/utilities/lambdify.py": [
          "\nfunction: _recursive_to_string\nline: 964"
        ]
      },
      "patches": [
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..480b48b 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -956,12 +956,16 @@ def _recursive_to_string(doprint, arg):\n         return doprint(arg)\n     elif iterable(arg):\n         if isinstance(arg, list):\n-            left, right = \"[]\"\n+            opener, closer = '[', ']'\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            opener, closer = '(', ')'\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            # Ensure 1-element tuples are printed with a trailing comma\n+            inner += ','\n+        return opener + inner + closer\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..e54ac47 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,11 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        items = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        # Ensure single-element tuples are represented with a trailing comma\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            items += ','\n+        return left + items + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..95ae384 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,16 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            return left + ', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            # Ensure singleton tuples are correctly represented with a trailing comma\n+            if len(arg) == 1:\n+                elem_str = _recursive_to_string(doprint, arg[0])\n+                return \"(\" + elem_str + \",)\"\n+            else:\n+                return \"(\" + ', '.join(_recursive_to_string(doprint, e) for e in arg) + \")\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..74d0082 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,15 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            content = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            content = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            if len(arg) == 1:\n+                content += ','\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        return left + content + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..c1def02 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,17 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            items = [_recursive_to_string(doprint, e) for e in arg]\n+            return left + ', '.join(items) + right\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            items = [_recursive_to_string(doprint, e) for e in arg]\n+            if len(arg) == 1:\n+                # Ensure single-element tuples are represented with a trailing comma\n+                return '(' + items[0] + ',)'\n+            else:\n+                return '(' + ', '.join(items) + ')'\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..b7aa1d7 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            inner += ','\n+        return left + inner + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..788da19 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,17 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + inner + right\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            # For a single-element tuple, ensure the trailing comma is present\n+            if len(arg) == 1:\n+                inner += ','\n+            return left + inner + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..fef4deb 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,11 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        # Ensure single-element tuples include the trailing comma for valid Python syntax\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            inner = inner + ','\n+        return left + inner + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..50ae107 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        items_str = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            items_str += ','\n+        return left + items_str + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..b7aa1d7 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            inner += ','\n+        return left + inner + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "sympy/utilities/lambdify.py": [
          "\nfunction: _recursive_to_string\nline: 959\nline: 960\nline: 961\nline: 964"
        ]
      },
      "patches": [
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..bcebc81 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        elems = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            return \"(\" + elems + \",)\"\n+        return left + elems + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..ac5b2c1 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,15 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            if len(arg) == 1:\n+                inner += ','\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        return left + inner + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..50ae107 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        items_str = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            items_str += ','\n+        return left + items_str + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..8c3f119 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        elements = [_recursive_to_string(doprint, e) for e in arg]\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            return \"(\" + elements[0] + \",)\"\n+        return left + ', '.join(elements) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..7f36744 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,12 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        # Build inner string for iterable elements\n+        inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        # Ensure Python singleton tuples have a trailing comma: (x,) not (x)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            inner += ','\n+        return left + inner + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..5d20191 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,17 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + inner + right\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            # Ensure correct Python syntax for a 1-element tuple: (elem,)\n+            if len(arg) == 1:\n+                inner += ','\n+            return left + inner + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..b7aa1d7 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            inner += ','\n+        return left + inner + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..9f06230 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,18 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            content = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + content + right\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            if len(arg) == 1:\n+                # Ensure single-element tuples include the trailing comma\n+                content = _recursive_to_string(doprint, arg[0]) + \",\"\n+            else:\n+                content = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + content + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..e35fb8b 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,17 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + body + right\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            # Ensure singleton tuples are printed with a trailing comma\n+            if len(arg) == 1:\n+                body += \",\"\n+            return left + body + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..a8a7dd7 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,16 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            # Ensure a trailing comma for one-element tuples to preserve tuple semantics\n+            if len(arg) == 1:\n+                body += ','\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        return left + body + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "sympy/utilities/lambdify.py": [
          "\nfunction: _recursive_to_string\nline: 961\nline: 964"
        ]
      },
      "patches": [
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..111c720 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,16 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            return left + ', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            if len(arg) == 1:\n+                inner = _recursive_to_string(doprint, arg[0])\n+                return \"(\" + inner + \",)\"\n+            else:\n+                left, right = \"()\"\n+                return left + ', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..4136c32 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,17 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            items = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + items + right\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            items = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            # Ensure single-element tuples are printed with a trailing comma\n+            if len(arg) == 1:\n+                items += ','\n+            return left + items + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..6758f9f 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,16 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + body + right\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            if len(arg) == 1:\n+                body += ','\n+            return left + body + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..a23ea32 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,16 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            inner = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            if len(arg) == 1:\n+                # Python syntax for a 1-element tuple requires a trailing comma\n+                inner += \",\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        return left + inner + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..a5e5e1b 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,11 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        items = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        # Ensure a single-element tuple has a trailing comma: (x,)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            items += ','\n+        return left + items + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..08b2388 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -956,12 +956,16 @@ def _recursive_to_string(doprint, arg):\n         return doprint(arg)\n     elif iterable(arg):\n         if isinstance(arg, list):\n-            left, right = \"[]\"\n+            elements = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return '[' + elements + ']'\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            elements = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            if len(arg) == 1:\n+                return '(' + elements + ',)'\n+            else:\n+                return '(' + elements + ')'\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..f664537 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -961,7 +961,10 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"()\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n+        body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+        if isinstance(arg, tuple) and len(arg) == 1:\n+            body = body + \",\"\n+        return left + body + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..3308836 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,17 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + body + right\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            # Respect Python's syntax for single-element tuples: trailing comma required.\n+            if len(arg) == 1:\n+                return '(' + _recursive_to_string(doprint, arg[0]) + ',)'\n+            else:\n+                body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+                return '(' + body + ')'\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..82b5666 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -956,12 +956,18 @@ def _recursive_to_string(doprint, arg):\n         return doprint(arg)\n     elif iterable(arg):\n         if isinstance(arg, list):\n-            left, right = \"[]\"\n+            # Lists use normal Python list syntax\n+            return \"[\" + \", \".join(_recursive_to_string(doprint, e) for e in arg) + \"]\"\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            # Tuples need a trailing comma when they have a single element\n+            if len(arg) == 0:\n+                return \"()\"\n+            elif len(arg) == 1:\n+                return \"(\" + _recursive_to_string(doprint, arg[0]) + \",)\"\n+            else:\n+                return \"(\" + \", \".join(_recursive_to_string(doprint, e) for e in arg) + \")\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n",
        "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..5bb000d 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -957,11 +957,17 @@ def _recursive_to_string(doprint, arg):\n     elif iterable(arg):\n         if isinstance(arg, list):\n             left, right = \"[]\"\n+            body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+            return left + body + right\n         elif isinstance(arg, tuple):\n-            left, right = \"()\"\n+            # Ensure singleton tuples are represented with a trailing comma: (x,)\n+            if len(arg) == 1:\n+                return \"(\" + _recursive_to_string(doprint, arg[0]) + \",)\"\n+            else:\n+                body = ', '.join(_recursive_to_string(doprint, e) for e in arg)\n+                return \"(\" + body + \")\"\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n-        return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n     elif isinstance(arg, str):\n         return arg\n     else:\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/sympy/utilities/lambdify.py b/sympy/utilities/lambdify.py\nindex 9dd6fe4..1062ede 100644\n--- a/sympy/utilities/lambdify.py\n+++ b/sympy/utilities/lambdify.py\n@@ -959,6 +959,9 @@ def _recursive_to_string(doprint, arg):\n             left, right = \"[]\"\n         elif isinstance(arg, tuple):\n             left, right = \"()\"\n+            # Ensure single-element tuples are printed with a trailing comma\n+            if len(arg) == 1:\n+                return left + _recursive_to_string(doprint, arg[0]) + ',' + right\n         else:\n             raise NotImplementedError(\"unhandled type: %s, %s\" % (type(arg), arg))\n         return left +', '.join(_recursive_to_string(doprint, e) for e in arg) + right\n",
  "7_resolved": true
}