{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__e97ac668",
  "original_id": "django__django-11790",
  "1_model_selected_files": [
    "django/contrib/auth/forms.py"
  ],
  "2_embedding_selected_files": [
    "django/contrib/auth/migrations/0008_alter_user_username_max_length.py",
    "django/contrib/auth/migrations/0009_alter_user_last_name_max_length.py",
    "django/contrib/auth/migrations/0004_alter_user_username_opts.py",
    "django/contrib/auth/migrations/0003_alter_user_email_max_length.py",
    "django/contrib/auth/migrations/0010_alter_group_name_max_length.py",
    "django/contrib/auth/forms.py",
    "django/contrib/auth/migrations/0002_alter_permission_name_max_length.py",
    "django/contrib/auth/migrations/0007_alter_validators_add_error_messages.py",
    "django/contrib/auth/validators.py",
    "django/forms/__init__.py",
    "django/contrib/auth/password_validation.py",
    "django/contrib/auth/migrations/0005_alter_user_last_login_null.py",
    "django/contrib/auth/views.py",
    "django/forms/fields.py",
    "django/contrib/auth/models.py",
    "django/contrib/auth/handlers/__init__.py",
    "django/contrib/auth/base_user.py",
    "django/contrib/auth/middleware.py",
    "django/contrib/auth/handlers/modwsgi.py",
    "django/forms/models.py",
    "django/contrib/auth/backends.py",
    "django/contrib/auth/migrations/__init__.py",
    "django/contrib/auth/management/commands/changepassword.py",
    "django/contrib/auth/management/commands/createsuperuser.py",
    "django/contrib/auth/apps.py",
    "django/forms/widgets.py",
    "django/contrib/auth/__init__.py",
    "django/contrib/auth/urls.py",
    "django/forms/boundfield.py",
    "django/contrib/auth/migrations/0001_initial.py",
    "django/contrib/auth/admin.py",
    "django/forms/forms.py",
    "django/contrib/auth/mixins.py",
    "django/contrib/auth/signals.py",
    "django/forms/utils.py",
    "django/contrib/__init__.py",
    "django/contrib/auth/checks.py",
    "django/contrib/auth/hashers.py",
    "django/contrib/auth/migrations/0006_require_contenttypes_0002.py",
    "django/forms/renderers.py",
    "django/contrib/auth/management/__init__.py",
    "django/contrib/auth/tokens.py",
    "django/contrib/auth/context_processors.py",
    "django/forms/formsets.py",
    "django/contrib/auth/decorators.py",
    "django/setup.py",
    "django/contrib/auth/migrations/0011_update_proxy_permissions.py",
    "django/__init__.py",
    "django/__main__.py",
    "django/shortcuts.py"
  ],
  "3_final_combined_files": [
    "django/contrib/auth/forms.py",
    "django/contrib/auth/migrations/0008_alter_user_username_max_length.py",
    "django/contrib/auth/migrations/0009_alter_user_last_name_max_length.py",
    "django/contrib/auth/migrations/0004_alter_user_username_opts.py"
  ],
  "4_related_elements": {
    "django/contrib/auth/forms.py": [
      "variable: UserModel\nfunction: UsernameField.__init__\nfunction: UsernameField.widget_attrs\nclass: AuthenticationForm\nclass: UserCreationForm\nclass: UserChangeForm"
    ],
    "django/contrib/auth/migrations/0008_alter_user_username_max_length.py": [
      ""
    ],
    "django/contrib/auth/migrations/0009_alter_user_last_name_max_length.py": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "django/contrib/auth/forms.py": [
          "\nfunction: UsernameField.widget_attrs"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..adfbf11 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,26 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        # Ensure the maxlength attribute is set for username inputs even when\n+        # max_length isn't explicitly provided (e.g., in AuthenticationForm).\n+        if 'maxlength' not in attrs and self.max_length is None:\n+            try:\n+                from django.contrib.auth import get_user_model\n+                UserModel = get_user_model()\n+                username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n+                max_length = getattr(username_field, 'max_length', None)\n+                if max_length is not None:\n+                    attrs['maxlength'] = max_length\n+            except Exception:\n+                # If the app registry isn't ready or any other issue occurs,\n+                # silently skip setting maxlength.\n+                pass\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..3fa77c8 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,22 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n+        attrs = {\n             **super().widget_attrs(widget),\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n         }\n+        # Ensure maxlength is set based on the user model if not provided by the field.\n+        if 'maxlength' not in attrs:\n+            try:\n+                from django.contrib.auth import get_user_model\n+                UserModel = get_user_model()\n+                max_length = UserModel._meta.get_field(UserModel.USERNAME_FIELD).max_length\n+            except Exception:\n+                max_length = None\n+            if max_length is not None:\n+                attrs['maxlength'] = str(max_length)\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..6a7842e 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,14 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        if self.max_length is not None and 'maxlength' not in attrs:\n+            attrs['maxlength'] = str(self.max_length)\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..b3d1209 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,23 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        # Include standard attrs and ensure maxlength is set based on the user model.\n+        attrs = super().widget_attrs(widget)\n+        if 'maxlength' not in attrs:\n+            from django.contrib.auth import get_user_model\n+            try:\n+                UserModel = get_user_model()\n+                username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n+                max_len = getattr(username_field, 'max_length', None)\n+            except Exception:\n+                max_len = None\n+            if max_len is not None and not isinstance(widget, forms.Textarea):\n+                attrs['maxlength'] = str(max_len)\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..882ed43 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -58,12 +58,20 @@ class ReadOnlyPasswordHashField(forms.Field):\n \n \n class UsernameField(forms.CharField):\n+    def __init__(self, *args, **kwargs):\n+        # Default to the USERNAME_FIELD's max_length so the widget renders maxlength.\n+        UserModel = get_user_model()\n+        username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n+        kwargs.setdefault('max_length', username_field.max_length)\n+        super().__init__(*args, **kwargs)\n+\n     def to_python(self, value):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n+        attrs = super().widget_attrs(widget)\n         return {\n-            **super().widget_attrs(widget),\n+            **attrs,\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n         }\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..032e268 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -58,6 +58,15 @@ class ReadOnlyPasswordHashField(forms.Field):\n \n \n class UsernameField(forms.CharField):\n+    def __init__(self, *args, **kwargs):\n+        # Ensure the username input renders a maxlength based on the user model.\n+        # Default to the installed User model's USERNAME_FIELD max_length if not explicitly provided.\n+        from django.contrib.auth import get_user_model\n+        user_model = get_user_model()\n+        username_field = user_model._meta.get_field(user_model.USERNAME_FIELD)\n+        kwargs.setdefault('max_length', username_field.max_length)\n+        super().__init__(*args, **kwargs)\n+\n     def to_python(self, value):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..fa3bd58 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -58,15 +58,36 @@ class ReadOnlyPasswordHashField(forms.Field):\n \n \n class UsernameField(forms.CharField):\n+    def __init__(self, *args, **kwargs):\n+        # Set a sensible default max_length from the user model if not explicitly provided.\n+        if 'max_length' not in kwargs or kwargs['max_length'] is None:\n+            try:\n+                from django.contrib.auth import get_user_model\n+                UserModel = get_user_model()\n+                kwargs['max_length'] = UserModel._meta.get_field(UserModel.USERNAME_FIELD).max_length\n+            except Exception:\n+                # If the user model isn't available, leave max_length unset.\n+                pass\n+        super().__init__(*args, **kwargs)\n+\n     def to_python(self, value):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n-            'autocapitalize': 'none',\n-            'autocomplete': 'username',\n-        }\n+        attrs = super().widget_attrs(widget)\n+        # Ensure maxlength is set even if not provided by the superclass.\n+        if 'maxlength' not in attrs and self.max_length is None:\n+            try:\n+                from django.contrib.auth import get_user_model\n+                UserModel = get_user_model()\n+                max_length = UserModel._meta.get_field(UserModel.USERNAME_FIELD).max_length\n+            except Exception:\n+                max_length = None\n+            if max_length is not None:\n+                attrs['maxlength'] = str(max_length)\n+        attrs['autocapitalize'] = 'none'\n+        attrs['autocomplete'] = 'username'\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..b530749 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,29 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        # Start with parent attrs (includes maxlength when max_length is set).\n+        attrs = super().widget_attrs(widget)\n+\n+        # Ensure maxlength is present for username input even if max_length\n+        # wasn't explicitly specified on the field (e.g., in AuthenticationForm).\n+        if 'maxlength' not in attrs:\n+            try:\n+                from django.contrib.auth import get_user_model\n+                user_model = get_user_model()\n+                username_field = user_model._meta.get_field(user_model.USERNAME_FIELD)\n+                max_length = getattr(username_field, 'max_length', None)\n+            except Exception:\n+                max_length = None\n+            if max_length is not None:\n+                input_type = getattr(widget, 'input_type', None)\n+                if input_type in ('text', 'email', 'password') or isinstance(widget, forms.TextInput):\n+                    attrs['maxlength'] = str(max_length)\n+\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..ae3aa55 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -58,6 +58,17 @@ class ReadOnlyPasswordHashField(forms.Field):\n \n \n class UsernameField(forms.CharField):\n+    def __init__(self, *args, **kwargs):\n+        # Default max_length to the user model's USERNAME_FIELD max_length so\n+        # that widgets (e.g., TextInput) receive the proper maxlength attribute.\n+        from django.contrib.auth import get_user_model\n+        UserModel = get_user_model()\n+        kwargs.setdefault(\n+            'max_length',\n+            UserModel._meta.get_field(UserModel.USERNAME_FIELD).max_length\n+        )\n+        super().__init__(*args, **kwargs)\n+\n     def to_python(self, value):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..5212e71 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,25 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        # Ensure maxlength is set for the username input. If the field itself\n+        # doesn't have a max_length, fall back to the user model's setting.\n+        if 'maxlength' not in attrs:\n+            try:\n+                from django.contrib.auth import get_user_model\n+                UserModel = get_user_model()\n+                model_username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n+                max_length = getattr(model_username_field, 'max_length', None)\n+                if max_length:\n+                    attrs['maxlength'] = str(max_length)\n+            except Exception:\n+                # If anything goes wrong, silently ignore and leave maxlength unset.\n+                pass\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "django/contrib/auth/forms.py": [
          "\nfunction: UsernameField.widget_attrs\nfunction: AuthenticationForm.__init__"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..bed9b61 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,15 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        # Ensure maxlength is preserved for the username input.\n+        if self.max_length is not None and 'maxlength' not in attrs:\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..0ec41d4 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,13 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n-            'autocapitalize': 'none',\n-            'autocomplete': 'username',\n-        }\n+        attrs = super().widget_attrs(widget)\n+        # Ensure the maxlength HTML attribute is present so browsers enforce it.\n+        if self.max_length is not None and 'maxlength' not in attrs:\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs['autocapitalize'] = 'none'\n+        attrs['autocomplete'] = 'username'\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..452a291 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,13 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n-            'autocapitalize': 'none',\n-            'autocomplete': 'username',\n-        }\n+        attrs = super().widget_attrs(widget)\n+        # Ensure the maxlength attribute is set on the username input.\n+        if self.max_length is not None:\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs['autocapitalize'] = 'none'\n+        attrs['autocomplete'] = 'username'\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..69c5fa6 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,15 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        # Ensure maxlength is present on the username input.\n+        if self.max_length is not None:\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..f87d180 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,14 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n-            'autocapitalize': 'none',\n-            'autocomplete': 'username',\n-        }\n+        attrs = super().widget_attrs(widget)\n+        # Ensure the maxlength HTML attribute is set from the field's max_length.\n+        if self.max_length is not None:\n+            attrs.setdefault('maxlength', str(self.max_length))\n+        # Preserve additional attributes for username inputs.\n+        attrs['autocapitalize'] = 'none'\n+        attrs['autocomplete'] = 'username'\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..02f0acf 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the username input renders with the correct maxlength attribute.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..d4bdaba 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,16 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        # Ensure the username field renders a maxlength attribute based on the\n+        # field's max_length, even if it's set dynamically in AuthenticationForm.__init__.\n+        if self.max_length is not None:\n+            attrs.setdefault('maxlength', str(self.max_length))\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..295214d 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the HTML maxlength attribute is set on the username input.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..b208f09 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -191,7 +191,10 @@ class AuthenticationForm(forms.Form):\n \n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n-        self.fields['username'].max_length = self.username_field.max_length or 254\n+        max_length = self.username_field.max_length or 254\n+        self.fields['username'].max_length = max_length\n+        # Ensure the HTML maxlength attribute is set on the username input.\n+        self.fields['username'].widget.attrs['maxlength'] = max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..e610687 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the HTML maxlength attribute is rendered on the widget.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "django/contrib/auth/forms.py": [
          "\nfunction: UsernameField.widget_attrs\nfunction: AuthenticationForm.__init__"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..666fce6 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -191,7 +191,10 @@ class AuthenticationForm(forms.Form):\n \n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n-        self.fields['username'].max_length = self.username_field.max_length or 254\n+        max_length = getattr(self.username_field, 'max_length', None) or 254\n+        self.fields['username'].max_length = max_length\n+        # Ensure the HTML maxlength attribute is set on the widget.\n+        self.fields['username'].widget.attrs['maxlength'] = str(max_length)\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..e2203ae 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,16 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        # Ensure maxlength is always set based on the field's max_length,\n+        # regardless of the specific input widget type (e.g., EmailInput).\n+        attrs = super().widget_attrs(widget)\n+        if self.max_length is not None:\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..b3a0a57 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,13 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n-            'autocapitalize': 'none',\n-            'autocomplete': 'username',\n-        }\n+        attrs = super().widget_attrs(widget)\n+        # Ensure maxlength is included in the rendered HTML.\n+        if getattr(self, 'max_length', None) is not None:\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs['autocapitalize'] = 'none'\n+        attrs['autocomplete'] = 'username'\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..36e8bca 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,14 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        if self.max_length is not None:\n+            attrs.setdefault('maxlength', str(self.max_length))\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..928d38a 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,16 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n-            'autocapitalize': 'none',\n-            'autocomplete': 'username',\n-        }\n+        # Start with the base attributes (e.g., maxlength from CharField).\n+        attrs = super().widget_attrs(widget)\n+        # Ensure maxlength is present based on the field's max_length.\n+        # Some callers adjust max_length after initialization, so compute it here.\n+        if self.max_length is not None and 'maxlength' not in attrs:\n+            attrs['maxlength'] = str(self.max_length)\n+        # Authentication UX attributes.\n+        attrs['autocapitalize'] = 'none'\n+        attrs['autocomplete'] = 'username'\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..fc88099 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,13 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n-            'autocapitalize': 'none',\n-            'autocomplete': 'username',\n-        }\n+        attrs = super().widget_attrs(widget)\n+        # Ensure the maxlength HTML attribute is set based on the field's max_length.\n+        if self.max_length is not None and not isinstance(widget, forms.Textarea):\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs['autocapitalize'] = 'none'\n+        attrs['autocomplete'] = 'username'\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..aace26d 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,7 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..2ac5526 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -62,11 +62,15 @@ class UsernameField(forms.CharField):\n         return unicodedata.normalize('NFKC', super().to_python(value))\n \n     def widget_attrs(self, widget):\n-        return {\n-            **super().widget_attrs(widget),\n+        attrs = super().widget_attrs(widget)\n+        # Preserve maxlength from CharField so the HTML attribute is rendered.\n+        if self.max_length is not None and 'maxlength' not in attrs:\n+            attrs['maxlength'] = str(self.max_length)\n+        attrs.update({\n             'autocapitalize': 'none',\n             'autocomplete': 'username',\n-        }\n+        })\n+        return attrs\n \n \n class UserCreationForm(forms.ModelForm):\n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..1b37336 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the widget renders the maxlength HTML attribute.\n+        self.fields['username'].widget.attrs['maxlength'] = str(self.fields['username'].max_length)\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "django/contrib/auth/forms.py": [
          "\nfunction: AuthenticationForm.__init__\nline: 194"
        ]
      },
      "patches": [
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..5cb993f 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the widget renders the maxlength HTML attribute.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..a1a666a 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -191,7 +191,9 @@ class AuthenticationForm(forms.Form):\n \n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n-        self.fields['username'].max_length = self.username_field.max_length or 254\n+        max_length = self.username_field.max_length or 254\n+        self.fields['username'].max_length = max_length\n+        self.fields['username'].widget.attrs['maxlength'] = max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..051f8c2 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the maxlength HTML attribute is set on the widget.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..aace26d 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,7 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..528b1e0 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -191,7 +191,10 @@ class AuthenticationForm(forms.Form):\n \n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n-        self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the underlying widget also receives the maxlength attribute.\n+        max_length = self.username_field.max_length or 254\n+        self.fields['username'].max_length = max_length\n+        self.fields['username'].widget.attrs.setdefault('maxlength', str(max_length))\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..470f08b 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the widget renders with the corresponding HTML maxlength attribute.\n+        self.fields['username'].widget.attrs['maxlength'] = str(self.fields['username'].max_length)\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..59f7055 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the HTML maxlength attribute is set on the username widget.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..8772fd0 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the maxlength HTML attribute is rendered on the input widget.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..af897da 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the HTML maxlength attribute is set on the widget.\n+        self.fields['username'].widget.attrs['maxlength'] = str(self.fields['username'].max_length)\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
        "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..a7df2b5 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,8 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        # Ensure the maxlength HTML attribute is rendered.\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/django/contrib/auth/forms.py b/django/contrib/auth/forms.py\nindex 4d607f6..aace26d 100644\n--- a/django/contrib/auth/forms.py\n+++ b/django/contrib/auth/forms.py\n@@ -192,6 +192,7 @@ class AuthenticationForm(forms.Form):\n         # Set the max length and label for the \"username\" field.\n         self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n         self.fields['username'].max_length = self.username_field.max_length or 254\n+        self.fields['username'].widget.attrs['maxlength'] = self.fields['username'].max_length\n         if self.fields['username'].label is None:\n             self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n",
  "7_resolved": true
}