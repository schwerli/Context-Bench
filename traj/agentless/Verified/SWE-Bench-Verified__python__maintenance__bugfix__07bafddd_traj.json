{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__07bafddd",
  "original_id": "scikit-learn__scikit-learn-26323",
  "1_model_selected_files": [
    "sklearn/compose/_column_transformer.py",
    "sklearn/utils/_set_output.py"
  ],
  "2_embedding_selected_files": [
    "sklearn/utils/estimator_checks.py",
    "sklearn/compose/_column_transformer.py",
    "sklearn/utils/_set_output.py",
    "sklearn/kernel_approximation.py",
    "sklearn/pipeline.py",
    "sklearn/base.py",
    "sklearn/compose/__init__.py",
    "sklearn/utils/_testing.py",
    "sklearn/compose/_target.py",
    "sklearn/multioutput.py",
    "sklearn/isotonic.py",
    "sklearn/multiclass.py",
    "sklearn/utils/validation.py",
    "sklearn/utils/_pprint.py",
    "sklearn/utils/_show_versions.py",
    "sklearn/utils/optimize.py",
    "sklearn/calibration.py",
    "sklearn/utils/fixes.py",
    "scikit-learn/setup.py",
    "sklearn/utils/__init__.py",
    "sklearn/conftest.py",
    "sklearn/utils/_estimator_html_repr.py",
    "sklearn/__init__.py",
    "sklearn/utils/_joblib.py",
    "sklearn/utils/multiclass.py",
    "scikit-learn/conftest.py",
    "sklearn/naive_bayes.py",
    "sklearn/exceptions.py",
    "sklearn/utils/_param_validation.py",
    "sklearn/utils/discovery.py",
    "sklearn/utils/_mocking.py",
    "sklearn/utils/metaestimators.py",
    "sklearn/utils/sparsefuncs.py",
    "sklearn/utils/_response.py",
    "sklearn/dummy.py"
  ],
  "3_final_combined_files": [
    "sklearn/compose/_column_transformer.py",
    "sklearn/utils/_set_output.py",
    "sklearn/utils/estimator_checks.py"
  ],
  "4_related_elements": {
    "sklearn/compose/_column_transformer.py": [
      "function: ColumnTransformer.set_output\nfunction: ColumnTransformer._fit_transform\nfunction: ColumnTransformer.transform\nfunction: ColumnTransformer._hstack\nfunction: ColumnTransformer._validate_remainder\nfunction: ColumnTransformer._validate_output\nfunction: ColumnTransformer.get_feature_names_out\nfunction: ColumnTransformer._get_feature_name_out_for_transformer\nfunction: ColumnTransformer._add_prefix_for_feature_names_out\nfunction: ColumnTransformer._iter\nfunction: ColumnTransformer._update_fitted_transformers"
    ],
    "sklearn/utils/_set_output.py": [
      "function: _safe_set_output\nclass: _SetOutputMixin\nfunction: _get_output_config\nfunction: _wrap_data_with_container"
    ],
    "sklearn/utils/estimator_checks.py": [
      "function: check_set_output_transform\nfunction: check_set_output_transform_pandas\nfunction: check_global_ouptut_transform_pandas\nfunction: _output_from_fit_transform\nfunction: _check_generated_dataframe"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "sklearn/compose/_column_transformer.py": [
          "\nfunction: ColumnTransformer.set_output\nline: 295\nline: 303"
        ]
      },
      "patches": [
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..919c4c0 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the estimator specified in `remainder` if any.\n \n         Parameters\n         ----------\n@@ -293,14 +293,21 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+        # Collect all sub-transformers (specified and fitted)\n+        transformers_to_update = []\n+        for tlist in (self.transformers, getattr(self, \"transformers_\", [])):\n+            for _, trans, _ in tlist:\n+                if trans not in {\"passthrough\", \"drop\"}:\n+                    transformers_to_update.append(trans)\n+\n+        # Include the remainder estimator (pre-fit and post-fit) if any\n+        for attr in (\"remainder\", \"remainder_\"):\n+            if hasattr(self, attr):\n+                rem = getattr(self, attr)\n+                if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                    transformers_to_update.append(rem)\n+\n+        for trans in transformers_to_update:\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..c373275 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` if it is an estimator.\n \n         Parameters\n         ----------\n@@ -293,13 +293,19 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n+        # Collect transformers from declared and fitted transformers\n+        transformers = []\n+        for _, trans, _ in chain(\n+            self.transformers, getattr(self, \"transformers_\", [])\n+        ):\n+            if trans not in {\"passthrough\", \"drop\"}:\n+                transformers.append(trans)\n+\n+        # Include remainder (pre- and post-fit) if it is an estimator\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                transformers.append(rem)\n+\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..370da9d 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,13 +293,23 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        transformers = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n+        ]\n+\n+        # Also apply set_output to remainder and remainder_ if they are estimators\n+        remainder = getattr(self, \"remainder\", \"drop\")\n+        if remainder not in {\"passthrough\", \"drop\"}:\n+            transformers.append(remainder)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", \"drop\")\n+        if remainder_fitted not in {\"passthrough\", \"drop\"}:\n+            transformers.append(remainder_fitted)\n+\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..8b75d75 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` estimator when applicable.\n \n         Parameters\n         ----------\n@@ -303,6 +303,11 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set the output on the `remainder` if it is an estimator\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem not in (None, \"passthrough\", \"drop\"):\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..ee69392 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,11 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also apply set_output to the remainder if it's an estimator\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem not in (None, \"passthrough\", \"drop\"):\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..fcf8c25 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,9 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and also the estimator provided in `remainder` (and `remainder_`\n+        after fitting) when applicable.\n \n         Parameters\n         ----------\n@@ -293,14 +294,22 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+\n+        # Collect all relevant estimators, including remainder if it is an estimator.\n+        estimators = []\n+        for _, trans, _ in chain(self.transformers, getattr(self, \"transformers_\", [])):\n+            if trans not in {\"passthrough\", \"drop\"}:\n+                estimators.append(trans)\n+\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            estimators.append(remainder)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted not in {\"passthrough\", \"drop\", None} and remainder_fitted is not remainder:\n+            estimators.append(remainder_fitted)\n+\n+        for trans in estimators:\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..6d94f41 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the estimator set in `remainder` (if any).\n \n         Parameters\n         ----------\n@@ -303,6 +303,16 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set the output on the remainder transformer when it's an estimator.\n+        remainder_candidates = [\n+            getattr(self, \"remainder\", None),\n+            getattr(self, \"remainder_\", None),\n+            getattr(self, \"_remainder\", None),\n+        ]\n+        for rem in remainder_candidates:\n+            if rem not in {\"passthrough\", \"drop\", None}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..cceeeeb 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,11 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set output on the remainder estimator, if any\n+        remainder = getattr(self, \"remainder\", \"drop\")\n+        if remainder not in {\"passthrough\", \"drop\"}:\n+            _safe_set_output(remainder, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..43eaa62 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `remainder`, and their fitted counterparts (`transformers_`, `remainder_`).\n \n         Parameters\n         ----------\n@@ -293,6 +293,7 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n+        # Collect all sub-estimators, including remainder if it's an estimator\n         transformers = (\n             trans\n             for _, trans, _ in chain(\n@@ -300,7 +301,12 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n         )\n-        for trans in transformers:\n+        remainders = [\n+            rem\n+            for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None))\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}\n+        ]\n+        for trans in chain(transformers, remainders):\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..9f5faa9 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,13 +293,24 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        # Set output on all sub-transformers, including a possible estimator in `remainder`\n+        transformers = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n+        ]\n+\n+        # Also handle the `remainder` if it's an estimator (both pre- and post-fit)\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in (None, \"passthrough\", \"drop\"):\n+            _safe_set_output(remainder, transform=transform)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted not in (None, \"passthrough\", \"drop\"):\n+            transformers.append(remainder_fitted)\n+\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "sklearn/compose/_column_transformer.py": [
          "\nfunction: ColumnTransformer.set_output"
        ]
      },
      "patches": [
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..07b0b6a 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,21 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+\n+        # Collect all sub-transformers, including remainder (if estimator) and their fitted counterparts\n+        iterable = chain(self.transformers, getattr(self, \"transformers_\", []))\n+\n+        # include remainder specified at init if it is an estimator\n+        if hasattr(self, \"remainder\") and self.remainder not in {\"passthrough\", \"drop\"}:\n+            iterable = chain(iterable, [(\"_remainder\", self.remainder, None)])\n+\n+        # include fitted remainder_ if present and is an estimator\n+        if hasattr(self, \"remainder_\") and self.remainder_ not in {\"passthrough\", \"drop\"}:\n+            iterable = chain(iterable, [(\"_remainder\", self.remainder_, None)])\n+\n+        for _, trans, _ in iterable:\n+            if trans in {\"passthrough\", \"drop\"}:\n+                continue\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..622a141 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` estimator (if any).\n \n         Parameters\n         ----------\n@@ -303,6 +303,11 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set output on the remainder if it is an estimator\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..8117d60 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,13 +293,22 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        # Collect transformers from both the configured (transformers)\n+        # and the fitted (transformers_) lists.\n+        transformers = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n+        ]\n+        # Also include the remainder estimator if present, both pre-fit and post-fit.\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            transformers.append(remainder)\n+        remainder_ = getattr(self, \"remainder_\", None)\n+        if remainder_ not in {\"passthrough\", \"drop\", None}:\n+            transformers.append(remainder_)\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..08f4207 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,15 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set the output on the remainder if it is an estimator\n+        remainder_candidates = (\n+            getattr(self, \"remainder\", None),\n+            getattr(self, \"remainder_\", None),\n+        )\n+        for rem in remainder_candidates:\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..10e01d2 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,15 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set output on the remainder estimator(s), if present\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            _safe_set_output(remainder, transform=transform)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted not in {\"passthrough\", \"drop\", None}:\n+            _safe_set_output(remainder_fitted, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..fa0469e 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,15 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also propagate to remainder and remainder_ when they are estimators\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            _safe_set_output(remainder, transform=transform)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted not in {\"passthrough\", \"drop\", None}:\n+            _safe_set_output(remainder_fitted, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..a38fcab 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the estimator provided in `remainder` (if any).\n \n         Parameters\n         ----------\n@@ -300,9 +300,20 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n         )\n+\n+        # Set output for all column-specific transformers\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set output for the remainder if it is an estimator\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\"} and remainder is not None:\n+            _safe_set_output(remainder, transform=transform)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted not in {\"passthrough\", \"drop\"} and remainder_fitted is not None:\n+            _safe_set_output(remainder_fitted, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..babee4b 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,28 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        # Collect sub-transformers (pre- and post-fit)\n+        estimators = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+        ]\n+        # Also include remainder estimator if specified (pre- and post-fit)\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                estimators.append(rem)\n+        # Deduplicate in case the same instance appears twice\n+        seen_ids = set()\n+        unique_estimators = []\n+        for est in estimators:\n+            est_id = id(est)\n+            if est_id in seen_ids:\n+                continue\n+            seen_ids.add(est_id)\n+            unique_estimators.append(est)\n+        for trans in unique_estimators:\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..3fc059c 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` (if it is an estimator).\n \n         Parameters\n         ----------\n@@ -293,14 +293,30 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        # Collect estimators from explicit transformers\n+        transformers = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n+        ]\n+\n+        # Include the remainder if it is an estimator (both pre- and post-fit)\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                transformers.append(rem)\n+\n+        # Deduplicate while preserving order\n+        seen_ids = set()\n+        unique_transformers = []\n         for trans in transformers:\n+            ident = id(trans)\n+            if ident not in seen_ids:\n+                seen_ids.add(ident)\n+                unique_transformers.append(trans)\n+\n+        for trans in unique_transformers:\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..56588d7 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the estimator specified in `remainder` (if any).\n \n         Parameters\n         ----------\n@@ -293,13 +293,27 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        # Collect explicit transformers (pre- and post-fit), excluding passthrough/drop.\n+        transformers = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n+        ]\n+\n+        # Include the remainder estimator if it is an estimator (pre-fit).\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in (None, \"passthrough\", \"drop\"):\n+            transformers.append(remainder)\n+\n+        # Include the fitted remainder estimator if present (post-fit).\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted not in (None, \"passthrough\", \"drop\"):\n+            # Avoid duplicates if both refer to the same object.\n+            if remainder_fitted is not remainder:\n+                transformers.append(remainder_fitted)\n+\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "sklearn/compose/_column_transformer.py": [
          "\nfunction: ColumnTransformer.set_output\nline: 295\nline: 296\nline: 297\nline: 298\nline: 299\nline: 300\nline: 301\nline: 302\nline: 303\nline: 304\nline: 305"
        ]
      },
      "patches": [
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..d4572b3 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,15 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set the output for the remainder if it is an estimator\n+        remainders = (\n+            rem\n+            for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None))\n+            if rem not in (None, \"passthrough\", \"drop\")\n+        )\n+        for rem in remainders:\n+            _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..c975047 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,20 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        transformers_iter = (\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n         )\n-        for trans in transformers:\n+        # Also handle remainder if it is an estimator\n+        remainder_estimators = [\n+            r\n+            for r in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None))\n+            if r is not None and r not in {\"passthrough\", \"drop\"}\n+        ]\n+        for trans in chain(transformers_iter, remainder_estimators):\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..54ecac6 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -277,6 +277,7 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n \n         Calling `set_output` will set the output of all estimators in `transformers`\n         and `transformers_`.\n+        It also propagates the configuration to the `remainder` estimator when applicable.\n \n         Parameters\n         ----------\n@@ -303,6 +304,16 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also propagate to remainder (both pre-fit and post-fit) if it's an estimator\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            _safe_set_output(remainder, transform=transform)\n+\n+        if hasattr(self, \"remainder_\"):\n+            remainder_fitted = self.remainder_\n+            if remainder_fitted not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(remainder_fitted, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..d3a7e44 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the estimator provided in `remainder` (if any).\n \n         Parameters\n         ----------\n@@ -303,6 +303,12 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set output for the remainder if it's an estimator, both before and after fit.\n+        for rem_attr in (\"remainder\", \"remainder_\"):\n+            rem = getattr(self, rem_attr, None)\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..409f730 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` estimator when applicable.\n \n         Parameters\n         ----------\n@@ -303,6 +303,12 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also propagate output configuration to the remainder transformer, if any.\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is None or rem in {\"passthrough\", \"drop\"}:\n+                continue\n+            _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..a59d6c3 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` estimator (if any).\n \n         Parameters\n         ----------\n@@ -293,15 +293,32 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        # Collect estimators from the column-specific transformers\n+        estimators = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n-            _safe_set_output(trans, transform=transform)\n+        ]\n+\n+        # Also include the remainder estimator (pre- and post-fit), if applicable\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            estimators.append(remainder)\n+\n+        remainder_ = getattr(self, \"remainder_\", None)\n+        if remainder_ not in {\"passthrough\", \"drop\", None}:\n+            estimators.append(remainder_)\n+\n+        # Avoid calling set_output on the same estimator multiple times\n+        seen = set()\n+        for est in estimators:\n+            est_id = id(est)\n+            if est_id in seen:\n+                continue\n+            seen.add(est_id)\n+            _safe_set_output(est, transform=transform)\n \n         return self\n \n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..774c6cb 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,11 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also handle the remainder if it is an estimator (both pre- and post-fit)\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..1a69c97 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -277,6 +277,7 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n \n         Calling `set_output` will set the output of all estimators in `transformers`\n         and `transformers_`.\n+        It also applies to the `remainder` transformer when it is an estimator.\n \n         Parameters\n         ----------\n@@ -303,6 +304,11 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set the output on the remainder transformer if it is an estimator\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..e8cb0ae 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,29 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n+\n+        def _is_estimator(trans):\n+            return trans is not None and trans not in {\"passthrough\", \"drop\"}\n+\n+        # Collect transformers from specified and fitted transformers\n         transformers = (\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n-            if trans not in {\"passthrough\", \"drop\"}\n+            if _is_estimator(trans)\n         )\n-        for trans in transformers:\n+\n+        # Also include remainder and remainder_ if they are estimators\n+        remainder_estimators = []\n+        remainder = getattr(self, \"remainder\", None)\n+        if _is_estimator(remainder):\n+            remainder_estimators.append(remainder)\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if _is_estimator(remainder_fitted):\n+            remainder_estimators.append(remainder_fitted)\n+\n+        for trans in chain(transformers, remainder_estimators):\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..90203bc 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,16 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also propagate to the remainder if it is an estimator\n+        remainder_candidates = []\n+        if hasattr(self, \"remainder\"):\n+            remainder_candidates.append(self.remainder)\n+        if hasattr(self, \"remainder_\"):\n+            remainder_candidates.append(self.remainder_)\n+        for rem in remainder_candidates:\n+            if rem not in (None, \"passthrough\", \"drop\"):\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "sklearn/compose/_column_transformer.py": [
          "\nfunction: ColumnTransformer.set_output\nline: 295\nline: 296\nline: 297\nline: 298\nline: 299\nline: 300\nline: 301\nline: 302\nline: 303\nline: 304\nline: 305"
        ]
      },
      "patches": [
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..1ccbd3c 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the estimator defined in `remainder` if any.\n \n         Parameters\n         ----------\n@@ -293,15 +293,25 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n+\n+        # Apply output configuration to explicit transformers (both before and after fit)\n+        transformers_iter = chain(\n+            (trans for _, trans, _ in self.transformers),\n+            (trans for _, trans, _ in getattr(self, \"transformers_\", [])),\n         )\n-        for trans in transformers:\n-            _safe_set_output(trans, transform=transform)\n+        for trans in transformers_iter:\n+            if trans not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(trans, transform=transform)\n+\n+        # Apply output configuration to the remainder if it is an estimator\n+        remainder_candidates = []\n+        if hasattr(self, \"remainder\"):\n+            remainder_candidates.append(self.remainder)\n+        if hasattr(self, \"remainder_\"):\n+            remainder_candidates.append(self.remainder_)\n+        for rem in remainder_candidates:\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n \n         return self\n \n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..7d3296a 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` estimator if provided.\n \n         Parameters\n         ----------\n@@ -303,6 +303,11 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set output on the remainder if it's an estimator\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..c0a1134 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -277,6 +277,7 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n \n         Calling `set_output` will set the output of all estimators in `transformers`\n         and `transformers_`.\n+        It will also set the output of the estimator specified in `remainder`, if any.\n \n         Parameters\n         ----------\n@@ -303,6 +304,15 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Ensure remainder estimator's output is set as well (both pre-fit and post-fit)\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in (None, \"passthrough\", \"drop\"):\n+            _safe_set_output(remainder, transform=transform)\n+\n+        fitted_remainder = getattr(self, \"_remainder\", None)\n+        if fitted_remainder not in (None, \"passthrough\", \"drop\"):\n+            _safe_set_output(fitted_remainder, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..8976f76 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` transformer if it is an estimator.\n \n         Parameters\n         ----------\n@@ -293,13 +293,22 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n+\n+        # Collect sub-transformers\n+        transformers = []\n+        for _, trans, _ in chain(self.transformers, getattr(self, \"transformers_\", [])):\n+            if trans not in {\"passthrough\", \"drop\"}:\n+                transformers.append(trans)\n+\n+        # Include remainder (pre-/post-fit) if it is an estimator\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            transformers.append(remainder)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted not in {\"passthrough\", \"drop\", None}:\n+            transformers.append(remainder_fitted)\n+\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..73ad982 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,20 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+\n+        # Collect all estimators from explicitly defined transformers (pre/post-fit)\n+        estimators = []\n+        for _, trans, _ in chain(self.transformers, getattr(self, \"transformers_\", [])):\n+            if trans not in {\"passthrough\", \"drop\"}:\n+                estimators.append(trans)\n+\n+        # Also include the remainder estimator (pre/post-fit) if applicable\n+        for attr in (\"remainder\", \"remainder_\"):\n+            rem = getattr(self, attr, None)\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                estimators.append(rem)\n+\n+        for trans in estimators:\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..4955e3c 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,12 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also propagate output configuration to the remainder transformer\n+        # when it is an estimator (and not \"passthrough\" or \"drop\").\n+        for rem in (getattr(self, \"remainder\", None), getattr(self, \"remainder_\", None)):\n+            if rem is not None and rem not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(rem, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..8831d10 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -275,8 +275,8 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n     def set_output(self, *, transform=None):\n         \"\"\"Set the output container when `\"transform\"` and `\"fit_transform\"` are called.\n \n-        Calling `set_output` will set the output of all estimators in `transformers`\n-        and `transformers_`.\n+        Calling `set_output` will set the output of all estimators in `transformers`,\n+        `transformers_`, and the `remainder` estimator (if any).\n \n         Parameters\n         ----------\n@@ -303,6 +303,16 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Ensure remainder transformer also receives output configuration\n+        # when it is an estimator (both pre- and post-fit).\n+        remainder_candidates = [\n+            getattr(self, \"remainder\", None),\n+            getattr(self, \"remainder_\", None),\n+        ]\n+        for remainder in remainder_candidates:\n+            if remainder is not None and remainder not in {\"passthrough\", \"drop\"}:\n+                _safe_set_output(remainder, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..3f6d3c1 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -303,6 +303,15 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n+        # Also set output for the remainder if it is an estimator\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder is not None and remainder not in {\"passthrough\", \"drop\"}:\n+            _safe_set_output(remainder, transform=transform)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted is not None and remainder_fitted not in {\"passthrough\", \"drop\"}:\n+            _safe_set_output(remainder_fitted, transform=transform)\n+\n         return self\n \n     def get_params(self, deep=True):\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..96612b8 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,33 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        estimators = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+        ]\n+\n+        # Also configure the remainder, if it's an estimator\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder is not None and remainder not in {\"passthrough\", \"drop\"}:\n+            estimators.append(remainder)\n+\n+        remainder_fitted = getattr(self, \"remainder_\", None)\n+        if remainder_fitted is not None and remainder_fitted not in {\"passthrough\", \"drop\"}:\n+            estimators.append(remainder_fitted)\n+\n+        # Deduplicate estimators (in case remainder and remainder_ point to same object)\n+        seen = set()\n+        unique_estimators = []\n+        for est in estimators:\n+            if id(est) in seen:\n+                continue\n+            seen.add(id(est))\n+            unique_estimators.append(est)\n+\n+        for trans in unique_estimators:\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
        "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..837111e 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,13 +293,18 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n+        # Collect all sub-transformers, including `remainder` if it is an estimator.\n+        transformers = [\n             trans\n             for _, trans, _ in chain(\n                 self.transformers, getattr(self, \"transformers_\", [])\n             )\n             if trans not in {\"passthrough\", \"drop\"}\n-        )\n+        ]\n+        remainder = getattr(self, \"remainder\", None)\n+        if remainder not in {\"passthrough\", \"drop\", None}:\n+            transformers.append(remainder)\n+\n         for trans in transformers:\n             _safe_set_output(trans, transform=transform)\n \n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/sklearn/compose/_column_transformer.py b/sklearn/compose/_column_transformer.py\nindex eec24f1..07b0b6a 100644\n--- a/sklearn/compose/_column_transformer.py\n+++ b/sklearn/compose/_column_transformer.py\n@@ -293,14 +293,21 @@ class ColumnTransformer(TransformerMixin, _BaseComposition):\n             Estimator instance.\n         \"\"\"\n         super().set_output(transform=transform)\n-        transformers = (\n-            trans\n-            for _, trans, _ in chain(\n-                self.transformers, getattr(self, \"transformers_\", [])\n-            )\n-            if trans not in {\"passthrough\", \"drop\"}\n-        )\n-        for trans in transformers:\n+\n+        # Collect all sub-transformers, including remainder (if estimator) and their fitted counterparts\n+        iterable = chain(self.transformers, getattr(self, \"transformers_\", []))\n+\n+        # include remainder specified at init if it is an estimator\n+        if hasattr(self, \"remainder\") and self.remainder not in {\"passthrough\", \"drop\"}:\n+            iterable = chain(iterable, [(\"_remainder\", self.remainder, None)])\n+\n+        # include fitted remainder_ if present and is an estimator\n+        if hasattr(self, \"remainder_\") and self.remainder_ not in {\"passthrough\", \"drop\"}:\n+            iterable = chain(iterable, [(\"_remainder\", self.remainder_, None)])\n+\n+        for _, trans, _ in iterable:\n+            if trans in {\"passthrough\", \"drop\"}:\n+                continue\n             _safe_set_output(trans, transform=transform)\n \n         return self\n",
  "7_resolved": true
}