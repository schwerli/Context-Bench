{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__5d44a351",
  "original_id": "matplotlib__matplotlib-20676",
  "1_model_selected_files": [
    "lib/matplotlib/widgets.py",
    "lib/matplotlib/axes/_base.py"
  ],
  "2_embedding_selected_files": [
    "lib/matplotlib/widgets.py",
    "lib/mpl_toolkits/axisartist/floating_axes.py",
    "lib/mpl_toolkits/mplot3d/axis3d.py",
    "lib/matplotlib/rcsetup.py",
    "lib/matplotlib/axis.py",
    "lib/matplotlib/pyplot.py",
    "lib/mpl_toolkits/axisartist/axislines.py",
    "lib/matplotlib/axes/_axes.py",
    "lib/matplotlib/axes/_base.py",
    "lib/matplotlib/ticker.py",
    "lib/mpl_toolkits/axisartist/parasite_axes.py",
    "lib/mpl_toolkits/axes_grid/parasite_axes.py",
    "lib/mpl_toolkits/axes_grid1/axes_grid.py",
    "lib/mpl_toolkits/axisartist/grid_helper_curvelinear.py",
    "lib/matplotlib/_constrained_layout.py",
    "lib/mpl_toolkits/axes_grid1/parasite_axes.py",
    "lib/mpl_toolkits/axisartist/__init__.py",
    "lib/matplotlib/axes/_subplots.py",
    "lib/mpl_toolkits/mplot3d/axes3d.py",
    "lib/mpl_toolkits/axes_grid1/mpl_axes.py",
    "lib/mpl_toolkits/axes_grid1/__init__.py",
    "lib/matplotlib/axes/_secondary_axes.py",
    "lib/mpl_toolkits/axes_grid1/axes_divider.py",
    "lib/matplotlib/spines.py",
    "lib/matplotlib/figure.py",
    "lib/matplotlib/colorbar.py",
    "lib/matplotlib/_layoutgrid.py",
    "lib/mpl_toolkits/axes_grid/inset_locator.py",
    "lib/mpl_toolkits/axisartist/axis_artist.py",
    "lib/mpl_toolkits/axes_grid/axes_divider.py",
    "lib/matplotlib/projections/polar.py",
    "lib/matplotlib/axes/__init__.py"
  ],
  "3_final_combined_files": [
    "lib/matplotlib/widgets.py",
    "lib/matplotlib/axes/_base.py",
    "lib/mpl_toolkits/axisartist/floating_axes.py",
    "lib/mpl_toolkits/mplot3d/axis3d.py"
  ],
  "4_related_elements": {
    "lib/matplotlib/widgets.py": [
      "class: SpanSelector\nclass: _SelectorWidget\nclass: ToolLineHandles\nclass: ToolHandles\nclass: RectangleSelector"
    ],
    "lib/matplotlib/axes/_base.py": [
      "function: _AxesBase.add_line\nfunction: _AxesBase.add_patch\nfunction: _AxesBase.add_collection\nfunction: _AxesBase._update_line_limits\nfunction: _AxesBase._update_patch_limits\nfunction: _AxesBase.update_datalim\nfunction: _AxesBase.relim\nfunction: _AxesBase.autoscale_view\nfunction: _AxesBase.margins\nfunction: _AxesBase.set_xmargin\nfunction: _AxesBase.set_xlim\nfunction: _AxesBase.get_xlim\nfunction: _AxesBase.set_autoscalex_on\nfunction: _AxesBase.get_autoscalex_on\nvariable: _AxesBase.use_sticky_edges"
    ],
    "lib/mpl_toolkits/axisartist/floating_axes.py": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "lib/matplotlib/widgets.py": [
          "\nfunction: SpanSelector.new_axes\nline: 2147"
        ]
      },
      "patches": [
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..be1126d 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,18 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            # Initialize the rectangle's data-coordinate to the current xlim\n+            # to avoid autoscaling to include 0 on creation.\n+            x0 = ax.get_xlim()[0]\n+            y0 = 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            # Initialize the rectangle's data-coordinate to the current ylim\n+            # to avoid autoscaling to include 0 on creation.\n+            x0 = 0\n+            y0 = ax.get_ylim()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..6829135 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            xy = (ax.get_xbound()[0], 0)\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            xy = (0, ax.get_ybound()[0])\n+        self._rect = Rectangle(xy, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..105fd75 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,13 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            pos = (ax.get_xlim()[0], 0)  # initialize in data space to current lower xlim\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            pos = (0, ax.get_ylim()[0])  # initialize in data space to current lower ylim\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle(pos, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..849b4ea 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            x0, y0 = ax.get_xlim()[0], 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            x0, y0 = 0, ax.get_ylim()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..849b4ea 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            x0, y0 = ax.get_xlim()[0], 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            x0, y0 = 0, ax.get_ylim()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..d3e23ce 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            x0, y0 = ax.get_xbound()[0], 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            x0, y0 = 0, ax.get_ybound()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..47dd8db 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,17 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            # Initialize the rectangle within current x bounds to avoid\n+            # expanding limits to include 0.\n+            x0, y0 = ax.get_xbound()[0], 0\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            # Initialize the rectangle within current y bounds to avoid\n+            # expanding limits to include 0.\n+            x0, y0 = 0, ax.get_ybound()[0]\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..0f5f086 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            start = (ax.get_xlim()[0], 0)\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            start = (0, ax.get_ylim()[0])\n+        self._rect = Rectangle(start, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..16dd621 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            xy = (ax.get_xlim()[0], 0)\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            xy = (0, ax.get_ylim()[0])\n+        self._rect = Rectangle(xy, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..02cb03f 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,17 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            # Initialize at current x-axis lower bound to avoid expanding limits to include 0.\n+            x0 = ax.get_xbound()[0]\n+            y0 = 0\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            x0 = 0\n+            # Initialize at current y-axis lower bound to avoid expanding limits to include 0.\n+            y0 = ax.get_ybound()[0]\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "lib/matplotlib/widgets.py": [
          "\nfunction: SpanSelector.new_axes\nfunction: ToolLineHandles.__init__"
        ],
        "lib/matplotlib/axes/_base.py": [
          "\nfunction: Axes.add_line\nfunction: Axes.add_patch"
        ]
      },
      "patches": [
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..a96aa12 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2366,10 +2366,15 @@ class ToolLineHandles:\n             line_props = {}\n         line_props.update({'visible': False, 'animated': useblit})\n \n-        line_fun = ax.axvline if self.direction == 'horizontal' else ax.axhline\n+        if self.direction == 'horizontal':\n+            line_fun = ax.axvline\n+            scale_kwargs = {'scalex': False}\n+        else:\n+            line_fun = ax.axhline\n+            scale_kwargs = {'scaley': False}\n         self._line_props = line_props\n \n-        self.artists = [line_fun(p, **line_props) for p in positions]\n+        self.artists = [line_fun(p, **scale_kwargs, **line_props) for p in positions]\n \n     @property\n     def positions(self):\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..0e2718f 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2365,8 +2365,13 @@ class ToolLineHandles:\n         if line_props is None:\n             line_props = {}\n         line_props.update({'visible': False, 'animated': useblit})\n-\n-        line_fun = ax.axvline if self.direction == 'horizontal' else ax.axhline\n+        # Prevent initial, invisible handles from changing the data limits.\n+        if self.direction == 'horizontal':\n+            line_props.setdefault('scalex', False)\n+            line_fun = ax.axvline\n+        else:\n+            line_props.setdefault('scaley', False)\n+            line_fun = ax.axhline\n         self._line_props = line_props\n \n         self.artists = [line_fun(p, **line_props) for p in positions]\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..7c5c64c 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,13 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            x0, y0 = float('nan'), 0\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            x0, y0 = 0, float('nan')\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n@@ -2369,7 +2371,11 @@ class ToolLineHandles:\n         line_fun = ax.axvline if self.direction == 'horizontal' else ax.axhline\n         self._line_props = line_props\n \n-        self.artists = [line_fun(p, **line_props) for p in positions]\n+        # Avoid affecting data limits on initialization by placing handles at NaN\n+        # when they are initially invisible. Positions will be updated when shown.\n+        initial_visible = line_props.get('visible', True)\n+        init_pos = [p if initial_visible else float('nan') for p in positions]\n+        self.artists = [line_fun(pv, **line_props) for pv in init_pos]\n \n     @property\n     def positions(self):\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..0f669b0 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            pos = (ax.get_xbound()[0], 0)\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            pos = (0, ax.get_ybound()[0])\n+        self._rect = Rectangle(pos, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..3a66f7a 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2156,7 +2156,13 @@ class SpanSelector(_SelectorWidget):\n             self.artists.append(self._rect)\n \n     def _setup_edge_handle(self, props):\n-        self._edge_handles = ToolLineHandles(self.ax, self.extents,\n+        # Initialize edge handles without forcing axis limits to include 0\n+        positions = self.extents\n+        if positions is None or positions == (0, 0):\n+            positions = (self.ax.get_xbound()\n+                         if self.direction == 'horizontal'\n+                         else self.ax.get_ybound())\n+        self._edge_handles = ToolLineHandles(self.ax, positions,\n                                              direction=self.direction,\n                                              line_props=props,\n                                              useblit=self.useblit)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..093dfb2 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2366,10 +2366,25 @@ class ToolLineHandles:\n             line_props = {}\n         line_props.update({'visible': False, 'animated': useblit})\n \n-        line_fun = ax.axvline if self.direction == 'horizontal' else ax.axhline\n         self._line_props = line_props\n \n-        self.artists = [line_fun(p, **line_props) for p in positions]\n+        # Create handle lines without triggering autoscaling on the data axes.\n+        # Using axvline/axhline would update the data limits (e.g., to include 0)\n+        # upon creation. Instead, build lines with appropriate axis transforms\n+        # and add them with scalex/scaley disabled.\n+        self.artists = []\n+        if self.direction == 'horizontal':\n+            trans = ax.get_xaxis_transform()\n+            for p in positions:\n+                line, = ax.plot([p, p], [0, 1], transform=trans,\n+                                scalex=False, scaley=False, **line_props)\n+                self.artists.append(line)\n+        else:\n+            trans = ax.get_yaxis_transform()\n+            for p in positions:\n+                line, = ax.plot([0, 1], [p, p], transform=trans,\n+                                scalex=False, scaley=False, **line_props)\n+                self.artists.append(line)\n \n     @property\n     def positions(self):\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..eadf6de 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,15 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            x0 = min(ax.get_xbound())\n+            xy = (x0, 0)\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            y0 = min(ax.get_ybound())\n+            xy = (0, y0)\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle(xy, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n@@ -2369,7 +2373,19 @@ class ToolLineHandles:\n         line_fun = ax.axvline if self.direction == 'horizontal' else ax.axhline\n         self._line_props = line_props\n \n-        self.artists = [line_fun(p, **line_props) for p in positions]\n+        # Clamp initial handle positions to current view limits to avoid\n+        # expanding data limits (e.g., to include 0) when creating invisible handles.\n+        if self.direction == 'horizontal':\n+            lo, hi = ax.get_xbound()\n+        else:\n+            lo, hi = ax.get_ybound()\n+        lo, hi = (lo, hi) if lo <= hi else (hi, lo)\n+\n+        clamped_positions = [\n+            (p if (p is not None and lo <= p <= hi) else lo)\n+            for p in positions\n+        ]\n+        self.artists = [line_fun(p, **line_props) for p in clamped_positions]\n \n     @property\n     def positions(self):\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..c35a258 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,17 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            x0 = ax.get_xlim()[0]\n+            y0 = 0\n             w, h = 0, 1\n+            xy = (x0, y0)\n         else:\n             trans = ax.get_yaxis_transform()\n+            x0 = 0\n+            y0 = ax.get_ylim()[0]\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            xy = (x0, y0)\n+        self._rect = Rectangle(xy, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n@@ -2371,6 +2377,17 @@ class ToolLineHandles:\n \n         self.artists = [line_fun(p, **line_props) for p in positions]\n \n+        # Prevent initial, invisible handles from affecting data limits by\n+        # setting their data to NaN until they are first positioned/displayed.\n+        if not any(line.get_visible() for line in self.artists):\n+            nan = float(\"nan\")\n+            if self.direction == 'horizontal':\n+                for line in self.artists:\n+                    line.set_xdata([nan, nan])\n+            else:\n+                for line in self.artists:\n+                    line.set_ydata([nan, nan])\n+\n     @property\n     def positions(self):\n         \"\"\"Positions of the handle in data coordinates.\"\"\"\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..dbf6ecc 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,14 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            # Initialize rectangle at current x-limits to avoid autoscaling to 0.\n+            x0, y0 = ax.get_xlim()[0], 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            # Initialize rectangle at current y-limits to avoid autoscaling to 0.\n+            x0, y0 = 0, ax.get_ylim()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n@@ -2156,7 +2160,12 @@ class SpanSelector(_SelectorWidget):\n             self.artists.append(self._rect)\n \n     def _setup_edge_handle(self, props):\n-        self._edge_handles = ToolLineHandles(self.ax, self.extents,\n+        # Initialize handles at current view limits to avoid autoscaling to 0.\n+        if self.direction == 'horizontal':\n+            positions = self.ax.get_xlim()\n+        else:\n+            positions = self.ax.get_ylim()\n+        self._edge_handles = ToolLineHandles(self.ax, positions,\n                                              direction=self.direction,\n                                              line_props=props,\n                                              useblit=self.useblit)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..445c7e0 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,16 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            # Initialize the degenerate rectangle within current x bounds to\n+            # avoid expanding limits to include 0.\n+            xy = (ax.get_xbound()[0], 0)\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            # Initialize the degenerate rectangle within current y bounds to\n+            # avoid expanding limits to include 0.\n+            xy = (0, ax.get_ybound()[0])\n+        self._rect = Rectangle(xy, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n@@ -2156,7 +2162,18 @@ class SpanSelector(_SelectorWidget):\n             self.artists.append(self._rect)\n \n     def _setup_edge_handle(self, props):\n-        self._edge_handles = ToolLineHandles(self.ax, self.extents,\n+        # Initialize handle positions within current view limits if there is no\n+        # existing selection, to avoid expanding limits to include 0.\n+        positions = self.extents\n+        try:\n+            no_selection = positions[0] == positions[1] == 0\n+        except Exception:\n+            no_selection = False\n+        if no_selection:\n+            positions = (self.ax.get_xbound() if self.direction == 'horizontal'\n+                         else self.ax.get_ybound())\n+\n+        self._edge_handles = ToolLineHandles(self.ax, positions,\n                                              direction=self.direction,\n                                              line_props=props,\n                                              useblit=self.useblit)\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "lib/matplotlib/axes/_base.py": [
          "\nfunction: Axes.add_line\nline: 2283\nfunction: Axes.add_patch\nline: 2360"
        ],
        "lib/matplotlib/widgets.py": [
          "\nfunction: ToolLineHandles.__init__\nline: 2372"
        ]
      },
      "patches": [
        "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 9906dc5..cce6a5d 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -2280,7 +2280,10 @@ class _AxesBase(martist.Artist):\n         if line.get_clip_path() is None:\n             line.set_clip_path(self.patch)\n \n-        self._update_line_limits(line)\n+        # Only update data limits for visible lines. Invisible tool handles\n+        # (e.g., from interactive widgets) should not affect autoscaling.\n+        if line.get_visible():\n+            self._update_line_limits(line)\n         if not line.get_label():\n             line.set_label(f'_child{len(self._children)}')\n         self._children.append(line)\n",
        "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 9906dc5..ea6a4a9 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -2280,7 +2280,10 @@ class _AxesBase(martist.Artist):\n         if line.get_clip_path() is None:\n             line.set_clip_path(self.patch)\n \n-        self._update_line_limits(line)\n+        # Only update data limits for visible lines; invisible auxiliary lines\n+        # (e.g., widget handles) should not affect autoscale or expand limits.\n+        if line.get_visible():\n+            self._update_line_limits(line)\n         if not line.get_label():\n             line.set_label(f'_child{len(self._children)}')\n         self._children.append(line)\n",
        "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 9906dc5..ea35c65 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -2280,7 +2280,10 @@ class _AxesBase(martist.Artist):\n         if line.get_clip_path() is None:\n             line.set_clip_path(self.patch)\n \n-        self._update_line_limits(line)\n+        # Only update data limits for visible lines; invisible artists should not\n+        # affect autoscaling (e.g., interactive widget handles initialized off-screen).\n+        if line.get_visible():\n+            self._update_line_limits(line)\n         if not line.get_label():\n             line.set_label(f'_child{len(self._children)}')\n         self._children.append(line)\n",
        "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 9906dc5..d11b170 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -2280,7 +2280,10 @@ class _AxesBase(martist.Artist):\n         if line.get_clip_path() is None:\n             line.set_clip_path(self.patch)\n \n-        self._update_line_limits(line)\n+        # Only update data limits for visible lines; invisible helper artists\n+        # (e.g., widget handles) should not affect autoscaling.\n+        if line.get_visible():\n+            self._update_line_limits(line)\n         if not line.get_label():\n             line.set_label(f'_child{len(self._children)}')\n         self._children.append(line)\n",
        "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 9906dc5..4bf0c5a 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -2280,7 +2280,10 @@ class _AxesBase(martist.Artist):\n         if line.get_clip_path() is None:\n             line.set_clip_path(self.patch)\n \n-        self._update_line_limits(line)\n+        # Only update data limits for visible lines to avoid invisible control\n+        # artists (e.g., widget handles) from affecting autoscaling.\n+        if line.get_visible():\n+            self._update_line_limits(line)\n         if not line.get_label():\n             line.set_label(f'_child{len(self._children)}')\n         self._children.append(line)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..ee74d5e 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2381,6 +2381,7 @@ class ToolLineHandles:\n     def direction(self):\n         \"\"\"Direction of the handle: 'vertical' or 'horizontal'.\"\"\"\n         return self._direction\n+        return self._direction\n \n     def set_data(self, positions):\n         \"\"\"\n",
        "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 9906dc5..ac28d7c 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -2280,7 +2280,10 @@ class _AxesBase(martist.Artist):\n         if line.get_clip_path() is None:\n             line.set_clip_path(self.patch)\n \n-        self._update_line_limits(line)\n+        # Only update data limits for visible lines; invisible helper lines\n+        # (e.g., widget handles) should not affect autoscaling.\n+        if line.get_visible():\n+            self._update_line_limits(line)\n         if not line.get_label():\n             line.set_label(f'_child{len(self._children)}')\n         self._children.append(line)\n",
        "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex 9906dc5..c727e6a 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -2280,7 +2280,10 @@ class _AxesBase(martist.Artist):\n         if line.get_clip_path() is None:\n             line.set_clip_path(self.patch)\n \n-        self._update_line_limits(line)\n+        # Only update limits for visible lines; invisible helpers (e.g., widget\n+        # handles) should not affect autoscaling.\n+        if line.get_visible():\n+            self._update_line_limits(line)\n         if not line.get_label():\n             line.set_label(f'_child{len(self._children)}')\n         self._children.append(line)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..1d513eb 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2366,7 +2366,7 @@ class ToolLineHandles:\n             line_props = {}\n         line_props.update({'visible': False, 'animated': useblit})\n \n-        line_fun = ax.axvline if self.direction == 'horizontal' else ax.axhline\n+        line_fun = ax.axhline if self.direction == 'horizontal' else ax.axvline\n         self._line_props = line_props\n \n         self.artists = [line_fun(p, **line_props) for p in positions]\n@@ -2374,7 +2374,7 @@ class ToolLineHandles:\n     @property\n     def positions(self):\n         \"\"\"Positions of the handle in data coordinates.\"\"\"\n-        method = 'get_xdata' if self.direction == 'horizontal' else 'get_ydata'\n+        method = 'get_ydata' if self.direction == 'horizontal' else 'get_xdata'\n         return [getattr(line, method)()[0] for line in self.artists]\n \n     @property\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..1d513eb 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2366,7 +2366,7 @@ class ToolLineHandles:\n             line_props = {}\n         line_props.update({'visible': False, 'animated': useblit})\n \n-        line_fun = ax.axvline if self.direction == 'horizontal' else ax.axhline\n+        line_fun = ax.axhline if self.direction == 'horizontal' else ax.axvline\n         self._line_props = line_props\n \n         self.artists = [line_fun(p, **line_props) for p in positions]\n@@ -2374,7 +2374,7 @@ class ToolLineHandles:\n     @property\n     def positions(self):\n         \"\"\"Positions of the handle in data coordinates.\"\"\"\n-        method = 'get_xdata' if self.direction == 'horizontal' else 'get_ydata'\n+        method = 'get_ydata' if self.direction == 'horizontal' else 'get_xdata'\n         return [getattr(line, method)()[0] for line in self.artists]\n \n     @property\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "lib/matplotlib/widgets.py": [
          "\nfunction: SpanSelector.new_axes\nline: 2147"
        ]
      },
      "patches": [
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..849b4ea 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            x0, y0 = ax.get_xlim()[0], 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            x0, y0 = 0, ax.get_ylim()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..6f37965 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,15 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            x0 = ax.get_xlim()[0]\n+            y0 = 0\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            x0 = 0\n+            y0 = ax.get_ylim()[0]\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..2a11972 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,13 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            x0, y0 = min(ax.get_xlim()), 0\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            x0, y0 = 0, min(ax.get_ylim())\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..7f824d2 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,13 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            # Initialize with NaN in the data coordinate to avoid autoscaling to 0.\n+            start_x, start_y = float('nan'), 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            start_x, start_y = 0, float('nan')\n+        self._rect = Rectangle((start_x, start_y), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..dfedd5d 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2144,7 +2144,13 @@ class SpanSelector(_SelectorWidget):\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        # Initialize the rectangle at the current data limit along the\n+        # data-dependent axis to avoid expanding the axes limits (e.g., to 0).\n+        if self.direction == 'horizontal':\n+            start_coord = (self.ax.get_xlim()[0], 0)\n+        else:\n+            start_coord = (0, self.ax.get_ylim()[0])\n+        self._rect = Rectangle(start_coord, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..88406a0 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,21 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            # Initialize the rectangle anchored at the current x-lower limit to\n+            # avoid expanding the x-limits to include 0 on creation.\n+            x0 = ax.get_xlim()[0]\n+            y0 = 0\n             w, h = 0, 1\n+            xy = (x0, y0)\n         else:\n             trans = ax.get_yaxis_transform()\n+            # Initialize the rectangle anchored at the current y-lower limit to\n+            # avoid expanding the y-limits to include 0 on creation.\n+            x0 = 0\n+            y0 = ax.get_ylim()[0]\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            xy = (x0, y0)\n+        self._rect = Rectangle(xy, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..6fb708a 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,15 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            x0 = ax.get_xbound()[0]\n+            y0 = 0\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            x0 = 0\n+            y0 = ax.get_ybound()[0]\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..4ad6efb 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,14 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            x0 = ax.get_xlim()[0]\n+            xy = (x0, 0)\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            y0 = ax.get_ylim()[0]\n+            xy = (0, y0)\n+        self._rect = Rectangle(xy, w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..d3e23ce 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            x0, y0 = ax.get_xbound()[0], 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            x0, y0 = 0, ax.get_ybound()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
        "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..6fb708a 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2140,11 +2140,15 @@ class SpanSelector(_SelectorWidget):\n \n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n+            x0 = ax.get_xbound()[0]\n+            y0 = 0\n             w, h = 0, 1\n         else:\n             trans = ax.get_yaxis_transform()\n+            x0 = 0\n+            y0 = ax.get_ybound()[0]\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/lib/matplotlib/widgets.py b/lib/matplotlib/widgets.py\nindex a6bed3c..849b4ea 100644\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -2141,10 +2141,12 @@ class SpanSelector(_SelectorWidget):\n         if self.direction == 'horizontal':\n             trans = ax.get_xaxis_transform()\n             w, h = 0, 1\n+            x0, y0 = ax.get_xlim()[0], 0\n         else:\n             trans = ax.get_yaxis_transform()\n             w, h = 1, 0\n-        self._rect = Rectangle((0, 0), w, h,\n+            x0, y0 = 0, ax.get_ylim()[0]\n+        self._rect = Rectangle((x0, y0), w, h,\n                                transform=trans,\n                                visible=False,\n                                **self._rectprops)\n",
  "7_resolved": false
}