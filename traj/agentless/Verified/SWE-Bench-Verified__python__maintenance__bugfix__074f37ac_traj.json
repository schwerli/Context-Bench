{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__074f37ac",
  "original_id": "sympy__sympy-22714",
  "1_model_selected_files": [
    "sympy/geometry/point.py",
    "sympy/parsing/sympy_parser.py",
    "sympy/core/sympify.py"
  ],
  "2_embedding_selected_files": [
    "sympy/core/sympify.py",
    "sympy/parsing/sympy_parser.py",
    "sympy/core/function.py",
    "sympy/this.py",
    "sympy/parsing/ast_parser.py",
    "sympy/__init__.py",
    "sympy/core/numbers.py",
    "sympy/core/mul.py",
    "sympy/core/power.py",
    "sympy/core/__init__.py",
    "sympy/core/relational.py",
    "sympy/core/add.py",
    "sympy/core/expr.py",
    "sympy/geometry/point.py",
    "sympy/isympy.py",
    "sympy/core/benchmarks/bench_sympify.py",
    "sympy/core/evalf.py",
    "sympy/core/operations.py",
    "sympy/core/benchmarks/bench_expand.py",
    "sympy/parsing/__init__.py",
    "sympy/core/basic.py",
    "sympy/core/benchmarks/bench_assumptions.py",
    "sympy/parsing/autolev/_listener_autolev_antlr.py",
    "sympy/core/exprtools.py",
    "sympy/core/parameters.py",
    "sympy/parsing/sym_expr.py",
    "sympy/core/backend.py",
    "sympy/core/assumptions.py",
    "sympy/parsing/latex/__init__.py",
    "sympy/core/benchmarks/__init__.py",
    "sympy/geometry/__init__.py",
    "sympy/galgebra.py",
    "sympy/setup.py",
    "sympy/parsing/mathematica.py",
    "sympy/core/benchmarks/bench_arit.py",
    "sympy/parsing/latex/_parse_latex_antlr.py",
    "sympy/core/symbol.py",
    "sympy/release.py"
  ],
  "3_final_combined_files": [
    "sympy/parsing/sympy_parser.py",
    "sympy/core/sympify.py",
    "sympy/geometry/point.py",
    "sympy/core/function.py"
  ],
  "4_related_elements": {
    "sympy/parsing/sympy_parser.py": [
      "function: parse_expr\nfunction: eval_expr\nfunction: evaluateFalse\nclass: EvaluateFalseTransformer\nfunction: stringify_expr\nvariable: standard_transformations\nfunction: implicit_application\nfunction: implicit_multiplication_application\nclass: AppliedFunction"
    ],
    "sympy/core/sympify.py": [
      "function: sympify\nfunction: _sympify\nfunction: kernS\nclass: SympifyError\nvariable: converter"
    ],
    "sympy/geometry/point.py": [
      "class: Point\nclass: Point2D\nclass: Point3D"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "sympy/geometry/point.py": [
          "\nfunction: Point.__new__\nline: 155"
        ]
      },
      "patches": [
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..f884d30 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Use as_real_imag to test for imaginary parts without relying on evaluation,\n+        # so that global evaluate(False) does not cause false positives.\n+        if any(a.is_number and not a.as_real_imag()[1].is_zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..5f0737d 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,8 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Avoid relying on Python truthiness of SymPy expressions; ensure robust check\n+        if any(a.is_number and not im(a).is_zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..a2e3a31 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Only raise if the coordinate is known to have a non-zero imaginary part.\n+        # Using im(a) directly in a boolean context is unsafe when global evaluation\n+        # is disabled since it may not simplify to 0.\n+        if any(a.is_number and not im(a).equals(S.Zero) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..f7f7339 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Only forbid numeric coordinates that are not real. Avoid using im(a)\n+        # directly because under evaluate=False it may not simplify to 0 and\n+        # its truthiness can be ambiguous.\n+        if any(a.is_number and a.is_real is False for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..bee2689 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Avoid relying on truthiness of im(a) which may be unevaluated under evaluate(False)\n+        # Only reject when the imaginary part is explicitly nonzero for numeric inputs\n+        if any(a.is_number and (a.as_real_imag()[1].is_zero is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..67165b7 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Use as_real_imag to robustly detect non-zero imaginary parts\n+        # even when global evaluation is disabled.\n+        if any(a.is_number and a.as_real_imag()[1] for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..bc0399e 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Reject numeric coordinates with a non-zero imaginary part.\n+        # Using is_real avoids dependence on evaluation context (evaluate(False)).\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..b379464 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Only reject coordinates that are provably non-real.\n+        # Using im(a) here can depend on global evaluation settings,\n+        # so prefer the tri-state is_real predicate.\n+        if any(a.is_number and a.is_real is False for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..c6d0bfd 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Use as_real_imag to robustly detect nonzero imaginary parts.\n+        # Relying on truthiness of im(a) can fail under evaluate(False)\n+        # when Im does not evaluate to 0 for real numbers.\n+        if any(a.is_number and a.as_real_imag()[1] != 0 for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..817dd5e 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,12 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Only reject coordinates with a known nonzero imaginary part.\n+        # Using the truthiness of im(a) can incorrectly flag real numbers\n+        # when global evaluation is disabled, since Im(1) may not simplify\n+        # to 0 under evaluate(False) and would be truthy. Instead, check\n+        # the is_zero property explicitly.\n+        if any(a.is_number and (im(a).is_zero is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "sympy/geometry/point.py": [
          "\nclass: Point\nline: 155"
        ]
      },
      "patches": [
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..20527ae 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow coordinates with a nonzero imaginary component.\n+        # Using is_real avoids reliance on evaluation of im() under global evaluate=False.\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..dad7f9d 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Avoid relying on evaluation of im(a) under global evaluate(False).\n+        # Use is_real to detect non-real numeric coordinates.\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..929e93f 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Use as_real_imag to robustly detect non-zero imaginary parts even when\n+        # global evaluation is disabled. Relying on the truthiness of im(a) can\n+        # incorrectly trigger when evaluate=False keeps im(a) unevaluated.\n+        if any(a.is_number and a.as_real_imag()[1] != S.Zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..f63a736 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow numeric coordinates with a nonzero imaginary part.\n+        # Use as_real_imag to avoid dependence on the global evaluation setting.\n+        if any(a.is_number and a.as_real_imag()[1] != 0 for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..1287567 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Reject numeric coordinates with non-zero imaginary part.\n+        # Use as_real_imag(evaluate=False) to avoid relying on the truthiness\n+        # of unevaluated Im(...) when global evaluation is disabled.\n+        if any(a.is_number and a.as_real_imag(evaluate=False)[1] != S.Zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..9e083fe 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # For numeric coordinates, disallow a nonzero imaginary part.\n+        # Use as_real_imag to avoid relying on evaluation behaviour that can be disabled\n+        # by the global evaluate flag/context manager.\n+        if any(a.is_number and (a.as_real_imag()[1].is_zero is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..6c47bc3 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,7 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        if any(a.is_number and not a.is_real for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..8384095 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow complex (non-real) numeric coordinates.\n+        # Using is_real avoids dependence on evaluation of im(a) which can be\n+        # symbolic under evaluate(False) and incorrectly trigger this check.\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..219a759 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow numeric coordinates that are not real.\n+        # Using is_real avoids evaluation-dependent behavior of im().\n+        if any(a.is_number and a.is_real is False for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..f14fc10 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Only reject coordinates when we can determine that the imaginary\n+        # part is non-zero. Using truthiness on im(a) can erroneously trigger\n+        # under global evaluate(False), since im(a) may remain unevaluated.\n+        if any(a.is_number and (a.as_real_imag()[1].is_zero is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "sympy/geometry/point.py": [
          "\nfunction: Point.__new__\nline: 156"
        ]
      },
      "patches": [
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..5aa99e9 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,12 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow numeric coordinates with a nonzero imaginary part.\n+        # Using im(a) directly in a boolean context can misbehave under\n+        # `evaluate(False)` because Im(1) may remain unevaluated.\n+        # Instead, rely on as_real_imag()[1].is_zero to avoid truth-testing\n+        # of unevaluated expressions.\n+        if any(a.is_number and (a.as_real_imag()[1].is_zero is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..54bc93b 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # For numeric coordinates, ensure they are real without relying on im() evaluation,\n+        # which can be affected by global evaluate=False.\n+        if any(a.is_number and not a.is_real for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..c59cc9e 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Avoid using im(a) here since under evaluate(False) Im(1) may remain\n+        # unevaluated and be treated as truthy, incorrectly triggering this error.\n+        # Instead, rely on is_real for numeric coordinates.\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..281cca7 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Under evaluate(False), im(a) may remain unevaluated (e.g. Im(1)),\n+        # so do not use it in a boolean context. Use equals(0) to determine\n+        # zero imaginary part robustly.\n+        if any(a.is_number and not im(a).equals(S.Zero) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..0eccdbf 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Reject points with numerical coordinates that are not real.\n+        # Using a.is_real avoids relying on im(a) which may not evaluate\n+        # under global evaluate(False) contexts.\n+        if any(a.is_number and not a.is_real for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..8db3585 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Only reject points with a definite nonzero imaginary part.\n+        # Using im(a).is_zero avoids unevaluated Im(...) when global evaluate is False.\n+        if any(a.is_number and im(a).is_zero is False for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..95ea6e0 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow non-real numerical coordinates. Using im(a) in a boolean\n+        # context can behave incorrectly under evaluate(False) since Im may\n+        # not evaluate to 0 and bool(Im(1)) is problematic. Rely on is_real.\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..35d8c7a 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Detect imaginary components robustly without depending on evaluation,\n+        # to avoid false positives under evaluate(False).\n+        if any(a.is_number and a.as_real_imag()[1] != 0 for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..a2a8e97 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,7 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..0063ab9 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,8 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # For numeric coordinates, ensure no imaginary part irrespective of evaluation context\n+        if any(a.is_number and a.as_real_imag()[1] != 0 for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "sympy/geometry/point.py": [
          "\nfunction: Point.__new__\nline: 155"
        ]
      },
      "patches": [
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..8da35f4 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Use as_real_imag to determine the imaginary component robustly,\n+        # irrespective of global evaluation settings.\n+        if any(a.is_number and a.as_real_imag()[1] for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..995611d 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,8 +152,14 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n-            raise ValueError('Imaginary coordinates are not permitted.')\n+        # Disallow numeric coordinates with a nonzero imaginary part.\n+        # Avoid relying on the truthiness of im(a), which can be affected by\n+        # global evaluate=False and lead to unexpected behavior.\n+        for a in coords:\n+            if a.is_number:\n+                _, imag = a.as_real_imag()\n+                if not imag.is_zero:\n+                    raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n \n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..421e442 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Reject coordinates that are known to be non-real numbers.\n+        # Using im(a) here can give incorrect truthiness when evaluation is disabled.\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..12cd372 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,8 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow numeric coordinates that are explicitly non-real (e.g. containing I)\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..ea562ee 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,11 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow coordinates with a nonzero imaginary part. Using im(a) in a\n+        # boolean context can be incorrect when global evaluation is disabled\n+        # (e.g., with evaluate(False)), since im(1) may not simplify to 0.\n+        # Rely on is_real for numeric values instead.\n+        if any(a.is_number and (a.is_real is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..ba049be 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Reject numeric coordinates with a nonzero imaginary part.\n+        # Use is_zero to avoid relying on truthiness of SymPy expressions,\n+        # which can behave unexpectedly under evaluate(False).\n+        if any(a.is_number and (im(a).is_zero is False) for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..9457ba2 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,7 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        if any(a.is_number and not im(a).is_zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..4fb8bba 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Avoid relying on im() evaluation which may remain unevaluated\n+        # under evaluate(False); directly check the imaginary part.\n+        if any(a.is_number and a.as_real_imag()[1] != S.Zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..2cbbcc1 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Only disallow numeric coordinates that have a nonzero imaginary part.\n+        # Using as_real_imag avoids relying on truthiness of SymPy expressions\n+        # which can behave differently under evaluate(False).\n+        if any(a.is_number and a.as_real_imag()[1] != 0 for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
        "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..3935584 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,10 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Disallow numeric coordinates with a nonzero imaginary part.\n+        # Use .is_zero to avoid truth-testing of SymPy expressions which can\n+        # behave unexpectedly when global evaluation is disabled.\n+        if any(a.is_number and not im(a).is_zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/sympy/geometry/point.py b/sympy/geometry/point.py\nindex b7f7a47..f884d30 100644\n--- a/sympy/geometry/point.py\n+++ b/sympy/geometry/point.py\n@@ -152,7 +152,9 @@ class Point(GeometryEntity):\n                         'warn' or 'ignore'.'''))\n         if any(coords[dim:]):\n             raise ValueError('Nonzero coordinates cannot be removed.')\n-        if any(a.is_number and im(a) for a in coords):\n+        # Use as_real_imag to test for imaginary parts without relying on evaluation,\n+        # so that global evaluate(False) does not cause false positives.\n+        if any(a.is_number and not a.as_real_imag()[1].is_zero for a in coords):\n             raise ValueError('Imaginary coordinates are not permitted.')\n         if not all(isinstance(a, Expr) for a in coords):\n             raise TypeError('Coordinates must be valid SymPy expressions.')\n",
  "7_resolved": true
}