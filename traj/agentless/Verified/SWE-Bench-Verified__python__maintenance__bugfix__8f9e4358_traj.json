{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__8f9e4358",
  "original_id": "django__django-16454",
  "1_model_selected_files": [
    "django/core/management/base.py"
  ],
  "2_embedding_selected_files": [
    "django/core/management/base.py",
    "django/core/management/__init__.py",
    "django/core/management/commands/__init__.py",
    "django/core/management/commands/makemessages.py",
    "django/core/management/commands/startapp.py",
    "django/core/management/commands/check.py",
    "django/core/management/utils.py",
    "django/core/management/commands/shell.py",
    "django/core/management/commands/squashmigrations.py",
    "django/core/management/commands/optimizemigration.py",
    "django/core/management/commands/sendtestemail.py",
    "django/core/management/commands/dbshell.py",
    "django/core/management/commands/migrate.py",
    "django/core/management/commands/sqlmigrate.py",
    "django/core/management/commands/createcachetable.py",
    "django/core/management/commands/flush.py",
    "django/core/management/commands/makemigrations.py",
    "django/core/management/commands/startproject.py",
    "django/core/management/commands/diffsettings.py",
    "django/core/management/commands/sqlsequencereset.py",
    "django/__main__.py",
    "django/core/management/commands/loaddata.py",
    "django/core/management/commands/sqlflush.py",
    "django/core/management/commands/inspectdb.py",
    "django/core/exceptions.py",
    "django/setup.py",
    "django/core/management/commands/runserver.py",
    "django/core/management/templates.py",
    "django/core/__init__.py",
    "django/core/management/commands/compilemessages.py",
    "django/__init__.py",
    "django/shortcuts.py",
    "django/core/management/color.py",
    "django/core/management/commands/dumpdata.py",
    "django/core/management/commands/showmigrations.py",
    "django/core/management/sql.py",
    "django/core/signals.py",
    "django/core/validators.py",
    "django/core/signing.py",
    "django/core/asgi.py",
    "django/core/wsgi.py",
    "django/core/paginator.py"
  ],
  "3_final_combined_files": [
    "django/core/management/base.py",
    "django/core/management/__init__.py",
    "django/core/management/commands/__init__.py"
  ],
  "4_related_elements": {
    "django/core/management/base.py": [
      "class: CommandParser\nfunction: BaseCommand.create_parser\nfunction: BaseCommand.run_from_argv\nclass: DjangoHelpFormatter"
    ],
    "django/core/management/__init__.py": [
      "function: ManagementUtility.execute\nfunction: execute_from_command_line"
    ],
    "django/core/management/commands/__init__.py": [
      ""
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "django/core/management/base.py": [
          "\nclass: CommandParser\nfunction: CommandParser.add_subparsers\nclass: DjangoSubParsersAction\nfunction: DjangoSubParsersAction.add_parser"
        ]
      },
      "patches": [
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..720bbf1 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,38 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers are constructed using CommandParser (or subclass) and\n+        inherit relevant initialization arguments so error handling is consistent.\n+        \"\"\"\n+        # Default to using the same parser class as the parent.\n+        if \"parser_class\" not in kwargs:\n+            kwargs[\"parser_class\"] = self.__class__\n+        subparsers = super().add_subparsers(**kwargs)\n+\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            parser_cls = kwargs.get(\"parser_class\")\n+            # Only forward custom kwargs if the subparser class understands them.\n+            try:\n+                is_cmd_parser = issubclass(parser_cls, CommandParser)\n+            except Exception:\n+                is_cmd_parser = False\n+\n+            if is_cmd_parser:\n+                kw.setdefault(\n+                    \"called_from_command_line\", self.called_from_command_line\n+                )\n+                kw.setdefault(\"missing_args_message\", self.missing_args_message)\n+\n+            return original_add_parser(name, **kw)\n+\n+        # Monkey-patch the add_parser method to inject our custom kwargs.\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..013630d 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,29 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, *args, **kwargs):\n+        \"\"\"\n+        Ensure subparsers created from this parser inherit Django-specific\n+        error-handling configuration so CLI errors are formatted consistently.\n+        \"\"\"\n+        action = super().add_subparsers(*args, **kwargs)\n+        original_add_parser = action.add_parser\n+\n+        def add_parser(name, **add_kwargs):\n+            # Only inject Django-specific kwargs when creating CommandParser\n+            parser_class = getattr(action, \"_parser_class\", None)\n+            if parser_class is not None and issubclass(parser_class, CommandParser):\n+                add_kwargs.setdefault(\n+                    \"called_from_command_line\", self.called_from_command_line\n+                )\n+                add_kwargs.setdefault(\n+                    \"missing_args_message\", self.missing_args_message\n+                )\n+            return original_add_parser(name, **add_kwargs)\n+\n+        action.add_parser = add_parser\n+        return action\n+\n \n def handle_default_options(options):\n     \"\"\"\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..ca0c6b1 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,26 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers use CommandParser (or a subclass) and inherit\n+        error formatting behavior so errors are user-friendly on the CLI.\n+        \"\"\"\n+        # Use the same parser class for subparsers.\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        subparsers = super().add_subparsers(**kwargs)\n+\n+        # Wrap add_parser to propagate our custom initialization kwargs.\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            kw.setdefault(\"called_from_command_line\", self.called_from_command_line)\n+            kw.setdefault(\"missing_args_message\", self.missing_args_message)\n+            return original_add_parser(name, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..27671c9 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,25 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, *args, **kwargs):\n+        \"\"\"\n+        Ensure subparsers created from this parser retain Django-specific\n+        error handling behavior by propagating called_from_command_line.\n+        \"\"\"\n+        action = super().add_subparsers(*args, **kwargs)\n+        original_add_parser = action.add_parser\n+\n+        def add_parser(name, **parser_kwargs):\n+            # Propagate called_from_command_line so subparsers format errors\n+            # consistently when invoked from the command line.\n+            parser_kwargs.setdefault(\n+                \"called_from_command_line\", self.called_from_command_line\n+            )\n+            return original_add_parser(name, **parser_kwargs)\n+\n+        action.add_parser = add_parser\n+        return action\n+\n \n def handle_default_options(options):\n     \"\"\"\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..92db93d 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,28 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers are instances of this CommandParser (or subclass) and\n+        inherit relevant error-formatting options.\n+        \"\"\"\n+        # Make sure subparsers use the same parser class.\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        subparsers = super().add_subparsers(**kwargs)\n+\n+        # Ensure subparsers inherit error-formatting behavior.\n+        parent_called_from_command_line = self.called_from_command_line\n+        parent_missing_args_message = self.missing_args_message\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, *a, **kw):\n+            kw.setdefault(\"called_from_command_line\", parent_called_from_command_line)\n+            kw.setdefault(\"missing_args_message\", parent_missing_args_message)\n+            return original_add_parser(name, *a, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n \n def handle_default_options(options):\n     \"\"\"\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..8fbe441 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,29 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure that subparsers created from this parser inherit the relevant\n+        CommandParser options so error formatting remains consistent.\n+        \"\"\"\n+        subparsers = super().add_subparsers(**kwargs)\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            # Only pass through custom kwargs when the subparser class supports them.\n+            parser_class = getattr(subparsers, \"_parser_class\", None)\n+            try:\n+                if parser_class is None or issubclass(parser_class, CommandParser):\n+                    kw.setdefault(\"called_from_command_line\", self.called_from_command_line)\n+                    kw.setdefault(\"missing_args_message\", self.missing_args_message)\n+            except Exception:\n+                # In case parser_class is not a class or issubclass fails, fall back silently.\n+                pass\n+            return original_add_parser(name, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..60c99b7 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,26 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, *args, **kwargs):\n+        \"\"\"\n+        Ensure that subparsers inherit CommandParser behavior so that their\n+        errors are formatted consistently on the CLI.\n+        \"\"\"\n+        kwargs.setdefault(\"parser_class\", CommandParser)\n+        subparsers = super().add_subparsers(*args, **kwargs)\n+\n+        # Preserve error formatting behavior for subparsers created via add_parser().\n+        called = self.called_from_command_line\n+        original_add_parser = subparsers.add_parser\n+\n+        def _add_parser(name, *a, **kw):\n+            kw.setdefault(\"parser_class\", CommandParser)\n+            kw.setdefault(\"called_from_command_line\", called)\n+            return original_add_parser(name, *a, **kw)\n+\n+        subparsers.add_parser = _add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..90c0236 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -57,6 +57,23 @@ class CommandParser(ArgumentParser):\n         self.called_from_command_line = called_from_command_line\n         super().__init__(**kwargs)\n \n+    def add_subparsers(self, **kwargs):\n+        # Ensure subparsers use CommandParser and inherit formatting behavior.\n+        if \"parser_class\" not in kwargs:\n+            kwargs[\"parser_class\"] = CommandParser\n+        action = super().add_subparsers(**kwargs)\n+        parent_called_from_command_line = self.called_from_command_line\n+        parent_missing_args_message = self.missing_args_message\n+        original_add_parser = action.add_parser\n+\n+        def add_parser(name, **kw):\n+            kw.setdefault(\"called_from_command_line\", parent_called_from_command_line)\n+            kw.setdefault(\"missing_args_message\", parent_missing_args_message)\n+            return original_add_parser(name, **kw)\n+\n+        action.add_parser = add_parser\n+        return action\n+\n     def parse_args(self, args=None, namespace=None):\n         # Catch missing argument for a better error message\n         if self.missing_args_message and not (\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..eedaa5e 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,37 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers use the same parser class and propagate Django-specific\n+        formatting flags so that errors from subcommands render as user-facing\n+        usage messages rather than tracebacks.\n+        \"\"\"\n+        if \"parser_class\" not in kwargs:\n+            kwargs[\"parser_class\"] = type(self)\n+        subparsers = super().add_subparsers(**kwargs)\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            parser_cls = getattr(subparsers, \"_parser_class\", None)\n+            # Propagate custom CommandParser flags if supported by the subparser class.\n+            if parser_cls is not None:\n+                try:\n+                    if issubclass(parser_cls, CommandParser):\n+                        kw.setdefault(\n+                            \"called_from_command_line\", self.called_from_command_line\n+                        )\n+                        kw.setdefault(\n+                            \"missing_args_message\", self.missing_args_message\n+                        )\n+                except Exception:\n+                    # Be tolerant if parser_cls isn't a class or issubclass fails.\n+                    pass\n+            return original_add_parser(name, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..991579e 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,29 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers inherit CommandParser's error-handling behavior.\n+        \"\"\"\n+        # Make sure the subparsers use the same parser class by default.\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        subparsers = super().add_subparsers(**kwargs)\n+\n+        # Patch add_parser so created subparsers propagate our init kwargs.\n+        original_add_parser = subparsers.add_parser\n+        parent_called_from_command_line = self.called_from_command_line\n+        parent_missing_args_message = self.missing_args_message\n+\n+        def add_parser(name, **kw):\n+            kw.setdefault(\n+                \"called_from_command_line\", parent_called_from_command_line\n+            )\n+            kw.setdefault(\"missing_args_message\", parent_missing_args_message)\n+            return original_add_parser(name, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n \n def handle_default_options(options):\n     \"\"\"\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "django/core/management/base.py": [
          "\nfunction: CommandParser.add_subparsers"
        ]
      },
      "patches": [
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        ""
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "django/core/management/base.py": [
          "\nfunction: CommandParser.add_subparsers"
        ]
      },
      "patches": [
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
        ""
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "django/core/management/base.py": [
          "\nclass: CommandParser\nfunction: CommandParser.add_subparsers"
        ]
      },
      "patches": [
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..2444774 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,23 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, *args, **kwargs):\n+        # Ensure subparsers use CommandParser and inherit error formatting behavior.\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        action = super().add_subparsers(*args, **kwargs)\n+        original_add_parser = action.add_parser\n+        parent_called_from_command_line = self.called_from_command_line\n+\n+        def add_parser(name, **sub_kwargs):\n+            parser = original_add_parser(name, **sub_kwargs)\n+            # Propagate called_from_command_line so subparsers format errors like the parent.\n+            if isinstance(parser, CommandParser):\n+                parser.called_from_command_line = parent_called_from_command_line\n+            return parser\n+\n+        action.add_parser = add_parser\n+        return action\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..7b8ff66 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,28 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure that subparsers created from this parser preserve Django's\n+        CommandParser behavior and formatting.\n+        \"\"\"\n+        # Default to using this parser class for subparsers.\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        action = super().add_subparsers(**kwargs)\n+\n+        original_add_parser = action.add_parser\n+\n+        def django_add_parser(name, **kw):\n+            # Propagate CommandParser-specific kwargs to subparsers so that\n+            # errors are formatted consistently.\n+            if issubclass(kwargs[\"parser_class\"], CommandParser):\n+                kw.setdefault(\"missing_args_message\", self.missing_args_message)\n+                kw.setdefault(\"called_from_command_line\", self.called_from_command_line)\n+            return original_add_parser(name, **kw)\n+\n+        action.add_parser = django_add_parser\n+        return action\n+\n \n def handle_default_options(options):\n     \"\"\"\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..698d19e 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,22 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, **kwargs):\n+        # Ensure subparsers are instances of this CommandParser subclass.\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        action = super().add_subparsers(**kwargs)\n+\n+        # Ensure subparsers inherit called_from_command_line so they format\n+        # errors consistently (i.e., print usage on CLI rather than raising).\n+        original_add_parser = action.add_parser\n+\n+        def add_parser(name, **kw):\n+            kw.setdefault(\"called_from_command_line\", self.called_from_command_line)\n+            return original_add_parser(name, **kw)\n+\n+        action.add_parser = add_parser\n+        return action\n+\n \n def handle_default_options(options):\n     \"\"\"\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..fcb22ad 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,25 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, *args, **kwargs):\n+        \"\"\"\n+        Ensure subparsers created from this parser inherit the custom\n+        initialization arguments that control error formatting.\n+        \"\"\"\n+        subparsers = super().add_subparsers(*args, **kwargs)\n+\n+        parent_called_from_command_line = self.called_from_command_line\n+        parent_missing_args_message = self.missing_args_message\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            kw.setdefault(\"called_from_command_line\", parent_called_from_command_line)\n+            kw.setdefault(\"missing_args_message\", parent_missing_args_message)\n+            return original_add_parser(name, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n \n def handle_default_options(options):\n     \"\"\"\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..26895b6 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -57,6 +57,29 @@ class CommandParser(ArgumentParser):\n         self.called_from_command_line = called_from_command_line\n         super().__init__(**kwargs)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers use CommandParser and inherit error-handling settings.\n+        \"\"\"\n+        # Use the same parser class for subparsers.\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        subparsers = super().add_subparsers(**kwargs)\n+\n+        # Wrap add_parser so subparsers inherit relevant arguments.\n+        original_add_parser = subparsers.add_parser\n+\n+        def _add_parser(name, **parser_kwargs):\n+            parser_kwargs.setdefault(\n+                \"missing_args_message\", self.missing_args_message\n+            )\n+            parser_kwargs.setdefault(\n+                \"called_from_command_line\", self.called_from_command_line\n+            )\n+            return original_add_parser(name, **parser_kwargs)\n+\n+        subparsers.add_parser = _add_parser\n+        return subparsers\n+\n     def parse_args(self, args=None, namespace=None):\n         # Catch missing argument for a better error message\n         if self.missing_args_message and not (\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..e775d8e 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,28 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, *args, **kwargs):\n+        \"\"\"\n+        Create subparsers that retain CommandParser's custom error handling.\n+        \"\"\"\n+        subparsers = super().add_subparsers(*args, **kwargs)\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **parser_kwargs):\n+            # Use the same parser class unless explicitly overridden.\n+            parser_kwargs.setdefault(\"parser_class\", type(self))\n+            # Propagate CommandParser-specific options to subparsers.\n+            parser_kwargs.setdefault(\n+                \"missing_args_message\", self.missing_args_message\n+            )\n+            parser_kwargs.setdefault(\n+                \"called_from_command_line\", self.called_from_command_line\n+            )\n+            return original_add_parser(name, **parser_kwargs)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..82b0559 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,26 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure that subparsers created from this parser:\n+        - Use the same parser class (CommandParser) by default.\n+        - Inherit error-formatting behavior by propagating\n+          called_from_command_line and missing_args_message.\n+        \"\"\"\n+        kwargs.setdefault(\"parser_class\", type(self))\n+        subparsers = super().add_subparsers(**kwargs)\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, *a, **kw):\n+            kw.setdefault(\"called_from_command_line\", self.called_from_command_line)\n+            if \"missing_args_message\" not in kw and getattr(self, \"missing_args_message\", None):\n+                kw[\"missing_args_message\"] = self.missing_args_message\n+            return original_add_parser(name, *a, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..9868e28 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,26 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure that subparsers created from this parser inherit the extra\n+        configuration used for better error formatting.\n+        \"\"\"\n+        subparsers = super().add_subparsers(**kwargs)\n+        parent_called_from_command_line = self.called_from_command_line\n+        parent_missing_args_message = self.missing_args_message\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            kw.setdefault(\"called_from_command_line\", parent_called_from_command_line)\n+            # Propagate missing_args_message so subparsers get consistent behavior.\n+            if parent_missing_args_message is not None:\n+                kw.setdefault(\"missing_args_message\", parent_missing_args_message)\n+            return original_add_parser(name, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..ff6bbbb 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,30 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, *args, **kwargs):\n+        \"\"\"\n+        Ensure that subparsers use CommandParser and inherit error formatting\n+        behavior from the parent parser.\n+        \"\"\"\n+        subparsers = super().add_subparsers(*args, **kwargs)\n+        # Make sure subparsers create CommandParser instances.\n+        try:\n+            subparsers._parser_class = type(self)\n+        except Exception:\n+            pass\n+\n+        parent_called_from_command_line = self.called_from_command_line\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            # Propagate called_from_command_line so subparsers format errors\n+            # properly when invoked from the CLI.\n+            kw.setdefault(\"called_from_command_line\", parent_called_from_command_line)\n+            return original_add_parser(name, **kw)\n+\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
        "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..fe049bc 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -71,6 +71,28 @@ class CommandParser(ArgumentParser):\n         else:\n             raise CommandError(\"Error: %s\" % message)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers inherit CommandParser behavior (notably\n+        called_from_command_line and missing_args_message) so that errors in\n+        subcommands produce user-facing messages rather than stack traces.\n+        \"\"\"\n+        if \"parser_class\" not in kwargs:\n+            parent_called = self.called_from_command_line\n+            parent_missing = self.missing_args_message\n+            parent_cls = type(self)\n+\n+            class SubParser(parent_cls):\n+                def __init__(self, *args, **kw):\n+                    if parent_called is not None:\n+                        kw.setdefault(\"called_from_command_line\", parent_called)\n+                    if parent_missing is not None:\n+                        kw.setdefault(\"missing_args_message\", parent_missing)\n+                    super().__init__(*args, **kw)\n+\n+            kwargs[\"parser_class\"] = SubParser\n+        return super().add_subparsers(**kwargs)\n+\n \n def handle_default_options(options):\n     \"\"\"\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/django/core/management/base.py b/django/core/management/base.py\nindex f221176..720bbf1 100644\n--- a/django/core/management/base.py\n+++ b/django/core/management/base.py\n@@ -65,6 +65,38 @@ class CommandParser(ArgumentParser):\n             self.error(self.missing_args_message)\n         return super().parse_args(args, namespace)\n \n+    def add_subparsers(self, **kwargs):\n+        \"\"\"\n+        Ensure subparsers are constructed using CommandParser (or subclass) and\n+        inherit relevant initialization arguments so error handling is consistent.\n+        \"\"\"\n+        # Default to using the same parser class as the parent.\n+        if \"parser_class\" not in kwargs:\n+            kwargs[\"parser_class\"] = self.__class__\n+        subparsers = super().add_subparsers(**kwargs)\n+\n+        original_add_parser = subparsers.add_parser\n+\n+        def add_parser(name, **kw):\n+            parser_cls = kwargs.get(\"parser_class\")\n+            # Only forward custom kwargs if the subparser class understands them.\n+            try:\n+                is_cmd_parser = issubclass(parser_cls, CommandParser)\n+            except Exception:\n+                is_cmd_parser = False\n+\n+            if is_cmd_parser:\n+                kw.setdefault(\n+                    \"called_from_command_line\", self.called_from_command_line\n+                )\n+                kw.setdefault(\"missing_args_message\", self.missing_args_message)\n+\n+            return original_add_parser(name, **kw)\n+\n+        # Monkey-patch the add_parser method to inject our custom kwargs.\n+        subparsers.add_parser = add_parser\n+        return subparsers\n+\n     def error(self, message):\n         if self.called_from_command_line:\n             super().error(message)\n",
  "7_resolved": true
}