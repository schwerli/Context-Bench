{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__d0723f55",
  "original_id": "sphinx-doc__sphinx-8120",
  "1_model_selected_files": [
    "sphinx/locale/__init__.py",
    "sphinx/application.py",
    "sphinx/util/i18n.py",
    "sphinx/config.py",
    "sphinx/jinja2glue.py"
  ],
  "2_embedding_selected_files": [
    "sphinx/locale/__init__.py",
    "sphinx/setup.py",
    "sphinx/builders/gettext.py",
    "sphinx/transforms/i18n.py",
    "sphinx/util/i18n.py",
    "sphinx/__init__.py",
    "sphinx/writers/latex.py",
    "sphinx/builders/changes.py",
    "sphinx/transforms/__init__.py",
    "sphinx/io.py",
    "sphinx/highlighting.py",
    "sphinx/registry.py",
    "sphinx/project.py",
    "sphinx/builders/html/__init__.py",
    "sphinx/builders/linkcheck.py",
    "sphinx/config.py",
    "sphinx/setup_command.py",
    "sphinx/transforms/references.py",
    "sphinx/transforms/post_transforms/code.py",
    "sphinx/directives/patches.py",
    "sphinx/versioning.py",
    "sphinx/directives/code.py",
    "sphinx/util/smartypants.py",
    "sphinx/builders/manpage.py",
    "sphinx/util/docutils.py",
    "sphinx/util/__init__.py",
    "sphinx/writers/html5.py",
    "sphinx/jinja2glue.py",
    "sphinx/writers/html.py",
    "sphinx/__main__.py",
    "sphinx/util/rst.py",
    "sphinx/transforms/post_transforms/__init__.py",
    "sphinx/addnodes.py",
    "sphinx/writers/texinfo.py",
    "sphinx/builders/texinfo.py",
    "sphinx/directives/other.py",
    "sphinx/pygments_styles.py",
    "sphinx/application.py",
    "sphinx/util/texescape.py",
    "sphinx/builders/text.py",
    "sphinx/errors.py",
    "sphinx/writers/manpage.py",
    "sphinx/builders/_epub_base.py",
    "sphinx/util/pycompat.py",
    "sphinx/util/template.py",
    "sphinx/writers/__init__.py",
    "sphinx/builders/__init__.py",
    "sphinx/builders/htmlhelp.py",
    "sphinx/util/logging.py",
    "sphinx/transforms/post_transforms/images.py",
    "sphinx/theming.py",
    "sphinx/builders/xml.py",
    "sphinx/builders/devhelp.py",
    "sphinx/directives/__init__.py",
    "sphinx/util/cfamily.py",
    "sphinx/builders/singlehtml.py",
    "sphinx/util/images.py",
    "sphinx/extension.py",
    "sphinx/builders/epub3.py",
    "sphinx/util/nodes.py"
  ],
  "3_final_combined_files": [
    "sphinx/locale/__init__.py",
    "sphinx/application.py",
    "sphinx/util/i18n.py",
    "sphinx/setup.py",
    "sphinx/builders/gettext.py"
  ],
  "4_related_elements": {
    "sphinx/locale/__init__.py": [
      "class: _TranslationProxy\nvariable: translators\nfunction: init\nfunction: setlocale\nfunction: init_console\nfunction: get_translator\nfunction: is_translator_registered\nfunction: _lazy_translate\nfunction: get_translation\nvariable: _\nvariable: __\nvariable: admonitionlabels\nvariable: versionlabels\nvariable: pairindextypes"
    ],
    "sphinx/application.py": [
      "variable: builtin_extensions\nclass: Sphinx\nfunction: Sphinx._init_i18n\nfunction: Sphinx.add_message_catalog"
    ],
    "sphinx/util/i18n.py": [
      "class: CatalogInfo\nclass: CatalogRepository\nfunction: find_catalog\nfunction: docname_to_domain\nfunction: find_catalog_files\nfunction: find_catalog_source_files"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "sphinx/application.py": [
          "\nfunction: Sphinx._init_i18n\nline: 296"
        ]
      },
      "patches": [
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..8f47ebd 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prefer user-provided locale directories before built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..79952ef 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # ensure user-provided locale directories take precedence over built-in translations\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..cb6e1fc 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-specified locale directories over built-in ones\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..a9817c2 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # User-provided locale directories should take precedence over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..25f21ef 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Search user-provided locale directories first so they can override\n+            # built-in translations shipped with Sphinx.\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "sphinx/locale/__init__.py": [
          "\nfunction: init\nline: 134\nline: 135\nline: 136\nline: 137"
        ],
        "sphinx/application.py": [
          "\nfunction: Sphinx._init_i18n\nline: 296"
        ]
      },
      "patches": [
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..b7d77ae 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Load user-provided locale dirs first so they can override built-in translations\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..8e72a54 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Load user-provided locale directories first so they override built-in translations.\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..fcaf801 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prioritize user-provided locales before built-in ones so that\n+            # project overrides take precedence over Sphinx's translations.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..8e6f677 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prioritize user-provided locale directories so they can override built-in messages.\n+            # Built-in translations should act as a fallback when user overrides are not present.\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..6d1895f 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locales so they can override built-ins\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..cb029f4 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # ensure user-provided locale directories take precedence over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..e06976c 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locales over built-in ones\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..3f225f4 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories so their translations override built-ins\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..34155ee 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prioritize user-provided locales so they can override built-in translations.\n+            # Built-in translations will be used as a fallback.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "sphinx/application.py": [
          "\nfunction: Sphinx._init_i18n\nline: 296"
        ],
        "sphinx/locale/__init__.py": [
          "\nfunction: init\nline: 131\nline: 134\nline: 135\nline: 137"
        ]
      },
      "patches": [
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..802ae13 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Give user-provided locale directories precedence over built-in ones\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..cdf5df6 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Load user-provided locales first so they can override built-in translations.\n+            # Fallbacks should be: built-in package locale, then system default.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..3de0302 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,10 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Ensure user-provided locale directories take precedence over built-in ones.\n+            # gettext uses the first loaded catalog as primary and subsequent ones as fallbacks.\n+            # By placing user locales before the built-in Sphinx locales, user overrides work.\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..ca1b32d 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Ensure user-provided locale directories take precedence over built-in translations.\n+            # Load user locales first, then fall back to Sphinx's built-in locale catalog.\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..72fdd3d 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prioritize user-provided locale directories over built-in ones so that\n+            # project overrides take precedence. Keep system default (None) as a last resort.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..a1f554e 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,10 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Load user-provided locale directories first so they override built-in translations.\n+            # gettext uses the first loaded catalog as the primary, and fallbacks only for missing keys.\n+            # Therefore, order matters: user locales should come before the package locales.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..b0fe1db 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # search user locale directories first so user translations override built-ins\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..c978425 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,10 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # User-provided locale directories should take precedence over built-in ones.\n+            # This ensures that custom translations in locale/<language>/LC_MESSAGES/sphinx.mo\n+            # override the official translations shipped with Sphinx.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..86f3a9a 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # User locale directories should take precedence over built-in ones.\n+            # Load user locales first so their translations override Sphinx defaults.\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "sphinx/application.py": [
          "\nfunction: Sphinx._init_i18n\nline: 296"
        ],
        "sphinx/locale/__init__.py": [
          "\nfunction: init\nline: 131\nline: 137"
        ]
      },
      "patches": [
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..e979a15 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Load user-provided locales first so they can override built-in translations,\n+            # then fall back to Sphinx's package locales and finally the system default.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..b4b85d2 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Ensure user-provided locales have priority over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..6c079a4 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prioritize user-provided locale directories to allow overriding built-in translations\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..cb187c6 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prefer user-provided locale directories so their translations can override\n+            # built-in ones. Built-in and system locales are used as fallbacks.\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..2c66994 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Ensure user-provided locale directories take precedence over built-in ones.\n+            # The first loaded catalog is the primary; later ones are fallbacks.\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..bcee6d7 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user locale directories so their translations override built-ins\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..cb029f4 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # ensure user-provided locale directories take precedence over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..209b131 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Prioritize user-provided locale directories so their translations override\n+            # built-in ones. Built-in translations should be used as a fallback.\n+            locale_dirs = list(repo.locale_dirs) + [None, path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..7a1ab72 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,9 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # Load user-provided locale directories first so they can override\n+            # built-in translations, then fall back to Sphinx's own and the system default.\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
        "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..313bed9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale dirs so their translations override built-in ones\n+            locale_dirs = list(repo.locale_dirs) + [path.join(package_dir, 'locale'), None]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 562ce64..f478ec9 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -293,7 +293,8 @@ class Sphinx:\n                 if catalog.domain == 'sphinx' and catalog.is_outdated():\n                     catalog.write_mo(self.config.language)\n \n-            locale_dirs = [None, path.join(package_dir, 'locale')] + list(repo.locale_dirs)\n+            # prioritize user-provided locale directories over built-in ones\n+            locale_dirs = [None] + list(repo.locale_dirs) + [path.join(package_dir, 'locale')]\n             self.translator, has_translation = locale.init(locale_dirs, self.config.language)\n             if has_translation or self.config.language == 'en':\n                 # \"en\" never needs to be translated\n",
  "7_resolved": true
}