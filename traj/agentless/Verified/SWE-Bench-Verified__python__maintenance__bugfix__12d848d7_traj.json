{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__12d848d7",
  "original_id": "django__django-11433",
  "1_model_selected_files": [
    "django/forms/models.py"
  ],
  "2_embedding_selected_files": [
    "django/forms/forms.py",
    "django/forms/fields.py",
    "django/forms/models.py",
    "django/db/models/fields/__init__.py",
    "django/db/models/base.py",
    "django/db/migrations/autodetector.py",
    "django/db/backends/base/schema.py",
    "django/db/backends/mysql/schema.py",
    "django/db/backends/sqlite3/schema.py",
    "django/db/models/options.py",
    "django/db/migrations/operations/fields.py",
    "django/forms/widgets.py",
    "django/db/models/fields/files.py",
    "django/forms/__init__.py",
    "django/db/models/fields/mixins.py",
    "django/db/models/fields/proxy.py",
    "django/db/migrations/questioner.py",
    "django/db/models/__init__.py",
    "django/db/models/sql/query.py",
    "django/db/models/fields/related_descriptors.py",
    "django/forms/boundfield.py",
    "django/db/migrations/operations/__init__.py",
    "django/db/models/fields/related.py",
    "django/db/backends/dummy/__init__.py",
    "django/db/backends/base/validation.py",
    "django/setup.py",
    "django/db/backends/oracle/schema.py",
    "django/db/backends/base/__init__.py",
    "django/db/backends/mysql/validation.py",
    "django/db/backends/dummy/features.py",
    "django/db/migrations/operations/models.py",
    "django/db/models/constraints.py",
    "django/db/backends/__init__.py",
    "django/db/models/query_utils.py",
    "django/db/models/sql/compiler.py",
    "django/db/backends/base/features.py",
    "django/db/models/fields/reverse_related.py",
    "django/forms/utils.py",
    "django/forms/formsets.py",
    "django/forms/renderers.py",
    "django/db/backends/mysql/features.py"
  ],
  "3_final_combined_files": [
    "django/forms/models.py",
    "django/forms/forms.py",
    "django/forms/fields.py"
  ],
  "4_related_elements": {
    "django/forms/models.py": [
      "function: construct_instance\nfunction: BaseModelForm.save\nfunction: BaseModelForm._post_clean\nfunction: BaseModelForm._get_validation_exclusions"
    ],
    "django/forms/forms.py": [
      "function: BaseForm.full_clean\nfunction: BaseForm._clean_form\nfunction: BaseForm.changed_data"
    ],
    "django/forms/fields.py": [
      "function: Field.has_changed"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "django/forms/models.py": [
          "\nfunction: construct_instance\nline: 49\nline: 50\nline: 51\nline: 52\nline: 53"
        ]
      },
      "patches": [
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..c6eb7f1 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,14 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n+        # Leave defaults for fields that aren't in POST data, unless a cleaned value\n+        # different from the field's initial has been provided (e.g. set in Form.clean()).\n+        # Checkboxes are handled by the widget's value_omitted_from_data() implementation.\n         if (f.has_default() and\n                 form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+            initial_val = form.initial.get(f.name, form.fields[f.name].initial)\n+            if cleaned_data.get(f.name) == initial_val:\n+                continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..0f13b3f 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Apply cleaned_data even if the value was omitted from POST data so\n+        # that form cleaning can override model defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..04940a5 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Use cleaned_data values even if data for the field was omitted.\n+        # This allows form cleaning logic to override model default values.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..2b2a68a 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data if available, even if the field was omitted\n+        # from POST data or the model field defines a default. This allows\n+        # form cleaning logic to override model defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..3c5d75f 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Allow cleaned_data to override model defaults even if the value was\n+        # omitted from POST data. The presence of a value in cleaned_data\n+        # indicates validation/cleaning supplied a value that should be saved.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..f6399c3 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data to populate the instance, even if the field\n+        # value was omitted from POST data. This allows values computed in\n+        # clean() to override model defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..2b424c0 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,10 +46,17 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n+        # Leave defaults for fields that aren't in POST data only when the\n+        # cleaned value is empty. Allow non-empty cleaned_data to override\n+        # model defaults even if the value was omitted from the form data.\n+        # Checkbox inputs are handled by value_omitted_from_data().\n+        if (\n+            f.has_default()\n+            and form[f.name].field.widget.value_omitted_from_data(\n+                form.data, form.files, form.add_prefix(f.name)\n+            )\n+            and cleaned_data[f.name] in form[f.name].field.empty_values\n+        ):\n             continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..7317658 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data to populate the instance. This allows values\n+        # set during form cleaning to override model defaults even if a value\n+        # wasn't supplied in POST data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "django/forms/models.py": [
          "\nfunction: construct_instance\nline: 49\nline: 50\nline: 51\nline: 52\nline: 53"
        ]
      },
      "patches": [
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..b141f19 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data to populate the instance, even for fields\n+        # with a model default. This allows values set/derived in cleaned_data\n+        # to overwrite model defaults when the field isn't present in POST data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..2ecdf3c 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Use cleaned_data to set field values even if not present in POST data,\n+        # allowing explicit values computed in form.clean() to override model\n+        # defaults. Fields absent from cleaned_data are still left at defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..eae4192 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Apply cleaned_data even if a value is omitted from POST data; this\n+        # allows programmatically-set values in clean() to override model defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..01acb17 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,10 +46,17 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n+        # Leave defaults for fields that aren't in POST data only when the\n+        # cleaned value is empty. This allows cleaned_data to override model\n+        # defaults (e.g. values computed in clean()). Checkbox inputs are\n+        # unaffected since a missing checkbox yields False, which isn't empty.\n+        if (\n+            f.has_default()\n+            and form[f.name].field.widget.value_omitted_from_data(\n+                form.data, form.files, form.add_prefix(f.name)\n+            )\n+            and cleaned_data.get(f.name) in form[f.name].field.empty_values\n+        ):\n             continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..bdc0ed8 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Allow cleaned_data to override model defaults even if the field's\n+        # value is omitted from POST data. Fields missing from cleaned_data\n+        # will retain their model defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..e34334b 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,15 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Leave existing/initial value when a field is omitted from POST data\n+        # (except for checkbox inputs which signal omission differently),\n+        # but allow an explicit value from cleaned_data to override defaults.\n+        if f.has_default() and form[f.name].field.widget.value_omitted_from_data(\n+                form.data, form.files, form.add_prefix(f.name)):\n+            # If the cleaned value equals the instance's current value, skip\n+            # assignment so model defaults or existing values are preserved.\n+            if cleaned_data[f.name] == f.value_from_object(instance):\n+                continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..7badea6 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,17 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Leave defaults for fields that aren't in POST data (e.g., when an input\n+        # wasn't submitted), except when a non-empty value has been explicitly\n+        # provided via cleaned_data (e.g., set in Form.clean()).\n+        # Checkbox inputs are handled by their widget which reports that a value\n+        # wasn't omitted when unchecked.\n+        if f.has_default():\n+            bf = form[f.name]\n+            if bf.field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name)):\n+                # Only preserve the model default when the cleaned value is effectively empty.\n+                if cleaned_data.get(f.name) in bf.field.empty_values:\n+                    continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..18b0aa6 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,15 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Leave defaults for fields that aren't in POST data only when the\n+        # cleaned value equals the form's initial. This allows values set in\n+        # form.cleaned_data (e.g. in Form.clean()) to override model defaults.\n+        if f.has_default() and f.name in form.fields:\n+            bound_field = form[f.name]\n+            if bound_field.field.widget.value_omitted_from_data(form.data, form.files, bound_field.html_name):\n+                initial = bound_field.initial\n+                if cleaned_data.get(f.name) == initial:\n+                    continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..f8e2698 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,14 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Leave defaults for fields that aren't in POST data only when the\n+        # field is present on the form. This allows values set on cleaned_data\n+        # (e.g., in Form.clean()) to override model defaults for fields that\n+        # aren't submitted with the form.\n+        if f.has_default() and f.name in form.fields:\n+            bf = form[f.name]\n+            if bf.field.widget.value_omitted_from_data(form.data, form.files, bf.html_name):\n+                continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "django/forms/models.py": [
          "\nfunction: construct_instance\nline: 49\nline: 50\nline: 51\nline: 52\nline: 53"
        ]
      },
      "patches": [
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..d02f5f3 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data to set the field value, even if the value was\n+        # omitted from the submitted data. This allows forms to compute or\n+        # override values in clean(), rather than forcing use of raw POST data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..7d2e88a 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Use cleaned_data to update even if field has a default; defaults apply only\n+        # when the field isn't present in cleaned_data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..c428d77 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Allow cleaned_data to override model defaults even if the value was\n+        # omitted from the submitted data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..6bff578 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use values from cleaned_data to populate the instance, even if\n+        # the field has a default and the value was omitted from POST data.\n+        # This allows derived/cleaned values to override model defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..d716bba 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # cleaned_data should be able to overwrite model defaults even if the\n+        # value was omitted from POST data. This allows values derived in\n+        # form.clean() to be saved to the instance.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..3bd8f38 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Use cleaned_data values even if the field's value was omitted from POST data.\n+        # This allows cleaned_data to overwrite model defaults when desired.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..ff58cf7 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,12 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always apply cleaned_data to the instance when available.\n+        # Even if a field has a model default and its value was omitted from\n+        # the submitted data, cleaned_data values (possibly derived in clean())\n+        # should override the default. The earlier check for\n+        # \"f.name not in cleaned_data\" already preserves defaults when no value\n+        # is provided by the form.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..e86391a 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,17 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n+        # Leave defaults for fields that aren't in POST data when the value\n+        # hasn't been explicitly set in cleaned_data, except for checkbox inputs\n+        # because they don't appear in POST data if not checked.\n         if (f.has_default() and\n                 form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+            # If the cleaned value matches the initial value, treat it as omitted\n+            # and allow the model field's default to apply. Otherwise, permit\n+            # cleaned_data to override the default.\n+            initial_value = form[f.name].initial\n+            if cleaned_data[f.name] == initial_value:\n+                continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "django/forms/models.py": [
          "\nfunction: construct_instance\nline: 49\nline: 50\nline: 51\nline: 52\nline: 53"
        ]
      },
      "patches": [
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..2662d3a 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data to populate instance fields so that derived or\n+        # programmatically set values can override model defaults even when the\n+        # field isn't present in the submitted data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..41fa305 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,10 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Prefer cleaned_data values over model defaults, even if the field\n+        # wasn't included in the submitted data. This allows values computed\n+        # during form cleaning to override defaults.\n+        # Note: Fields missing from cleaned_data are still skipped above.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..6fd06e2 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,6 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..1e496c1 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data to set field values even if omitted from POST\n+        # data, allowing overrides of model field defaults.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..4bb3686 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,12 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Allow cleaned_data to override model field defaults. If a field isn't\n+        # present in the submitted data but a value has been provided in cleaned_data\n+        # (e.g., derived in Form.clean()), use it rather than the model default.\n+        # Defaults will still be kept when a field has no cleaned value.\n+        # Note: The earlier check for \"f.name not in cleaned_data\" already preserves\n+        # defaults when no cleaned value is available.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..0f1ed26 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,12 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n+        # Leave defaults for fields that aren't in POST data only if the cleaned\n+        # value is empty. Allow non-empty cleaned_data to override defaults.\n         if (f.has_default() and\n                 form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+            if cleaned_data.get(f.name) in form[f.name].field.empty_values:\n+                continue\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..40c36b6 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Allow cleaned_data to overwrite model defaults even if the field's\n+        # value is omitted from POST data. This enables programmatically\n+        # computed values in cleaned_data (e.g., in Form.clean()) to be saved.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
        "",
        "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..c428d77 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,8 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Allow cleaned_data to override model defaults even if the value was\n+        # omitted from the submitted data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/django/forms/models.py b/django/forms/models.py\nindex 74a2377..b141f19 100644\n--- a/django/forms/models.py\n+++ b/django/forms/models.py\n@@ -46,11 +46,9 @@ def construct_instance(form, instance, fields=None, exclude=None):\n             continue\n         if exclude and f.name in exclude:\n             continue\n-        # Leave defaults for fields that aren't in POST data, except for\n-        # checkbox inputs because they don't appear in POST data if not checked.\n-        if (f.has_default() and\n-                form[f.name].field.widget.value_omitted_from_data(form.data, form.files, form.add_prefix(f.name))):\n-            continue\n+        # Always use cleaned_data to populate the instance, even for fields\n+        # with a model default. This allows values set/derived in cleaned_data\n+        # to overwrite model defaults when the field isn't present in POST data.\n         # Defer saving file-type fields until after the other fields, so a\n         # callable upload_to can use the values from other fields.\n         if isinstance(f, models.FileField):\n",
  "7_resolved": false
}