{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__cb2c6ff3",
  "original_id": "pydata__xarray-7233",
  "1_model_selected_files": [
    "xarray/core/rolling.py",
    "xarray/core/dataset.py",
    "xarray/core/dataarray.py",
    "xarray/core/coordinates.py"
  ],
  "2_embedding_selected_files": [
    "xarray/core/rolling.py",
    "xarray/core/common.py",
    "xarray/core/coordinates.py",
    "xarray/core/dataset.py",
    "xarray/core/merge.py",
    "xarray/core/combine.py",
    "xarray/core/dataarray.py",
    "xarray/core/variable.py",
    "xarray/core/formatting.py",
    "xarray/core/concat.py",
    "xarray/core/_aggregations.py",
    "xarray/core/types.py",
    "xarray/core/indexes.py",
    "xarray/core/groupby.py",
    "xarray/core/computation.py",
    "xarray/conventions.py",
    "xarray/core/arithmetic.py",
    "xarray/core/formatting_html.py",
    "xarray/core/accessor_dt.py",
    "xarray/tutorial.py",
    "xarray/__init__.py",
    "xarray/core/ops.py",
    "xarray/core/resample.py"
  ],
  "3_final_combined_files": [
    "xarray/core/rolling.py",
    "xarray/core/dataset.py",
    "xarray/core/dataarray.py",
    "xarray/core/common.py",
    "xarray/core/coordinates.py"
  ],
  "4_related_elements": {
    "xarray/core/rolling.py": [
      "class: Coarsen\nfunction: Coarsen.construct\nclass: DatasetCoarsen\nclass: DataArrayCoarsen"
    ],
    "xarray/core/dataset.py": [
      "class: Dataset\nfunction: Dataset.coarsen\nfunction: Dataset._construct_direct\nfunction: Dataset._replace_vars_and_dims\nfunction: Dataset._replace_with_new_dims\nfunction: Dataset.set_coords"
    ],
    "xarray/core/dataarray.py": [
      "class: DataArray\nfunction: DataArray.coarsen\nfunction: DataArray.to_dataset"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "xarray/core/rolling.py": [
          "\nfunction: Coarsen.construct\nline: 976\nline: 977"
        ]
      },
      "patches": [
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..9bb263f 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinates (including non-dimension coordinates)\n+        coord_names = set(self.obj.coords)\n+        result = reshaped.set_coords(coord_names)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..b1156af 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinate variables after reshaping\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..ae27f3d 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates, not only those that are coarsened dimensions.\n+        # This ensures non-dimensional coordinates remain coordinates after construct.\n+        should_be_coords = set(obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..a113ba7 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinate variables\n+        orig_coord_names = set(self.obj.coords)\n+        should_be_coords = [name for name in orig_coord_names if name in reshaped.variables]\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..0b378d7 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates (including non-dimensional) after reshaping\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..8eee174 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates (including non-dimensional) after reshape\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..473637d 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates (both dimension and non-dimension coordinates)\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..df240b3 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates after reshaping\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..c0a2e50 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all coordinates from the original object, including non-dimension coordinates.\n+        # Previously, only coordinates whose names matched coarsened dimensions were preserved,\n+        # which incorrectly demoted non-dimension coordinates to data variables.\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..5c49573 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinates (including non-dimensional) after reshape\n+        coords_to_set = [name for name in self.obj.coords if name in reshaped.variables]\n+        result = reshaped.set_coords(coords_to_set)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "xarray/core/rolling.py": [
          "\nfunction: Coarsen.construct\nline: 976\nline: 977\nline: 978"
        ]
      },
      "patches": [
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..c39eca0 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,12 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve any coordinate variables present on the original object.\n+        # This ensures non-dimension coordinates remain coordinates after construct.\n+        orig_coords = set(self.obj.coords)\n+        # Only keep those coordinates that still exist in the reshaped dataset.\n+        existing_coords = orig_coords & set(reshaped.variables)\n+        result = reshaped.set_coords(existing_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..2301ad4 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinates (including non-dimensional ones)\n+        original_coords = list(self.obj.coords)\n+        result = reshaped.set_coords(original_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..d739175 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates (including non-dimension coordinates)\n+        should_be_coords = set(obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..53883c0 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve coordinate status for all variables that were coordinates\n+        # in the original object, not just those corresponding to coarsened dims.\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..26c8c8d 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates after constructing coarsened dimensions.\n+        should_be_coords = set(self.obj.coords)\n+        # Only set coordinates that still exist in the reshaped dataset.\n+        should_be_coords = should_be_coords & set(reshaped.variables)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..157a4ca 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates, including non-dimension coordinates\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..8b6052d 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinate variables, not just those matching coarsened dims\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..157a4ca 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates, including non-dimension coordinates\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..5341c6c 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinate variables, not just dimensional coordinates\n+        orig_coords = set(self.obj.coords)\n+        result = reshaped.set_coords(orig_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..74815d1 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve original coordinate variables (including non-dimension coords)\n+        original_coords = set(self.obj.coords)\n+        # Only set those coordinates that still exist after reshaping\n+        should_be_coords = original_coords & set(reshaped.variables)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "xarray/core/rolling.py": [
          "\nfunction: Coarsen.construct\nline: 976\nline: 977"
        ]
      },
      "patches": [
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..134a07f 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,11 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve the coordinate status for all original coordinates, including\n+        # non-dimensional coordinates. Previously, only coordinates whose names\n+        # matched the coarsened dimension keys were preserved, which demoted\n+        # other coordinates to data variables.\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..2ac460c 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates as coordinates in the reshaped result.\n+        # Previously, only coordinates corresponding to the coarsened dimensions\n+        # were kept, which incorrectly demoted non-dimensional coordinates.\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..17737b3 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinate variables, including non-dimensional coordinates,\n+        # so they remain coordinates after construct.\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..22df5a7 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates (including non-dimensional ones)\n+        # after reshaping. Restrict to variables present in the reshaped object.\n+        original_coords = set(self.obj.coords)\n+        should_be_coords = original_coords & set(reshaped.variables)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..5a4100c 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinate variables\n+        should_be_coords = set(obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..69c0728 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinate variables, not just those that were dimension names.\n+        # Variables that were coordinates before construct should remain coordinates afterwards.\n+        original_coords = set(self.obj.coords)\n+        result = reshaped.set_coords(original_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..d1f445c 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all existing coordinate variables, including non-dimensional coordinates\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..25881c5 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinate variables (including non-dimension coordinates)\n+        # after reshaping, rather than only those listed in window_dim.\n+        # This ensures coordinates are not demoted to data variables.\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..0bd7548 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        original_coord_names = set(self.obj.coords)\n+        result = reshaped.set_coords(original_coord_names)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..be36ac4 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,11 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve the coordinate status of all original coordinates\n+        # (not only the coarsened dimension coordinates).\n+        original_coord_names = set(self.obj.coords)\n+        # Only set as coordinates those that are still present after reshaping\n+        should_be_coords = original_coord_names & set(reshaped.variables)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "xarray/core/rolling.py": [
          "\nfunction: Coarsen.construct\nline: 976\nline: 977\nline: 978\nline: 979\nline: 980\nline: 981"
        ]
      },
      "patches": [
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..e69e3cf 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates after construct, including non-dimensional ones\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..6b170fd 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve coordinate status for all existing coordinates after reshape\n+        should_be_coords = set(self.obj.coords)\n+        existing_vars = set(reshaped.variables)\n+        result = reshaped.set_coords(should_be_coords & existing_vars)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..1435263 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,11 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinates (both dimension and non-dimension)\n+        # after reshaping, instead of only coordinates that share the coarsened\n+        # dimension names. This avoids demoting non-dimensional coordinates to variables.\n+        orig_coord_names = list(obj.coords)\n+        result = reshaped.set_coords(orig_coord_names)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..9a63254 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinates, including non-dimension coordinates\n+        result = reshaped.set_coords(list(self.obj.coords))\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..a387f28 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates after reshape, not only coarsened dims\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..7b15a90 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates, not just those that are dimension names.\n+        # Previously this intersected with window_dim keys, which demoted non-dimension\n+        # coordinates to data variables after construct.\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..8f8f459 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,8 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinates (dimensional and non-dimensional)\n+        should_be_coords = set(self.obj.coords)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..c5fb258 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinates (including non-dimensional ones) after construct\n+        original_coords = set(obj.coords)\n+        result = reshaped.set_coords(original_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..5d0009e 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,12 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinate variables (both dimensional and non-dimensional)\n+        # after reshaping. Previously, only coordinates whose names matched the coarsened\n+        # dimensions were preserved, which inadvertently demoted non-dimensional coordinates\n+        # to data variables.\n+        original_coords = set(self.obj.coords)\n+        result = reshaped.set_coords(original_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
        "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..f4cef08 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,7 +973,10 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n+        # Preserve all original coordinate variables after reshaping\n+        orig_coord_names = set(self.obj.coords)\n+        # Ensure we only set coordinates that are present in the reshaped Dataset\n+        should_be_coords = orig_coord_names & set(reshaped.variables)\n         result = reshaped.set_coords(should_be_coords)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/xarray/core/rolling.py b/xarray/core/rolling.py\nindex d923cdb..9bb263f 100644\n--- a/xarray/core/rolling.py\n+++ b/xarray/core/rolling.py\n@@ -973,8 +973,9 @@ class Coarsen(CoarsenArithmetic, Generic[T_Xarray]):\n             else:\n                 reshaped[key] = var\n \n-        should_be_coords = set(window_dim) & set(self.obj.coords)\n-        result = reshaped.set_coords(should_be_coords)\n+        # Preserve all original coordinates (including non-dimension coordinates)\n+        coord_names = set(self.obj.coords)\n+        result = reshaped.set_coords(coord_names)\n         if isinstance(self.obj, DataArray):\n             return self.obj._from_temp_dataset(result)\n         else:\n",
  "7_resolved": true
}