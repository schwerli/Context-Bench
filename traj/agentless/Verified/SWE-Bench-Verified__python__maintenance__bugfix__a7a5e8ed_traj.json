{
  "instance_id": "SWE-Bench-Verified__python__maintenance__bugfix__a7a5e8ed",
  "original_id": "django__django-14349",
  "1_model_selected_files": [
    "django/core/validators.py"
  ],
  "2_embedding_selected_files": [
    "django/core/validators.py",
    "django/utils/ipv6.py",
    "django/utils/html.py",
    "django/core/exceptions.py",
    "django/utils/encoding.py",
    "django/utils/autoreload.py",
    "django/utils/version.py",
    "django/utils/formats.py",
    "django/utils/__init__.py",
    "django/utils/cache.py",
    "django/utils/translation/__init__.py",
    "django/core/__init__.py",
    "django/setup.py",
    "django/utils/http.py",
    "django/utils/_os.py",
    "django/utils/translation/trans_null.py",
    "django/utils/deprecation.py",
    "django/utils/translation/trans_real.py",
    "django/utils/translation/template.py",
    "django/utils/itercompat.py",
    "django/utils/translation/reloader.py",
    "django/utils/dates.py",
    "django/utils/inspect.py",
    "django/utils/dateparse.py",
    "django/utils/text.py",
    "django/core/signing.py",
    "django/utils/crypto.py",
    "django/utils/datetime_safe.py",
    "django/shortcuts.py",
    "django/utils/log.py",
    "django/utils/duration.py",
    "django/utils/timezone.py",
    "django/__init__.py",
    "django/core/paginator.py",
    "django/utils/regex_helper.py",
    "django/utils/archive.py",
    "django/utils/dateformat.py",
    "django/utils/functional.py",
    "django/utils/module_loading.py",
    "django/utils/asyncio.py",
    "django/utils/hashable.py",
    "django/utils/xmlutils.py",
    "django/utils/deconstruct.py",
    "django/utils/safestring.py",
    "django/core/signals.py",
    "django/utils/feedgenerator.py",
    "django/utils/jslex.py",
    "django/utils/datastructures.py",
    "django/utils/lorem_ipsum.py",
    "django/utils/termcolors.py",
    "django/utils/decorators.py",
    "django/__main__.py",
    "django/core/wsgi.py",
    "django/utils/baseconv.py",
    "django/utils/timesince.py",
    "django/core/asgi.py",
    "django/utils/connection.py",
    "django/utils/numberformat.py",
    "django/utils/topological_sort.py",
    "django/utils/tree.py"
  ],
  "3_final_combined_files": [
    "django/core/validators.py",
    "django/utils/ipv6.py",
    "django/utils/html.py"
  ],
  "4_related_elements": {
    "django/core/validators.py": [
      "class: URLValidator\nclass: RegexValidator\nclass: ProhibitNullCharactersValidator\nfunction: validate_ipv4_address\nfunction: validate_ipv6_address\nfunction: validate_ipv46_address"
    ],
    "django/utils/ipv6.py": [
      "function: clean_ipv6_address\nfunction: is_valid_ipv6_address"
    ],
    "django/utils/html.py": [
      "variable: word_split_re\nvariable: simple_url_re\nvariable: simple_url_2_re\nfunction: smart_urlquote\nfunction: urlize"
    ]
  },
  "5_sampled_edit_locs_and_patches": [
    {
      "sample_index": 0,
      "edit_locs": {
        "django/core/validators.py": [
          "\nfunction: URLValidator.__call__"
        ]
      },
      "patches": [
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..4e3f9d7 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -106,6 +106,10 @@ class URLValidator(RegexValidator):\n         if scheme not in self.schemes:\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n \n+        # Disallow control characters that urllib.parse may strip (bpo-43882).\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n+\n         # Then check full URL\n         try:\n             super().__call__(value)\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..bd70c59 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that may be stripped by urlsplit() in newer Python versions.\n+        # See bpo-43882; Django should treat URLs containing CR, LF, or TAB as invalid.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..bd5082e 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing prohibited control characters that urlsplit() strips.\n+        # See Python bpo-43882; ensure consistent validation regardless of splitting behavior.\n+        if any(c in value for c in '\\r\\n\\t'):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..6fa0ed3 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that urllib.parse.urlsplit() strips (see bpo-43882).\n+        if re.search(r'[\\r\\n\\t]', value):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..d1cd23f 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control whitespace characters that urllib.parse strips (bpo-43882).\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..8c5f197 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control whitespace that urllib.parse.urlsplit() may strip (bpo-43882).\n+        # Ensure consistent behavior across Python versions by failing early.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..d3b6c63 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,11 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing ASCII control whitespace that urlsplit() may strip.\n+        # See Python bpo-43882: urlsplit() strips CR, LF, and TAB before splitting.\n+        # Ensure consistent validation by rejecting them explicitly.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..93308a8 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that some Python versions strip before splitting.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..7370ea3 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Disallow control characters that urlsplit() strips (see bpo-43882) to ensure consistent validation.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..b481810 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters (CR, LF, TAB) early, before any URL splitting\n+        # that may strip them (see Python bpo-43882).\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n"
      ]
    },
    {
      "sample_index": 1,
      "edit_locs": {
        "django/core/validators.py": [
          "\nfunction: URLValidator.__call__"
        ],
        "django/utils/html.py": [
          "\nfunction: smart_urlquote"
        ]
      },
      "patches": [
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..3074188 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control whitespace that Python's urlsplit may strip (bpo-43882).\n+        # Preserve Django's behavior of considering CR/LF/TAB in URLs invalid.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..d87ba5d 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing ASCII control whitespace that may be stripped by urlsplit.\n+        # Ensure such inputs are consistently invalid regardless of Python's urlsplit behavior.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..d694252 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that are stripped by urlsplit() in Python â‰¥ 3.9 (bpo-43882).\n+        # Ensures that URLs containing CR, LF, or TAB are considered invalid before any splitting.\n+        if any(char in value for char in '\\r\\n\\t'):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..2cbb430 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that urllib.parse.urlsplit() strips (CR, LF, TAB).\n+        # See Python bpo-43882; ensure such URLs are considered invalid.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..d6317a2 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing prohibited control characters that urlsplit() strips.\n+        # See Python bpo-43882. Validate against original input to avoid silent acceptance.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..7f9f4b1 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that are forbidden in URLs (CR, LF, TAB).\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..101d28b 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that are stripped by urlsplit (see Python bpo-43882).\n+        # These characters must not appear in a URL.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..032e291 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject ASCII control/whitespace characters that urlsplit() may strip.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..e051d35 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that urllib.parse.urlsplit() may strip.\n+        if any(char in value for char in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..928b55b 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that may be stripped by urlsplit() on newer Python versions (bpo-43882).\n+        # Keep previous behavior by raising for URLs containing CR, LF, or TAB.\n+        if re.search(r'[\\r\\n\\t]', value):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n"
      ]
    },
    {
      "sample_index": 2,
      "edit_locs": {
        "django/core/validators.py": [
          "\nfunction: URLValidator.__call__"
        ]
      },
      "patches": [
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..909b737 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that may be stripped by urlsplit() in some Python versions.\n+        if any(c in value for c in '\\r\\n\\t'):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..4e4f38f 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,12 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+\n+        # Reject URLs containing control characters that may be stripped by urlsplit()\n+        # on newer Python versions (see bpo-43882). These should be considered invalid.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n+\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..c7bcdf0 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that may be stripped by urlsplit() (see bpo-43882).\n+        # These should cause validation to fail rather than be silently ignored.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..5bbf160 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing forbidden control characters that urlsplit() may strip (CR, LF, TAB).\n+        # This ensures consistent validation regardless of Python's urlsplit behavior (bpo-43882).\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..9cf6339 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that should not appear in URLs. Python's urlsplit()\n+        # strips these (bpo-43882), which would let invalid inputs pass validation.\n+        if any(c in value for c in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..7d9a4f3 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing control characters that may be stripped by urlsplit (bpo-43882).\n+        # Explicitly disallow CR, LF, and tab anywhere in the URL to avoid accepting a sanitized URL.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..a9c1d50 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,11 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing ASCII control characters that should never\n+        # appear in a URL. Python's urlsplit() strips these (bpo-43882),\n+        # which could otherwise allow such inputs to pass validation.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..e64b7e1 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing ASCII control characters that urlsplit() may strip.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..8029e08 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,12 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that should not appear in URLs. On newer\n+        # Python versions, urlsplit() strips these, which could otherwise cause\n+        # invalid URLs to be accepted during IDN fallback. Reject early to keep\n+        # consistent behavior across Python versions.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..325f49f 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that urllib.parse.urlsplit() strips on some Python versions (bpo-43882).\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n"
      ]
    },
    {
      "sample_index": 3,
      "edit_locs": {
        "django/core/validators.py": [
          "\nfunction: URLValidator.__call__"
        ]
      },
      "patches": [
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..f863f3f 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,11 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters early. On Python versions patched for bpo-43882,\n+        # urlsplit() strips CR/LF/TAB before splitting, which could cause invalid\n+        # URLs to be accepted. Ensure such URLs are rejected consistently.\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..8c9a24f 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that urlsplit() would strip (CR, LF, TAB).\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..64ce9a4 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters (CR, LF, TAB) which urlsplit() strips, to maintain validation.\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..0e7e5f5 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that may be stripped by urlsplit (bpo-43882).\n+        if '\\r' in value or '\\n' in value or '\\t' in value:\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..d5a228c 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing ASCII control whitespace that may be stripped by urlsplit.\n+        # See Python bpo-43882. Django should treat CR, LF, and TAB as invalid in URLs.\n+        if re.search(r'[\\r\\n\\t]', value):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..4da9025 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control whitespace characters that urllib.parse.urlsplit() strips\n+        # (CR, LF, and tab) to avoid silently accepting invalid input.\n+        if any(char in value for char in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..b6dd1f1 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,9 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject control characters that may be stripped by urlsplit(), to ensure invalid URLs are not accepted.\n+        if any(c in value for c in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..7143efe 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing control characters that are stripped by urlsplit in Python >= 3.9 (bpo-43882).\n+        # Always validate the raw input rather than the sanitized split result.\n+        if ('\\r' in value) or ('\\n' in value) or ('\\t' in value):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..abc069b 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing ASCII control characters that may be stripped by urlsplit()\n+        # (see Python bpo-43882). These should be considered invalid.\n+        if any(ch in value for ch in '\\r\\n\\t'):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n",
        "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..8e1a83d 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -101,6 +101,10 @@ class URLValidator(RegexValidator):\n     def __call__(self, value):\n         if not isinstance(value, str):\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n+        # Reject URLs containing control characters that should not appear in URLs.\n+        # Python's urlsplit() strips these (see bpo-43882), which could mask invalid input.\n+        if any(ch in value for ch in '\\r\\n\\t'):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n         # Check if the scheme is valid.\n         scheme = value.split('://')[0].lower()\n         if scheme not in self.schemes:\n"
      ]
    }
  ],
  "6_final_selected_patch": "diff --git a/django/core/validators.py b/django/core/validators.py\nindex fde6d56..4e3f9d7 100644\n--- a/django/core/validators.py\n+++ b/django/core/validators.py\n@@ -106,6 +106,10 @@ class URLValidator(RegexValidator):\n         if scheme not in self.schemes:\n             raise ValidationError(self.message, code=self.code, params={'value': value})\n \n+        # Disallow control characters that urllib.parse may strip (bpo-43882).\n+        if any(ch in value for ch in ('\\r', '\\n', '\\t')):\n+            raise ValidationError(self.message, code=self.code, params={'value': value})\n+\n         # Then check full URL\n         try:\n             super().__call__(value)\n",
  "7_resolved": true
}