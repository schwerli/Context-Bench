{
    "instance_id": "SWE-Bench-Pro__python__maintenance__bugfix__2464eadb",
    "original_id": "instance_ansible__ansible-77658704217d5f166404fc67997203c25381cb6e-v390e508d27db7a51eece36bb6d9698b63a5b638a",
    "1_model_selected_files": [
        "lib/ansible/modules/network/nxos/nxos_vrf_af.py",
        "lib/ansible/module_utils/network/nxos/nxos.py"
    ],
    "2_embedding_selected_files": [],
    "3_final_combined_files": [
        "lib/ansible/modules/network/nxos/nxos_vrf_af.py",
        "lib/ansible/module_utils/network/nxos/nxos.py"
    ],
    "4_related_elements": {
        "lib/ansible/modules/network/nxos/nxos_vrf_af.py": [
            "variable: DOCUMENTATION\nvariable: EXAMPLES\nvariable: RETURN\nfunction: main"
        ],
        "lib/ansible/module_utils/network/nxos/nxos.py": [
            "class: NxosCmdRef\nfunction: get_config\nfunction: run_commands\nfunction: load_config"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "lib/ansible/modules/network/nxos/nxos_vrf_af.py": [
                    "line: 35\nline: 45\nline: 58\nfunction: main\nline: 81\nline: 112\nline: 124"
                ],
                "lib/ansible/module_utils/network/nxos/nxos.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/ansible/modules/network/nxos/nxos_vrf_af.py b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\nindex 9961af7..fe55b29 100644\n--- a/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n+++ b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n@@ -47,6 +47,21 @@ options:\n       - Enable/Disable the EVPN route-target 'auto' setting for both\n         import and export target communities.\n     type: bool\n+  route_target_import:\n+    description:\n+      - List of route-target values to configure with import direction.\n+      - Multiple entries are supported.\n+    type: list\n+  route_target_export:\n+    description:\n+      - List of route-target values to configure with export direction.\n+      - Multiple entries are supported.\n+    type: list\n+  route_target_both:\n+    description:\n+      - List of route-target values to configure with both import and export direction.\n+      - Multiple entries are supported.\n+    type: list\n   state:\n     description:\n       - Determines whether the config should be present or\n@@ -60,6 +75,14 @@ EXAMPLES = '''\n     vrf: ntc\n     afi: ipv4\n     route_target_both_auto_evpn: True\n+    route_target_import:\n+      - 1:1\n+      - 2:2\n+    route_target_export:\n+      - 1:1\n+      - 2:2\n+    route_target_both:\n+      - 65000:100\n     state: present\n '''\n \n@@ -81,6 +104,9 @@ def main():\n         vrf=dict(required=True),\n         afi=dict(required=True, choices=['ipv4', 'ipv6']),\n         route_target_both_auto_evpn=dict(required=False, type='bool'),\n+        route_target_import=dict(required=False, type='list'),\n+        route_target_export=dict(required=False, type='list'),\n+        route_target_both=dict(required=False, type='list'),\n         state=dict(choices=['present', 'absent'], default='present'),\n     )\n \n@@ -109,21 +135,71 @@ def main():\n \n     elif module.params['state'] == 'present':\n \n+        af_cmd_added = False\n+\n         if current:\n-            have = 'route-target both auto evpn' in current\n+            have_auto = 'route-target both auto evpn' in current\n             if module.params['route_target_both_auto_evpn'] is not None:\n-                want = bool(module.params['route_target_both_auto_evpn'])\n-                if want and not have:\n+                want_auto = bool(module.params['route_target_both_auto_evpn'])\n+                if want_auto and not have_auto:\n                     commands.append('address-family %s unicast' % module.params['afi'])\n+                    af_cmd_added = True\n                     commands.append('route-target both auto evpn')\n-                elif have and not want:\n+                elif have_auto and not want_auto:\n                     commands.append('address-family %s unicast' % module.params['afi'])\n+                    af_cmd_added = True\n                     commands.append('no route-target both auto evpn')\n \n+            # Parse current route-targets present\n+            present_import = set()\n+            present_export = set()\n+            present_both = set()\n+            for line in current.splitlines():\n+                line = line.strip()\n+                if line.startswith('route-target import '):\n+                    present_import.add(line.replace('route-target import ', '', 1).strip())\n+                elif line.startswith('route-target export '):\n+                    present_export.add(line.replace('route-target export ', '', 1).strip())\n+                elif line.startswith('route-target both '):\n+                    val = line.replace('route-target both ', '', 1).strip()\n+                    if val != 'auto evpn':\n+                        present_both.add(val)\n+\n+            # Ensure desired route-targets exist\n+            for val in module.params.get('route_target_import') or []:\n+                sval = str(val)\n+                if sval not in present_import:\n+                    if not af_cmd_added:\n+                        commands.append('address-family %s unicast' % module.params['afi'])\n+                        af_cmd_added = True\n+                    commands.append('route-target import %s' % sval)\n+\n+            for val in module.params.get('route_target_export') or []:\n+                sval = str(val)\n+                if sval not in present_export:\n+                    if not af_cmd_added:\n+                        commands.append('address-family %s unicast' % module.params['afi'])\n+                        af_cmd_added = True\n+                    commands.append('route-target export %s' % sval)\n+\n+            for val in module.params.get('route_target_both') or []:\n+                sval = str(val)\n+                if sval not in present_both:\n+                    if not af_cmd_added:\n+                        commands.append('address-family %s unicast' % module.params['afi'])\n+                        af_cmd_added = True\n+                    commands.append('route-target both %s' % sval)\n+\n         else:\n             commands.append('address-family %s unicast' % module.params['afi'])\n-            if module.params['route_target_both_auto_evpn']:\n+            if module.params.get('route_target_both_auto_evpn'):\n                 commands.append('route-target both auto evpn')\n+            for val in module.params.get('route_target_import') or []:\n+                commands.append('route-target import %s' % str(val))\n+            for val in module.params.get('route_target_export') or []:\n+                commands.append('route-target export %s' % str(val))\n+            for val in module.params.get('route_target_both') or []:\n+                commands.append('route-target both %s' % str(val))\n \n     if commands:\n         commands.insert(0, 'vrf context %s' % module.params['vrf'])\n",
                "diff --git a/lib/ansible/modules/network/nxos/nxos_vrf_af.py b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\nindex 9961af7..c58a606 100644\n--- a/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n+++ b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n@@ -81,6 +81,9 @@ def main():\n         vrf=dict(required=True),\n         afi=dict(required=True, choices=['ipv4', 'ipv6']),\n         route_target_both_auto_evpn=dict(required=False, type='bool'),\n+        route_target_import=dict(required=False, type='list'),\n+        route_target_export=dict(required=False, type='list'),\n+        route_target_both=dict(required=False, type='list'),\n         state=dict(choices=['present', 'absent'], default='present'),\n     )\n \n@@ -95,8 +98,12 @@ def main():\n     config_text = get_config(module)\n     config = NetworkConfig(indent=2, contents=config_text)\n \n-    path = ['vrf context %s' % module.params['vrf'],\n-            'address-family %s unicast' % module.params['afi']]\n+    vrf = module.params['vrf']\n+    afi = module.params['afi']\n+    af_line = 'address-family %s unicast' % afi\n+\n+    path = ['vrf context %s' % vrf,\n+            af_line]\n \n     try:\n         current = config.get_block_config(path)\n@@ -104,29 +111,99 @@ def main():\n         current = None\n \n     commands = list()\n-    if current and module.params['state'] == 'absent':\n-        commands.append('no address-family %s unicast' % module.params['afi'])\n+    state = module.params['state']\n \n-    elif module.params['state'] == 'present':\n+    if current and state == 'absent':\n+        commands.append('no address-family %s unicast' % afi)\n \n+    elif state == 'present':\n+        # Ensure EVPN 'auto' handling and manual route-targets\n         if current:\n-            have = 'route-target both auto evpn' in current\n+            # Handle EVPN auto setting\n+            have_auto = 'route-target both auto evpn' in current\n             if module.params['route_target_both_auto_evpn'] is not None:\n-                want = bool(module.params['route_target_both_auto_evpn'])\n-                if want and not have:\n-                    commands.append('address-family %s unicast' % module.params['afi'])\n+                want_auto = bool(module.params['route_target_both_auto_evpn'])\n+                if want_auto and not have_auto:\n+                    if af_line not in commands:\n+                        commands.append(af_line)\n                     commands.append('route-target both auto evpn')\n-                elif have and not want:\n-                    commands.append('address-family %s unicast' % module.params['afi'])\n+                elif have_auto and not want_auto:\n+                    if af_line not in commands:\n+                        commands.append(af_line)\n                     commands.append('no route-target both auto evpn')\n \n+            # Parse current manual route-targets\n+            current_import = set()\n+            current_export = set()\n+            current_both = set()\n+            for line in current.splitlines():\n+                l = line.strip()\n+                if not l.startswith('route-target '):\n+                    continue\n+                parts = l.split()\n+                if len(parts) < 3:\n+                    continue\n+                direction = parts[1]\n+                # Skip the EVPN auto line which is handled separately\n+                if direction == 'both' and len(parts) >= 3 and parts[2] == 'auto':\n+                    continue\n+                if direction in ('import', 'export', 'both'):\n+                    # route-target <dir> <value>\n+                    if len(parts) >= 3:\n+                        value = parts[2]\n+                        if direction == 'import':\n+                            current_import.add(value)\n+                        elif direction == 'export':\n+                            current_export.add(value)\n+                        elif direction == 'both':\n+                            current_both.add(value)\n+\n+            # Desired manual route-targets management\n+            desired_map = {\n+                'import': module.params.get('route_target_import'),\n+                'export': module.params.get('route_target_export'),\n+                'both': module.params.get('route_target_both'),\n+            }\n+            current_map = {\n+                'import': current_import,\n+                'export': current_export,\n+                'both': current_both,\n+            }\n+\n+            for direction, desired in desired_map.items():\n+                # Only manage if parameter provided (including empty list to remove all)\n+                if desired is not None:\n+                    want_set = set(desired)\n+                    have_set = current_map[direction]\n+                    to_add = sorted(want_set - have_set)\n+                    to_remove = sorted(have_set - want_set)\n+                    for val in to_add:\n+                        if af_line not in commands:\n+                            commands.append(af_line)\n+                        commands.append('route-target %s %s' % (direction, val))\n+                    for val in to_remove:\n+                        if af_line not in commands:\n+                            commands.append(af_line)\n+                        commands.append('no route-target %s %s' % (direction, val))\n+\n         else:\n-            commands.append('address-family %s unicast' % module.params['afi'])\n+            # Address-family block not present; create and apply desired settings\n+            commands.append(af_line)\n             if module.params['route_target_both_auto_evpn']:\n                 commands.append('route-target both auto evpn')\n \n+            if module.params.get('route_target_import'):\n+                for val in module.params.get('route_target_import') or []:\n+                    commands.append('route-target import %s' % val)\n+            if module.params.get('route_target_export'):\n+                for val in module.params.get('route_target_export') or []:\n+                    commands.append('route-target export %s' % val)\n+            if module.params.get('route_target_both'):\n+                for val in module.params.get('route_target_both') or []:\n+                    commands.append('route-target both %s' % val)\n+\n     if commands:\n-        commands.insert(0, 'vrf context %s' % module.params['vrf'])\n+        commands.insert(0, 'vrf context %s' % vrf)\n         if not module.check_mode:\n             load_config(module, commands)\n         result['changed'] = True\n@@ -137,4 +214,4 @@ def main():\n \n \n if __name__ == '__main__':\n-    main()\n+    main()\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "lib/ansible/modules/network/nxos/nxos_vrf_af.py": [
                    "line: 45\nline: 46\nline: 47\nline: 48\nline: 49\nline: 50\nline: 51\nline: 52\nline: 53\nline: 54\nline: 55\nline: 56\nline: 58\nline: 59\nline: 60\nline: 61\nline: 62\nline: 63\nline: 80\nline: 81\nline: 82\nline: 83\nline: 84\nline: 85\nfunction: main\nline: 111\nline: 112\nline: 113\nline: 114\nline: 115\nline: 116\nline: 117\nline: 118\nline: 119\nline: 120\nline: 121\nline: 122\nline: 124\nline: 125\nline: 126\nline: 127"
                ],
                "lib/ansible/module_utils/network/nxos/nxos.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/ansible/modules/network/nxos/nxos_vrf_af.py b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\nindex 9961af7..810eefb 100644\n--- a/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n+++ b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n@@ -47,6 +47,18 @@ options:\n       - Enable/Disable the EVPN route-target 'auto' setting for both\n         import and export target communities.\n     type: bool\n+  route_target_import:\n+    description:\n+      - List of route-target community values to import under the address-family.\n+    type: list\n+  route_target_export:\n+    description:\n+      - List of route-target community values to export under the address-family.\n+    type: list\n+  route_target_both:\n+    description:\n+      - List of route-target community values to apply to both import and export under the address-family.\n+    type: list\n   state:\n     description:\n       - Determines whether the config should be present or\n@@ -56,11 +68,24 @@ options:\n '''\n \n EXAMPLES = '''\n-- nxos_vrf_af:\n+- name: Enable EVPN auto route-targets for both import/export\n+  nxos_vrf_af:\n     vrf: ntc\n     afi: ipv4\n     route_target_both_auto_evpn: True\n     state: present\n+\n+- name: Manually configure multiple route-targets under VRF address-family\n+  nxos_vrf_af:\n+    vrf: vrfA\n+    afi: ipv4\n+    route_target_import:\n+      - 1:1\n+      - 2:2\n+    route_target_export:\n+      - 1:1\n+      - 2:2\n+    state: present\n '''\n \n RETURN = '''\n@@ -81,6 +106,9 @@ def main():\n         vrf=dict(required=True),\n         afi=dict(required=True, choices=['ipv4', 'ipv6']),\n         route_target_both_auto_evpn=dict(required=False, type='bool'),\n+        route_target_import=dict(required=False, type='list'),\n+        route_target_export=dict(required=False, type='list'),\n+        route_target_both=dict(required=False, type='list'),\n         state=dict(choices=['present', 'absent'], default='present'),\n     )\n \n@@ -108,23 +136,66 @@ def main():\n         commands.append('no address-family %s unicast' % module.params['afi'])\n \n     elif module.params['state'] == 'present':\n+        af = module.params['afi']\n+        rt_import = module.params.get('route_target_import')\n+        rt_export = module.params.get('route_target_export')\n+        rt_both = module.params.get('route_target_both')\n+        rtae = module.params.get('route_target_both_auto_evpn')\n+\n+        have_import = set()\n+        have_export = set()\n+        have_both = set()\n+        have_auto = False\n \n         if current:\n-            have = 'route-target both auto evpn' in current\n-            if module.params['route_target_both_auto_evpn'] is not None:\n-                want = bool(module.params['route_target_both_auto_evpn'])\n-                if want and not have:\n-                    commands.append('address-family %s unicast' % module.params['afi'])\n+            for line in current.splitlines():\n+                line = line.strip()\n+                if line.startswith('route-target import '):\n+                    have_import.add(line.split('route-target import ', 1)[1].strip())\n+                elif line.startswith('route-target export '):\n+                    have_export.add(line.split('route-target export ', 1)[1].strip())\n+                elif line.startswith('route-target both '):\n+                    rest = line.split('route-target both ', 1)[1].strip()\n+                    if rest == 'auto evpn':\n+                        have_auto = True\n+                    else:\n+                        have_both.add(rest)\n+\n+            # Toggle EVPN auto both if explicitly requested\n+            if rtae is not None:\n+                want_auto = bool(rtae)\n+                if want_auto and not have_auto:\n+                    commands.append('address-family %s unicast' % af)\n                     commands.append('route-target both auto evpn')\n-                elif have and not want:\n-                    commands.append('address-family %s unicast' % module.params['afi'])\n+                elif have_auto and not want_auto:\n+                    commands.append('address-family %s unicast' % af)\n                     commands.append('no route-target both auto evpn')\n-\n         else:\n-            commands.append('address-family %s unicast' % module.params['afi'])\n-            if module.params['route_target_both_auto_evpn']:\n+            # Create the address-family if it does not exist\n+            commands.append('address-family %s unicast' % af)\n+            if rtae:\n                 commands.append('route-target both auto evpn')\n \n+        # Helper to ensure address-family is entered once before making changes\n+        def ensure_kind(kind, wanted, have):\n+            if wanted is None:\n+                return\n+            wanted_set = set(wanted)\n+            add = sorted(wanted_set - have)\n+            remove = sorted(have - wanted_set)\n+            if add or remove:\n+                if ('address-family %s unicast' % af) not in commands:\n+                    commands.append('address-family %s unicast' % af)\n+                for v in add:\n+                    commands.append('route-target %s %s' % (kind, v))\n+                for v in remove:\n+                    commands.append('no route-target %s %s' % (kind, v))\n+\n+        # Apply desired route-targets; only touch kinds explicitly provided\n+        ensure_kind('import', rt_import, have_import)\n+        ensure_kind('export', rt_export, have_export)\n+        ensure_kind('both', rt_both, have_both)\n+\n     if commands:\n         commands.insert(0, 'vrf context %s' % module.params['vrf'])\n         if not module.check_mode:\n",
                "diff --git a/lib/ansible/modules/network/nxos/nxos_vrf_af.py b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\nindex 9961af7..117ee9a 100644\n--- a/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n+++ b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n@@ -47,6 +47,21 @@ options:\n       - Enable/Disable the EVPN route-target 'auto' setting for both\n         import and export target communities.\n     type: bool\n+  route_target_import:\n+    description:\n+      - List of manual route-target values to import under the VRF address-family.\n+      - Multiple entries are supported.\n+    type: list\n+  route_target_export:\n+    description:\n+      - List of manual route-target values to export under the VRF address-family.\n+      - Multiple entries are supported.\n+    type: list\n+  route_target_both:\n+    description:\n+      - List of manual route-target values to apply for both import and export under the VRF address-family.\n+      - Multiple entries are supported.\n+    type: list\n   state:\n     description:\n       - Determines whether the config should be present or\n@@ -56,10 +71,31 @@ options:\n '''\n \n EXAMPLES = '''\n-- nxos_vrf_af:\n-    vrf: ntc\n+- name: Enable EVPN auto and configure manual route-targets for IPv4 AF\n+  nxos_vrf_af:\n+    vrf: vrfA\n     afi: ipv4\n     route_target_both_auto_evpn: True\n+    route_target_import:\n+      - 1:1\n+      - 2:2\n+    route_target_export:\n+      - 1:1\n+      - 2:2\n+    state: present\n+\n+- name: Configure manual route-targets for IPv6 AF without EVPN auto\n+  nxos_vrf_af:\n+    vrf: vrfA\n+    afi: ipv6\n+    route_target_both:\n+      - 100:100\n+    route_target_import:\n+      - 1:1\n+      - 2:2\n+    route_target_export:\n+      - 1:1\n+      - 2:2\n     state: present\n '''\n \n@@ -81,6 +117,9 @@ def main():\n         vrf=dict(required=True),\n         afi=dict(required=True, choices=['ipv4', 'ipv6']),\n         route_target_both_auto_evpn=dict(required=False, type='bool'),\n+        route_target_import=dict(required=False, type='list'),\n+        route_target_export=dict(required=False, type='list'),\n+        route_target_both=dict(required=False, type='list'),\n         state=dict(choices=['present', 'absent'], default='present'),\n     )\n \n@@ -109,21 +148,73 @@ def main():\n \n     elif module.params['state'] == 'present':\n \n-        if current:\n-            have = 'route-target both auto evpn' in current\n-            if module.params['route_target_both_auto_evpn'] is not None:\n-                want = bool(module.params['route_target_both_auto_evpn'])\n-                if want and not have:\n-                    commands.append('address-family %s unicast' % module.params['afi'])\n-                    commands.append('route-target both auto evpn')\n-                elif have and not want:\n-                    commands.append('address-family %s unicast' % module.params['afi'])\n-                    commands.append('no route-target both auto evpn')\n+        # Parse current config for existing route-targets and EVPN auto\n+        have_auto = False\n+        import_current = set()\n+        export_current = set()\n+        both_current = set()\n \n-        else:\n+        if current:\n+            lines = [l.strip() for l in current.splitlines()]\n+            for line in lines:\n+                if line.startswith('route-target both auto evpn'):\n+                    have_auto = True\n+                elif line.startswith('route-target import '):\n+                    val = line[len('route-target import '):].strip()\n+                    if val:\n+                        import_current.add(val)\n+                elif line.startswith('route-target export '):\n+                    val = line[len('route-target export '):].strip()\n+                    if val:\n+                        export_current.add(val)\n+                elif line.startswith('route-target both '):\n+                    remainder = line[len('route-target both '):].strip()\n+                    # Ignore auto evpn when parsing manual 'both' values\n+                    if remainder and not remainder.startswith('auto'):\n+                        both_current.add(remainder)\n+\n+        rt_cmds = []\n+\n+        # Handle EVPN auto setting for both import/export\n+        if module.params['route_target_both_auto_evpn'] is not None:\n+            want_auto = bool(module.params['route_target_both_auto_evpn'])\n+            if want_auto and not have_auto:\n+                rt_cmds.append('route-target both auto evpn')\n+            elif have_auto and not want_auto:\n+                rt_cmds.append('no route-target both auto evpn')\n+\n+        # Handle manual route-target import values\n+        if module.params.get('route_target_import') is not None:\n+            want_import = set(module.params.get('route_target_import') or [])\n+            for val in sorted(want_import - import_current):\n+                rt_cmds.append('route-target import %s' % val)\n+            for val in sorted(import_current - want_import):\n+                rt_cmds.append('no route-target import %s' % val)\n+\n+        # Handle manual route-target export values\n+        if module.params.get('route_target_export') is not None:\n+            want_export = set(module.params.get('route_target_export') or [])\n+            for val in sorted(want_export - export_current):\n+                rt_cmds.append('route-target export %s' % val)\n+            for val in sorted(export_current - want_export):\n+                rt_cmds.append('no route-target export %s' % val)\n+\n+        # Handle manual route-target both values\n+        if module.params.get('route_target_both') is not None:\n+            want_both = set(module.params.get('route_target_both') or [])\n+            for val in sorted(want_both - both_current):\n+                rt_cmds.append('route-target both %s' % val)\n+            for val in sorted(both_current - want_both):\n+                rt_cmds.append('no route-target both %s' % val)\n+\n+        # If we have any route-target commands to send, ensure we enter AF context first\n+        if rt_cmds:\n             commands.append('address-family %s unicast' % module.params['afi'])\n-            if module.params['route_target_both_auto_evpn']:\n-                commands.append('route-target both auto evpn')\n+            commands.extend(rt_cmds)\n+        else:\n+            # Ensure the address-family is created when state=present even without RT changes\n+            if not current:\n+                commands.append('address-family %s unicast' % module.params['afi'])\n \n     if commands:\n         commands.insert(0, 'vrf context %s' % module.params['vrf'])\n@@ -137,4 +228,4 @@ def main():\n \n \n if __name__ == '__main__':\n-    main()\n+    main()\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/lib/ansible/modules/network/nxos/nxos_vrf_af.py b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\nindex 9961af7..fe55b29 100644\n--- a/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n+++ b/lib/ansible/modules/network/nxos/nxos_vrf_af.py\n@@ -47,6 +47,21 @@ options:\n       - Enable/Disable the EVPN route-target 'auto' setting for both\n         import and export target communities.\n     type: bool\n+  route_target_import:\n+    description:\n+      - List of route-target values to configure with import direction.\n+      - Multiple entries are supported.\n+    type: list\n+  route_target_export:\n+    description:\n+      - List of route-target values to configure with export direction.\n+      - Multiple entries are supported.\n+    type: list\n+  route_target_both:\n+    description:\n+      - List of route-target values to configure with both import and export direction.\n+      - Multiple entries are supported.\n+    type: list\n   state:\n     description:\n       - Determines whether the config should be present or\n@@ -60,6 +75,14 @@ EXAMPLES = '''\n     vrf: ntc\n     afi: ipv4\n     route_target_both_auto_evpn: True\n+    route_target_import:\n+      - 1:1\n+      - 2:2\n+    route_target_export:\n+      - 1:1\n+      - 2:2\n+    route_target_both:\n+      - 65000:100\n     state: present\n '''\n \n@@ -81,6 +104,9 @@ def main():\n         vrf=dict(required=True),\n         afi=dict(required=True, choices=['ipv4', 'ipv6']),\n         route_target_both_auto_evpn=dict(required=False, type='bool'),\n+        route_target_import=dict(required=False, type='list'),\n+        route_target_export=dict(required=False, type='list'),\n+        route_target_both=dict(required=False, type='list'),\n         state=dict(choices=['present', 'absent'], default='present'),\n     )\n \n@@ -109,21 +135,71 @@ def main():\n \n     elif module.params['state'] == 'present':\n \n+        af_cmd_added = False\n+\n         if current:\n-            have = 'route-target both auto evpn' in current\n+            have_auto = 'route-target both auto evpn' in current\n             if module.params['route_target_both_auto_evpn'] is not None:\n-                want = bool(module.params['route_target_both_auto_evpn'])\n-                if want and not have:\n+                want_auto = bool(module.params['route_target_both_auto_evpn'])\n+                if want_auto and not have_auto:\n                     commands.append('address-family %s unicast' % module.params['afi'])\n+                    af_cmd_added = True\n                     commands.append('route-target both auto evpn')\n-                elif have and not want:\n+                elif have_auto and not want_auto:\n                     commands.append('address-family %s unicast' % module.params['afi'])\n+                    af_cmd_added = True\n                     commands.append('no route-target both auto evpn')\n \n+            # Parse current route-targets present\n+            present_import = set()\n+            present_export = set()\n+            present_both = set()\n+            for line in current.splitlines():\n+                line = line.strip()\n+                if line.startswith('route-target import '):\n+                    present_import.add(line.replace('route-target import ', '', 1).strip())\n+                elif line.startswith('route-target export '):\n+                    present_export.add(line.replace('route-target export ', '', 1).strip())\n+                elif line.startswith('route-target both '):\n+                    val = line.replace('route-target both ', '', 1).strip()\n+                    if val != 'auto evpn':\n+                        present_both.add(val)\n+\n+            # Ensure desired route-targets exist\n+            for val in module.params.get('route_target_import') or []:\n+                sval = str(val)\n+                if sval not in present_import:\n+                    if not af_cmd_added:\n+                        commands.append('address-family %s unicast' % module.params['afi'])\n+                        af_cmd_added = True\n+                    commands.append('route-target import %s' % sval)\n+\n+            for val in module.params.get('route_target_export') or []:\n+                sval = str(val)\n+                if sval not in present_export:\n+                    if not af_cmd_added:\n+                        commands.append('address-family %s unicast' % module.params['afi'])\n+                        af_cmd_added = True\n+                    commands.append('route-target export %s' % sval)\n+\n+            for val in module.params.get('route_target_both') or []:\n+                sval = str(val)\n+                if sval not in present_both:\n+                    if not af_cmd_added:\n+                        commands.append('address-family %s unicast' % module.params['afi'])\n+                        af_cmd_added = True\n+                    commands.append('route-target both %s' % sval)\n+\n         else:\n             commands.append('address-family %s unicast' % module.params['afi'])\n-            if module.params['route_target_both_auto_evpn']:\n+            if module.params.get('route_target_both_auto_evpn'):\n                 commands.append('route-target both auto evpn')\n+            for val in module.params.get('route_target_import') or []:\n+                commands.append('route-target import %s' % str(val))\n+            for val in module.params.get('route_target_export') or []:\n+                commands.append('route-target export %s' % str(val))\n+            for val in module.params.get('route_target_both') or []:\n+                commands.append('route-target both %s' % str(val))\n \n     if commands:\n         commands.insert(0, 'vrf context %s' % module.params['vrf'])\n"
}