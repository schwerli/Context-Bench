{
    "instance_id": "SWE-Bench-Pro__python__maintenance__bugfix__e6efdd87",
    "original_id": "instance_ansible__ansible-cb94c0cc550df9e98f1247bc71d8c2b861c75049-v1055803c3a812189a1133297f7f5468579283f86",
    "1_model_selected_files": [
        "lib/ansible/cli/console.py",
        "lib/ansible/cli/adhoc.py",
        "lib/ansible/playbook/task_include.py",
        "lib/ansible/cli/arguments/option_helpers.py",
        "lib/ansible/playbook/task.py"
    ],
    "2_embedding_selected_files": [
        "lib/ansible/plugins/action/pause.py",
        "lib/ansible/cli/adhoc.py",
        "lib/ansible/executor/task_executor.py",
        "lib/ansible/cli/console.py",
        "lib/ansible/module_utils/facts/timeout.py",
        "lib/ansible/cli/arguments/option_helpers.py",
        "lib/ansible/modules/pause.py",
        "lib/ansible/modules/wait_for.py",
        "lib/ansible/playbook/task_include.py",
        "lib/ansible/modules/async_wrapper.py",
        "lib/ansible/modules/include_tasks.py",
        "lib/ansible/plugins/doc_fragments/shell_common.py",
        "lib/ansible/modules/async_status.py",
        "lib/ansible/playbook/task.py",
        "lib/ansible/modules/include_vars.py",
        "lib/ansible/plugins/action/wait_for_connection.py",
        "lib/ansible/playbook/handler_task_include.py",
        "lib/ansible/modules/cron.py",
        "lib/ansible/modules/include.py",
        "lib/ansible/plugins/action/reboot.py",
        "lib/ansible/plugins/action/async_status.py",
        "lib/ansible/plugins/callback/default.py",
        "lib/ansible/modules/wait_for_connection.py",
        "lib/ansible/modules/shell.py",
        "lib/ansible/module_utils/basic.py",
        "lib/ansible/modules/yum.py",
        "lib/ansible/modules/command.py",
        "hacking/build_library/build_ansible/command_plugins/file_deprecated_issues.py",
        "lib/ansible/modules/meta.py",
        "lib/ansible/plugins/action/__init__.py",
        "lib/ansible/modules/import_tasks.py",
        "lib/ansible/modules/expect.py",
        "lib/ansible/cli/__init__.py",
        "lib/ansible/cli/playbook.py",
        "lib/ansible/plugins/doc_fragments/template_common.py",
        "lib/ansible/module_utils/common/file.py",
        "lib/ansible/plugins/connection/winrm.py",
        "lib/ansible/modules/raw.py",
        "lib/ansible/modules/add_host.py",
        "lib/ansible/cli/vault.py",
        "lib/ansible/plugins/action/include_vars.py",
        "hacking/build_library/build_ansible/announce.py",
        "lib/ansible/plugins/doc_fragments/shell_windows.py",
        "lib/ansible/cli/doc.py",
        "lib/ansible/plugins/doc_fragments/default_callback.py",
        "hacking/build_library/build_ansible/errors.py",
        "lib/ansible/cli/pull.py",
        "lib/ansible/plugins/become/runas.py",
        "lib/ansible/modules/template.py",
        "lib/ansible/cli/scripts/ansible_connection_cli_stub.py",
        "hacking/build_library/build_ansible/command_plugins/dump_config.py",
        "lib/ansible/plugins/become/sudo.py",
        "lib/ansible/plugins/action/command.py",
        "lib/ansible/modules/apt_key.py",
        "lib/ansible/executor/module_common.py"
    ],
    "3_final_combined_files": [
        "lib/ansible/cli/adhoc.py",
        "lib/ansible/cli/console.py",
        "lib/ansible/playbook/task_include.py",
        "lib/ansible/plugins/action/pause.py",
        "lib/ansible/executor/task_executor.py"
    ],
    "4_related_elements": {
        "lib/ansible/cli/adhoc.py": [
            "function: AdHocCLI.init_parser\nfunction: AdHocCLI.post_process_args\nfunction: AdHocCLI._play_ds"
        ],
        "lib/ansible/cli/console.py": [
            "function: ConsoleCLI.init_parser\nfunction: ConsoleCLI.post_process_args\nfunction: ConsoleCLI.default\nvariable: ConsoleCLI.ARGUMENTS"
        ],
        "lib/ansible/playbook/task_include.py": [
            "variable: TaskInclude.VALID_INCLUDE_KEYWORDS\nfunction: TaskInclude.check_options\nfunction: TaskInclude.preprocess_data"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "lib/ansible/cli/adhoc.py": [
                    "function: AdHocCLI.init_parser\nfunction: AdHocCLI._play_ds"
                ],
                "lib/ansible/cli/console.py": [
                    "function: ConsoleCLI.init_parser\nfunction: ConsoleCLI.default\nfunction: ConsoleCLI.post_process_args"
                ],
                "lib/ansible/playbook/task_include.py": [
                    "class: TaskInclude"
                ]
            },
            "patches": [
                "diff --git a/lib/ansible/cli/adhoc.py b/lib/ansible/cli/adhoc.py\nindex 12d2387..b1390f1 100644\n--- a/lib/ansible/cli/adhoc.py\n+++ b/lib/ansible/cli/adhoc.py\n@@ -68,6 +68,11 @@ class AdHocCLI(CLI):\n \n         mytask = {'action': {'module': context.CLIARGS['module_name'], 'args': parse_kv(context.CLIARGS['module_args'], check_raw=check_raw)}}\n \n+        # set per-task timeout if provided\n+        timeout = context.CLIARGS.get('timeout')\n+        if timeout is not None:\n+            mytask['timeout'] = timeout\n+\n         # avoid adding to tasks that don't support it, unless set, then give user an error\n         if context.CLIARGS['module_name'] not in ('include_role', 'include_tasks') and any(frozenset((async_val, poll))):\n             mytask['async_val'] = async_val\ndiff --git a/lib/ansible/cli/console.py b/lib/ansible/cli/console.py\nindex 08c3c68..51c72a7 100644\n--- a/lib/ansible/cli/console.py\n+++ b/lib/ansible/cli/console.py\n@@ -90,6 +90,8 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         opt_help.add_vault_options(self.parser)\n         opt_help.add_fork_options(self.parser)\n         opt_help.add_module_options(self.parser)\n+        opt_help.add_runtask_options(self.parser)\n+        opt_help.add_extra_vars_options(self.parser)\n         opt_help.add_basedir_options(self.parser)\n \n         # options unique to shell\n@@ -183,11 +185,23 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         result = None\n         try:\n             check_raw = module in ('command', 'shell', 'script', 'raw')\n+            # build task definition and include per-task timeout if provided\n+            task_def = dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))\n+            timeout = None\n+            try:\n+                timeout = context.CLIARGS.get('timeout')\n+            except Exception:\n+                pass\n+            if timeout is None:\n+                timeout = getattr(self, 'timeout', None)\n+            if timeout is not None:\n+                task_def['timeout'] = timeout\n+\n             play_ds = dict(\n                 name=\"Ansible Shell\",\n                 hosts=self.cwd,\n                 gather_facts='no',\n-                tasks=[dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))],\n+                tasks=[task_def],\n                 remote_user=self.remote_user,\n                 become=self.become,\n                 become_user=self.become_user,\ndiff --git a/lib/ansible/playbook/task_include.py b/lib/ansible/playbook/task_include.py\nindex c0e7132..837aeba 100644\n--- a/lib/ansible/playbook/task_include.py\n+++ b/lib/ansible/playbook/task_include.py\n@@ -44,7 +44,7 @@ class TaskInclude(Task):\n     VALID_ARGS = BASE.union(OTHER_ARGS)  # all valid args\n     VALID_INCLUDE_KEYWORDS = frozenset(('action', 'args', 'collections', 'debugger', 'ignore_errors', 'loop', 'loop_control',\n                                         'loop_with', 'name', 'no_log', 'register', 'run_once', 'tags', 'vars',\n-                                        'when'))\n+                                        'when', 'timeout'))\n \n     # =================================================================================\n     # ATTRIBUTES\n@@ -153,4 +153,4 @@ class TaskInclude(Task):\n         else:\n             p_block = self\n \n-        return p_block\n+        return p_block\n",
                "diff --git a/lib/ansible/cli/adhoc.py b/lib/ansible/cli/adhoc.py\nindex 12d2387..384e199 100644\n--- a/lib/ansible/cli/adhoc.py\n+++ b/lib/ansible/cli/adhoc.py\n@@ -52,6 +52,8 @@ class AdHocCLI(CLI):\n                                  help=\"module name to execute (default=%s)\" % C.DEFAULT_MODULE_NAME,\n                                  default=C.DEFAULT_MODULE_NAME)\n         self.parser.add_argument('args', metavar='pattern', help='host pattern')\n+        self.parser.add_argument('--task-timeout', dest='task_timeout', type=int,\n+                                 help=\"per-task timeout in seconds\", default=None)\n \n     def post_process_args(self, options):\n         '''Post process and validate options for bin/ansible '''\n@@ -68,6 +70,10 @@ class AdHocCLI(CLI):\n \n         mytask = {'action': {'module': context.CLIARGS['module_name'], 'args': parse_kv(context.CLIARGS['module_args'], check_raw=check_raw)}}\n \n+        # set per-task timeout if provided\n+        if 'task_timeout' in context.CLIARGS and context.CLIARGS['task_timeout'] is not None:\n+            mytask['timeout'] = context.CLIARGS['task_timeout']\n+\n         # avoid adding to tasks that don't support it, unless set, then give user an error\n         if context.CLIARGS['module_name'] not in ('include_role', 'include_tasks') and any(frozenset((async_val, poll))):\n             mytask['async_val'] = async_val\ndiff --git a/lib/ansible/cli/console.py b/lib/ansible/cli/console.py\nindex 08c3c68..cb63074 100644\n--- a/lib/ansible/cli/console.py\n+++ b/lib/ansible/cli/console.py\n@@ -75,6 +75,7 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         self.check_mode = None\n         self.diff = None\n         self.forks = None\n+        self.task_timeout = None\n \n         cmd.Cmd.__init__(self)\n \n@@ -90,17 +91,21 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         opt_help.add_vault_options(self.parser)\n         opt_help.add_fork_options(self.parser)\n         opt_help.add_module_options(self.parser)\n+        opt_help.add_extra_vars_options(self.parser)\n         opt_help.add_basedir_options(self.parser)\n \n         # options unique to shell\n         self.parser.add_argument('pattern', help='host pattern', metavar='pattern', default='all', nargs='?')\n         self.parser.add_argument('--step', dest='step', action='store_true',\n                                  help=\"one-step-at-a-time: confirm each task before running\")\n+        self.parser.add_argument('--task-timeout', dest='task_timeout', type=int, default=None,\n+                                 help=\"per-task timeout in seconds\")\n \n     def post_process_args(self, options):\n         options = super(ConsoleCLI, self).post_process_args(options)\n         display.verbosity = options.verbosity\n         self.validate_conflicts(options, runas_opts=True, fork_opts=True)\n+        self.task_timeout = options.task_timeout\n         return options\n \n     def get_names(self):\n@@ -183,11 +188,14 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         result = None\n         try:\n             check_raw = module in ('command', 'shell', 'script', 'raw')\n+            task_item = dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))\n+            if self.task_timeout is not None:\n+                task_item['timeout'] = self.task_timeout\n             play_ds = dict(\n                 name=\"Ansible Shell\",\n                 hosts=self.cwd,\n                 gather_facts='no',\n-                tasks=[dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))],\n+                tasks=[task_item],\n                 remote_user=self.remote_user,\n                 become=self.become,\n                 become_user=self.become_user,\ndiff --git a/lib/ansible/playbook/task_include.py b/lib/ansible/playbook/task_include.py\nindex c0e7132..837aeba 100644\n--- a/lib/ansible/playbook/task_include.py\n+++ b/lib/ansible/playbook/task_include.py\n@@ -44,7 +44,7 @@ class TaskInclude(Task):\n     VALID_ARGS = BASE.union(OTHER_ARGS)  # all valid args\n     VALID_INCLUDE_KEYWORDS = frozenset(('action', 'args', 'collections', 'debugger', 'ignore_errors', 'loop', 'loop_control',\n                                         'loop_with', 'name', 'no_log', 'register', 'run_once', 'tags', 'vars',\n-                                        'when'))\n+                                        'when', 'timeout'))\n \n     # =================================================================================\n     # ATTRIBUTES\n@@ -153,4 +153,4 @@ class TaskInclude(Task):\n         else:\n             p_block = self\n \n-        return p_block\n+        return p_block\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "lib/ansible/cli/adhoc.py": [
                    "function: AdHocCLI.init_parser\nfunction: AdHocCLI._play_ds"
                ],
                "lib/ansible/cli/console.py": [
                    "function: ConsoleCLI.init_parser\nfunction: ConsoleCLI.default"
                ],
                "lib/ansible/playbook/task_include.py": [
                    "class: TaskInclude"
                ]
            },
            "patches": [
                "diff --git a/lib/ansible/cli/adhoc.py b/lib/ansible/cli/adhoc.py\nindex 12d2387..ff725c2 100644\n--- a/lib/ansible/cli/adhoc.py\n+++ b/lib/ansible/cli/adhoc.py\n@@ -51,6 +51,8 @@ class AdHocCLI(CLI):\n         self.parser.add_argument('-m', '--module-name', dest='module_name',\n                                  help=\"module name to execute (default=%s)\" % C.DEFAULT_MODULE_NAME,\n                                  default=C.DEFAULT_MODULE_NAME)\n+        self.parser.add_argument('--timeout', dest='timeout', type=int,\n+                                 help=\"set per-task timeout in seconds\", default=None)\n         self.parser.add_argument('args', metavar='pattern', help='host pattern')\n \n     def post_process_args(self, options):\n@@ -67,6 +69,8 @@ class AdHocCLI(CLI):\n         check_raw = context.CLIARGS['module_name'] in C.MODULE_REQUIRE_ARGS\n \n         mytask = {'action': {'module': context.CLIARGS['module_name'], 'args': parse_kv(context.CLIARGS['module_args'], check_raw=check_raw)}}\n+        if context.CLIARGS.get('timeout') is not None:\n+            mytask['timeout'] = context.CLIARGS['timeout']\n \n         # avoid adding to tasks that don't support it, unless set, then give user an error\n         if context.CLIARGS['module_name'] not in ('include_role', 'include_tasks') and any(frozenset((async_val, poll))):\ndiff --git a/lib/ansible/cli/console.py b/lib/ansible/cli/console.py\nindex 08c3c68..3e5dfa5 100644\n--- a/lib/ansible/cli/console.py\n+++ b/lib/ansible/cli/console.py\n@@ -75,6 +75,7 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         self.check_mode = None\n         self.diff = None\n         self.forks = None\n+        self.timeout = None\n \n         cmd.Cmd.__init__(self)\n \n@@ -91,16 +92,20 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         opt_help.add_fork_options(self.parser)\n         opt_help.add_module_options(self.parser)\n         opt_help.add_basedir_options(self.parser)\n+        opt_help.add_extra_vars_options(self.parser)\n \n         # options unique to shell\n         self.parser.add_argument('pattern', help='host pattern', metavar='pattern', default='all', nargs='?')\n         self.parser.add_argument('--step', dest='step', action='store_true',\n                                  help=\"one-step-at-a-time: confirm each task before running\")\n+        self.parser.add_argument('--timeout', dest='timeout', type=int,\n+                                 help=\"set per-task timeout in seconds\", default=None)\n \n     def post_process_args(self, options):\n         options = super(ConsoleCLI, self).post_process_args(options)\n         display.verbosity = options.verbosity\n         self.validate_conflicts(options, runas_opts=True, fork_opts=True)\n+        self.timeout = getattr(options, 'timeout', None)\n         return options\n \n     def get_names(self):\n@@ -183,11 +188,14 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         result = None\n         try:\n             check_raw = module in ('command', 'shell', 'script', 'raw')\n+            task_def = dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))\n+            if self.timeout is not None:\n+                task_def['timeout'] = self.timeout\n             play_ds = dict(\n                 name=\"Ansible Shell\",\n                 hosts=self.cwd,\n                 gather_facts='no',\n-                tasks=[dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))],\n+                tasks=[task_def],\n                 remote_user=self.remote_user,\n                 become=self.become,\n                 become_user=self.become_user,\ndiff --git a/lib/ansible/playbook/task_include.py b/lib/ansible/playbook/task_include.py\nindex c0e7132..e356604 100644\n--- a/lib/ansible/playbook/task_include.py\n+++ b/lib/ansible/playbook/task_include.py\n@@ -43,7 +43,7 @@ class TaskInclude(Task):\n     OTHER_ARGS = frozenset(('apply',))  # assigned to matching property\n     VALID_ARGS = BASE.union(OTHER_ARGS)  # all valid args\n     VALID_INCLUDE_KEYWORDS = frozenset(('action', 'args', 'collections', 'debugger', 'ignore_errors', 'loop', 'loop_control',\n-                                        'loop_with', 'name', 'no_log', 'register', 'run_once', 'tags', 'vars',\n+                                        'loop_with', 'name', 'no_log', 'register', 'run_once', 'tags', 'timeout', 'vars',\n                                         'when'))\n \n     # =================================================================================\n@@ -153,4 +153,4 @@ class TaskInclude(Task):\n         else:\n             p_block = self\n \n-        return p_block\n+        return p_block\n",
                "diff --git a/lib/ansible/cli/adhoc.py b/lib/ansible/cli/adhoc.py\nindex 12d2387..61ca380 100644\n--- a/lib/ansible/cli/adhoc.py\n+++ b/lib/ansible/cli/adhoc.py\n@@ -51,6 +51,8 @@ class AdHocCLI(CLI):\n         self.parser.add_argument('-m', '--module-name', dest='module_name',\n                                  help=\"module name to execute (default=%s)\" % C.DEFAULT_MODULE_NAME,\n                                  default=C.DEFAULT_MODULE_NAME)\n+        self.parser.add_argument('--timeout', dest='timeout', type=int, default=None,\n+                                 help=\"set task execution timeout in seconds\")\n         self.parser.add_argument('args', metavar='pattern', help='host pattern')\n \n     def post_process_args(self, options):\n@@ -67,6 +69,9 @@ class AdHocCLI(CLI):\n         check_raw = context.CLIARGS['module_name'] in C.MODULE_REQUIRE_ARGS\n \n         mytask = {'action': {'module': context.CLIARGS['module_name'], 'args': parse_kv(context.CLIARGS['module_args'], check_raw=check_raw)}}\n+        # add per-task timeout if provided\n+        if context.CLIARGS.get('timeout') is not None:\n+            mytask['timeout'] = context.CLIARGS['timeout']\n \n         # avoid adding to tasks that don't support it, unless set, then give user an error\n         if context.CLIARGS['module_name'] not in ('include_role', 'include_tasks') and any(frozenset((async_val, poll))):\ndiff --git a/lib/ansible/cli/console.py b/lib/ansible/cli/console.py\nindex 08c3c68..4bce42c 100644\n--- a/lib/ansible/cli/console.py\n+++ b/lib/ansible/cli/console.py\n@@ -91,16 +91,21 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         opt_help.add_fork_options(self.parser)\n         opt_help.add_module_options(self.parser)\n         opt_help.add_basedir_options(self.parser)\n+        opt_help.add_extra_vars_options(self.parser)\n \n         # options unique to shell\n         self.parser.add_argument('pattern', help='host pattern', metavar='pattern', default='all', nargs='?')\n         self.parser.add_argument('--step', dest='step', action='store_true',\n                                  help=\"one-step-at-a-time: confirm each task before running\")\n+        self.parser.add_argument('--timeout', dest='timeout', type=int, default=None,\n+                                 help=\"set task execution timeout in seconds\")\n \n     def post_process_args(self, options):\n         options = super(ConsoleCLI, self).post_process_args(options)\n         display.verbosity = options.verbosity\n         self.validate_conflicts(options, runas_opts=True, fork_opts=True)\n+        # store timeout option for use in tasks\n+        self.timeout = getattr(options, 'timeout', None)\n         return options\n \n     def get_names(self):\n@@ -183,11 +188,15 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         result = None\n         try:\n             check_raw = module in ('command', 'shell', 'script', 'raw')\n+            # build task with optional timeout\n+            _task = dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))\n+            if getattr(self, 'timeout', None) is not None:\n+                _task['timeout'] = self.timeout\n             play_ds = dict(\n                 name=\"Ansible Shell\",\n                 hosts=self.cwd,\n                 gather_facts='no',\n-                tasks=[dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))],\n+                tasks=[_task],\n                 remote_user=self.remote_user,\n                 become=self.become,\n                 become_user=self.become_user,\ndiff --git a/lib/ansible/playbook/task_include.py b/lib/ansible/playbook/task_include.py\nindex c0e7132..837aeba 100644\n--- a/lib/ansible/playbook/task_include.py\n+++ b/lib/ansible/playbook/task_include.py\n@@ -44,7 +44,7 @@ class TaskInclude(Task):\n     VALID_ARGS = BASE.union(OTHER_ARGS)  # all valid args\n     VALID_INCLUDE_KEYWORDS = frozenset(('action', 'args', 'collections', 'debugger', 'ignore_errors', 'loop', 'loop_control',\n                                         'loop_with', 'name', 'no_log', 'register', 'run_once', 'tags', 'vars',\n-                                        'when'))\n+                                        'when', 'timeout'))\n \n     # =================================================================================\n     # ATTRIBUTES\n@@ -153,4 +153,4 @@ class TaskInclude(Task):\n         else:\n             p_block = self\n \n-        return p_block\n+        return p_block\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/lib/ansible/cli/adhoc.py b/lib/ansible/cli/adhoc.py\nindex 12d2387..b1390f1 100644\n--- a/lib/ansible/cli/adhoc.py\n+++ b/lib/ansible/cli/adhoc.py\n@@ -68,6 +68,11 @@ class AdHocCLI(CLI):\n \n         mytask = {'action': {'module': context.CLIARGS['module_name'], 'args': parse_kv(context.CLIARGS['module_args'], check_raw=check_raw)}}\n \n+        # set per-task timeout if provided\n+        timeout = context.CLIARGS.get('timeout')\n+        if timeout is not None:\n+            mytask['timeout'] = timeout\n+\n         # avoid adding to tasks that don't support it, unless set, then give user an error\n         if context.CLIARGS['module_name'] not in ('include_role', 'include_tasks') and any(frozenset((async_val, poll))):\n             mytask['async_val'] = async_val\ndiff --git a/lib/ansible/cli/console.py b/lib/ansible/cli/console.py\nindex 08c3c68..51c72a7 100644\n--- a/lib/ansible/cli/console.py\n+++ b/lib/ansible/cli/console.py\n@@ -90,6 +90,8 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         opt_help.add_vault_options(self.parser)\n         opt_help.add_fork_options(self.parser)\n         opt_help.add_module_options(self.parser)\n+        opt_help.add_runtask_options(self.parser)\n+        opt_help.add_extra_vars_options(self.parser)\n         opt_help.add_basedir_options(self.parser)\n \n         # options unique to shell\n@@ -183,11 +185,23 @@ class ConsoleCLI(CLI, cmd.Cmd):\n         result = None\n         try:\n             check_raw = module in ('command', 'shell', 'script', 'raw')\n+            # build task definition and include per-task timeout if provided\n+            task_def = dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))\n+            timeout = None\n+            try:\n+                timeout = context.CLIARGS.get('timeout')\n+            except Exception:\n+                pass\n+            if timeout is None:\n+                timeout = getattr(self, 'timeout', None)\n+            if timeout is not None:\n+                task_def['timeout'] = timeout\n+\n             play_ds = dict(\n                 name=\"Ansible Shell\",\n                 hosts=self.cwd,\n                 gather_facts='no',\n-                tasks=[dict(action=dict(module=module, args=parse_kv(module_args, check_raw=check_raw)))],\n+                tasks=[task_def],\n                 remote_user=self.remote_user,\n                 become=self.become,\n                 become_user=self.become_user,\ndiff --git a/lib/ansible/playbook/task_include.py b/lib/ansible/playbook/task_include.py\nindex c0e7132..837aeba 100644\n--- a/lib/ansible/playbook/task_include.py\n+++ b/lib/ansible/playbook/task_include.py\n@@ -44,7 +44,7 @@ class TaskInclude(Task):\n     VALID_ARGS = BASE.union(OTHER_ARGS)  # all valid args\n     VALID_INCLUDE_KEYWORDS = frozenset(('action', 'args', 'collections', 'debugger', 'ignore_errors', 'loop', 'loop_control',\n                                         'loop_with', 'name', 'no_log', 'register', 'run_once', 'tags', 'vars',\n-                                        'when'))\n+                                        'when', 'timeout'))\n \n     # =================================================================================\n     # ATTRIBUTES\n@@ -153,4 +153,4 @@ class TaskInclude(Task):\n         else:\n             p_block = self\n \n-        return p_block\n+        return p_block\n"
}