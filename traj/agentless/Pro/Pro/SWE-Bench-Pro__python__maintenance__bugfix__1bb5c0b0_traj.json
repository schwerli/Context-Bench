{
    "instance_id": "SWE-Bench-Pro__python__maintenance__bugfix__1bb5c0b0",
    "original_id": "instance_ansible__ansible-5260527c4a71bfed99d803e687dd19619423b134-vba6da65a0f3baefda7a058ebbd0a8dcafb8512f5",
    "1_model_selected_files": [
        "lib/ansible/module_utils/common/file.py",
        "lib/ansible/module_utils/basic.py"
    ],
    "2_embedding_selected_files": [
        "lib/ansible/module_utils/basic.py",
        "lib/ansible/plugins/doc_fragments/files.py",
        "lib/ansible/plugins/action/__init__.py",
        "lib/ansible/modules/copy.py",
        "lib/ansible/module_utils/common/file.py",
        "lib/ansible/plugins/action/copy.py",
        "lib/ansible/modules/user.py",
        "lib/ansible/executor/action_write_locks.py",
        "lib/ansible/modules/file.py",
        "lib/ansible/modules/unarchive.py",
        "hacking/fix_test_syntax.py",
        "lib/ansible/plugins/action/script.py",
        "lib/ansible/executor/module_common.py",
        "lib/ansible/modules/tempfile.py",
        "lib/ansible/plugins/action/raw.py",
        "lib/ansible/modules/stat.py",
        "lib/ansible/plugins/action/template.py",
        "lib/ansible/plugins/become/sudo.py",
        "lib/ansible/plugins/doc_fragments/shell_common.py",
        "hacking/build_library/build_ansible/change_detection.py",
        "lib/ansible/plugins/become/su.py",
        "lib/ansible/modules/replace.py",
        "lib/ansible/plugins/become/runas.py",
        "lib/ansible/plugins/action/fetch.py",
        "lib/ansible/plugins/action/unarchive.py",
        "hacking/build_library/build_ansible/announce.py",
        "lib/ansible/modules/apt.py",
        "lib/ansible/module_utils/six/__init__.py",
        "lib/ansible/modules/git.py",
        "hacking/build_library/build_ansible/command_plugins/file_deprecated_issues.py",
        "lib/ansible/parsing/vault/__init__.py",
        "lib/ansible/modules/blockinfile.py",
        "lib/ansible/modules/raw.py",
        "lib/ansible/plugins/lookup/unvault.py",
        "lib/ansible/plugins/lookup/password.py",
        "lib/ansible/modules/template.py",
        "lib/ansible/utils/path.py",
        "lib/ansible/vars/clean.py"
    ],
    "3_final_combined_files": [
        "lib/ansible/module_utils/basic.py",
        "lib/ansible/module_utils/common/file.py",
        "lib/ansible/plugins/doc_fragments/files.py",
        "lib/ansible/plugins/action/__init__.py"
    ],
    "4_related_elements": {
        "lib/ansible/module_utils/basic.py": [
            "variable: FILE_COMMON_ARGUMENTS\nfunction: AnsibleModule.atomic_move\nfunction: AnsibleModule._unsafe_writes\nfunction: AnsibleModule.set_fs_attributes_if_different\nfunction: AnsibleModule.set_file_attributes_if_different\nfunction: AnsibleModule.set_mode_if_different\nfunction: AnsibleModule._get_octal_mode_from_symbolic_perms\nfunction: AnsibleModule.load_file_common_arguments\nfunction: AnsibleModule.backup_local\nfunction: AnsibleModule.append_to_file\nfunction: AnsibleModule.preserved_copy"
        ],
        "lib/ansible/module_utils/common/file.py": [
            "variable: _DEFAULT_PERM\nfunction: get_file_arg_spec\nclass: FileLock"
        ],
        "lib/ansible/plugins/doc_fragments/files.py": [
            "class: ModuleDocFragment"
        ]
    },
    "5_sampled_edit_locs_and_patches": [
        {
            "sample_index": 0,
            "edit_locs": {
                "lib/ansible/module_utils/basic.py": [
                    "line: 2442"
                ],
                "lib/ansible/module_utils/common/file.py": [
                    "line: 62"
                ],
                "lib/ansible/plugins/doc_fragments/files.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py\nindex f5dd727..99fd158 100644\n--- a/lib/ansible/module_utils/basic.py\n+++ b/lib/ansible/module_utils/basic.py\n@@ -2439,7 +2439,8 @@ class AnsibleModule(object):\n             # based on the current value of umask\n             umask = os.umask(0)\n             os.umask(umask)\n-            os.chmod(b_dest, DEFAULT_PERM & ~umask)\n+            # Apply a secure default (0600) combined with umask to avoid world-readable files\n+            os.chmod(b_dest, 0o0600 & ~umask)\n             try:\n                 os.chown(b_dest, os.geteuid(), os.getegid())\n             except OSError:\ndiff --git a/lib/ansible/module_utils/common/file.py b/lib/ansible/module_utils/common/file.py\nindex d20ef04..eece6c1 100644\n--- a/lib/ansible/module_utils/common/file.py\n+++ b/lib/ansible/module_utils/common/file.py\n@@ -59,7 +59,7 @@ PERMS_RE = re.compile(r'[^rwxXstugo]')\n \n _PERM_BITS = 0o7777          # file mode permission bits\n _EXEC_PERM_BITS = 0o0111     # execute permission bits\n-_DEFAULT_PERM = 0o0666       # default file permission bits\n+_DEFAULT_PERM = 0o0600       # default file permission bits (restrictive by default: user read/write)\n \n \n def is_executable(path):\n",
                "diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py\nindex f5dd727..87dd6f3 100644\n--- a/lib/ansible/module_utils/basic.py\n+++ b/lib/ansible/module_utils/basic.py\n@@ -2439,7 +2439,8 @@ class AnsibleModule(object):\n             # based on the current value of umask\n             umask = os.umask(0)\n             os.umask(umask)\n-            os.chmod(b_dest, DEFAULT_PERM & ~umask)\n+            # Use restrictive default permissions for new files to avoid world-readable files (CVE-2020-1736)\n+            os.chmod(b_dest, 0o0600 & ~umask)\n             try:\n                 os.chown(b_dest, os.geteuid(), os.getegid())\n             except OSError:\ndiff --git a/lib/ansible/module_utils/common/file.py b/lib/ansible/module_utils/common/file.py\nindex d20ef04..1745a69 100644\n--- a/lib/ansible/module_utils/common/file.py\n+++ b/lib/ansible/module_utils/common/file.py\n@@ -59,7 +59,7 @@ PERMS_RE = re.compile(r'[^rwxXstugo]')\n \n _PERM_BITS = 0o7777          # file mode permission bits\n _EXEC_PERM_BITS = 0o0111     # execute permission bits\n-_DEFAULT_PERM = 0o0666       # default file permission bits\n+_DEFAULT_PERM = 0o0600       # default file permission bits (restrictive to avoid world-readable files)\n \n \n def is_executable(path):\n"
            ]
        },
        {
            "sample_index": 1,
            "edit_locs": {
                "lib/ansible/module_utils/basic.py": [
                    "function: AnsibleModule.atomic_move\nline: 2442"
                ],
                "lib/ansible/module_utils/common/file.py": [
                    "line: 62"
                ],
                "lib/ansible/plugins/doc_fragments/files.py": [
                    ""
                ]
            },
            "patches": [
                "diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py\nindex f5dd727..9ce8eaf 100644\n--- a/lib/ansible/module_utils/basic.py\n+++ b/lib/ansible/module_utils/basic.py\n@@ -2439,7 +2439,8 @@ class AnsibleModule(object):\n             # based on the current value of umask\n             umask = os.umask(0)\n             os.umask(umask)\n-            os.chmod(b_dest, DEFAULT_PERM & ~umask)\n+            # Use a restrictive default to avoid world-readable files (CVE-2020-1736)\n+            os.chmod(b_dest, 0o0600 & ~umask)\n             try:\n                 os.chown(b_dest, os.geteuid(), os.getegid())\n             except OSError:\ndiff --git a/lib/ansible/module_utils/common/file.py b/lib/ansible/module_utils/common/file.py\nindex d20ef04..1745a69 100644\n--- a/lib/ansible/module_utils/common/file.py\n+++ b/lib/ansible/module_utils/common/file.py\n@@ -59,7 +59,7 @@ PERMS_RE = re.compile(r'[^rwxXstugo]')\n \n _PERM_BITS = 0o7777          # file mode permission bits\n _EXEC_PERM_BITS = 0o0111     # execute permission bits\n-_DEFAULT_PERM = 0o0666       # default file permission bits\n+_DEFAULT_PERM = 0o0600       # default file permission bits (restrictive to avoid world-readable files)\n \n \n def is_executable(path):\n",
                "diff --git a/lib/ansible/module_utils/common/file.py b/lib/ansible/module_utils/common/file.py\nindex d20ef04..a91fdd6 100644\n--- a/lib/ansible/module_utils/common/file.py\n+++ b/lib/ansible/module_utils/common/file.py\n@@ -59,7 +59,7 @@ PERMS_RE = re.compile(r'[^rwxXstugo]')\n \n _PERM_BITS = 0o7777          # file mode permission bits\n _EXEC_PERM_BITS = 0o0111     # execute permission bits\n-_DEFAULT_PERM = 0o0666       # default file permission bits\n+_DEFAULT_PERM = 0o0600       # restrictive default file permission bits for new files\n \n \n def is_executable(path):\n"
            ]
        }
    ],
    "6_final_selected_patch": "diff --git a/lib/ansible/module_utils/basic.py b/lib/ansible/module_utils/basic.py\nindex f5dd727..99fd158 100644\n--- a/lib/ansible/module_utils/basic.py\n+++ b/lib/ansible/module_utils/basic.py\n@@ -2439,7 +2439,8 @@ class AnsibleModule(object):\n             # based on the current value of umask\n             umask = os.umask(0)\n             os.umask(umask)\n-            os.chmod(b_dest, DEFAULT_PERM & ~umask)\n+            # Apply a secure default (0600) combined with umask to avoid world-readable files\n+            os.chmod(b_dest, 0o0600 & ~umask)\n             try:\n                 os.chown(b_dest, os.geteuid(), os.getegid())\n             except OSError:\ndiff --git a/lib/ansible/module_utils/common/file.py b/lib/ansible/module_utils/common/file.py\nindex d20ef04..eece6c1 100644\n--- a/lib/ansible/module_utils/common/file.py\n+++ b/lib/ansible/module_utils/common/file.py\n@@ -59,7 +59,7 @@ PERMS_RE = re.compile(r'[^rwxXstugo]')\n \n _PERM_BITS = 0o7777          # file mode permission bits\n _EXEC_PERM_BITS = 0o0111     # execute permission bits\n-_DEFAULT_PERM = 0o0666       # default file permission bits\n+_DEFAULT_PERM = 0o0600       # default file permission bits (restrictive by default: user read/write)\n \n \n def is_executable(path):\n"
}