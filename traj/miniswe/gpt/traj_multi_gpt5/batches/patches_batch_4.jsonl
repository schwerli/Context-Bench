{"org": "nlohmann", "repo": "json", "number": "2225", "fix_patch": "diff --git a/README.md b/README.md\nindex 0699bdc3..6d21e2d8 100644\n--- a/README.md\n+++ b/README.md\n@@ -869,6 +869,42 @@ Some important things:\n * In function `from_json`, use function [`at()`](https://nlohmann.github.io/json/classnlohmann_1_1basic__json_a93403e803947b86f4da2d1fb3345cf2c.html#a93403e803947b86f4da2d1fb3345cf2c) to access the object values rather than `operator[]`. In case a key does not exist, `at` throws an exception that you can handle, whereas `operator[]` exhibits undefined behavior.\n * You do not need to add serializers or deserializers for STL types like `std::vector`: the library already implements these.\n \n+#### Simplify your life with macros\n+\n+If you just want to serialize/deserialize some structs, the `to_json`/`from_json` functions can be a lot of boilerplate.\n+\n+There are two macros to make your life easier as long as you (1) want to use a JSON object as serialization and (2) want to use the member variable names as object keys in that object:\n+\n+- `NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE(name, member1, member2, ...)` is to be defined inside of the namespace of the class/struct to create code for.\n+- `NLOHMANN_DEFINE_TYPE_INTRUSIVE(name, member1, member2, ...)` is to be defined inside of the class/struct to create code for. This macro can also access private members.\n+\n+In both macros, the first parameter is the name of the class/struct, and all remaining parameters name the members.\n+\n+##### Examples\n+\n+The `to_json`/`from_json` functions for the `person` struct above can be created with:\n+\n+```cpp\n+namespace ns {\n+    NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE(person, name, address, age);\n+}\n+```\n+\n+Here is an example with private members, where `NLOHMANN_DEFINE_TYPE_INTRUSIVE` is needed:\n+\n+```cpp\n+namespace ns {\n+    class address {\n+      private:\n+        std::string street;\n+        int housenumber;\n+        int postcode;\n+        \n+      public:\n+        NLOHMANN_DEFINE_TYPE_INTRUSIVE(address, street, housenumber, postcode);\n+    };\n+}\n+```\n \n #### How do I convert third-party types?\n \ndiff --git a/include/nlohmann/detail/macro_scope.hpp b/include/nlohmann/detail/macro_scope.hpp\nindex a48d18e8..46fa8c10 100644\n--- a/include/nlohmann/detail/macro_scope.hpp\n+++ b/include/nlohmann/detail/macro_scope.hpp\n@@ -124,3 +124,44 @@\n     basic_json<ObjectType, ArrayType, StringType, BooleanType,             \\\n     NumberIntegerType, NumberUnsignedType, NumberFloatType,                \\\n     AllocatorType, JSONSerializer, BinaryType>\n+\n+// Macros to simplify conversion from/to types\n+\n+#define NLOHMANN_JSON_EXPAND( x ) x\n+#define NLOHMANN_JSON_GET_MACRO(_1,_2,_3,_4,_5,_6, _7, _8, _9, _10, _11, NAME,...) NAME\n+\n+#define NLOHMANN_JSON_PASTE(...) NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_GET_MACRO(__VA_ARGS__, NLOHMANN_JSON_PASTE11, \\\n+        NLOHMANN_JSON_PASTE10, NLOHMANN_JSON_PASTE9, NLOHMANN_JSON_PASTE8, NLOHMANN_JSON_PASTE7, \\\n+        NLOHMANN_JSON_PASTE6, NLOHMANN_JSON_PASTE5, NLOHMANN_JSON_PASTE4, NLOHMANN_JSON_PASTE3, \\\n+        NLOHMANN_JSON_PASTE2, NLOHMANN_JSON_PASTE1)(__VA_ARGS__))\n+#define NLOHMANN_JSON_PASTE2(func,  v1)                                      func(v1)\n+#define NLOHMANN_JSON_PASTE3(func,  v1, v2)                                  NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE2(func, v2)\n+#define NLOHMANN_JSON_PASTE4(func,  v1, v2, v3)                              NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE3(func, v2, v3)\n+#define NLOHMANN_JSON_PASTE5(func,  v1, v2, v3, v4)                          NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE4(func, v2, v3, v4)\n+#define NLOHMANN_JSON_PASTE6(func,  v1, v2, v3, v4, v5)                      NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE5(func, v2, v3, v4, v5)\n+#define NLOHMANN_JSON_PASTE7(func,  v1, v2, v3, v4, v5, v6)                  NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE6(func, v2, v3, v4, v5, v6)\n+#define NLOHMANN_JSON_PASTE8(func,  v1, v2, v3, v4, v5, v6, v7)              NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE7(func, v2, v3, v4, v5, v6, v7)\n+#define NLOHMANN_JSON_PASTE9(func,  v1, v2, v3, v4, v5, v6, v7, v8)          NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE8(func, v2, v3, v4, v5, v6, v7, v8)\n+#define NLOHMANN_JSON_PASTE10(func, v1, v2, v3, v4, v5, v6, v7, v8, v9)      NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE8(func, v2, v3, v4, v5, v6, v7, v8, v9)\n+#define NLOHMANN_JSON_PASTE11(func, v1, v2, v3, v4, v5, v6, v7, v8, v9, v10) NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE8(func, v2, v3, v4, v5, v6, v7, v8, v9, v10)\n+\n+#define NLOHMANN_JSON_TO(v1) j[#v1] = t.v1;\n+#define NLOHMANN_JSON_FROM(v1) j.at(#v1).get_to(t.v1);\n+\n+/*!\n+@brief macro\n+@def NLOHMANN_DEFINE_TYPE_INTRUSIVE\n+@since version 3.9.0\n+*/\n+#define NLOHMANN_DEFINE_TYPE_INTRUSIVE(Type, ...)  \\\n+    friend void to_json(nlohmann::json& j, const Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_TO, __VA_ARGS__)) } \\\n+    friend void from_json(const nlohmann::json& j, Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_FROM, __VA_ARGS__)) }\n+\n+/*!\n+@brief macro\n+@def NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE\n+@since version 3.9.0\n+*/\n+#define NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE(Type, ...)  \\\n+    void to_json(nlohmann::json& j, const Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_TO, __VA_ARGS__)) } \\\n+    void from_json(const nlohmann::json& j, Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_FROM, __VA_ARGS__)) }\ndiff --git a/single_include/nlohmann/json.hpp b/single_include/nlohmann/json.hpp\nindex 770418f4..d90c76c7 100644\n--- a/single_include/nlohmann/json.hpp\n+++ b/single_include/nlohmann/json.hpp\n@@ -2153,6 +2153,47 @@ JSON_HEDLEY_DIAGNOSTIC_POP\n     NumberIntegerType, NumberUnsignedType, NumberFloatType,                \\\n     AllocatorType, JSONSerializer, BinaryType>\n \n+// Macros to simplify conversion from/to types\n+\n+#define NLOHMANN_JSON_EXPAND( x ) x\n+#define NLOHMANN_JSON_GET_MACRO(_1,_2,_3,_4,_5,_6, _7, _8, _9, _10, _11, NAME,...) NAME\n+\n+#define NLOHMANN_JSON_PASTE(...) NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_GET_MACRO(__VA_ARGS__, NLOHMANN_JSON_PASTE11, \\\n+        NLOHMANN_JSON_PASTE10, NLOHMANN_JSON_PASTE9, NLOHMANN_JSON_PASTE8, NLOHMANN_JSON_PASTE7, \\\n+        NLOHMANN_JSON_PASTE6, NLOHMANN_JSON_PASTE5, NLOHMANN_JSON_PASTE4, NLOHMANN_JSON_PASTE3, \\\n+        NLOHMANN_JSON_PASTE2, NLOHMANN_JSON_PASTE1)(__VA_ARGS__))\n+#define NLOHMANN_JSON_PASTE2(func,  v1)                                      func(v1)\n+#define NLOHMANN_JSON_PASTE3(func,  v1, v2)                                  NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE2(func, v2)\n+#define NLOHMANN_JSON_PASTE4(func,  v1, v2, v3)                              NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE3(func, v2, v3)\n+#define NLOHMANN_JSON_PASTE5(func,  v1, v2, v3, v4)                          NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE4(func, v2, v3, v4)\n+#define NLOHMANN_JSON_PASTE6(func,  v1, v2, v3, v4, v5)                      NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE5(func, v2, v3, v4, v5)\n+#define NLOHMANN_JSON_PASTE7(func,  v1, v2, v3, v4, v5, v6)                  NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE6(func, v2, v3, v4, v5, v6)\n+#define NLOHMANN_JSON_PASTE8(func,  v1, v2, v3, v4, v5, v6, v7)              NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE7(func, v2, v3, v4, v5, v6, v7)\n+#define NLOHMANN_JSON_PASTE9(func,  v1, v2, v3, v4, v5, v6, v7, v8)          NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE8(func, v2, v3, v4, v5, v6, v7, v8)\n+#define NLOHMANN_JSON_PASTE10(func, v1, v2, v3, v4, v5, v6, v7, v8, v9)      NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE8(func, v2, v3, v4, v5, v6, v7, v8, v9)\n+#define NLOHMANN_JSON_PASTE11(func, v1, v2, v3, v4, v5, v6, v7, v8, v9, v10) NLOHMANN_JSON_PASTE2(func, v1) NLOHMANN_JSON_PASTE8(func, v2, v3, v4, v5, v6, v7, v8, v9, v10)\n+\n+#define NLOHMANN_JSON_TO(v1) j[#v1] = t.v1;\n+#define NLOHMANN_JSON_FROM(v1) j.at(#v1).get_to(t.v1);\n+\n+/*!\n+@brief macro\n+@def NLOHMANN_DEFINE_TYPE_INTRUSIVE\n+@since version 3.9.0\n+*/\n+#define NLOHMANN_DEFINE_TYPE_INTRUSIVE(Type, ...)  \\\n+    friend void to_json(nlohmann::json& j, const Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_TO, __VA_ARGS__)) } \\\n+    friend void from_json(const nlohmann::json& j, Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_FROM, __VA_ARGS__)) }\n+\n+/*!\n+@brief macro\n+@def NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE\n+@since version 3.9.0\n+*/\n+#define NLOHMANN_DEFINE_TYPE_NON_INTRUSIVE(Type, ...)  \\\n+    void to_json(nlohmann::json& j, const Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_TO, __VA_ARGS__)) } \\\n+    void from_json(const nlohmann::json& j, Type& t) { NLOHMANN_JSON_EXPAND(NLOHMANN_JSON_PASTE(NLOHMANN_JSON_FROM, __VA_ARGS__)) }\n+\n \n namespace nlohmann\n {\n"}
{"org": "nlohmann", "repo": "json", "number": "4512", "fix_patch": "diff --git a/include/nlohmann/detail/iterators/iter_impl.hpp b/include/nlohmann/detail/iterators/iter_impl.hpp\nindex 44470913..b04a5b28 100644\n--- a/include/nlohmann/detail/iterators/iter_impl.hpp\n+++ b/include/nlohmann/detail/iterators/iter_impl.hpp\n@@ -468,7 +468,8 @@ class iter_impl // NOLINT(cppcoreguidelines-special-member-functions,hicpp-speci\n     template < typename IterImpl, detail::enable_if_t < (std::is_same<IterImpl, iter_impl>::value || std::is_same<IterImpl, other_iter_impl>::value), std::nullptr_t > = nullptr >\n     bool operator==(const IterImpl& other) const\n     {\n-        // if objects are not the same, the comparison is undefined\n+        if (m_object == nullptr && other.m_object == nullptr) { return true; }\n+// if objects are not the same, the comparison is undefined\n         if (JSON_HEDLEY_UNLIKELY(m_object != other.m_object))\n         {\n             JSON_THROW(invalid_iterator::create(212, \"cannot compare iterators of different containers\", m_object));\n@@ -513,7 +514,8 @@ class iter_impl // NOLINT(cppcoreguidelines-special-member-functions,hicpp-speci\n     */\n     bool operator<(const iter_impl& other) const\n     {\n-        // if objects are not the same, the comparison is undefined\n+        if (m_object == nullptr && other.m_object == nullptr) { return false; }\n+// if objects are not the same, the comparison is undefined\n         if (JSON_HEDLEY_UNLIKELY(m_object != other.m_object))\n         {\n             JSON_THROW(invalid_iterator::create(212, \"cannot compare iterators of different containers\", m_object));\ndiff --git a/tests/src/unit-iterators3.cpp b/tests/src/unit-iterators3.cpp\nnew file mode 100644\nindex 00000000..4b5cff7e\n--- /dev/null\n+++ b/tests/src/unit-iterators3.cpp\n@@ -0,0 +1,35 @@\n+//     __ _____ _____ _____\n+//  __|  |   __|     |   | |  JSON for Modern C++ (supporting code)\n+// |  |  |__   |  |  | | | |  version 3.11.3\n+// |_____|_____|_____|_|___|  https://github.com/nlohmann/json\n+//\n+// SPDX-FileCopyrightText: 2013-2023 Niels Lohmann <https://nlohmann.me>\n+// SPDX-License-Identifier: MIT\n+\n+#include \"doctest_compatibility.h\"\n+\n+#include <string>\n+#include <unordered_map>\n+#include <vector>\n+\n+#include <nlohmann/json.hpp>\n+using nlohmann::json;\n+\n+#if (defined(__cplusplus) && __cplusplus >= 201402L) || (defined(_HAS_CXX14) && _HAS_CXX14 == 1)\n+    #define JSON_HAS_CPP_14\n+#endif\n+\n+#ifdef JSON_HAS_CPP_14\n+TEST_CASE_TEMPLATE(\"checking forward-iterators\", T, // NOLINT(readability-math-missing-parentheses)\n+                   std::vector<int>, std::string, nlohmann::json)\n+{\n+    auto it1 = typename T::iterator{};\n+    auto it2 = typename T::iterator{};\n+    CHECK(it1 == it2);\n+    CHECK(it1 <= it2);\n+    CHECK(it1 >= it2);\n+    CHECK_FALSE(it1 != it2);\n+    CHECK_FALSE(it1 < it2);\n+    CHECK_FALSE(it1 > it2);\n+}\n+#endif\n"}
{"org": "cli", "repo": "cli", "number": "7110", "fix_patch": "diff --git a/pkg/cmd/repo/sync/sync.go b/pkg/cmd/repo/sync/sync.go\nindex eebec4389..fb689b611 100644\n--- a/pkg/cmd/repo/sync/sync.go\n+++ b/pkg/cmd/repo/sync/sync.go\n@@ -256,7 +256,7 @@ func executeLocalRepoSync(srcRepo ghrepo.Interface, remote string, opts *SyncOpt\n \t}\n \tif currentBranch == branch {\n \t\tif isDirty, err := git.IsDirty(); err == nil && isDirty {\n-\t\t\treturn fmt.Errorf(\"can't sync because there are local changes; please stash them before trying again\")\n+\t\t\treturn fmt.Errorf(\"can't sync because there are local changes; please stash them before trying again. To include untracked files, use `git stash --all` (or `git stash --include-untracked`).\")\n \t\t} else if err != nil {\n \t\t\treturn err\n \t\t}\n"}
{"org": "simdjson", "repo": "simdjson", "number": "2016", "fix_patch": "diff --git a/singleheader/simdjson.h b/singleheader/simdjson.h\nindex f3880627..211c1bd0 100644\n--- a/singleheader/simdjson.h\n+++ b/singleheader/simdjson.h\n@@ -5328,7 +5328,8 @@ private:\n   error_code error;\n   size_t batch_start{0};\n   size_t doc_index{};\n-#ifdef SIMDJSON_THREADS_ENABLED\n+\n+  #ifdef SIMDJSON_THREADS_ENABLED\n   /** Indicates whether we use threads. Note that this needs to be a constant during the execution of the parsing. */\n   bool use_thread;\n \n@@ -8916,8 +8917,7 @@ simdjson_inline simdjson_result<element> parser::parse(const padded_string_view\n \n inline simdjson_result<document_stream> parser::parse_many(const uint8_t *buf, size_t len, size_t batch_size) noexcept {\n   if(batch_size < MINIMAL_BATCH_SIZE) { batch_size = MINIMAL_BATCH_SIZE; }\n-  return document_stream(*this, buf, len, batch_size);\n-}\n+\n inline simdjson_result<document_stream> parser::parse_many(const char *buf, size_t len, size_t batch_size) noexcept {\n   return parse_many(reinterpret_cast<const uint8_t *>(buf), len, batch_size);\n }\n@@ -26601,14 +26601,14 @@ public:\n    *         - other json errors if parsing fails. You should not rely on these errors to always the same for the\n    *           same document: they may vary under runtime dispatch (so they may vary depending on your system and hardware).\n    */\n-  inline simdjson_result<document_stream> iterate_many(const uint8_t *buf, size_t len, size_t batch_size = DEFAULT_BATCH_SIZE) noexcept;\n+  inline simdjson_result<document_stream> iterate_many(const uint8_t *buf, size_t len, size_t batch_size = DEFAULT_BATCH_SIZE, bool allow_comma_separated = false) noexcept;\n   /** @overload parse_many(const uint8_t *buf, size_t len, size_t batch_size) */\n-  inline simdjson_result<document_stream> iterate_many(const char *buf, size_t len, size_t batch_size = DEFAULT_BATCH_SIZE) noexcept;\n+  inline simdjson_result<document_stream> iterate_many(const char *buf, size_t len, size_t batch_size = DEFAULT_BATCH_SIZE, bool allow_comma_separated = false) noexcept;\n   /** @overload parse_many(const uint8_t *buf, size_t len, size_t batch_size) */\n-  inline simdjson_result<document_stream> iterate_many(const std::string &s, size_t batch_size = DEFAULT_BATCH_SIZE) noexcept;\n+  inline simdjson_result<document_stream> iterate_many(const std::string &s, size_t batch_size = DEFAULT_BATCH_SIZE, bool allow_comma_separated = false) noexcept;\n   inline simdjson_result<document_stream> iterate_many(const std::string &&s, size_t batch_size) = delete;// unsafe\n   /** @overload parse_many(const uint8_t *buf, size_t len, size_t batch_size) */\n-  inline simdjson_result<document_stream> iterate_many(const padded_string &s, size_t batch_size = DEFAULT_BATCH_SIZE) noexcept;\n+  inline simdjson_result<document_stream> iterate_many(const padded_string &s, size_t batch_size = DEFAULT_BATCH_SIZE, bool allow_comma_separated = false) noexcept;\n   inline simdjson_result<document_stream> iterate_many(const padded_string &&s, size_t batch_size) = delete;// unsafe\n \n   /** @private We do not want to allow implicit conversion from C string to std::string. */\n@@ -26953,7 +26953,7 @@ private:\n     const uint8_t *buf,\n     size_t len,\n     size_t batch_size\n-  ) noexcept;\n+  , bool allow_comma_separated) noexcept;\n \n   /**\n    * Parse the first document in the buffer. Used by begin(), to handle allocation and\n@@ -27011,6 +27011,7 @@ private:\n   error_code error;\n   size_t batch_start{0};\n   size_t doc_index{};\n+  bool allow_comma_separated{false};\n \n   #ifdef SIMDJSON_THREADS_ENABLED\n   /** Indicates whether we use threads. Note that this needs to be a constant during the execution of the parsing. */\n@@ -31265,18 +31266,20 @@ simdjson_warn_unused simdjson_inline simdjson_result<json_iterator> parser::iter\n   return json_iterator(reinterpret_cast<const uint8_t *>(json.data()), this);\n }\n \n-inline simdjson_result<document_stream> parser::iterate_many(const uint8_t *buf, size_t len, size_t batch_size) noexcept {\n+inline simdjson_result<document_stream> parser::iterate_many(const uint8_t *buf, size_t len, size_t batch_size, bool allow_comma_separated) noexcept {\n+  if (allow_comma_separated) { batch_size = len; }\n   if(batch_size < MINIMAL_BATCH_SIZE) { batch_size = MINIMAL_BATCH_SIZE; }\n-  return document_stream(*this, buf, len, batch_size);\n+  return document_stream(*this, buf, len, batch_size, allow_comma_separated);\n }\n-inline simdjson_result<document_stream> parser::iterate_many(const char *buf, size_t len, size_t batch_size) noexcept {\n-  return iterate_many(reinterpret_cast<const uint8_t *>(buf), len, batch_size);\n+\n+inline simdjson_result<document_stream> parser::iterate_many(const char *buf, size_t len, size_t batch_size, bool allow_comma_separated) noexcept {\n+  return iterate_many(reinterpret_cast<const uint8_t *>(buf), len, batch_size, allow_comma_separated);\n }\n-inline simdjson_result<document_stream> parser::iterate_many(const std::string &s, size_t batch_size) noexcept {\n-  return iterate_many(s.data(), s.length(), batch_size);\n+inline simdjson_result<document_stream> parser::iterate_many(const std::string &s, size_t batch_size, bool allow_comma_separated) noexcept {\n+  return iterate_many(s.data(), s.length(), batch_size, allow_comma_separated);\n }\n-inline simdjson_result<document_stream> parser::iterate_many(const padded_string &s, size_t batch_size) noexcept {\n-  return iterate_many(s.data(), s.length(), batch_size);\n+inline simdjson_result<document_stream> parser::iterate_many(const padded_string &s, size_t batch_size, bool allow_comma_separated) noexcept {\n+  return iterate_many(s.data(), s.length(), batch_size, allow_comma_separated);\n }\n \n simdjson_inline size_t parser::capacity() const noexcept {\n@@ -31413,7 +31416,8 @@ simdjson_inline document_stream::document_stream(\n   ondemand::parser &_parser,\n   const uint8_t *_buf,\n   size_t _len,\n-  size_t _batch_size\n+  size_t _batch_size,\n+  bool _allow_comma_separated\n ) noexcept\n   : parser{&_parser},\n     buf{_buf},\n@@ -31617,6 +31621,11 @@ inline void document_stream::next_document() noexcept {\n   // Go to next place where depth=0 (document depth)\n   error = doc.iter.skip_child(0);\n   if (error) { return; }\n+  if (allow_comma_separated) {\n+    if (!doc.iter.at_end() && *doc.iter.peek(0) == \\',\\') {\n+      doc.iter.return_current_and_advance();\n+    }\n+  }\n   // Always set depth=1 at the start of document\n   doc.iter._depth = 1;\n   // Resets the string buffer at the beginning, thus invalidating the strings.\n"}
{"org": "cli", "repo": "cli", "number": "8157", "fix_patch": "diff --git a/api/http_client.go b/api/http_client.go\nindex 9f2d59ce3..44e0fb226 100644\n--- a/api/http_client.go\n+++ b/api/http_client.go\n@@ -1,6 +1,7 @@\n package api\n \n import (\n+\t\"bytes\"\n \t\"fmt\"\n \t\"io\"\n \t\"net/http\"\n@@ -69,6 +70,7 @@ func NewHTTPClient(opts HTTPClientOptions) (*http.Client, error) {\n \t\tclient.Transport = AddAuthTokenHeader(client.Transport, opts.Config)\n \t}\n \n+ \tclient.Transport = SanitizeC0BackspaceFormfeed(client.Transport)\n \treturn client, nil\n }\n \n@@ -128,6 +130,67 @@ func ExtractHeader(name string, dest *string) func(http.RoundTripper) http.Round\n \t}\n }\n \n+// SanitizeC0BackspaceFormfeed wraps the transport to convert C0 backspace (0x08) and form feed (0x0C)\n+// into caret notation (^H and ^L) for JSON responses.\n+func SanitizeC0BackspaceFormfeed(rt http.RoundTripper) http.RoundTripper {\n+\treturn &funcTripper{roundTrip: func(req *http.Request) (*http.Response, error) {\n+\t\tres, err := rt.RoundTrip(req)\n+\t\tif err != nil || res == nil || res.Body == nil {\n+\t\t\treturn res, err\n+\t\t}\n+\t\tct := res.Header.Get(\"Content-Type\")\n+\t\tif !strings.HasPrefix(ct, \"application/json\") {\n+\t\t\treturn res, nil\n+\t\t}\n+\t\tb, err := io.ReadAll(res.Body)\n+\t\t_ = res.Body.Close()\n+\t\tif err != nil {\n+\t\t\t// If reading fails, restore an empty body and return the response.\n+\t\t\tres.Body = io.NopCloser(bytes.NewReader(nil))\n+\t\t\tres.ContentLength = 0\n+\t\t\tif res.Header != nil {\n+\t\t\t\tres.Header.Set(\"Content-Length\", \"0\")\n+\t\t\t}\n+\t\t\treturn res, nil\n+\t\t}\n+ \t\t// replace JSON escape sequences for backspace and form feed\n+\t\tsb := b\n+\t\tsb = bytes.ReplaceAll(sb, []byte(\"\\\\u0008\"), []byte(\"^H\"))\n+\t\tsb = bytes.ReplaceAll(sb, []byte(\"\\\\u000c\"), []byte(\"^L\"))\n+\t\tsb = bytes.ReplaceAll(sb, []byte(\"\\\\u000C\"), []byte(\"^L\"))\n+\t\tsb = bytes.ReplaceAll(sb, []byte(\"\\\\b\"), []byte(\"^H\"))\n+\t\tsb = bytes.ReplaceAll(sb, []byte(\"\\\\f\"), []byte(\"^L\"))\n+\t\tvar out bytes.Buffer\n+\t\tout.Grow(len(b))\n+\t\tfor _, c := range sb {\n+\t\t\tswitch c {\n+\t\t\tcase 0x08:\n+\t\t\t\tout.WriteString(\"^H\")\n+\t\t\tcase 0x0C:\n+\t\t\t\tout.WriteString(\"^L\")\n+\t\t\tdefault:\n+\t\t\t\tout.WriteByte(c)\n+\t\t\t}\n+\t\t}\n+\t\tnb := out.Bytes()\n+\t\tres.Body = io.NopCloser(bytes.NewReader(nb))\n+\t\tres.ContentLength = int64(len(nb))\n+\t\tif res.Header != nil {\n+\t\t\tres.Header.Set(\"Content-Length\", fmt.Sprintf(\"%d\", len(nb)))\n+\t\t}\n+\t\treturn res, nil\n+\t}}\n+}\n+\n+func replaceJSONEscapes(b []byte) []byte {\n+  b = bytes.ReplaceAll(b, []byte(\"\\\\u0008\"), []byte(\"^H\"))\n+  b = bytes.ReplaceAll(b, []byte(\"\\\\u000c\"), []byte(\"^L\"))\n+  b = bytes.ReplaceAll(b, []byte(\"\\\\u000C\"), []byte(\"^L\"))\n+  b = bytes.ReplaceAll(b, []byte(\"\\\\b\"), []byte(\"^H\"))\n+  b = bytes.ReplaceAll(b, []byte(\"\\\\f\"), []byte(\"^L\"))\n+  return b\n+}\n+\n type funcTripper struct {\n \troundTrip func(*http.Request) (*http.Response, error)\n }\ndiff --git a/pkg/cmd/gist/list/list_test.go b/pkg/cmd/gist/list/list_test.go\nindex 54bb52eb1..682ebe8dc 100644\n--- a/pkg/cmd/gist/list/list_test.go\n+++ b/pkg/cmd/gist/list/list_test.go\n@@ -180,10 +180,11 @@ func Test_listRun(t *testing.T) {\n \t\t\t\t)\n \t\t\t},\n \t\t\twantOut: heredoc.Doc(`\n-\t\t\t\t1234567890  cool.txt                         1 file    public  about 6 hours ago\n-\t\t\t\t4567890123                                   1 file    public  about 6 hours ago\n-\t\t\t\t2345678901  tea leaves thwart those who ...  2 files   secret  about 6 hours ago\n-\t\t\t\t3456789012  short desc                       11 files  secret  about 6 hours ago\n+\t\t\t\tID          DESCRIPTION                  FILES     VISIBILITY  UPDATED\n+\t\t\t\t1234567890  cool.txt                     1 file    public      about 6 hours ago\n+\t\t\t\t4567890123                               1 file    public      about 6 hours ago\n+\t\t\t\t2345678901  tea leaves thwart those ...  2 files   secret      about 6 hours ago\n+\t\t\t\t3456789012  short desc                   11 files  secret      about 6 hours ago\n \t\t\t`),\n \t\t},\n \t\t{\n@@ -214,8 +215,9 @@ func Test_listRun(t *testing.T) {\n \t\t\t\t)\n \t\t\t},\n \t\t\twantOut: heredoc.Doc(`\n-\t\t\t\t1234567890  cool.txt  1 file  public  about 6 hours ago\n-\t\t\t\t4567890123            1 file  public  about 6 hours ago\n+\t\t\t\tID          DESCRIPTION  FILES   VISIBILITY  UPDATED\n+\t\t\t\t1234567890  cool.txt     1 file  public      about 6 hours ago\n+\t\t\t\t4567890123               1 file  public      about 6 hours ago\n \t\t\t`),\n \t\t},\n \t\t{\n@@ -261,8 +263,9 @@ func Test_listRun(t *testing.T) {\n \t\t\t\t)\n \t\t\t},\n \t\t\twantOut: heredoc.Doc(`\n-\t\t\t\t2345678901  tea leaves thwart those who ...  2 files   secret  about 6 hours ago\n-\t\t\t\t3456789012  short desc                       11 files  secret  about 6 hours ago\n+\t\t\t\tID          DESCRIPTION                  FILES     VISIBILITY  UPDATED\n+\t\t\t\t2345678901  tea leaves thwart those ...  2 files   secret      about 6 hours ago\n+\t\t\t\t3456789012  short desc                   11 files  secret      about 6 hours ago\n \t\t\t`),\n \t\t},\n \t\t{\n@@ -285,7 +288,10 @@ func Test_listRun(t *testing.T) {\n \t\t\t\t\t)),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"1234567890  cool.txt  1 file  public  about 6 hours ago\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tID          DESCRIPTION  FILES   VISIBILITY  UPDATED\n+\t\t\t\t1234567890  cool.txt     1 file  public      about 6 hours ago\n+\t\t\t`),\n \t\t},\n \t\t{\n \t\t\tname: \"nontty output\",\ndiff --git a/pkg/cmd/issue/develop/develop_test.go b/pkg/cmd/issue/develop/develop_test.go\nindex d4f8bce2d..b834237ab 100644\n--- a/pkg/cmd/issue/develop/develop_test.go\n+++ b/pkg/cmd/issue/develop/develop_test.go\n@@ -6,6 +6,7 @@ import (\n \t\"net/http\"\n \t\"testing\"\n \n+\t\"github.com/MakeNowJust/heredoc\"\n \t\"github.com/cli/cli/v2/context\"\n \t\"github.com/cli/cli/v2/git\"\n \t\"github.com/cli/cli/v2/internal/ghrepo\"\n@@ -245,7 +246,14 @@ func TestDevelopRun(t *testing.T) {\n \t\t\t\t\t\tassert.Equal(t, \"REPO\", inputs[\"name\"])\n \t\t\t\t\t}))\n \t\t\t},\n-\t\t\texpectedOut: \"\\nShowing linked branches for OWNER/REPO#42\\n\\nfoo  https://github.com/OWNER/REPO/tree/foo\\nbar  https://github.com/OWNER/OTHER-REPO/tree/bar\\n\",\n+\t\t\texpectedOut: heredoc.Doc(`\n+\n+\t\t\t\tShowing linked branches for OWNER/REPO#42\n+\t\t\t\t\n+\t\t\t\tBRANCH  URL\n+\t\t\t\tfoo     https://github.com/OWNER/REPO/tree/foo\n+\t\t\t\tbar     https://github.com/OWNER/OTHER-REPO/tree/bar\n+\t\t\t`),\n \t\t},\n \t\t{\n \t\t\tname: \"list branches for an issue providing an issue url\",\ndiff --git a/pkg/cmd/issue/list/list_test.go b/pkg/cmd/issue/list/list_test.go\nindex cf0624c87..e816500c2 100644\n--- a/pkg/cmd/issue/list/list_test.go\n+++ b/pkg/cmd/issue/list/list_test.go\n@@ -104,9 +104,10 @@ func TestIssueList_tty(t *testing.T) {\n \n \t\tShowing 3 of 3 open issues in OWNER/REPO\n \n-\t\t#1  number won   label  about 1 day ago\n-\t\t#2  number too   label  about 1 month ago\n-\t\t#4  number fore  label  about 2 years ago\n+\t\tID  TITLE        LABELS  UPDATED\n+\t\t#1  number won   label   about 1 day ago\n+\t\t#2  number too   label   about 1 month ago\n+\t\t#4  number fore  label   about 2 years ago\n \t`), output.String())\n \tassert.Equal(t, ``, output.Stderr())\n }\ndiff --git a/pkg/cmd/label/list_test.go b/pkg/cmd/label/list_test.go\nindex 7e7a9a93d..37f458439 100644\n--- a/pkg/cmd/label/list_test.go\n+++ b/pkg/cmd/label/list_test.go\n@@ -215,7 +215,14 @@ func TestListRun(t *testing.T) {\n \t\t\t\t\t),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantStdout: \"\\nShowing 2 of 2 labels in OWNER/REPO\\n\\nbug   This is a bug label   #d73a4a\\ndocs  This is a docs label  #ffa8da\\n\",\n+\t\t\twantStdout: heredoc.Doc(`\n+\n+\t\t\t\tShowing 2 of 2 labels in OWNER/REPO\n+\t\t\t\t\n+\t\t\t\tNAME  DESCRIPTION           COLOR\n+\t\t\t\tbug   This is a bug label   #d73a4a\n+\t\t\t\tdocs  This is a docs label  #ffa8da\n+\t\t\t`),\n \t\t},\n \t\t{\n \t\t\tname: \"lists labels notty\",\n@@ -343,6 +350,7 @@ func TestListRun(t *testing.T) {\n \n \t\t\tShowing 2 of 2 labels in OWNER/REPO\n \n+\t\t\tNAME  DESCRIPTION           COLOR\n \t\t\tbug   This is a bug label   #d73a4a\n \t\t\tdocs  This is a docs label  #ffa8da\n \t\t\t`),\ndiff --git a/pkg/cmd/pr/checks/checks_test.go b/pkg/cmd/pr/checks/checks_test.go\nindex dcab36117..cc21043ba 100644\n--- a/pkg/cmd/pr/checks/checks_test.go\n+++ b/pkg/cmd/pr/checks/checks_test.go\n@@ -7,6 +7,7 @@ import (\n \t\"testing\"\n \t\"time\"\n \n+\t\"github.com/MakeNowJust/heredoc\"\n \t\"github.com/cli/cli/v2/api\"\n \t\"github.com/cli/cli/v2/internal/browser\"\n \tfd \"github.com/cli/cli/v2/internal/featuredetection\"\n@@ -167,7 +168,15 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/someFailing.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"Some checks were not successful\\n0 cancelled, 1 failing, 1 successful, 0 skipped, and 1 pending checks\\n\\nX  sad tests     1m26s  sweet link\\n✓  cool tests    1m26s  sweet link\\n*  slow tests    1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tSome checks were not successful\n+\t\t\t\t0 cancelled, 1 failing, 1 successful, 0 skipped, and 1 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME        DESCRIPTION  ELAPSED  URL\n+\t\t\t\tX  sad tests                1m26s    sweet link\n+\t\t\t\t✓  cool tests               1m26s    sweet link\n+\t\t\t\t*  slow tests               1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"SilentError\",\n \t\t},\n \t\t{\n@@ -179,7 +188,15 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/someCancelled.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"Some checks were cancelled\\n1 cancelled, 0 failing, 2 successful, 0 skipped, and 0 pending checks\\n\\n✓  cool tests       1m26s  sweet link\\n-  sad tests        1m26s  sweet link\\n✓  awesome tests    1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tSome checks were cancelled\n+\t\t\t\t1 cancelled, 0 failing, 2 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME           DESCRIPTION  ELAPSED  URL\n+\t\t\t\t✓  cool tests                  1m26s    sweet link\n+\t\t\t\t-  sad tests                   1m26s    sweet link\n+\t\t\t\t✓  awesome tests               1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\n@@ -191,7 +208,16 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/somePending.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"Some checks are still pending\\n1 cancelled, 0 failing, 2 successful, 0 skipped, and 1 pending checks\\n\\n✓  cool tests    1m26s  sweet link\\n✓  rad tests     1m26s  sweet link\\n*  slow tests    1m26s  sweet link\\n-  sad tests     1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tSome checks are still pending\n+\t\t\t\t1 cancelled, 0 failing, 2 successful, 0 skipped, and 1 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME        DESCRIPTION  ELAPSED  URL\n+\t\t\t\t✓  cool tests               1m26s    sweet link\n+\t\t\t\t✓  rad tests                1m26s    sweet link\n+\t\t\t\t*  slow tests               1m26s    sweet link\n+\t\t\t\t-  sad tests                1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"PendingError\",\n \t\t},\n \t\t{\n@@ -203,7 +229,15 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/allPassing.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"All checks were successful\\n0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\\n\\n✓  awesome tests    1m26s  sweet link\\n✓  cool tests       1m26s  sweet link\\n✓  rad tests        1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME           DESCRIPTION  ELAPSED  URL\n+\t\t\t\t✓  awesome tests               1m26s    sweet link\n+\t\t\t\t✓  cool tests                  1m26s    sweet link\n+\t\t\t\t✓  rad tests                   1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\n@@ -216,7 +250,22 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/allPassing.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"\\x1b[?1049hAll checks were successful\\n0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\\n\\n✓  awesome tests    1m26s  sweet link\\n✓  cool tests       1m26s  sweet link\\n✓  rad tests        1m26s  sweet link\\n\\x1b[?1049lAll checks were successful\\n0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\\n\\n✓  awesome tests    1m26s  sweet link\\n✓  cool tests       1m26s  sweet link\\n✓  rad tests        1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Docf(`\n+\t\t\t\t%[1]s[?1049hAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME           DESCRIPTION  ELAPSED  URL\n+\t\t\t\t✓  awesome tests               1m26s    sweet link\n+\t\t\t\t✓  cool tests                  1m26s    sweet link\n+\t\t\t\t✓  rad tests                   1m26s    sweet link\n+\t\t\t\t%[1]s[?1049lAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\n+\n+\t\t\t\t   NAME           DESCRIPTION  ELAPSED  URL\n+\t\t\t\t✓  awesome tests               1m26s    sweet link\n+\t\t\t\t✓  cool tests                  1m26s    sweet link\n+\t\t\t\t✓  rad tests                   1m26s    sweet link\n+\t\t\t`, \"\\x1b\"),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\n@@ -230,7 +279,24 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/someFailing.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"\\x1b[?1049h\\x1b[0;0H\\x1b[JRefreshing checks status every 0 seconds. Press Ctrl+C to quit.\\n\\nSome checks were not successful\\n0 cancelled, 1 failing, 1 successful, 0 skipped, and 1 pending checks\\n\\nX  sad tests     1m26s  sweet link\\n✓  cool tests    1m26s  sweet link\\n*  slow tests    1m26s  sweet link\\n\\x1b[?1049lSome checks were not successful\\n0 cancelled, 1 failing, 1 successful, 0 skipped, and 1 pending checks\\n\\nX  sad tests     1m26s  sweet link\\n✓  cool tests    1m26s  sweet link\\n*  slow tests    1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Docf(`\n+\t\t\t\t%[1]s[?1049h%[1]s[0;0H%[1]s[JRefreshing checks status every 0 seconds. Press Ctrl+C to quit.\n+\t\t\t\t\n+\t\t\t\tSome checks were not successful\n+\t\t\t\t0 cancelled, 1 failing, 1 successful, 0 skipped, and 1 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME        DESCRIPTION  ELAPSED  URL\n+\t\t\t\tX  sad tests                1m26s    sweet link\n+\t\t\t\t✓  cool tests               1m26s    sweet link\n+\t\t\t\t*  slow tests               1m26s    sweet link\n+\t\t\t\t%[1]s[?1049lSome checks were not successful\n+\t\t\t\t0 cancelled, 1 failing, 1 successful, 0 skipped, and 1 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME        DESCRIPTION  ELAPSED  URL\n+\t\t\t\tX  sad tests                1m26s    sweet link\n+\t\t\t\t✓  cool tests               1m26s    sweet link\n+\t\t\t\t*  slow tests               1m26s    sweet link\n+\t\t\t`, \"\\x1b\"),\n \t\t\twantErr: \"SilentError\",\n \t\t},\n \t\t{\n@@ -242,7 +308,15 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/withStatuses.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"Some checks were not successful\\n0 cancelled, 1 failing, 2 successful, 0 skipped, and 0 pending checks\\n\\nX  a status             sweet link\\n✓  cool tests    1m26s  sweet link\\n✓  rad tests     1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tSome checks were not successful\n+\t\t\t\t0 cancelled, 1 failing, 2 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME        DESCRIPTION  ELAPSED  URL\n+\t\t\t\tX  a status                          sweet link\n+\t\t\t\t✓  cool tests               1m26s    sweet link\n+\t\t\t\t✓  rad tests                1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"SilentError\",\n \t\t},\n \t\t{\n@@ -320,7 +394,15 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/someSkipping.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"All checks were successful\\n0 cancelled, 0 failing, 1 successful, 2 skipped, and 0 pending checks\\n\\n✓  cool tests    1m26s  sweet link\\n-  rad tests     1m26s  sweet link\\n-  skip tests    1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 1 successful, 2 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME        DESCRIPTION  ELAPSED  URL\n+\t\t\t\t✓  cool tests               1m26s    sweet link\n+\t\t\t\t-  rad tests                1m26s    sweet link\n+\t\t\t\t-  skip tests               1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\n@@ -344,7 +426,13 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/onlyRequired.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"All checks were successful\\n0 cancelled, 0 failing, 1 successful, 0 skipped, and 0 pending checks\\n\\n✓  cool tests    1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 1 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME        DESCRIPTION  ELAPSED  URL\n+\t\t\t\t✓  cool tests               1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\n@@ -393,7 +481,15 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/withDescriptions.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"All checks were successful\\n0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\\n\\n✓  awesome tests  awesome description  1m26s  sweet link\\n✓  cool tests     cool description     1m26s  sweet link\\n✓  rad tests      rad description      1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 3 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME           DESCRIPTION          ELAPSED  URL\n+\t\t\t\t✓  awesome tests  awesome description  1m26s    sweet link\n+\t\t\t\t✓  cool tests     cool description     1m26s    sweet link\n+\t\t\t\t✓  rad tests      rad description      1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\n@@ -416,7 +512,14 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/withEvents.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"All checks were successful\\n0 cancelled, 0 failing, 2 successful, 0 skipped, and 0 pending checks\\n\\n✓  tests/cool tests (pull_request)  cool description  1m26s  sweet link\\n✓  tests/cool tests (push)          cool description  1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 2 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME                             DESCRIPTION       ELAPSED  URL\n+\t\t\t\t✓  tests/cool tests (pull_request)  cool description  1m26s    sweet link\n+\t\t\t\t✓  tests/cool tests (push)          cool description  1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\n@@ -429,7 +532,13 @@ func Test_checksRun(t *testing.T) {\n \t\t\t\t\thttpmock.FileResponse(\"./fixtures/withoutEvents.json\"),\n \t\t\t\t)\n \t\t\t},\n-\t\t\twantOut: \"All checks were successful\\n0 cancelled, 0 failing, 1 successful, 0 skipped, and 0 pending checks\\n\\n✓  tests/cool tests  cool description  1m26s  sweet link\\n\",\n+\t\t\twantOut: heredoc.Doc(`\n+\t\t\t\tAll checks were successful\n+\t\t\t\t0 cancelled, 0 failing, 1 successful, 0 skipped, and 0 pending checks\n+\t\t\t\t\n+\t\t\t\t   NAME              DESCRIPTION       ELAPSED  URL\n+\t\t\t\t✓  tests/cool tests  cool description  1m26s    sweet link\n+\t\t\t`),\n \t\t\twantErr: \"\",\n \t\t},\n \t\t{\ndiff --git a/pkg/cmd/pr/list/list_test.go b/pkg/cmd/pr/list/list_test.go\nindex bc661f104..d4a658a81 100644\n--- a/pkg/cmd/pr/list/list_test.go\n+++ b/pkg/cmd/pr/list/list_test.go\n@@ -84,6 +84,7 @@ func TestPRList(t *testing.T) {\n \n \t\tShowing 3 of 3 open pull requests in OWNER/REPO\n \n+\t\tID   TITLE                  BRANCH         CREATED AT\n \t\t#32  New feature            feature        about 3 hours ago\n \t\t#29  Fixed bad bug          hubot:bug-fix  about 1 month ago\n \t\t#28  Improve documentation  docs           about 2 years ago\ndiff --git a/pkg/cmd/project/field-list/field_list_test.go b/pkg/cmd/project/field-list/field_list_test.go\nindex c6c2f97c6..85e67451f 100644\n--- a/pkg/cmd/project/field-list/field_list_test.go\n+++ b/pkg/cmd/project/field-list/field_list_test.go\n@@ -163,7 +163,8 @@ func TestRunList_User(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\tnumber: 1,\n \t\t\towner:  \"monalisa\",\n@@ -256,7 +257,8 @@ func TestRunList_Org(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\tnumber: 1,\n \t\t\towner:  \"github\",\n@@ -339,7 +341,8 @@ func TestRunList_Me(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\tnumber: 1,\n \t\t\towner:  \"@me\",\n@@ -406,7 +409,8 @@ func TestRunList_Empty(t *testing.T) {\n \n \tios, _, _, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\tnumber: 1,\n \t\t\towner:  \"@me\",\ndiff --git a/pkg/cmd/project/item-list/item_list_test.go b/pkg/cmd/project/item-list/item_list_test.go\nindex 490473691..c36dfc589 100644\n--- a/pkg/cmd/project/item-list/item_list_test.go\n+++ b/pkg/cmd/project/item-list/item_list_test.go\n@@ -178,7 +178,8 @@ func TestRunList_User(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\tnumber: 1,\n \t\t\towner:  \"monalisa\",\n@@ -285,7 +286,8 @@ func TestRunList_Org(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\tnumber: 1,\n \t\t\towner:  \"github\",\n@@ -382,7 +384,8 @@ func TestRunList_Me(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\tnumber: 1,\n \t\t\towner:  \"@me\",\ndiff --git a/pkg/cmd/project/list/list_test.go b/pkg/cmd/project/list/list_test.go\nindex 492d224b0..bafdf8e93 100644\n--- a/pkg/cmd/project/list/list_test.go\n+++ b/pkg/cmd/project/list/list_test.go\n@@ -154,7 +154,8 @@ func TestRunList(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\towner: \"monalisa\",\n \t\t},\n@@ -225,7 +226,8 @@ func TestRunList_Me(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\towner: \"@me\",\n \t\t},\n@@ -296,7 +298,8 @@ func TestRunListViewer(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp:     tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp:     tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts:   listOpts{},\n \t\tclient: client,\n \t\tio:     ios,\n@@ -374,7 +377,8 @@ func TestRunListOrg(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\towner: \"github\",\n \t\t},\n@@ -428,7 +432,8 @@ func TestRunListEmpty(t *testing.T) {\n \n \tios, _, _, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp:     tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp:     tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts:   listOpts{},\n \t\tclient: client,\n \t\tio:     ios,\n@@ -504,7 +509,8 @@ func TestRunListWithClosed(t *testing.T) {\n \n \tios, _, stdout, _ := iostreams.Test()\n \tconfig := listConfig{\n-\t\ttp: tableprinter.New(ios),\n+\t\t//nolint:staticcheck // SA1019: tableprinter.NoHeaders temporarily allowed in project tests.\n+\t\ttp: tableprinter.New(ios, tableprinter.NoHeader),\n \t\topts: listOpts{\n \t\t\towner:  \"monalisa\",\n \t\t\tclosed: true,\ndiff --git a/pkg/cmd/repo/deploy-key/list/list_test.go b/pkg/cmd/repo/deploy-key/list/list_test.go\nindex 0cefd0eb2..4e5a57f11 100644\n--- a/pkg/cmd/repo/deploy-key/list/list_test.go\n+++ b/pkg/cmd/repo/deploy-key/list/list_test.go\n@@ -48,6 +48,7 @@ func TestListRun(t *testing.T) {\n \t\t\t\t)\n \t\t\t},\n \t\t\twantStdout: heredoc.Doc(`\n+\t\t\t\tID    TITLE          TYPE        KEY                  CREATED AT\n \t\t\t\t1234  Mac            read-only   ssh-rsa AAAABbBB123  1d\n \t\t\t\t5678  hubot@Windows  read-write  ssh-rsa EEEEEEEK247  1d\n \t\t\t`),\ndiff --git a/pkg/cmd/repo/list/list_test.go b/pkg/cmd/repo/list/list_test.go\nindex 3a02cbb22..55e4da83d 100644\n--- a/pkg/cmd/repo/list/list_test.go\n+++ b/pkg/cmd/repo/list/list_test.go\n@@ -385,6 +385,7 @@ func TestRepoList_tty(t *testing.T) {\n \n \t\tShowing 3 of 3 repositories in @octocat\n \n+\t\tNAME                 DESCRIPTION          INFO          UPDATED\n \t\toctocat/hello-world  My first repository  public        8h\n \t\toctocat/cli          GitHub CLI           public, fork  8h\n \t\toctocat/testing                           private       7d\ndiff --git a/pkg/cmd/workflow/view/view_test.go b/pkg/cmd/workflow/view/view_test.go\nindex 9be264d92..c706da48f 100644\n--- a/pkg/cmd/workflow/view/view_test.go\n+++ b/pkg/cmd/workflow/view/view_test.go\n@@ -176,10 +176,11 @@ func TestViewRun(t *testing.T) {\n \n \t\tTotal runs 10\n \t\tRecent runs\n-\t\tX  cool commit  a workflow  trunk  push  1\n-\t\t*  cool commit  a workflow  trunk  push  2\n-\t\t✓  cool commit  a workflow  trunk  push  3\n-\t\tX  cool commit  a workflow  trunk  push  4\n+\t\t   TITLE        WORKFLOW    BRANCH  EVENT  ID\n+\t\tX  cool commit  a workflow  trunk   push   1\n+\t\t*  cool commit  a workflow  trunk   push   2\n+\t\t✓  cool commit  a workflow  trunk   push   3\n+\t\tX  cool commit  a workflow  trunk   push   4\n \n \t\tTo see more runs for this workflow, try: gh run list --workflow flow.yml\n \t\tTo see the YAML for this workflow, try: gh workflow view flow.yml --yaml\n"}
{"org": "cli", "repo": "cli", "number": "5396", "fix_patch": "diff --git a/pkg/cmd/issue/delete/delete.go b/pkg/cmd/issue/delete/delete.go\nindex efabbbf5b..0901311ee 100644\n--- a/pkg/cmd/issue/delete/delete.go\n+++ b/pkg/cmd/issue/delete/delete.go\n@@ -26,6 +26,7 @@ type DeleteOptions struct {\n \tBaseRepo   func() (ghrepo.Interface, error)\n \n \tSelectorArg string\n+\t\tConfirm     bool\n }\n \n func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Command {\n@@ -54,6 +55,9 @@ func NewCmdDelete(f *cmdutil.Factory, runF func(*DeleteOptions) error) *cobra.Co\n \t\t},\n \t}\n \n+\n+\t\t// --confirm flag allows bypassing interactive confirmation in a TTY\n+\t\tcmd.Flags().BoolVar(&opts.Confirm, \"confirm\", false, \"Confirm deletion without prompting\")\n \treturn cmd\n }\n \n@@ -74,7 +78,7 @@ func deleteRun(opts *DeleteOptions) error {\n \t}\n \n \t// When executed in an interactive shell, require confirmation. Otherwise skip confirmation.\n-\tif opts.IO.CanPrompt() {\n+\tif opts.IO.CanPrompt() && !opts.Confirm {\n \t\tanswer := \"\"\n \t\terr = prompt.SurveyAskOne(\n \t\t\t&survey.Input{\n"}
{"org": "cli", "repo": "cli", "number": "5698", "fix_patch": "diff --git a/pkg/cmd/root/help.go b/pkg/cmd/root/help.go\nindex d8b3e18b1..7e83f46e4 100644\n--- a/pkg/cmd/root/help.go\n+++ b/pkg/cmd/root/help.go\n@@ -2,6 +2,7 @@ package root\n \n import (\n \t\"bytes\"\n+\t\"io\"\n \t\"fmt\"\n \t\"sort\"\n \t\"strings\"\n@@ -12,25 +13,25 @@ import (\n \t\"github.com/spf13/pflag\"\n )\n \n-func rootUsageFunc(command *cobra.Command) error {\n-\tcommand.Printf(\"Usage:  %s\", command.UseLine())\n+func rootUsageFunc(w io.Writer, command *cobra.Command) error {\n+\tfmt.Fprintf(w, \"Usage:  %s\", command.UseLine())\n \n \tsubcommands := command.Commands()\n \tif len(subcommands) > 0 {\n-\t\tcommand.Print(\"\\n\\nAvailable commands:\\n\")\n+\t\tfmt.Fprint(w, \"\\n\\nAvailable commands:\\n\")\n \t\tfor _, c := range subcommands {\n \t\t\tif c.Hidden {\n \t\t\t\tcontinue\n \t\t\t}\n-\t\t\tcommand.Printf(\"  %s\\n\", c.Name())\n+\t\t\tfmt.Fprintf(w, \"  %s\\n\", c.Name())\n \t\t}\n \t\treturn nil\n \t}\n \n \tflagUsages := command.LocalFlags().FlagUsages()\n \tif flagUsages != \"\" {\n-\t\tcommand.Println(\"\\n\\nFlags:\")\n-\t\tcommand.Print(text.Indent(dedent(flagUsages), \"  \"))\n+\t\tfmt.Fprintln(w, \"\\n\\nFlags:\")\n+\t\tfmt.Fprint(w, text.Indent(dedent(flagUsages), \"  \"))\n \t}\n \treturn nil\n }\n@@ -52,8 +53,8 @@ func HasFailed() bool {\n // Display helpful error message in case subcommand name was mistyped.\n // This matches Cobra's behavior for root command, which Cobra\n // confusingly doesn't apply to nested commands.\n-func nestedSuggestFunc(command *cobra.Command, arg string) {\n-\tcommand.Printf(\"unknown command %q for %q\\n\", arg, command.CommandPath())\n+func nestedSuggestFunc(w io.Writer, command *cobra.Command, arg string) {\n+\tfmt.Fprintf(w, \"unknown command %q for %q\\n\", arg, command.CommandPath())\n \n \tvar candidates []string\n \tif arg == \"help\" {\n@@ -68,12 +69,12 @@ func nestedSuggestFunc(command *cobra.Command, arg string) {\n \tif len(candidates) > 0 {\n \t\tcommand.Print(\"\\nDid you mean this?\\n\")\n \t\tfor _, c := range candidates {\n-\t\t\tcommand.Printf(\"\\t%s\\n\", c)\n+\t\t\tfmt.Fprintf(w, \"\\t%s\\n\", c)\n \t\t}\n \t}\n \n-\tcommand.Print(\"\\n\")\n-\t_ = rootUsageFunc(command)\n+\tfmt.Fprint(w, \"\\n\")\n+\t_ = rootUsageFunc(w, command)\n }\n \n func isRootCmd(command *cobra.Command) bool {\n@@ -84,7 +85,7 @@ func rootHelpFunc(f *cmdutil.Factory, command *cobra.Command, args []string) {\n \tcs := f.IOStreams.ColorScheme()\n \n \tif isRootCmd(command.Parent()) && len(args) >= 2 && args[1] != \"--help\" && args[1] != \"-h\" {\n-\t\tnestedSuggestFunc(command, args[1])\n+\t\tnestedSuggestFunc(f.IOStreams.ErrOut, command, args[1])\n \t\thasFailed = true\n \t\treturn\n \t}\n@@ -190,7 +191,7 @@ Read the manual at https://cli.github.com/manual`})\n \t\thelpEntries = append(helpEntries, helpEntry{\"FEEDBACK\", command.Annotations[\"help:feedback\"]})\n \t}\n \n-\tout := command.OutOrStdout()\n+\tout := f.IOStreams.Out\n \tfor _, e := range helpEntries {\n \t\tif e.Title != \"\" {\n \t\t\t// If there is a title, add indentation to each line in the body\ndiff --git a/pkg/cmd/root/help_topic.go b/pkg/cmd/root/help_topic.go\nindex 757e972ed..79cc1baa7 100644\n--- a/pkg/cmd/root/help_topic.go\n+++ b/pkg/cmd/root/help_topic.go\n@@ -1,6 +1,8 @@\n package root\n \n import (\n+\t\"fmt\"\n+\t\"github.com/cli/cli/v2/pkg/iostreams\"\n \t\"github.com/MakeNowJust/heredoc\"\n \t\"github.com/cli/cli/v2/pkg/text\"\n \t\"github.com/spf13/cobra\"\n@@ -127,7 +129,7 @@ var HelpTopics = map[string]map[string]string{\n \t},\n }\n \n-func NewHelpTopic(topic string) *cobra.Command {\n+func NewHelpTopic(ios *iostreams.IOStreams, topic string) *cobra.Command {\n \tcmd := &cobra.Command{\n \t\tUse:     topic,\n \t\tShort:   HelpTopics[topic][\"short\"],\n@@ -140,21 +142,25 @@ func NewHelpTopic(topic string) *cobra.Command {\n \t\t},\n \t}\n \n-\tcmd.SetHelpFunc(helpTopicHelpFunc)\n-\tcmd.SetUsageFunc(helpTopicUsageFunc)\n+\tcmd.SetHelpFunc(helpTopicHelpFunc(ios))\n+\tcmd.SetUsageFunc(helpTopicUsageFunc(ios))\n \n \treturn cmd\n }\n \n-func helpTopicHelpFunc(command *cobra.Command, args []string) {\n-\tcommand.Print(command.Long)\n-\tif command.Example != \"\" {\n-\t\tcommand.Printf(\"\\n\\nEXAMPLES\\n\")\n-\t\tcommand.Print(text.Indent(command.Example, \"  \"))\n+func helpTopicHelpFunc(ios *iostreams.IOStreams) func(*cobra.Command, []string) {\n+\treturn func(command *cobra.Command, args []string) {\n+\t\tfmt.Fprint(ios.Out, command.Long)\n+\t\tif command.Example != \"\" {\n+\t\t\tfmt.Fprint(ios.Out, \"\\n\\nEXAMPLES\\n\")\n+\t\t\tfmt.Fprint(ios.Out, text.Indent(command.Example, \"  \"))\n+\t\t}\n \t}\n }\n \n-func helpTopicUsageFunc(command *cobra.Command) error {\n-\tcommand.Printf(\"Usage: gh help %s\", command.Use)\n-\treturn nil\n+func helpTopicUsageFunc(ios *iostreams.IOStreams) func(*cobra.Command) error {\n+\treturn func(command *cobra.Command) error {\n+\t\tfmt.Fprintf(ios.ErrOut, \"Usage: gh help %s\", command.Use)\n+\t\treturn nil\n+\t}\n }\ndiff --git a/pkg/cmd/root/root.go b/pkg/cmd/root/root.go\nindex 4c21330a5..19331f286 100644\n--- a/pkg/cmd/root/root.go\n+++ b/pkg/cmd/root/root.go\n@@ -56,14 +56,14 @@ func NewCmdRoot(f *cmdutil.Factory, version, buildDate string) *cobra.Command {\n \t\t},\n \t}\n \n-\tcmd.SetOut(f.IOStreams.Out)\n+\tcmd.SetOut(f.IOStreams.ErrOut)\n \tcmd.SetErr(f.IOStreams.ErrOut)\n \n \tcmd.PersistentFlags().Bool(\"help\", false, \"Show help for command\")\n \tcmd.SetHelpFunc(func(cmd *cobra.Command, args []string) {\n \t\trootHelpFunc(f, cmd, args)\n \t})\n-\tcmd.SetUsageFunc(rootUsageFunc)\n+\tcmd.SetUsageFunc(func(c *cobra.Command) error { return rootUsageFunc(f.IOStreams.ErrOut, c) })\n \tcmd.SetFlagErrorFunc(rootFlagErrorFunc)\n \n \tformattedVersion := versionCmd.Format(version, buildDate)\n@@ -108,10 +108,10 @@ func NewCmdRoot(f *cmdutil.Factory, version, buildDate string) *cobra.Command {\n \tcmd.AddCommand(labelCmd.NewCmdLabel(&repoResolvingCmdFactory))\n \n \t// Help topics\n-\tcmd.AddCommand(NewHelpTopic(\"environment\"))\n-\tcmd.AddCommand(NewHelpTopic(\"formatting\"))\n-\tcmd.AddCommand(NewHelpTopic(\"mintty\"))\n-\treferenceCmd := NewHelpTopic(\"reference\")\n+\tcmd.AddCommand(NewHelpTopic(f.IOStreams, \"environment\"))\n+\tcmd.AddCommand(NewHelpTopic(f.IOStreams, \"formatting\"))\n+\tcmd.AddCommand(NewHelpTopic(f.IOStreams, \"mintty\"))\n+\treferenceCmd := NewHelpTopic(f.IOStreams, \"reference\")\n \treferenceCmd.SetHelpFunc(referenceHelpFn(f.IOStreams))\n \tcmd.AddCommand(referenceCmd)\n \n"}
{"org": "cli", "repo": "cli", "number": "5648", "fix_patch": "diff --git a/api/queries_pr.go b/api/queries_pr.go\nindex 18217a583..7f51576d9 100644\n--- a/api/queries_pr.go\n+++ b/api/queries_pr.go\n@@ -56,6 +56,7 @@ type PullRequest struct {\n \tBaseRef struct {\n \t\tBranchProtectionRule struct {\n \t\t\tRequiresStrictStatusChecks   bool\n+ \t\t\t\tRequiredStatusCheckContexts []string\n \t\t\tRequiredApprovingReviewCount int\n \t\t}\n \t}\ndiff --git a/api/query_builder.go b/api/query_builder.go\nindex 16665cfd8..fc5806530 100644\n--- a/api/query_builder.go\n+++ b/api/query_builder.go\n@@ -255,8 +255,10 @@ func IssueGraphQL(fields []string) string {\n \t\t\tq = append(q, `commits(last:1){nodes{commit{oid}}}`)\n \t\tcase \"commitsCount\": // pseudo-field\n \t\t\tq = append(q, `commits{totalCount}`)\n-\t\tcase \"requiresStrictStatusChecks\": // pseudo-field\n-\t\t\tq = append(q, `baseRef{branchProtectionRule{requiresStrictStatusChecks}}`)\n+            case \"requiresStrictStatusChecks\": // pseudo-field\n+                q = append(q, `baseRef{branchProtectionRule{requiresStrictStatusChecks}}`)\n+            case \"requiredStatusCheckContexts\": // pseudo-field\n+                q = append(q, `baseRef{branchProtectionRule{requiredStatusCheckContexts}}`)\n \t\tcase \"statusCheckRollup\":\n \t\t\tq = append(q, StatusCheckRollupGraphQL(\"\"))\n \t\tdefault:\ndiff --git a/pkg/cmd/pr/checks/checks.go b/pkg/cmd/pr/checks/checks.go\nindex 4bb536bc4..b276e84e6 100644\n--- a/pkg/cmd/pr/checks/checks.go\n+++ b/pkg/cmd/pr/checks/checks.go\n@@ -27,6 +27,7 @@ type ChecksOptions struct {\n \tWebMode     bool\n \tInterval    time.Duration\n \tWatch       bool\n+\tRequired    bool\n }\n \n func NewCmdChecks(f *cmdutil.Factory, runF func(*ChecksOptions) error) *cobra.Command {\n@@ -82,6 +83,7 @@ func NewCmdChecks(f *cmdutil.Factory, runF func(*ChecksOptions) error) *cobra.Co\n \tcmd.Flags().BoolVarP(&opts.WebMode, \"web\", \"w\", false, \"Open the web browser to show details about checks\")\n \tcmd.Flags().BoolVarP(&opts.Watch, \"watch\", \"\", false, \"Watch checks until they finish\")\n \tcmd.Flags().IntVarP(&interval, \"interval\", \"i\", 10, \"Refresh interval in seconds when using `--watch` flag\")\n+ \t\tcmd.Flags().BoolVarP(&opts.Required, \"required\", \"\", false, \"Show only required status checks\")\n \n \treturn cmd\n }\n@@ -130,7 +132,7 @@ func checksRun(opts *ChecksOptions) error {\n \tfor {\n \t\tfindOptions := shared.FindOptions{\n \t\t\tSelector: opts.SelectorArg,\n-\t\t\tFields:   []string{\"number\", \"headRefName\", \"statusCheckRollup\"},\n+\t\t\tFields:   []string{\"number\", \"headRefName\", \"statusCheckRollup\", \"requiredStatusCheckContexts\"},\n \t\t}\n \n \t\tvar pr *api.PullRequest\n@@ -140,6 +142,39 @@ func checksRun(opts *ChecksOptions) error {\n \t\t}\n \n \t\tchecks, counts, err = aggregateChecks(pr)\n+ \t\t\tif opts.Required {\n+\t\t\t\treq := pr.BaseRef.BranchProtectionRule.RequiredStatusCheckContexts\n+\t\t\t\tif len(req) == 0 {\n+\t\t\t\t\tif opts.IO.IsStdoutTTY() {\n+\t\t\t\t\t\tfmt.Fprintln(opts.IO.Out, \"No required checks\")\n+\t\t\t\t\t}\n+\t\t\t\t\tbreak\n+\t\t\t\t}\n+\t\t\t\treqSet := map[string]struct{}{}\n+\t\t\t\tfor _, r := range req {\n+\t\t\t\t\treqSet[r] = struct{}{}\n+\t\t\t\t}\n+\t\t\t\tfiltered := make([]check, 0, len(checks))\n+\t\t\t\tfor _, c := range checks {\n+\t\t\t\t\tif _, ok := reqSet[c.Name]; ok {\n+\t\t\t\t\t\tfiltered = append(filtered, c)\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tcounts = checkCounts{}\n+\t\t\t\tfor _, c := range filtered {\n+\t\t\t\t\tswitch c.Bucket {\n+\t\t\t\t\tcase \"pass\":\n+\t\t\t\t\t\tcounts.Passed++\n+\t\t\t\t\tcase \"fail\":\n+\t\t\t\t\t\tcounts.Failed++\n+\t\t\t\t\tcase \"pending\":\n+\t\t\t\t\t\tcounts.Pending++\n+\t\t\t\t\tcase \"skipping\":\n+\t\t\t\t\t\tcounts.Skipping++\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tchecks = filtered\n+\t\t\t}\n \t\tif err != nil {\n \t\t\tbreak\n \t\t}\n"}
{"org": "cli", "repo": "cli", "number": "5019", "fix_patch": "diff --git a/pkg/cmd/release/create/create.go b/pkg/cmd/release/create/create.go\nindex 4d0ea32c8..750da2b33 100644\n--- a/pkg/cmd/release/create/create.go\n+++ b/pkg/cmd/release/create/create.go\n@@ -443,7 +443,7 @@ func createRun(opts *CreateOptions) error {\n \t\t}\n \n \t\tif !opts.Draft {\n-\t\t\trel, err := publishRelease(httpClient, newRelease.APIURL)\n+\t\t\trel, err := publishRelease(httpClient, newRelease.APIURL, opts.DiscussionCategory)\n \t\t\tif err != nil {\n \t\t\t\treturn err\n \t\t\t}\ndiff --git a/pkg/cmd/release/create/http.go b/pkg/cmd/release/create/http.go\nindex 07a37a4f6..4a0322969 100644\n--- a/pkg/cmd/release/create/http.go\n+++ b/pkg/cmd/release/create/http.go\n@@ -155,8 +155,18 @@ func createRelease(httpClient *http.Client, repo ghrepo.Interface, params map[st\n \treturn &newRelease, err\n }\n \n-func publishRelease(httpClient *http.Client, releaseURL string) (*shared.Release, error) {\n-\treq, err := http.NewRequest(\"PATCH\", releaseURL, bytes.NewBufferString(`{\"draft\":false}`))\n+func publishRelease(httpClient *http.Client, releaseURL string, discussionCategory string) (*shared.Release, error) {\n+    params := map[string]interface{}{\n+        \"draft\": false,\n+    }\n+    if discussionCategory != \"\" {\n+        params[\"discussion_category_name\"] = discussionCategory\n+    }\n+    bodyBytes, err := json.Marshal(params)\n+    if err != nil {\n+        return nil, err\n+    }\n+\treq, err := http.NewRequest(\"PATCH\", releaseURL, bytes.NewBuffer(bodyBytes))\n \tif err != nil {\n \t\treturn nil, err\n \t}\n"}
{"org": "cli", "repo": "cli", "number": "3608", "fix_patch": "diff --git a/api/queries_repo.go b/api/queries_repo.go\nindex 90d3949a5..4fec9152c 100644\n--- a/api/queries_repo.go\n+++ b/api/queries_repo.go\n@@ -965,3 +965,30 @@ func ProjectNamesToPaths(client *Client, repo ghrepo.Interface, projectNames []s\n \t}\n \treturn ProjectsToPaths(projects, projectNames)\n }\n+// ForkRepoToOrg forks the repository into the specified organization on GitHub and returns the new repository\n+func ForkRepoToOrg(client *Client, repo ghrepo.Interface, org string) (*Repository, error) {\n+        path := fmt.Sprintf(\"repos/%s/forks\", ghrepo.FullName(repo))\n+        params := map[string]string{\"organization\": org}\n+        b, err := json.Marshal(params)\n+        if err != nil {\n+                return nil, err\n+        }\n+        body := bytes.NewBuffer(b)\n+        result := repositoryV3{}\n+        err = client.REST(repo.RepoHost(), \"POST\", path, body, &result)\n+        if err != nil {\n+                return nil, err\n+        }\n+\n+        return &Repository{\n+                ID:        result.NodeID,\n+                Name:      result.Name,\n+                CloneURL:  result.CloneURL,\n+                CreatedAt: result.CreatedAt,\n+                Owner: RepositoryOwner{\n+                        Login: result.Owner.Login,\n+                },\n+                ViewerPermission: \"WRITE\",\n+                hostname:         repo.RepoHost(),\n+        }, nil\n+}\ndiff --git a/pkg/cmd/repo/fork/fork.go b/pkg/cmd/repo/fork/fork.go\nindex 30df5ae67..358f8d214 100644\n--- a/pkg/cmd/repo/fork/fork.go\n+++ b/pkg/cmd/repo/fork/fork.go\n@@ -37,6 +37,7 @@ type ForkOptions struct {\n \tPromptRemote bool\n \tRemoteName   string\n \tRename       bool\n+        Organization string\n }\n \n var Since = func(t time.Time) time.Duration {\n@@ -110,6 +111,7 @@ Additional 'git clone' flags can be passed in by listing them after '--'.`,\n \tcmd.Flags().BoolVar(&opts.Clone, \"clone\", false, \"Clone the fork {true|false}\")\n \tcmd.Flags().BoolVar(&opts.Remote, \"remote\", false, \"Add remote for fork {true|false}\")\n \tcmd.Flags().StringVar(&opts.RemoteName, \"remote-name\", \"origin\", \"Specify a name for a fork's new remote.\")\n+        cmd.Flags().StringVar(&opts.Organization, \"org\", \"\", \"Fork the repository into an organization\")\n \n \treturn cmd\n }\n@@ -168,8 +170,9 @@ func forkRun(opts *ForkOptions) error {\n \n \tapiClient := api.NewClientFromHTTP(httpClient)\n \n+        var forkedRepo *api.Repository\n \topts.IO.StartProgressIndicator()\n-\tforkedRepo, err := api.ForkRepo(apiClient, repoToFork)\n+\tif opts.Organization != \"\" { forkedRepo, err = api.ForkRepoToOrg(apiClient, repoToFork, opts.Organization) } else { forkedRepo, err = api.ForkRepo(apiClient, repoToFork) }\n \topts.IO.StopProgressIndicator()\n \tif err != nil {\n \t\treturn fmt.Errorf(\"failed to fork: %w\", err)\n"}
{"org": "cli", "repo": "cli", "number": "2250", "fix_patch": "diff --git a/api/queries_pr.go b/api/queries_pr.go\nindex ad4f23644..9317358a0 100644\n--- a/api/queries_pr.go\n+++ b/api/queries_pr.go\n@@ -420,7 +420,7 @@ func PullRequests(client *Client, repo ghrepo.Interface, currentPRNumber int, cu\n \t}\n \n \tviewerQuery := fmt.Sprintf(\"repo:%s state:open is:pr author:%s\", ghrepo.FullName(repo), currentUsername)\n-\treviewerQuery := fmt.Sprintf(\"repo:%s state:open review-requested:%s\", ghrepo.FullName(repo), currentUsername)\n+\treviewerQuery := fmt.Sprintf(\"repo:%s state:open is:pr review-requested:%s\", ghrepo.FullName(repo), currentUsername)\n \n \tbranchWithoutOwner := currentPRHeadRef\n \tif idx := strings.Index(currentPRHeadRef, \":\"); idx >= 0 {\ndiff --git a/pkg/cmd/pr/create/create_test.go b/pkg/cmd/pr/create/create_test.go\nindex 939e4116b..6809a2040 100644\n--- a/pkg/cmd/pr/create/create_test.go\n+++ b/pkg/cmd/pr/create/create_test.go\n@@ -304,6 +304,57 @@ func TestPRCreate(t *testing.T) {\n \tassert.Equal(t, \"\\nCreating pull request for feature into master in OWNER/REPO\\n\\n\", output.Stderr())\n }\n \n+func TestPRCreate_NoMaintainerModify(t *testing.T) {\n+\t// TODO update this copypasta\n+\thttp := initFakeHTTP()\n+\tdefer http.Verify(t)\n+\n+\thttp.StubRepoInfoResponse(\"OWNER\", \"REPO\", \"master\")\n+\thttp.StubRepoResponse(\"OWNER\", \"REPO\")\n+\thttp.Register(\n+\t\thttpmock.GraphQL(`query UserCurrent\\b`),\n+\t\thttpmock.StringResponse(`{\"data\": {\"viewer\": {\"login\": \"OWNER\"} } }`))\n+\thttp.Register(\n+\t\thttpmock.GraphQL(`query PullRequestForBranch\\b`),\n+\t\thttpmock.StringResponse(`\n+\t\t{ \"data\": { \"repository\": { \"pullRequests\": { \"nodes\" : [\n+\t\t] } } } }\n+\t\t`))\n+\thttp.Register(\n+\t\thttpmock.GraphQL(`mutation PullRequestCreate\\b`),\n+\t\thttpmock.GraphQLMutation(`\n+\t\t{ \"data\": { \"createPullRequest\": { \"pullRequest\": {\n+\t\t\t\"URL\": \"https://github.com/OWNER/REPO/pull/12\"\n+\t\t} } } }\n+\t\t`, func(input map[string]interface{}) {\n+\t\t\tassert.Equal(t, false, input[\"maintainerCanModify\"].(bool))\n+\t\t\tassert.Equal(t, \"REPOID\", input[\"repositoryId\"].(string))\n+\t\t\tassert.Equal(t, \"my title\", input[\"title\"].(string))\n+\t\t\tassert.Equal(t, \"my body\", input[\"body\"].(string))\n+\t\t\tassert.Equal(t, \"master\", input[\"baseRefName\"].(string))\n+\t\t\tassert.Equal(t, \"feature\", input[\"headRefName\"].(string))\n+\t\t}))\n+\n+\tcs, cmdTeardown := test.InitCmdStubber()\n+\tdefer cmdTeardown()\n+\n+\tcs.Stub(\"\")                                         // git config --get-regexp (determineTrackingBranch)\n+\tcs.Stub(\"\")                                         // git show-ref --verify   (determineTrackingBranch)\n+\tcs.Stub(\"\")                                         // git status\n+\tcs.Stub(\"1234567890,commit 0\\n2345678901,commit 1\") // git log\n+\tcs.Stub(\"\")                                         // git push\n+\n+\task, cleanupAsk := prompt.InitAskStubber()\n+\tdefer cleanupAsk()\n+\task.StubOne(0)\n+\n+\toutput, err := runCommand(http, nil, \"feature\", true, `-t \"my title\" -b \"my body\" --no-maintainer-edit`)\n+\trequire.NoError(t, err)\n+\n+\tassert.Equal(t, \"https://github.com/OWNER/REPO/pull/12\\n\", output.String())\n+\tassert.Equal(t, \"\\nCreating pull request for feature into master in OWNER/REPO\\n\\n\", output.Stderr())\n+}\n+\n func TestPRCreate_createFork(t *testing.T) {\n \thttp := initFakeHTTP()\n \tdefer http.Verify(t)\n"}
{"org": "cli", "repo": "cli", "number": "1567", "fix_patch": "diff --git a/pkg/cmd/repo/view/view.go b/pkg/cmd/repo/view/view.go\nindex a508317b0..fe32db3c2 100644\n--- a/pkg/cmd/repo/view/view.go\n+++ b/pkg/cmd/repo/view/view.go\n@@ -8,6 +8,7 @@ import (\n \n \t\"github.com/MakeNowJust/heredoc\"\n \t\"github.com/cli/cli/api\"\n+\t\"github.com/cli/cli/internal/ghinstance\"\n \t\"github.com/cli/cli/internal/ghrepo\"\n \t\"github.com/cli/cli/pkg/cmdutil\"\n \t\"github.com/cli/cli/pkg/iostreams\"\n@@ -71,7 +72,17 @@ func viewRun(opts *ViewOptions) error {\n \t\t}\n \t} else {\n \t\tvar err error\n-\t\ttoView, err = ghrepo.FromFullName(opts.RepoArg)\n+\t\tif !strings.Contains(opts.RepoArg, \"/\") && !strings.Contains(opts.RepoArg, \":\") && !strings.HasPrefix(opts.RepoArg, \"http://\") && !strings.HasPrefix(opts.RepoArg, \"https://\") {\n+\t\t\tapiClient := api.NewClientFromHTTP(httpClient)\n+\t\t\thostname := ghinstance.OverridableDefault()\n+\t\t\tviewer, vErr := api.CurrentLoginName(apiClient, hostname)\n+\t\t\tif vErr != nil {\n+\t\t\t\treturn fmt.Errorf(\"could not determine current user: %w\", vErr)\n+\t\t\t}\n+\t\t\ttoView = ghrepo.New(viewer, opts.RepoArg)\n+\t\t} else {\n+\t\t\ttoView, err = ghrepo.FromFullName(opts.RepoArg)\n+\t\t}\n \t\tif err != nil {\n \t\t\treturn fmt.Errorf(\"argument error: %w\", err)\n \t\t}\n"}
{"org": "zeromicro", "repo": "go-zero", "number": "1969", "fix_patch": "diff --git a/core/mapping/unmarshaler.go b/core/mapping/unmarshaler.go\nindex a633453a..abf35d30 100644\n--- a/core/mapping/unmarshaler.go\n+++ b/core/mapping/unmarshaler.go\n@@ -253,6 +253,13 @@ func (u *Unmarshaler) processFieldPrimitiveWithJSONNumber(field reflect.StructFi\n \t\treturn err\n \t}\n \n+\t// Validate that the incoming value is within the allowed options when options are specified.\n+\t// This aligns the behavior with other primitive processing paths, ensuring json.Number values\n+\t// respect `options=` constraints.\n+\tif err := validateValueInOptions(opts.options(), v); err != nil {\n+\t\treturn err\n+\t}\n+\n \tif fieldKind == reflect.Ptr {\n \t\tvalue = value.Elem()\n \t}\ndiff --git a/core/mapping/unmarshaler_test.go b/core/mapping/unmarshaler_test.go\nindex da042490..fe839d11 100644\n--- a/core/mapping/unmarshaler_test.go\n+++ b/core/mapping/unmarshaler_test.go\n@@ -1170,6 +1170,34 @@ func TestUnmarshalWithIntOptionsIncorrect(t *testing.T) {\n \tassert.NotNil(t, UnmarshalKey(m, &in))\n }\n \n+func TestUnmarshalWithJsonNumberOptionsIncorrect(t *testing.T) {\n+\ttype inner struct {\n+\t\tValue     string `key:\"value,options=first|second\"`\n+\t\tIncorrect int    `key:\"incorrect,options=1|2\"`\n+\t}\n+\tm := map[string]interface{}{\n+\t\t\"value\":     \"first\",\n+\t\t\"incorrect\": json.Number(\"3\"),\n+\t}\n+\n+\tvar in inner\n+\tassert.NotNil(t, UnmarshalKey(m, &in))\n+}\n+\n+func TestUnmarshalWithJsonNumberOptionsIncorrect(t *testing.T) {\n+\ttype inner struct {\n+\t\tValue     string `key:\"value,options=first|second\"`\n+\t\tIncorrect int    `key:\"incorrect,options=1|2\"`\n+\t}\n+\tm := map[string]interface{}{\n+\t\t\"value\":     \"first\",\n+\t\t\"incorrect\": json.Number(\"3\"),\n+\t}\n+\n+\tvar in inner\n+\tassert.NotNil(t, UnmarshalKey(m, &in))\n+}\n+\n func TestUnmarshalWithUintOptionsCorrect(t *testing.T) {\n \ttype inner struct {\n \t\tValue  string `key:\"value,options=first|second\"`\n"}
{"org": "cli", "repo": "cli", "number": "1457", "fix_patch": "diff --git a/command/issue.go b/command/issue.go\nindex 43049faa2..c1205f303 100644\n--- a/command/issue.go\n+++ b/command/issue.go\n@@ -361,11 +361,19 @@ func issueStateTitleWithColor(state string) string {\n }\n \n func listHeader(repoName string, itemName string, matchCount int, totalMatchCount int, hasFilters bool) string {\n+\tneedsOpen := itemName == \"issue\" || itemName == \"pull request\"\n+\n \tif totalMatchCount == 0 {\n \t\tif hasFilters {\n+\t\t\tif needsOpen {\n+\t\t\t\treturn fmt.Sprintf(\"No open %ss match your search in %s\", itemName, repoName)\n+\t\t\t}\n \t\t\treturn fmt.Sprintf(\"No %ss match your search in %s\", itemName, repoName)\n \t\t}\n-\t\treturn fmt.Sprintf(\"There are no open %ss in %s\", itemName, repoName)\n+\t\tif needsOpen {\n+\t\t\treturn fmt.Sprintf(\"There are no open %ss in %s\", itemName, repoName)\n+\t\t}\n+\t\treturn fmt.Sprintf(\"There are no %ss in %s\", itemName, repoName)\n \t}\n \n \tif hasFilters {\n@@ -373,10 +381,18 @@ func listHeader(repoName string, itemName string, matchCount int, totalMatchCoun\n \t\tif totalMatchCount == 1 {\n \t\t\tmatchVerb = \"matches\"\n \t\t}\n-\t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName, matchVerb)\n+\t\titemDisplay := utils.Pluralize(totalMatchCount, itemName)\n+\t\tif needsOpen {\n+\t\t\titemDisplay = \"open \" + itemDisplay\n+\t\t}\n+\t\treturn fmt.Sprintf(\"Showing %d of %s in %s that %s your search\", matchCount, itemDisplay, repoName, matchVerb)\n \t}\n \n-\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, utils.Pluralize(totalMatchCount, itemName), repoName)\n+\titemDisplay := utils.Pluralize(totalMatchCount, itemName)\n+\tif needsOpen {\n+\t\titemDisplay = \"open \" + itemDisplay\n+\t}\n+\treturn fmt.Sprintf(\"Showing %d of %s in %s\", matchCount, itemDisplay, repoName)\n }\n \n func printRawIssuePreview(out io.Writer, issue *api.Issue) error {\n"}
{"org": "cli", "repo": "cli", "number": "2888", "fix_patch": "diff --git a/pkg/cmd/gist/view/view.go b/pkg/cmd/gist/view/view.go\nindex 9d8b41110..fb420915b 100644\n--- a/pkg/cmd/gist/view/view.go\n+++ b/pkg/cmd/gist/view/view.go\n@@ -91,7 +91,7 @@ func viewRun(opts *ViewOptions) error {\n \n \tcs := opts.IO.ColorScheme()\n \tif gist.Description != \"\" {\n-\t\tfmt.Fprintf(opts.IO.Out, \"%s\\n\", cs.Bold(gist.Description))\n+\t\tfmt.Fprintf(opts.IO.Out, \"%s\\n\\n\", cs.Bold(gist.Description))\n \t}\n \n \tif opts.Filename != \"\" {\n@@ -108,6 +108,7 @@ func viewRun(opts *ViewOptions) error {\n \tshowFilenames := len(gist.Files) > 1\n \n \touts := []string{} // to ensure consistent ordering\n+hadRenderedMarkdown := false\n \n \tfor filename, gistFile := range gist.Files {\n \t\tout := \"\"\n@@ -120,18 +121,26 @@ func viewRun(opts *ViewOptions) error {\n \t\t\trendered, err := markdown.Render(gistFile.Content, style, \"\")\n \t\t\tif err == nil {\n \t\t\t\tcontent = rendered\n+hadRenderedMarkdown = true\n \t\t\t}\n \t\t}\n-\t\tout += fmt.Sprintf(\"%s\\n\\n\", content)\n+\t\tcontent = strings.TrimRight(content, \"\\n\") + \"\\n\"\n+\t\tout += content\n \n \t\touts = append(outs, out)\n \t}\n \n \tsort.Strings(outs)\n \n-\tfor _, out := range outs {\n+\tfor i, out := range outs {\n+\t\tif i > 0 {\n+\t\t\tfmt.Fprint(opts.IO.Out, \"\\n\")\n+\t\t}\n \t\tfmt.Fprint(opts.IO.Out, out)\n \t}\n \n-\treturn nil\n+\t\t\tif hadRenderedMarkdown {\n+\t\t\tfmt.Fprint(opts.IO.Out, \"\\n\")\n+\t\t}\n+\t\treturn nil\n }\ndiff --git a/pkg/cmd/gist/view/view_test.go b/pkg/cmd/gist/view/view_test.go\nindex 0ddf55f49..a296a10fb 100644\n--- a/pkg/cmd/gist/view/view_test.go\n+++ b/pkg/cmd/gist/view/view_test.go\n@@ -109,7 +109,7 @@ func Test_viewRun(t *testing.T) {\n \t\t\t\t\t},\n \t\t\t\t},\n \t\t\t},\n-\t\t\twantOut: \"bwhiizzzbwhuiiizzzz\\n\\n\",\n+\t\t\twantOut: \"bwhiizzzbwhuiiizzzz\\n\",\n \t\t},\n \t\t{\n \t\t\tname: \"filename selected\",\n@@ -129,7 +129,28 @@ func Test_viewRun(t *testing.T) {\n \t\t\t\t\t},\n \t\t\t\t},\n \t\t\t},\n-\t\t\twantOut: \"bwhiizzzbwhuiiizzzz\\n\\n\",\n+\t\t\twantOut: \"bwhiizzzbwhuiiizzzz\\n\",\n+\t\t},\n+\t\t{\n+\t\t\tname: \"filename selected, raw\",\n+\t\t\topts: &ViewOptions{\n+\t\t\t\tSelector: \"1234\",\n+\t\t\t\tFilename: \"cicada.txt\",\n+\t\t\t\tRaw:      true,\n+\t\t\t},\n+\t\t\tgist: &shared.Gist{\n+\t\t\t\tFiles: map[string]*shared.GistFile{\n+\t\t\t\t\t\"cicada.txt\": {\n+\t\t\t\t\t\tContent: \"bwhiizzzbwhuiiizzzz\",\n+\t\t\t\t\t\tType:    \"text/plain\",\n+\t\t\t\t\t},\n+\t\t\t\t\t\"foo.md\": {\n+\t\t\t\t\t\tContent: \"# foo\",\n+\t\t\t\t\t\tType:    \"application/markdown\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\twantOut: \"bwhiizzzbwhuiiizzzz\\n\",\n \t\t},\n \t\t{\n \t\t\tname: \"multiple files, no description\",\n@@ -148,7 +169,26 @@ func Test_viewRun(t *testing.T) {\n \t\t\t\t\t},\n \t\t\t\t},\n \t\t\t},\n-\t\t\twantOut: \"cicada.txt\\n\\nbwhiizzzbwhuiiizzzz\\n\\nfoo.md\\n\\n\\n  # foo                                                                       \\n\\n\\n\\n\",\n+\t\t\twantOut: \"cicada.txt\\n\\nbwhiizzzbwhuiiizzzz\\n\\nfoo.md\\n\\n\\n  # foo                                                                       \\n\\n\",\n+\t\t},\n+\t\t{\n+\t\t\tname: \"multiple files, trailing newlines\",\n+\t\t\topts: &ViewOptions{\n+\t\t\t\tSelector: \"1234\",\n+\t\t\t},\n+\t\t\tgist: &shared.Gist{\n+\t\t\t\tFiles: map[string]*shared.GistFile{\n+\t\t\t\t\t\"cicada.txt\": {\n+\t\t\t\t\t\tContent: \"bwhiizzzbwhuiiizzzz\\n\",\n+\t\t\t\t\t\tType:    \"text/plain\",\n+\t\t\t\t\t},\n+\t\t\t\t\t\"foo.txt\": {\n+\t\t\t\t\t\tContent: \"bar\\n\",\n+\t\t\t\t\t\tType:    \"text/plain\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\twantOut: \"cicada.txt\\n\\nbwhiizzzbwhuiiizzzz\\n\\nfoo.txt\\n\\nbar\\n\",\n \t\t},\n \t\t{\n \t\t\tname: \"multiple files, description\",\n@@ -168,10 +208,10 @@ func Test_viewRun(t *testing.T) {\n \t\t\t\t\t},\n \t\t\t\t},\n \t\t\t},\n-\t\t\twantOut: \"some files\\ncicada.txt\\n\\nbwhiizzzbwhuiiizzzz\\n\\nfoo.md\\n\\n\\n                                                                              \\n  • foo                                                                       \\n\\n\\n\\n\",\n+\t\t\twantOut: \"some files\\n\\ncicada.txt\\n\\nbwhiizzzbwhuiiizzzz\\n\\nfoo.md\\n\\n\\n                                                                              \\n  • foo                                                                       \\n\\n\",\n \t\t},\n \t\t{\n-\t\t\tname: \"raw\",\n+\t\t\tname: \"multiple files, raw\",\n \t\t\topts: &ViewOptions{\n \t\t\t\tSelector: \"1234\",\n \t\t\t\tRaw:      true,\n@@ -189,7 +229,7 @@ func Test_viewRun(t *testing.T) {\n \t\t\t\t\t},\n \t\t\t\t},\n \t\t\t},\n-\t\t\twantOut: \"some files\\ncicada.txt\\n\\nbwhiizzzbwhuiiizzzz\\n\\nfoo.md\\n\\n- foo\\n\\n\",\n+\t\t\twantOut: \"some files\\n\\ncicada.txt\\n\\nbwhiizzzbwhuiiizzzz\\n\\nfoo.md\\n\\n- foo\\n\",\n \t\t},\n \t}\n \n"}
{"org": "fasterxml", "repo": "jackson-core", "number": "1016", "fix_patch": "diff --git a/pom.xml b/pom.xml\nindex 560b4281..cc1ab6d0 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -8,12 +8,12 @@\n   <parent>\n     <groupId>com.fasterxml.jackson</groupId>\n     <artifactId>jackson-base</artifactId>\n-    <version>2.16.0-SNAPSHOT</version>\n+    <version>2.16.3-SNAPSHOT</version>\n   </parent>\n   <groupId>com.fasterxml.jackson.core</groupId>\n   <artifactId>jackson-core</artifactId>\n   <name>Jackson-core</name>\n-  <version>2.16.0-SNAPSHOT</version>\n+  <version>2.16.3-SNAPSHOT</version>\n   <packaging>jar</packaging>\n   <description>Core Jackson processing abstractions (aka Streaming API), implementation for JSON</description>\n   <licenses>\ndiff --git a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\nindex bff4efba..1427ba50 100644\n--- a/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n+++ b/src/main/java/com/fasterxml/jackson/core/JsonFactory.java\n@@ -1299,7 +1299,7 @@ public class JsonFactory\n         //   for non-JSON input:\n         _requireJSONFactory(\"Non-blocking source not (yet?) supported for this format (%s)\");\n         IOContext ctxt = _createNonBlockingContext(null);\n-        ByteQuadsCanonicalizer can = _byteSymbolCanonicalizer.makeChild(_factoryFeatures);\n+        ByteQuadsCanonicalizer can = _byteSymbolCanonicalizer.makeChildOrPlaceholder(_factoryFeatures);\n         return new NonBlockingJsonParser(ctxt, _parserFeatures, can);\n     }\n \n@@ -1326,7 +1326,7 @@ public class JsonFactory\n         //   for non-JSON input:\n         _requireJSONFactory(\"Non-blocking source not (yet?) supported for this format (%s)\");\n         IOContext ctxt = _createNonBlockingContext(null);\n-        ByteQuadsCanonicalizer can = _byteSymbolCanonicalizer.makeChild(_factoryFeatures);\n+        ByteQuadsCanonicalizer can = _byteSymbolCanonicalizer.makeChildOrPlaceholder(_factoryFeatures);\n         return new NonBlockingByteBufferJsonParser(ctxt, _parserFeatures, can);\n     }\n \n@@ -1849,7 +1849,7 @@ public class JsonFactory\n         // Also: while we can't do full bootstrapping (due to read-ahead limitations), should\n         // at least handle possible UTF-8 BOM\n         int firstByte = ByteSourceJsonBootstrapper.skipUTF8BOM(input);\n-        ByteQuadsCanonicalizer can = _byteSymbolCanonicalizer.makeChild(_factoryFeatures);\n+        ByteQuadsCanonicalizer can = _byteSymbolCanonicalizer.makeChildOrPlaceholder(_factoryFeatures);\n         return new UTF8DataInputJsonParser(ctxt, _parserFeatures, input,\n                 _objectCodec, can, firstByte);\n     }\ndiff --git a/src/main/java/com/fasterxml/jackson/core/json/UTF8DataInputJsonParser.java b/src/main/java/com/fasterxml/jackson/core/json/UTF8DataInputJsonParser.java\nindex 24ba3101..67311a1c 100644\n--- a/src/main/java/com/fasterxml/jackson/core/json/UTF8DataInputJsonParser.java\n+++ b/src/main/java/com/fasterxml/jackson/core/json/UTF8DataInputJsonParser.java\n@@ -1933,6 +1933,10 @@ public class UTF8DataInputJsonParser\n \n         // Ok. Now we have the character array, and can construct the String\n         String baseName = new String(cbuf, 0, cix);\n+        // 5-May-2023, ckozak: [core#1015] respect CANONICALIZE_FIELD_NAMES factory config.\n+        if (!_symbols.isCanonicalizing()) {\n+            return baseName;\n+        }\n         // And finally, un-align if necessary\n         if (lastQuadBytes < 4) {\n             quads[qlen-1] = lastQuad;\ndiff --git a/src/main/java/com/fasterxml/jackson/core/json/async/NonBlockingJsonParserBase.java b/src/main/java/com/fasterxml/jackson/core/json/async/NonBlockingJsonParserBase.java\nindex 05adcf5c..a5469f50 100644\n--- a/src/main/java/com/fasterxml/jackson/core/json/async/NonBlockingJsonParserBase.java\n+++ b/src/main/java/com/fasterxml/jackson/core/json/async/NonBlockingJsonParserBase.java\n@@ -790,6 +790,10 @@ public abstract class NonBlockingJsonParserBase\n \n         // Ok. Now we have the character array, and can construct the String\n         String baseName = new String(cbuf, 0, cix);\n+        // 5-May-2023, ckozak: [core#1015] respect CANONICALIZE_FIELD_NAMES factory config.\n+        if (!_symbols.isCanonicalizing()) {\n+            return baseName;\n+        }\n         // And finally, un-align if necessary\n         if (lastQuadBytes < 4) {\n             quads[qlen-1] = lastQuad;\n"}
{"org": "elastic", "repo": "logstash", "number": "14027", "fix_patch": "diff --git a/logstash-core/lib/logstash/plugins/builtin/pipeline/input.rb b/logstash-core/lib/logstash/plugins/builtin/pipeline/input.rb\nindex 1cc885beb..b301a6e4c 100644\n--- a/logstash-core/lib/logstash/plugins/builtin/pipeline/input.rb\n+++ b/logstash-core/lib/logstash/plugins/builtin/pipeline/input.rb\n@@ -55,15 +55,23 @@ module ::LogStash; module Plugins; module Builtin; module Pipeline; class Input\n   # To understand why this value is useful see Internal.send_to\n   # Note, this takes a java Stream, not a ruby array\n   def internalReceive(events)\n-    return false if !@running.get()\n+    return 0 if !@running.get()\n \n-    # TODO This should probably push a batch at some point in the future when doing so\n-    # buys us some efficiency\n-    events.forEach do |event|\n-      decorate(event)\n-      @queue << event\n+    i = 0\n+    begin\n+      events.forEach do |event|\n+        decorate(event)\n+        @queue << event\n+        i += 1\n+      end\n+    rescue => e\n+      logger.warn(\"pipeline-to-pipeline input exception; will retry from event\", :exception => e.class, :message => e.message, :processed_count => i)\n+      return i\n     end\n \n+    -1\n+  end\n+\n     true\n   end\n \ndiff --git a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineBus.java.tmp b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineBus.java.tmp\nnew file mode 100644\nindex 000000000..e69de29bb\ndiff --git a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java\nindex b3500a47a..7fd3025c5 100644\n--- a/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java\n+++ b/logstash-core/src/main/java/org/logstash/plugins/pipeline/PipelineInput.java\n@@ -34,7 +34,7 @@ public interface PipelineInput {\n      * @param events a collection of events\n      * @return true if the event was successfully received\n      */\n-    boolean internalReceive(Stream<JrubyEventExtLibrary.RubyEvent> events);\n+    int internalReceive(Stream<JrubyEventExtLibrary.RubyEvent> events);\n \n     /**\n      * @return true if the input is running\n"}
{"org": "fasterxml", "repo": "jackson-databind", "number": "4641", "fix_patch": "diff --git a/pom.xml b/pom.xml\nindex 8fe712dae..5f5562891 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -9,11 +9,11 @@\n   <parent>\n     <groupId>com.fasterxml.jackson</groupId>\n     <artifactId>jackson-base</artifactId>\n-    <version>2.18.0-SNAPSHOT</version>\n+    <version>2.18.5-SNAPSHOT</version>\n   </parent>\n   <groupId>com.fasterxml.jackson.core</groupId>\n   <artifactId>jackson-databind</artifactId>\n-  <version>2.18.0-SNAPSHOT</version>\n+  <version>2.18.5-SNAPSHOT</version>\n   <name>jackson-databind</name>\n   <packaging>jar</packaging>\n   <description>General data-binding functionality for Jackson: works on core streaming API</description>\ndiff --git a/src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java b/src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java\nindex 80d9d492c..04d0de8b5 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/deser/BeanDeserializerFactory.java\n@@ -666,12 +666,7 @@ ClassUtil.name(propName)));\n               BeanDescription beanDesc, SettableBeanProperty[] creatorProps)\n             throws JsonMappingException\n     {\n-        // Find the regular method/field level any-setter\n-        AnnotatedMember anySetter = beanDesc.findAnySetterAccessor();\n-        if (anySetter != null) {\n-            return constructAnySetter(ctxt, beanDesc, anySetter);\n-        }\n-        // else look for any-setter via @JsonCreator\n+        // Prefer any-setter via @JsonCreator\n         if (creatorProps != null) {\n             for (SettableBeanProperty prop : creatorProps) {\n                 AnnotatedMember member = prop.getMember();\n@@ -680,7 +675,12 @@ ClassUtil.name(propName)));\n                 }\n             }\n         }\n-        // not found, that's fine, too\n+        // Then look for regular method/field level any-setter\n+        AnnotatedMember anySetter = beanDesc.findAnySetterAccessor();\n+        if (anySetter != null) {\n+            return constructAnySetter(ctxt, beanDesc, anySetter);\n+        }\n+        // not found, that\\x27s fine, too\n         return null;\n     }\n \n"}
{"org": "fasterxml", "repo": "jackson-databind", "number": "4015", "fix_patch": "diff --git a/pom.xml b/pom.xml\nindex e43b8115a..69a351517 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -9,11 +9,11 @@\n   <parent>\n     <groupId>com.fasterxml.jackson</groupId>\n     <artifactId>jackson-base</artifactId>\n-    <version>2.16.0-SNAPSHOT</version>\n+    <version>2.16.3-SNAPSHOT</version>\n   </parent>\n   <groupId>com.fasterxml.jackson.core</groupId>\n   <artifactId>jackson-databind</artifactId>\n-  <version>2.16.0-SNAPSHOT</version>\n+  <version>2.16.3-SNAPSHOT</version>\n   <name>jackson-databind</name>\n   <packaging>jar</packaging>\n   <description>General data-binding functionality for Jackson: works on core streaming API</description>\ndiff --git a/src/main/java/com/fasterxml/jackson/databind/deser/std/StdKeyDeserializer.java b/src/main/java/com/fasterxml/jackson/databind/deser/std/StdKeyDeserializer.java\nindex 6fc337ed0..ac7c2f964 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/StdKeyDeserializer.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/StdKeyDeserializer.java\n@@ -196,6 +196,11 @@ public class StdKeyDeserializer extends KeyDeserializer\n             return _parseDouble(key);\n         case TYPE_LOCALE:\n             try {\n+                // For empty String keys, align behavior with value deserialization:\n+                // treat \"\" as Locale.ROOT (see [databind#1123] and fix #4009)\n+                if (key.isEmpty()) {\n+                    return Locale.ROOT;\n+                }\n                 return _deser._deserialize(key, ctxt);\n             } catch (IllegalArgumentException e) {\n                 return _weirdKey(ctxt, key, e);\n@@ -213,319 +218,3 @@ public class StdKeyDeserializer extends KeyDeserializer\n         case TYPE_UUID:\n             try {\n                 return UUID.fromString(key);\n-            } catch (Exception e) {\n-                return _weirdKey(ctxt, key, e);\n-            }\n-        case TYPE_URI:\n-            try {\n-                return URI.create(key);\n-            } catch (Exception e) {\n-                return _weirdKey(ctxt, key, e);\n-            }\n-        case TYPE_URL:\n-            try {\n-                return new URL(key);\n-            } catch (MalformedURLException e) {\n-                return _weirdKey(ctxt, key, e);\n-            }\n-        case TYPE_CLASS:\n-            try {\n-                return ctxt.findClass(key);\n-            } catch (Exception e) {\n-                return ctxt.handleWeirdKey(_keyClass, key, \"unable to parse key as Class\");\n-            }\n-        case TYPE_BYTE_ARRAY:\n-            try {\n-                return ctxt.getConfig().getBase64Variant().decode(key);\n-            } catch (IllegalArgumentException e) {\n-                return _weirdKey(ctxt, key, e);\n-            }\n-        default:\n-            throw new IllegalStateException(\"Internal error: unknown key type \"+_keyClass);\n-        }\n-    }\n-\n-    /*\n-    /**********************************************************\n-    /* Helper methods for sub-classes\n-    /**********************************************************\n-     */\n-\n-    protected int _parseInt(String key) throws IllegalArgumentException {\n-        return NumberInput.parseInt(key);\n-    }\n-\n-    protected long _parseLong(String key) throws IllegalArgumentException {\n-        return NumberInput.parseLong(key);\n-    }\n-\n-    protected double _parseDouble(String key) throws IllegalArgumentException {\n-        return NumberInput.parseDouble(key);\n-    }\n-\n-    // @since 2.9\n-    protected Object _weirdKey(DeserializationContext ctxt, String key, Exception e) throws IOException {\n-        return ctxt.handleWeirdKey(_keyClass, key, \"problem: %s\",\n-                ClassUtil.exceptionMessage(e));\n-    }\n-\n-    /*\n-    /**********************************************************\n-    /* First: the standard \"String as String\" deserializer\n-    /**********************************************************\n-     */\n-\n-    @JacksonStdImpl\n-    final static class StringKD extends StdKeyDeserializer\n-    {\n-        private static final long serialVersionUID = 1L;\n-        private final static StringKD sString = new StringKD(String.class);\n-        private final static StringKD sObject = new StringKD(Object.class);\n-\n-        private StringKD(Class<?> nominalType) { super(-1, nominalType); }\n-\n-        public static StringKD forType(Class<?> nominalType)\n-        {\n-            if (nominalType == String.class) {\n-                return sString;\n-            }\n-            if (nominalType == Object.class) {\n-                return sObject;\n-            }\n-            return new StringKD(nominalType);\n-        }\n-\n-        @Override\n-        public Object deserializeKey(String key, DeserializationContext ctxt) throws IOException {\n-            return key;\n-        }\n-    }\n-\n-    /*\n-    /**********************************************************\n-    /* Key deserializer implementations; other\n-    /**********************************************************\n-     */\n-\n-    /**\n-     * Key deserializer that wraps a \"regular\" deserializer (but one\n-     * that must recognize FIELD_NAMEs as text!) to reuse existing\n-     * handlers as key handlers.\n-     */\n-    final static class DelegatingKD\n-        extends KeyDeserializer // note: NOT the std one\n-        implements java.io.Serializable\n-    {\n-        private static final long serialVersionUID = 1L;\n-\n-        final protected Class<?> _keyClass;\n-\n-        protected final JsonDeserializer<?> _delegate;\n-\n-        protected DelegatingKD(Class<?> cls, JsonDeserializer<?> deser) {\n-            _keyClass = cls;\n-            _delegate = deser;\n-        }\n-\n-        @SuppressWarnings(\"resource\")\n-        @Override\n-        public final Object deserializeKey(String key, DeserializationContext ctxt)\n-            throws IOException\n-        {\n-            if (key == null) { // is this even legal call?\n-                return null;\n-            }\n-            TokenBuffer tb = ctxt.bufferForInputBuffering();\n-            tb.writeString(key);\n-            try {\n-                // Ugh... should not have to give parser which may or may not be correct one...\n-                JsonParser p = tb.asParser();\n-                p.nextToken();\n-                Object result = _delegate.deserialize(p, ctxt);\n-                if (result != null) {\n-                    return result;\n-                }\n-                return ctxt.handleWeirdKey(_keyClass, key, \"not a valid representation\");\n-            } catch (Exception re) {\n-                return ctxt.handleWeirdKey(_keyClass, key, \"not a valid representation: %s\", re.getMessage());\n-            }\n-        }\n-\n-        public Class<?> getKeyClass() { return _keyClass; }\n-    }\n-\n-    @JacksonStdImpl\n-    final static class EnumKD extends StdKeyDeserializer\n-    {\n-        private static final long serialVersionUID = 1L;\n-\n-        protected final EnumResolver _byNameResolver;\n-\n-        protected final AnnotatedMethod _factory;\n-\n-        /**\n-         * Lazily constructed alternative in case there is need to\n-         * use 'toString()' method as the source.\n-         *\n-         * @since 2.7.3\n-         */\n-        protected volatile EnumResolver _byToStringResolver;\n-\n-        /**\n-         * Lazily constructed alternative in case there is need to\n-         * parse using enum index method as the source.\n-         *\n-         * @since 2.15\n-         */\n-        protected volatile EnumResolver _byIndexResolver;\n-\n-        /**\n-         * Look up map with <b>key</b> as <code>Enum.name()</code> converted by\n-         * {@link EnumNamingStrategy#convertEnumToExternalName(String)}\n-         * and <b>value</b> as Enums.\n-         *\n-         * @since 2.15\n-         */\n-        protected final EnumResolver _byEnumNamingResolver;\n-\n-        protected final Enum<?> _enumDefaultValue;\n-\n-        protected EnumKD(EnumResolver er, AnnotatedMethod factory) {\n-            super(-1, er.getEnumClass());\n-            _byNameResolver = er;\n-            _factory = factory;\n-            _enumDefaultValue = er.getDefaultValue();\n-            _byEnumNamingResolver = null;\n-        }\n-\n-        /**\n-         * @since 2.15\n-         */\n-        protected EnumKD(EnumResolver er, AnnotatedMethod factory, EnumResolver byEnumNamingResolver) {\n-            super(-1, er.getEnumClass());\n-            _byNameResolver = er;\n-            _factory = factory;\n-            _enumDefaultValue = er.getDefaultValue();\n-            _byEnumNamingResolver = byEnumNamingResolver;\n-        }\n-\n-        @Override\n-        public Object _parse(String key, DeserializationContext ctxt) throws IOException\n-        {\n-            if (_factory != null) {\n-                try {\n-                    return _factory.call1(key);\n-                } catch (Exception e) {\n-                    ClassUtil.unwrapAndThrowAsIAE(e);\n-                }\n-            }\n-\n-            EnumResolver res = _resolveCurrentResolver(ctxt);\n-            Enum<?> e = res.findEnum(key);\n-            // If enum is found, no need to try deser using index\n-            if (e == null && ctxt.isEnabled(EnumFeature.READ_ENUM_KEYS_USING_INDEX)) {\n-                res = _getIndexResolver(ctxt);\n-                e = res.findEnum(key);\n-            }\n-            if (e == null) {\n-                if ((_enumDefaultValue != null)\n-                        && ctxt.isEnabled(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_USING_DEFAULT_VALUE)) {\n-                    e = _enumDefaultValue;\n-                } else if (!ctxt.isEnabled(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_AS_NULL)) {\n-                    return ctxt.handleWeirdKey(_keyClass, key, \"not one of the values accepted for Enum class: %s\",\n-                        res.getEnumIds());\n-                }\n-                // fall-through if problems are collected, not immediately thrown\n-            }\n-            return e;\n-        }\n-\n-        /**\n-         * @since 2.15\n-         */\n-        protected EnumResolver _resolveCurrentResolver(DeserializationContext ctxt) {\n-            if (_byEnumNamingResolver != null) {\n-                return _byEnumNamingResolver;\n-            }\n-            return ctxt.isEnabled(DeserializationFeature.READ_ENUMS_USING_TO_STRING)\n-                ? _getToStringResolver(ctxt)\n-                : _byNameResolver;\n-        }\n-\n-        private EnumResolver _getToStringResolver(DeserializationContext ctxt)\n-        {\n-            EnumResolver res = _byToStringResolver;\n-            if (res == null) {\n-                synchronized (this) {\n-                    res = _byToStringResolver;\n-                    if (res == null) {\n-                        res = EnumResolver.constructUsingToString(ctxt.getConfig(),\n-                            _byNameResolver.getEnumClass());\n-                        _byToStringResolver = res;\n-                    }\n-                }\n-            }\n-            return res;\n-        }\n-\n-        private EnumResolver _getIndexResolver(DeserializationContext ctxt) {\n-            EnumResolver res = _byIndexResolver;\n-            if (res == null) {\n-                synchronized (this) {\n-                    res = _byIndexResolver;\n-                    if (res == null) {\n-                        res = EnumResolver.constructUsingIndex(ctxt.getConfig(),\n-                            _byNameResolver.getEnumClass());\n-                        _byIndexResolver = res;\n-                    }\n-                }\n-            }\n-            return res;\n-        }\n-    }\n-\n-    /**\n-     * Key deserializer that calls a single-string-arg constructor\n-     * to instantiate desired key type.\n-     */\n-    final static class StringCtorKeyDeserializer extends StdKeyDeserializer\n-    {\n-        private static final long serialVersionUID = 1L;\n-\n-        protected final Constructor<?> _ctor;\n-\n-        public StringCtorKeyDeserializer(Constructor<?> ctor) {\n-            super(-1, ctor.getDeclaringClass());\n-            _ctor = ctor;\n-        }\n-\n-        @Override\n-        public Object _parse(String key, DeserializationContext ctxt) throws Exception\n-        {\n-            return _ctor.newInstance(key);\n-        }\n-    }\n-\n-    /**\n-     * Key deserializer that calls a static no-args factory method\n-     * to instantiate desired key type.\n-     */\n-    final static class StringFactoryKeyDeserializer extends StdKeyDeserializer\n-    {\n-        private static final long serialVersionUID = 1L;\n-\n-        final Method _factoryMethod;\n-\n-        public StringFactoryKeyDeserializer(Method fm) {\n-            super(-1, fm.getDeclaringClass());\n-            _factoryMethod = fm;\n-        }\n-\n-        @Override\n-        public Object _parse(String key, DeserializationContext ctxt) throws Exception\n-        {\n-            return _factoryMethod.invoke(null, key);\n-        }\n-    }\n-}\n-\ndiff --git a/src/test/java/com/fasterxml/jackson/databind/deser/jdk/LocaleDeser4009Test.java b/src/test/java/com/fasterxml/jackson/databind/deser/jdk/LocaleDeser4009Test.java\nindex 1f7e65ef5..b133a340f 100644\n--- a/src/test/java/com/fasterxml/jackson/databind/deser/jdk/LocaleDeser4009Test.java\n+++ b/src/test/java/com/fasterxml/jackson/databind/deser/jdk/LocaleDeser4009Test.java\n@@ -19,7 +19,10 @@ public class LocaleDeser4009Test extends BaseMapTest\n \n     public void testLocaleWithFeatureEnabled() throws Exception \n     {\n-        assertNull(MAPPER.readerFor(Locale.class)\n+        // 06-Jul-2023, tatu: as per [databind#4009] should not become 'null'\n+        //   just because\n+        assertEquals(Locale.ROOT,\n+            MAPPER.readerFor(Locale.class)\n                 .with(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT)\n                     .readValue(\"\\\"\\\"\"));\n     }\n"}
{"org": "fasterxml", "repo": "jackson-databind", "number": "4050", "fix_patch": "diff --git a/pom.xml b/pom.xml\nindex e43b8115a..69a351517 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -9,11 +9,11 @@\n   <parent>\n     <groupId>com.fasterxml.jackson</groupId>\n     <artifactId>jackson-base</artifactId>\n-    <version>2.16.0-SNAPSHOT</version>\n+    <version>2.16.3-SNAPSHOT</version>\n   </parent>\n   <groupId>com.fasterxml.jackson.core</groupId>\n   <artifactId>jackson-databind</artifactId>\n-  <version>2.16.0-SNAPSHOT</version>\n+  <version>2.16.3-SNAPSHOT</version>\n   <name>jackson-databind</name>\n   <packaging>jar</packaging>\n   <description>General data-binding functionality for Jackson: works on core streaming API</description>\ndiff --git a/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java b/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java\nindex 4610a58e5..bcb032f5c 100644\n--- a/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java\n+++ b/src/main/java/com/fasterxml/jackson/databind/ObjectMapper.java\n@@ -3521,7 +3521,7 @@ public class ObjectMapper\n \n         // inlined 'writeValue' with minor changes:\n         // first: disable wrapping when writing\n-        final SerializationConfig config = getSerializationConfig().without(SerializationFeature.WRAP_ROOT_VALUE);\n+        final SerializationConfig config = getSerializationConfig();\n         final DefaultSerializerProvider context = _serializerProvider(config);\n \n         // Then create TokenBuffer to use as JsonGenerator\n@@ -4510,7 +4510,7 @@ public class ObjectMapper\n     {\n         // inlined 'writeValue' with minor changes:\n         // first: disable wrapping when writing\n-        final SerializationConfig config = getSerializationConfig().without(SerializationFeature.WRAP_ROOT_VALUE);\n+        final SerializationConfig config = getSerializationConfig();\n         final DefaultSerializerProvider context = _serializerProvider(config);\n \n         // Then create TokenBuffer to use as JsonGenerator\ndiff --git a/src/test/java/com/fasterxml/jackson/databind/node/TestConversions.java b/src/test/java/com/fasterxml/jackson/databind/node/TestConversions.java\nindex 2f4b4a524..9a3bc07d2 100644\n--- a/src/test/java/com/fasterxml/jackson/databind/node/TestConversions.java\n+++ b/src/test/java/com/fasterxml/jackson/databind/node/TestConversions.java\n@@ -1,5 +1,6 @@\n package com.fasterxml.jackson.databind.node;\n \n+import com.fasterxml.jackson.annotation.JsonRootName;\n import java.io.IOException;\n import java.math.BigDecimal;\n import java.util.*;\n@@ -108,6 +109,13 @@ public class TestConversions extends BaseMapTest\n         }\n     }\n \n+    // [databind#4047]\n+    @JsonRootName(\"event\")\n+    static class Event {\n+        public Long id;\n+        public String name;\n+    }\n+\n     /*\n     /**********************************************************\n     /* Unit tests\n@@ -363,4 +371,22 @@ public class TestConversions extends BaseMapTest\n         result = MAPPER.treeToValue(node, MAPPER.constructType(ObjectNode.class));\n         assertSame(src, result);\n     }\n+\n+    // [databind#4047] : ObjectMapper.valueToTree will ignore the configuration SerializationFeature.WRAP_ROOT_VALUE\n+    public void testValueToTree() throws Exception\n+    {\n+        // Arrange\n+        Event value = new Event();\n+        value.id = 1L;\n+        value.name = \"foo\";\n+\n+        ObjectMapper wrapRootMapper = jsonMapperBuilder()\n+                .enable(SerializationFeature.WRAP_ROOT_VALUE)\n+                .build();\n+\n+        // Act & Assert\n+        String expected = \"{\\\"event\\\":{\\\"id\\\":1,\\\"name\\\":\\\"foo\\\"}}\";\n+        assertEquals(expected, wrapRootMapper.writeValueAsString(value));\n+        assertEquals(expected, wrapRootMapper.valueToTree(value).toString());\n+    }\n }\n"}
